/*
 Textbox.io JavaScript Library
 Copyright (c) 2013-2017 Ephox Corp. All rights reserved.
 This software is provided "AS IS," without a warranty of any kind.

 Version: 2.4.1.70
 Client Build: 2.4.1.130
*/
(function(){function hv(){return{major:"2",minor:"4",full:"2.4.1.70"}}function zO(){var a=g.none(),b=function(b){a=g.some(b.api)};return{add:function(c){var d=t(b,c);a.isNone()&&b(c);c.api.events.focus.addListener(d)},get:function(){return a},remove:function(b){a.is(b.api)&&(a=g.none())}}}function AO(a,b,c){var d=g.from(a.ui.editorName).map(N.error);c=c.map(N.value);d=d.or(c).getOrThunk(function(){return N.value(BO())});c=iv.toolbar(a.platform.toolbar,b);b=iv.mentions(a.mentions,b);return cb(a,{ui:{editorName:d},
platform:{toolbar:c},mentions:b})}function CO(){var a=[];return{get:function(b){return va(a,function(a){return a.is(b)})},findAll:function(b){var c=za.all(b);return ka(a,function(a){return Va(c,a.is)})},add:function(b){a.push(b)},remove:function(b){zc(a,b).each(function(b){a.splice(b,1)})}}}function jv(a,b,c,d,e){return a(c,d)?g.some(c):wb(e)&&e(c)?g.none():b(c,d,e)}function Jb(a,b){A(b,function(b,d){if(d>a.length-1){if(b.required())throw Error('missing parameter "'+b.name()+'"');}else b.validate(a[d])})}
function DO(a){var b=sk.create(),c=Wb(a,function(a){var c=EO.create();b.bind(a,c.eventTrigger);return c});a=Wb(c,function(a){return a.eventRegistry});c=Wb(c,function(a){return a.eventTrigger});return{registry:a,trigger:c,destroy:function(){b.unbindAll()}}}function FO(){var a={};return{getOrSetIndexed:function(b,c){if(void 0!==a[b])return a[b];c=c();return a[b]=c},waitForLoad:function(){var b=se(a);return tk(b,Ba.nu)}}}function kv(){var a=FO(),b=function(){return a.waitForLoad()};return{preload:function(){b().get(aa)},
addStylesheet:function(b,d){return a.getOrSetIndexed(b,function(){return GO.download(b,d)})},addScript:function(b,d){return a.getOrSetIndexed(b,function(){return HO.download(b).map(d)})},waitForLoad:b}}function IO(a){var b=function(b,c,f){Jb(arguments,[X.func("filter"),X.string("selector"),X.func("callback")]);var d=b(c,lv(f));a.filter().customFilters().addFilter(d)},c=function(b,c,f){Jb(arguments,[X.func("filter"),X.func("predicate"),X.func("callback")]);var d=b(JO(c),lv(f));a.filter().customFilters().addFilter(d)};
return{selector:{addInput:t(b,ei.inputSelector),addOutput:t(b,ei.outputSelector)},predicate:{addInput:t(c,ei.inputPredicate),addOutput:t(c,ei.outputPredicate)}}}function Eo(a,b,c,d){return{term:function(){return new RegExp(a,d.getOr("g"))},prefix:b,suffix:c}}function KO(a,b,c){var d=sb.sanitise(a),e=sb.sanitise(b);return{patterns:function(){return[new RegExp(d+"(.*?)"+e,"gi")]},useCursor:xb,generate:function(a,b){return c.generate(a,b.key(),b.value())},derive:function(a){var b=a[1];return c.get(b).map(function(c){return{startIndex:k(a.index),
finishIndex:k(a.index+a[0].length),key:k(b),value:k(c)}})}}}function mv(a,b,c){return KO(a,b,{get:function(a){a=c(a);return g.some(a)},generate:function(a,b,c){a=te.fromHtml(c,a.dom());return Gd.species({elements:k(a),cursor:g.none,dictation:g.none,notify:g.none})}})}function nv(a,b){var c=function(a){try{return d(a)}catch(l){return g.none()}},d=function(b){return a(b)?g.from(b.dom().nodeValue):g.none()},e=ba.detect().browser,f=e.isIE()&&10===e.version.major?c:d;return{get:function(c){if(!a(c))throw Error("Can only get "+
b+" value of a "+b+" node");return f(c).getOr("")},getOption:f,set:function(c,d){if(!a(c))throw Error("Can only set raw "+b+" value of a "+b+" node");c.dom().nodeValue=d}}}function gb(){return{up:k({selector:L.ancestor,closest:L.closest,predicate:Da.ancestor,all:B.parents}),down:k({selector:ca.descendants,predicate:Cc.descendants}),styles:k({get:v.get,getRaw:v.getRaw,set:v.set,remove:v.remove}),attrs:k({get:m.get,set:m.set,remove:m.remove,copyTo:function(a,b){a=m.clone(a);m.setAll(b,a)}}),insert:k({before:y.before,
after:y.after,afterAll:O.after,append:y.append,appendAll:O.append,prepend:y.prepend,wrap:y.wrap}),remove:k({unwrap:E.unwrap,remove:E.remove}),create:k({nu:p.fromTag,clone:function(a){return p.fromDom(a.dom().cloneNode(!1))},text:p.fromText}),query:k({comparePosition:function(a,b){return a.dom().compareDocumentPosition(b.dom())},prevSibling:B.prevSibling,nextSibling:B.nextSibling}),property:k({children:B.children,name:C.name,parent:B.parent,isText:C.isText,isComment:C.isComment,isElement:C.isElement,
getText:Oa.get,setText:Oa.set,isBoundary:function(a){return C.isElement(a)?"body"===C.name(a)?!0:V(LO,C.name(a)):!1},isEmptyTag:function(a){return C.isElement(a)?V(["br","img","hr","input"],C.name(a)):!1}}),eq:P.eq,is:P.is}}function MO(a,b,c){var d=DO({loaded:a.events.loaded,focus:a.events.focus,change:a.events.change,dirty:a.events.dirty,internal:a.events.internal}),e=function(a,b){var c=B.owner(a);a=B.defaultView(a);c=Pa.get(c);b=b();a.dom().scrollTo(c.left(),c.top());return b},f=t(Fo.getText,a),
h=uk.makeReadOnly({content:{documentElement:t(ld.documentElement,a),insertHtmlAtCursor:t(ld.insertHtmlAtCursor,a),uploadImages:t(ld.uploadImages,a),get:t(ld.get,a),set:t(ld.set,a),isDirty:t(ld.isDirty,a),setDirty:t(ld.setDirty,a),selection:{findTagAtCursor:t(Fo.findTagAtCursor,a),getText:f,getHtml:t(Fo.getHtml,a)},getSelectedText:f},mode:{set:t(ov.set,a),get:t(ov.get,a)},filters:IO(a),macros:{addSimpleMacro:t(pv.addSimpleMacro,a),removeMacro:t(pv.removeMacro,a)},message:t(NO.message,a),events:d.registry,
element:function(){return a.element().dom()},focus:a.focus,restore:Xb(function(){return e(a.element(),function(){OO.blur();var b=ld.get(a);d.destroy();a.destroy();return c.restore(b)})})});A(b,function(a){Go.hookup(h,a)});return h}function PO(){var a=zO(),b=CO(),c=function(a){return a.api},d=function(c,d){var e=AO(d.options(),function(){return f.getOrDie("Internal Error")},g.from(m.get(c,"id"))),f=QO.one(c,d.constructors(),e).map(function(d){var f=MO(d.polish,e&&e.plugins?e.plugins:[],{restore:function(c){b.remove(h);
a.remove(h);return d.restore(c).dom()}}),h={is:function(a){return P.eq(c,a)},api:f};b.add(h);a.add(h);return f});return f};return{getOrCreate:function(a,f){return b.get(a).map(c).orThunk(function(){return d(a,f)})},get:function(a){a=b.findAll(a);return F(a,c)},getActiveEditor:a.get}}function Ho(a,b,c){var d=c||!1,e=function(){b();d=!0},f=function(){a();d=!1};return{on:e,off:f,toggle:function(){(d?f:e)()},isOn:function(){return d}}}function q(a){var b=M.apply(null,a),c=[];return{bind:function(a){if(void 0===
a)throw"Event bind error: undefined handler";c.push(a)},unbind:function(a){c=ka(c,function(b){return b!==a})},trigger:function(){var a=b.apply(null,arguments);A(c,function(b){b(a)})}}}function qv(a,b){var c=function(c){var d=b(c);return 0>=d||null===d?(c=v.get(c,a),parseFloat(c)||0):d},d=function(a,b){return hb(b,function(b,c){c=v.get(a,c);c=void 0===c?0:parseInt(c,10);return isNaN(c)?b:b+c},0)};return{set:function(b,c){if(!df(c)&&!c.match(/^[0-9]+$/))throw a+".set accepts only positive integer values. Value was "+
c;b=b.dom();ue.isSupported(b)&&(b.style[a]=c+"px")},get:c,getOuter:c,aggregate:d,max:function(a,b,c){a=d(a,c);return b>a?b-a:0}}}function md(a){return RO(a,function(){return{bind:u,unbind:u}})}function rv(a){a=Ga(a.dirty);var b=a.get,c=a.set,d=G.create({dirty:q([]),clean:q([])}),e=nd.tap(function(a){var f=b();a!==f&&(c(a),!0===a?d.trigger.dirty():(e.control.block(),d.trigger.clean(),e.control.unblock()))});return{events:d.registry,isDirty:b,setDirty:e.instance,state:function(){return{dirty:b()}}}}
function sv(a,b,c){var d=[],e=t(b,"input"),f=t(b,"output"),h=t(c,"input"),l=t(c,"output");b=function(a){ei.cata(a,e,f,h,l);d.push(a)};A(a.customs,b);return{state:function(){return{customs:d.slice(0)}},addFilter:b}}function Io(a){var b={};Ra(a,function(a,d){b[d]=a});return{get:function(){return se(b)},add:function(a){var c=Za("macro");b[c]=a;return c},remove:function(a){delete b[a]},state:function(){return ra({},b)}}}function SO(){var a=u;return Jo({setAutocorrect:u,setSpelling:u,events:md(["analytics"]),
init:function(b){b.body().each(function(b){m.set(b,"spellcheck","false");a=function(){m.remove(b,"spellcheck")}})},ui:g.none,check:u,scanView:u,situation:Tf.noSituation,hasDropdown:k(!1),hasAutocorrect:k(!1),handle:u,assign:u,lock:pb,destroy:function(){a()},state:k({}),lookup:k(g.none()),name:k("spelling-disabled")})}function Q(a,b){var c=q(a),d=0,e=function(b){var d=F(a,function(a){return b[a]()});c.trigger.apply(null,d)};return{bind:function(a){c.bind(a);d++;1===d&&b.bind(e)},unbind:function(a){c.unbind(a);
d--;0===d&&b.unbind(e)},trigger:yb("Cannot trigger a source event.")}}function tv(a,b,c){var d=Ja.state(c),e=g.none(),f=g.none(),h=G.create({loaded:q([]),focus:q([]),dirty:Q([],d.laundry.events.dirty),change:q([]),internal:q(["command","data"]),paint:q(["dimensions"])}),l=S.div();ja.add(l,[z.resolve("source-container"),"ephox-textbox-font",z.resolve("layer-editor")]);c=function(){return l};var r=function(){return f.getOrDie("CodeMirror not added to DOM")},D=function(a){return U()?uv.beautify(a):a},
x=function(a){var b=r().doc;a=D(a);b.setValue(a);b.clearHistory()},H=function(a){var b=p.fromDom(a.getWrapperElement()),c=-1;a.on("changes",function(){var d=a.doc.lineCount();d!=c&&(c=d,d=a.getScrollInfo(),d=vv({width:Aa.get(b),docWidth:d.width,height:d.height,docHeight:d.height}),h.trigger.paint(d))})},I=function(){r().focus()},U=function(){return!0===a.content.prettyprint};return fi.internal({activateInline:od.activateInline,blur:yb("blur is not supported in the API."),communication:Ja.communication,
connect:function(c){if(a.content&&!0===a.content.autoresize){var d=c.dom().clientHeight;pa.set(l,d)}y.append(c,l);b.updateUi(l);gi.detect(l);c=vk.use.codemirror()(l.dom(),{mode:"text/html",extraKeys:{"Ctrl-Space":"autocomplete"},lineWrapping:!0});c.on("focus",function(){h.trigger.focus()});f=g.some(c);h.trigger.loaded();H(c);return!0},content:k({body:k(g.none()),doc:yb("content.doc is not supported in code view"),execCommand:yb("content.execCommand is not supported in code view"),getSelectedText:function(){var a=
r().getSelection();return void 0!==a&&null!==a&&0<a.length?g.some(a):g.none()},focus:I,isInline:k(!1)}),deactivateInline:od.deactivateInline,destroy:function(){E.remove(l);E.empty(l);f=g.none()},element:c,events:h.registry,filter:d.filter,focus:I,fromTransfer:function(a){var b=function(a){x(a);e=g.some(a);f.each(function(a){a.on("changes",function(a,b){d.laundry.setDirty(!0);h.trigger.change()})})};ef.cata(a,b,b)},fullscreen:Ja.fullscreen,getContent:function(){return r().doc.getValue()},getMode:Yb.code,
insertHtmlAtCursor:function(a){r().replaceSelection(a)},isDirty:d.laundry.isDirty,isPrettyPrinting:U,keyboard:od.keyboard,macros:d.macros,operations:od.operations,setContent:function(a){x(a);d.laundry.setDirty(!1)},setDirty:d.laundry.setDirty,smartview:od.smartview,state:function(){return d.getState({content:{}})},toTransfer:function(){var a=r().doc.getValue();return e.filter(function(b){return D(b)===a}).fold(function(){return ef.changed(a)},ef.unchanged)},ui:od.ui,undo:k(Ja.undo()),uploader:k(Ja.uploader()),
viewport:c})}function UO(a){var b=S.span();n.add(b,na.resolve("toolbar-group"));var c=F(a,function(a){return a.component()});O.append(b,c);return wv.group({component:function(){return b},isVisible:function(){return Va(c,hi.isShowing)},refreshUi:function(){A(a,function(a){a.refreshUi()})},destroy:function(){A(a,function(a){a.destroy()})}})}function Lo(a,b,c){n.add(a,eb.resolve("button"));var d=VO.disable(a);b=b.getOr(a);var e=null,f=n.toggler(a,eb.resolve("button-disabled")),h=function(){f.isOn()||
r.trigger.click()},l=J.bind(b,"click",h),r=G.create({click:q([])});return{element:function(){return a},name:function(){return c},destroy:function(){l.unbind();d.unbind();E.remove(a)},content:function(b){null!==e&&E.remove(e.element());y.append(a,b.element());e=b},enable:f.off,disable:f.on,disabled:f.isOn,click:h,events:r.registry}}function Dc(a){var b=p.fromTag("span");n.add(b,eb.resolve("independent-button"));return Lo(b,g.none(),a)}function ve(a){var b=S.span();m.set(b,"aria-hidden",!0);ja.add(b,
[eb.resolve("icon-content")].concat(a));return{element:function(){return b},destroy:function(){E.remove(b)}}}function Mo(a){var b=S.span();n.add(b,eb.resolve("statebutton"));var c=Lo(S.span(),g.some(b),a);n.add(c.element(),eb.resolve("dependent-button"));y.append(b,c.element());a=n.toggler(b,eb.resolve("statebutton-selected"));var d=n.toggler(b,eb.resolve("statebutton-disabled"));return{element:function(){return b},destroy:function(){c.destroy();E.remove(b)},name:c.name,content:c.content,enable:function(){d.off();
c.enable()},disable:function(){d.on();c.disable()},disabled:function(){return d.isOn()&&c.disabled()},click:c.click,events:c.events,select:a.on,deselect:a.off,selected:a.isOn}}function Hd(a){var b=Mo(a),c=G.create({click:q([])}),d=function(){b.selected()?b.deselect():b.select();c.trigger.click()};b.events.click.bind(d);return{element:b.element,name:b.name,content:b.content,destroy:function(){b.events.click.unbind(d);b.destroy()},enable:b.enable,disable:b.disable,disabled:b.disabled,click:b.click,
events:c.registry,select:b.select,deselect:b.deselect,selected:b.selected}}function WO(a){var b=S.span();n.add(b,eb.resolve("dropbutton"));var c=S.span();n.add(c,eb.resolve("dropbutton-button"));var d=S.span();n.add(d,eb.resolve("dropbutton-arrow"));O.append(b,[c,d]);var e=Dc(),f=Hd();f.content(ve(["ephox-pastry-arrow-icon"]));y.append(c,e.element());y.append(d,f.element());var h=G.create({click:q([]),open:q([]),close:q([])}),l=function(){h.trigger.click()},r=function(){(f.selected()?h.trigger.open:
h.trigger.close)()};e.events.click.bind(l);f.events.click.bind(r);return{element:function(){return b},name:function(){return a},content:e.content,events:h.registry,open:function(){f.select();h.trigger.open()},close:function(){f.deselect();h.trigger.close()},destroy:function(){e.events.click.unbind(l);f.events.click.unbind(r);e.destroy();f.destroy();E.remove(b)},isOpen:function(){return f.selected()}}}function XO(a){var b=S.span();n.add(b,eb.resolve("dropbutton"));var c=S.span();n.add(c,eb.resolve("dropbutton-button"));
var d=S.span();n.add(d,eb.resolve("dropbutton-arrow"));O.append(b,[c,d]);var e=Hd(),f=Hd();f.content(ve(["ephox-pastry-arrow-icon"]));y.append(c,e.element());y.append(d,f.element());var h=G.create({click:q([]),open:q([]),close:q([])}),l=function(){h.trigger.click()},r=function(){(f.selected()?h.trigger.open:h.trigger.close)()};e.events.click.bind(l);f.events.click.bind(r);return{element:k(b),name:k(a),content:e.content,events:h.registry,open:function(){f.select();h.trigger.open()},close:function(){f.deselect();
h.trigger.close()},destroy:function(){e.events.click.unbind(l);f.events.click.unbind(r);e.destroy();f.destroy();E.remove(b)},isOpen:function(){return f.selected()},click:e.click,enable:e.enable,disable:e.disable,disabled:e.disabled,select:e.select,deselect:e.deselect,selected:e.selected}}function Rc(a){var b=S.span();n.add(b,eb.resolve("text-content"));y.append(b,p.fromText(a));return{element:function(){return b},destroy:function(){E.remove(b)}}}function wk(a){var b=Sd.resolve(a);return{set:function(a){n.add(a,
b)},up:function(a){return n.has(a,b)?g.some(a):L.ancestor(a,"."+b)},all:function(a){return ca.descendants(a,"."+b)},first:function(a){return L.descendant(a,"."+b)},is:function(a){return n.has(a,b)}}}function xv(a,b){b=void 0!==b?b:"info";var c=S.div();ja.add(c,[z.resolve("banner"),z.resolve("banner-"+b)]);b=S.div();n.add(b,z.resolve("banner-message"));y.append(b,p.fromText(a));var d=S.div();n.add(d,z.resolve("banner-buttons"));a=p.fromTag("span");n.add(a,z.resolve("banner-close"));y.append(d,a);T.button(a,
w.translate("banner.close"));O.append(c,[b,d]);var e=J.bind(a,"click",function(){f.trigger.close()}),f=G.create({close:q([])});return{element:function(){return c},action:function(a){y.prepend(d,a.element())},destroy:function(){e.unbind();E.remove(c)},events:f.registry}}function ii(a,b){b=void 0!==b?b:"error";var c=a.description();a=a.link();var d=xv(c,b),e=g.none(),f=function(a,b){return J.bind(a,"click",function(a){a.kill();window.open(b.url())})};b=function(a){var b=p.fromTag("a");m.set(b,"href",
a.url());m.set(b,"target","_blank");var c=p.fromText(a.text());e=g.some(f(b,a));y.append(b,c);d.action({element:k(b)})};null!==a&&a.url()&&a.text()&&b(a);return{element:d.element,action:d.action,destroy:function(){d.destroy();e.each(function(a){a.unbind()})},events:d.events}}function YO(a,b){var c=G.create({populate:q(["items"])}),d=function(b){var c=a(b.textkey);c=qb.item(ZO,b.name+"-menu-trigger",c);n.add(c,na.resolve("menu-more"));b=ji.generate("ephox-chameleon-"+b.name);O.prepend(c,b);T.menuItem(c,
g.none(),g.some(!0));return c}(b),e=function(a){a=p.fromText(a);f(a)},f=function(a){L.child(d,".ephox-gopher-item-text").each(function(b){E.empty(b);y.append(b,a);n.remove(b,yv)})},h=Kg.control(d);return{element:k(d),populate:function(a){c.trigger.populate(a)},select:function(c){L.child(d,bb.tokenSelector()).each(E.remove);var f=bb.describe(d,b.describe(c));y.append(d,f);c=a(c.textkey());e(c)},selectElement:f,disable:h.disable,enable:h.enable,clear:function(){e(a(b.textkey));L.child(d,".ephox-gopher-item-text").each(function(a){n.add(a,
yv)})},destroy:function(){E.remove(d)},events:c.registry}}function $O(a,b){var c=b?a.slice(0):[],d=b,e=b?F(se(R),function(a){return a()}):[];return{swallowShortcuts:function(a){c=a.slice(0)},yieldShortcuts:function(a){c=No(c,a)},swallowChars:function(){d=!0},yieldChars:function(){d=!1},swallowKeys:function(a){e=a.slice(0)},yieldKeys:function(a){e=No(e,a)},process:function(a,b){a.fold(function(a){V(c,a)&&b()},function(a){V(e,a)&&b()},function(){d&&b()})}}}function aP(a,b){var c=!1,d=$O(a,b);return{on:function(){c=
!0},off:function(){c=!1},isOn:function(){return c},handle:function(a){return function(b){c&&a(b.raw())}},stop:function(b){var c=bP.identify(b,a);d.process(c,t(zv.stop,b))},swallowShortcuts:d.swallowShortcuts,yieldShortcuts:d.yieldShortcuts,swallowChars:d.swallowChars,yieldChars:d.yieldChars,swallowKeys:d.swallowKeys,yieldKeys:d.yieldKeys}}function ki(a){var b=ra({shortcuts:[],swallow:!1},a),c=G.create({character:q(["character"]),space:q(["shift","stopper"]),left:q(["shift","stopper"]),right:q(["shift",
"stopper"]),backspace:q(["shift","stopper"]),tab:q(["shift","stopper"]),enter:q(["shift","stopper"]),capslock:q(["shift","stopper"]),escape:q(["shift","stopper"]),pageup:q(["shift","stopper"]),pagedown:q(["shift","stopper"]),end:q(["shift","stopper"]),home:q(["shift","stopper"]),down:q(["shift","stopper"]),up:q(["shift","stopper"]),insert:q(["shift","stopper"]),del:q(["shift","stopper"]),command:q(["command"])}),d=aP(b.shortcuts,b.swallow),e=function(a){return va(b.shortcuts,function(b){return Av.isCommand(a,
b)})},f=function(a,b,d){l(a);c.trigger[b].apply(void 0,d)},h=function(a){return function(){d.isOn()&&zv.stop(a)}};a=d.handle(function(a){e(a).fold(function(){var b=Vf.getSpecial(a.keyCode);Vf.noModifiers(a)&&null!==b&&(b=b.toLowerCase(),f(a,b,[a.shiftKey,h(a)]))},function(b){f(a,"command",[b])})});var l=function(a){d.isOn()&&d.stop(a)},r=d.handle(function(a){if(Vf.noModifiers(a))Vf.isCharCode(a)||null===Vf.getSpecial(a.keyCode)?e(a).isSome()?l(a):a.which&&f(a,"character",[String.fromCharCode(a.which)]):
l(a);else return!1});return{off:d.off,on:d.on,events:c.registry,swallowShortcuts:d.swallowShortcuts,yieldShortcuts:d.yieldShortcuts,swallowChars:d.swallowChars,yieldChars:d.yieldChars,swallowKeys:d.swallowKeys,yieldKeys:d.yieldKeys,keypress:r,keydown:a}}function cP(a){var b=G.create({mouseover:q(["item"]),click:q(["item"])}),c=[],d=ki({shortcuts:a.shortcuts,swallow:a.swallow});a=a.tabs?[R.TAB()]:[];d.swallowKeys([R.UP(),R.DOWN(),R.ENTER(),R.SPACE(),R.ESCAPE()].concat(a));var e=function(){A(c,function(a){a.mouseover().unbind();
a.click().unbind();a.keydown().unbind()});c=[];d.off()};return{destroy:function(){e()},attach:function(a){e();c=F(a,function(a){var c=J.bind(a,"mouseover",function(a){tc.up(a.target()).each(b.trigger.mouseover)}),e=J.bind(a,"click",function(a){tc.up(a.target()).each(b.trigger.click)});a=J.bind(a,"keydown",function(a){d.keydown(a)});return{mouseover:k(c),click:k(e),keydown:k(a)}});d.on()},detach:e,simulateKey:function(a){d.keydown(a)},events:b.registry,keys:d.events}}function dP(a,b){var c=G.create({select:q(["item"]),
active:q(["item"]),show:q(["menu"]),hide:q(["menu"]),collapse:q(["menu"]),expand:q(["menu","trigger"]),escaped:q([])}),d=cP({shortcuts:[],swallow:[],tabs:b.tabs}),e={},f=function(b){pd.activate(a,b)},h=function(){var b=pd.inactive(a);A(b,function(a){ff.submenu().is(a)&&c.trigger.hide(a)})},l=function(b){tc.isEnabled(b)&&pd.submenu(a,e,b).each(function(a){c.trigger.expand(a,b)})},r=function(a){pd.up(a).each(function(b){f(b);qd.selectAll(b,[a]);c.trigger.active(a)})},D=function(b){pd.active(a).bind(function(a){qd.selected(a).orThunk(function(){return Oo.first(a)}).each(function(c){b(a,
c)})})},x=function(a){D(function(b,c){tc.isEnabled(c)&&a(b,c)})},g=function(b){D(function(d,f){b(d,f).each(function(b){P.eq(f,b)||(pd.submenu(a,e,f).each(c.trigger.collapse),c.trigger.active(b))})})},I=t(g,Oo.prev),U=t(g,Oo.next),Qa=function(){ff.main().first(a).each(function(a){f(a);qd.selected(a).each(c.trigger.active)})},m=function(b){Y.active().fold(b.stopper(),function(a){!1===V(["input"],C.name(a))&&b.stopper()()});x(function(b,d){pd.submenu(a,e,d).fold(function(){ff.submenu().is(b)&&(c.trigger.collapse(b),
Qa())},function(a){c.trigger.expand(a,d);qd.none(a);qd.first(a).each(c.trigger.active);f(a)})})};g=function(a){Y.active().fold(a.stopper(),function(b){!1===V(["input"],C.name(b))&&a.stopper()()});x(function(a,b){ff.submenu().is(a)&&(c.trigger.collapse(a),Qa())})};var n=function(a){x(function(b,d){b=tc.get(d);e.hasOwnProperty(b)&&void 0!==e[b]?m(a):c.trigger.select(d)})},Uf=function(a){a.shift()?I(a):U(a)};d.keys.up.bind(I);d.keys.down.bind(U);b.tabs&&d.keys.tab.bind(Uf);d.keys.enter.bind(n);d.keys.space.bind(n);
d.keys.escape.bind(function(a){a.stopper()();D(function(a,b){ff.submenu().is(a)?(c.trigger.collapse(a),Qa()):c.trigger.escaped()})});"ltr"===we.getDirection(a)?(d.keys.left.bind(g),d.keys.right.bind(m)):(d.keys.right.bind(g),d.keys.left.bind(m));d.events.mouseover.bind(function(b){b=b.item();qd.is(b)&&pd.submenu(a,e,b).forall(kc.isVisible)||(r(b),h(),l(b))});d.events.click.bind(function(a){a=a.item();var b=tc.get(a);e.hasOwnProperty(b)&&void 0!==e[b]||!tc.isEnabled(a)||c.trigger.select(a)});return{destroy:function(){d.destroy()},
populate:function(a){e=ra({},a)},on:function(a){a=void 0!==a?a:[p.fromDom(document)];d.attach(a)},off:function(){d.detach()},selectFirst:function(){pd.active(a).each(function(a){qd.none(a);qd.first(a).each(c.trigger.active)})},select:function(a){r(a);h()},setActiveMenu:f,simulateKey:d.simulateKey,state:function(){return pd.active(a).bind(function(a){return qd.selected(a).map(function(b){return{menu:k(a),item:k(b)}})})},events:c.registry}}function Po(a,b,c){var d=S.div();n.add(d,na.resolve("menu-"+
b()+"-sandbox"));m.set(d,"tabindex",-1);y.append(a(),d);var e=g.none(),f=dP(d,{tabs:!0}),h=Ga({}),l=function(){f.off();x();D.trigger.close()},r=function(a){var b=xk(h.get(),M("submenu","item")),c=m.get(a,"data-ephox-gopher-menu-value");return va(b,function(a){return a.submenu()===c}).bind(function(b){return L.descendant(d,"[data-ephox-gopher-item-value="+b.item()+"]").map(function(b){return{menu:k(a),item:k(b)}})})};a=function(a){var b=r(a.menu()).map(function(a){return a.item()});D.trigger.collapse(a.menu(),
b)};var D=G.create({open:q([]),close:q([]),itemAction:q(["value","item"]),itemHover:Q(["item"],f.events.active),reveal:Q(["menu","trigger"],f.events.expand),collapse:q(["menu","item"]),escaped:Q([],f.events.escaped)});f.events.hide.bind(a);f.events.collapse.bind(a);f.events.escaped.bind(function(){f.state().fold(l,function(a){r(a.menu()).fold(function(){l()},function(a){D.trigger.collapse(a.menu(),g.some(a.item()));f.select(a.item())})})});f.events.select.bind(function(a){a=a.item();var b=m.get(a,
"data-ephox-gopher-item-value");D.trigger.itemAction(b,a)});f.events.active.bind(function(a){c.focusActive()&&Y.focusInside(a.item())});var x=function(){Ra(h.get(),function(a,b){L.descendant(d,'[data-ephox-gopher-menu-value="'+a+'"]').each(function(a){var c=L.descendant(d,'[data-ephox-gopher-item-value="'+b+'"]');D.trigger.collapse(a,c)})})};return{update:function(a){h.set(a);f.populate(a)},setActiveMenu:function(a){e=g.from(a);f.setActiveMenu(a);f.selectFirst()},getActiveMenu:function(){return e},
structure:h,destroy:function(){l();f.destroy()},open:function(a,b){Y.focus(b);f.on(a);D.trigger.open()},close:l,events:D.registry,sandbox:k(d),select:f.select,simulateKey:f.simulateKey}}function Lg(a,b){return{southeast:k(Ma(-a,b)),southwest:k(Ma(a,b)),northeast:k(Ma(-a,-b)),northwest:k(Ma(a,-b))}}function yk(){return{northwest:function(){return Ma(-2,1)},northeast:function(){return Ma(0,1)},southwest:function(){return Ma(-2,-2)},southeast:function(){return Ma(0,-2)}}}function Bv(a,b,c){c=c||[p.fromDom(document)];
var d=[],e=function(c){var d=b();c=c.target();P.member(c,d)||eP.anyAncestor(c,d)||a(c)};return{on:function(){A(c,function(a){d.push(J.bind(a,"mousedown",e).unbind)})},off:function(){A(d,pb)},mousedown:e}}function fP(a){var b=ra({layerClass:null,zindex:null},a),c=S.div();n.add(c,eb.resolve("panel"));v.setAll(c,{position:"fixed",display:"none",top:"0px"});b.zindex&&v.set(c,"z-index",b.zindex);b.layerClass&&n.add(c,b.layerClass);a=void 0!==a.container?a.container:L.first("body").getOrDie();y.append(a,
c);a=kc.displayToggler(c,"block");return{element:function(){return c},destroy:function(){E.remove(c)},content:function(a){E.empty(c);y.append(c,a)},show:a.on,hide:a.off,toggle:a.toggle}}function li(a,b,c,d,e){var f=[],h=function(){var a=F(f,function(a){return a.popup().panel()}).concat(d);A(f,function(b){b.popup().setComponents(a)})},l=function(a){var b=zk.get(f,a,Ak(a)).fold(function(){return D(a)},function(a){return a.popup()});h();f=zk.put(f,a,b,Cv,Ak(a));return b},r=function(a){zk.get(f,a,Ak(a)).each(function(a){a.popup().close()});
v.set(a,"display","none")},D=function(b){var c=gP.create(a,e);c.setContent(b);f=zk.put(f,b,c,Cv,Ak(b));h();return c};return{initMenu:D,registerMenus:function(a){f=hP.triage(f);return F(a,l)},hideAll:function(){A(f,function(a){r(a.menu())})},hideMenu:r,expandMenu:function(d,e){var f=l(d),h=tb.descendant(d,"."+Bk.styles())?xe.expandable():xe.anchored();e=Wf.submenu(a,b,k(e),c.uiDirection(),h);v.set(d,"display","block");f.open();e.recalculate(f);return{popup:f,anchorage:e}}}}function Dv(a,b){var c=S.span();
ja.add(c,[eb.resolve("righticon-content"),b]);y.append(c,a);return{element:function(){return c},destroy:function(){E.remove(c)}}}function iP(a,b){var c=Rc(a),d=Dv(c.element(),b);return{element:d.element,destroy:function(){c.destroy();d.destroy()}}}function jP(a,b,c,d,e,f,h,l,r,D){var x=Hd(c);h=Qo.control(x);ja.add(x.element(),[na.resolve("dropdown-button"),na.resolve(c+"-dropdown-button")]);m.set(x.element(),"title",l(d));T.toolbarButton(x.element(),l(d),!0,r);var g=Po(a.uiContainer,k("dropdown-"+
c),mi.menu({focusActive:!0})),I=p.fromDom(document),U=qb.mainmenu(I,c+"-menu",[]),Qa=li(g.sandbox,a.bounds,b,[x.element()],D).initMenu(U);c=yk();var jc=Wf.main(a.uiContainer,a.bounds,x.element,c,b.uiDirection(),xe.anchored());T.menu(U,l(e));var Ko=Za("menu-control");m.set(U,"id",Ko);T.controls(x.element(),Ko);var Uf=S.span();n.add(Uf,na.resolve("dropdown-viewport"));x.content({element:k(Uf)});var Jg=function(a,b){b=b.map(ji.generate).getOr([]);O.prepend(a,b)};b=function(){v(l(d))};var v=function(a){E.empty(Uf);
y.append(Uf,iP(a,"ephox-pastry-arrow-righticon").element())},w=function(){x.deselect();r&&ma.pressed(x);ma.collapsed(x.element());T.disown(x.element());Qa.close();g.close()},z=function(){x.select();r&&ma.pressed(x);ma.expanded(x.element());T.owns(x.element(),Ko);Qa.open();var b=[a.uiContainer()];g.open(b,x.element())},Ev=G.create({select:Q(["value","item"],g.events.itemAction),itemHover:Q(["item"],g.events.itemHover),escaped:Q([],g.events.escaped),open:q(["menu","popup","anchor"]),close:Q([],g.events.close)});
x.events.click.bind(function(){(x.selected()?z:w)()});Qa.events.close.bind(w);g.events.open.bind(function(){Ev.trigger.open(U,Qa,jc);g.update({});kP()||g.setActiveMenu(U)});g.events.escaped.bind(w);b();return{element:k(x.element()),menu:Qa.element,list:k(U),click:x.click,populate:function(a){E.empty(U);A(a,function(a){a.label().each(function(a){a=Ck.generateSeparator(I,a,l);y.append(U,a)});A(a.items(),function(a){var b=Ck.generateItem(I,a,f,l);T.menuItemCheckbox(b);Jg(b,a.icon());y.append(U,b)})})},
enable:h.enable,disable:h.disable,close:w,uiStale:Qa.uiStale,recalculate:function(){jc.recalculate(Qa)},clear:b,select:function(a){v(l(a.textkey()));Jg(Uf,a.icon())},selectElement:function(a){a=Dv(a,"ephox-pastry-arrow-righticon");x.content({element:a.element,destroy:u})},tick:t(Mg.tick,U),untick:t(Mg.untick,U),activate:t(Mg.activate,x.element()),deactivate:t(Mg.deactivate,x.element()),destroy:function(){g.destroy();x.destroy()},events:Ev.registry}}function lP(a){var b=Fv.menu(a);return{widget:b.widget,
menu:b.menu,general:b.general,"inline-widget":function(a){return b["inline-widget"]({instance:function(){return a.instance(Ro.menu())}})},"split-widget":b["split-widget"],dropdown:b.dropdown,palette:b.palette}}function mP(a,b,c,d,e,f,h){var l=Fv.toolbar(f,c,h,Xf.editorContainer()),r=function(r){return t(r,l,a,b,c,d,e,f,h)};return{widget:r(So.widget),"inline-widget":r(So.inlineWidget),"split-widget":r(So.splitWidget),cards:l.cards,general:r(nP.init),dropdown:r(oP.init),menu:r(pP.init),palette:l.palette}}
function qP(a){var b=Mo("overflower");n.add(b.element(),na.resolve("more-button"));b.content(Rc(a("toolbar.more")));var c=gf.onButton(b);m.set(b.element(),"tabindex","-1");a=a("aria.label.more");m.set(b.element(),"title",a);var d=Yf.aria(b,a,!0,!0),e=To.toolbar([{component:b.element,destroy:b.destroy,refreshUi:u}]);return{group:e.component,select:function(){b.select();d.press()},deselect:function(){d.release();b.deselect()},focus:function(){Y.focus(b.element())},destroy:function(){c.unbind();d.destroy();
e.destroy()},events:b.events}}function Gv(a){var b=[];return{add:function(c,d){d=d?a.indexOf(b,d).getOrDie():b.length;b.splice(d,0,c);return Hv(c,d)},remove:function(c){var d=a.resolve(b,c).getOrDie();return zc(b,d).bind(function(a){b.splice(a,1);return Hv(d,a)})},get:function(){return b.slice(0)},itemAt:function(c){return a.resolve(b,c)}}}function Iv(a){var b=function(a,b){return df(b)?c(a,b):ta(b)?d(a,b):Zb(b)?e(a,b):N.error("Unsupported specifier type: "+b)},c=function(a,b){return 0===a.length?
N.error("Items is empty"):0>b||b>=a.length?N.error("Item index: "+b+" is out of range (0-"+(a.length-1)+")"):N.value(a[b])},d=function(b,c){return va(b,function(b){return a(b)===c}).fold(function(){return N.error("No item with value: ["+c+"]")},function(a){return N.value(a)})},e=function(a,b){return zc(a,b).fold(function(){return N.error("Specified object is not a registered item: "+b)},function(a){return N.value(b)})};return{resolve:b,indexOf:function(a,c){return b(a,c).bind(function(b){return zc(a,
b).fold(function(){return N.error("Item not found: "+c)},function(a){return N.value(a)})})},index:c,value:d,item:e}}function rP(a,b){b=G.create({grow:q([]),shrink:q([]),exit:q([])});var c=Gv(Iv(aa)),d=p.fromTag("div");v.set(d,"overflow-x","auto");n.add(d,na.resolve("toolstrip"));T.toolbarGroup(d);var e=p.fromTag("div");ja.add(e,[na.resolve("toolbar"),na.resolve("toolbar-primary")]);var f=p.fromTag("div");ja.add(f,[na.resolve("toolbar"),na.resolve("toolbar-more")]);y.append(d,e);y.append(d,f);var h=
function(){var a=c.get();return ia(a,function(a){return a.isVisible()?[a.component()]:[]})},l=function(){var b=h();b=a.build(b);E.empty(e);E.empty(f);O.append(e,b);v.reflow(e)};return{element:function(){return d},main:k(e),mores:k(f),destroy:function(){var a=c.get();A(a,function(a){a.destroy()})},focused:Sc,enter:u,restore:u,refocus:u,refresh:t(Ng.preserve,l,d),repaint:t(Ng.preserve,l,d),add:function(a){c.add(a)},events:b.registry}}function Jv(a){Uo(a);var b=!1,c=J.bind(a,"transitionend",function(c){"height"===
c.raw().propertyName&&(ja.remove(a,[Kv,Lv]),b&&v.remove(a,"height"))});return{visible:function(){return b},hide:function(){b=!1;Vo(a,pa.get(a));n.add(a,Lv);Uo(a)},show:function(){Mv(a);var c=pa.get(a);Uo(a);n.add(a,Kv);Mv(a);Vo(a,c);b=!0},destroy:function(){c.unbind()}}}function sP(a,b){var c=G.create({grow:q([]),shrink:q([]),exit:q([])}),d=Gv(Iv(aa)),e=p.fromTag("div");T.toolbarGroup(e);n.add(e,na.resolve("toolstrip"));var f=p.fromTag("div");ja.add(f,[na.resolve("toolbar"),na.resolve("toolbar-primary")]);
var h=p.fromTag("div");ja.add(h,[na.resolve("toolbar"),na.resolve("toolbar-more")]);y.append(e,f);y.append(e,h);var l=Jv(h);b.events.click.bind(function(){l.visible()?(l.hide(),b.deselect(),c.trigger.shrink()):(l.show(),b.select(),c.trigger.grow())});var r=function(){var a=d.get();return ia(a,function(a){return a.isVisible()?[a.component()]:[]})},D=function(){a.update();var c=r();c=a.build(c);v.set(f,"visibility","hidden");a.clearWidth();E.empty(f);O.append(f,c);var d=a.width(f);y.append(f,b.group());
c=tP.partition(d,c,Aa.getOuter,b.group());d=c.extra();var e=c.within();E.empty(f);E.empty(h);O.append(f,e);O.append(h,d);a.updateWidth(b,c);v.remove(f,"visibility")},x=function(){Ng.preserve(D,e)};return{element:function(){return e},main:k(f),mores:k(h),destroy:function(){var a=d.get();A(a,function(a){a.destroy()});b.destroy();l.destroy()},focused:Sc,enter:u,restore:u,refocus:u,refresh:x,repaint:function(){a.shouldRefresh()&&x()},add:function(a){d.add(a)},events:c.registry}}function hf(a,b,c){var d=
J.bind(a,"keydown",c.getOr(function(a){va(b,function(b){return b.matches(a)}).each(function(b){b.run(a).each(function(b){a.kill()})})})),e=G.create({enter:q([]),exit:q([])});return Tc({isFocused:t($a.isFocused,a),element:k(a),clear:u,enter:function(){$a.set(a);e.trigger.enter()},refresh:u,isEnabled:xb,exit:function(){e.trigger.exit()},events:e.registry,destroy:function(){d.unbind()}})}function Wo(a,b){var c=hf(a,[Z.rule(Z.inSet(R.SPACE().concat(R.ENTER())),function(){b.execute()(a);return g.some(!0)})],
b.process());return Tc({element:c.element,destroy:c.destroy,clear:c.clear,isFocused:c.isFocused,isEnabled:xb,refresh:u,enter:c.enter,exit:c.exit})}function ni(a,b){var c=t(b,-1,0),d=t(b,1,0),e=we.onDirection(c,d);d=we.onDirection(d,c);c=t(b,0,-1);b=t(b,0,1);var f=function(b){return b(a)()};e=t(f,e);d=t(f,d);return{west:e,east:d,north:c,south:b}}function Nv(a,b){var c=J.bind(a,"keydown",function(a){var c=qa.locate(b,a);if(Z.is(R.ESCAPE()[0])(a))d(),a.kill();else if(void 0!==c&&null!==c&&Z.is(R.TAB()[0])(a)){var e=
(Z.isShift(a)?qa.prev:qa.next)(b,c);qa.progress(c,e);a.kill()}}),d=function(){qa.exit(b);e.trigger.exit()},e=G.create({enter:q([]),exit:q([])});return Tc({enter:function(){qa.first(b).each(function(a){a.enter()})},exit:d,clear:t(qa.clear,b),refresh:t(qa.refresh,b),isEnabled:t(qa.isEnabled,b),isFocused:t($a.isFocused,a),destroy:function(){qa.destroy(b);c.unbind()},events:e.registry})}function uP(a,b){var c=qP(b),d=ba.detect().deviceType.isTouch()?rP(a,c):sP(a,c);T.toolbar(d.main(),b("aria.label.toolbar"));
T.group(d.mores());var e=G.create({drawer:Q(["delta","total"],d.events.drawer),grow:Q([],d.events.grow),shrink:q([]),transitionend:q(["property"]),exit:q([])}),f=J.bind(d.element(),"transitionend",function(a){e.trigger.transitionend(a.raw().propertyName)}),h=g.none();a=xa.sectors({first:g.none,trigger:gf.trigger});var l=ea.sectors(d.element(),vP,a);l.events.exit.bind(function(){h=g.none();e.trigger.exit()});l.events.active.bind(function(a){h=g.some(a.element())});var r=function(){return l.isFocused()},
D=function(){h.each(Y.focus)};d.events.shrink.bind(function(){Y.search(d.mores()).isSome()&&c.focus();e.trigger.shrink()});return{element:d.element,refresh:d.refresh,repaint:d.repaint,add:d.add,enter:function(){l.enter()},destroy:function(){l.exit();h=g.none();f.unbind();d.destroy();l.destroy()},focused:r,restore:D,refocus:function(){r()&&D()},events:e.registry}}function wP(){var a=S.div();n.add(a,z.resolve("bannerarium"));n.add(a,z.resolve("layer-above-editor"));var b=g.some([]),c=sk.create(),d=
function(a){b=b.bind(function(b){b=ka(b,function(b){return b!==a});return g.some(b)});e(a)},e=function(a){a.destroy();c.unbind(a.events.close);E.remove(a.element())},f=G.create({close:q(["banner"])});return{element:function(){return a},display:function(e){b.fold(function(){e.destroy()},function(b){b.push(e);c.bind(e.events.close,function(){d(e);f.trigger.close(e)});y.append(a,e.element())})},hide:d,destroy:function(){E.remove(a);b=b.bind(function(a){A(a,e);return g.none()})},events:f.registry}}function Ov(){var a=
wP();a.events.close.bind(function(){b.trigger.resize()});var b=G.create({resize:q([])});return{element:a.element,display:function(c){a.display(c);b.trigger.resize()},hide:function(c){a.hide(c);b.trigger.resize()},destroy:a.destroy,events:b.registry}}function Pv(a,b,c){var d=-1;return{shouldRefresh:function(){return Aa.getOuter(b)!==d},updateWidth:t(function(a,b,c){d=Aa.getOuter(a)},b),updateHeight:u,clearWidth:u,build:aa,update:u,width:Aa.getOuter,init:function(a,b,c,d,r,D){a.refresh()},state:k({toolbar:{drag:g.none()}}),
integrate:function(a,b,c,d,r){var e=S.div();ja.add(e,[z.resolve("sticky-container"),z.resolve("layer-above-editor")]);O.append(e,[b.element(),c.element(),r]);O.append(a,[e,d])},destroy:u,events:md(["changed","dock","undock"])}}function xP(a){a=ra({layerClass:Qv.resolve("blocker")},a);var b=p.fromTag("div");m.set(b,"role","presentation");v.setAll(b,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"});n.add(b,Qv.resolve("blocker"));n.add(b,a.layerClass);return{element:function(){return b},
destroy:function(){E.remove(b)}}}function yP(){var a=g.none(),b=function(b,c){var d=a.map(function(a){return b.compare(a,c)});a=g.some(c);return d},c=G.create({move:q(["info"])});return{onEvent:function(a,e){e.extract(a).each(function(a){b(e,a).each(function(a){c.trigger.move(a)})})},reset:function(){a=g.none()},events:c.registry}}function zP(a){return{onEvent:function(a,c){},reset:u}}function AP(){var a=zP(),b=yP(),c=a;return{on:function(){c.reset();c=b},off:function(){c.reset();c=a},isOn:function(){return c===
b},onEvent:function(a,b){c.onEvent(a,b)},events:b.events}}function BP(a,b){var c=G.create({relocate:q(["x","y","deltaX","deltaY"]),dragend:q([])}),d=CP.both(a),e=oi.transform(d),f=J.bind(a,"mousedown",function(a){0!==a.raw().button||tb.closest(a.target(),b)||(e.on(),e.go(p.fromDom(document.body)))});e.events.stop.bind(function(){c.trigger.dragend();e.off()});d.events.relocate.bind(function(a){c.trigger.relocate(a.x(),a.y(),a.deltaX(),a.deltaY())});return{blocker:e.element,destroy:function(){f.unbind();
e.destroy()},events:c.registry}}function DP(){var a=G.create({dock:q([]),undock:q([])}),b=function(a,b,e,f,h,l){if("true"===m.get(e,"data-ephox-snap")){var c=Wa.absolute(h),d=c.top()+l.top;if(Rv.isAllInside(b,d,d+f()))return c=a.locationToAbsolute(e,c.left(),d),g.some({position:"absolute",left:l.left+c.left()+"px",top:c.top()+"px"});a=l.top+c.top()-f()<=b.y()?b.fy():b.fy()+b.h()-f();h=Wa.viewport(h).left()-c.left();l=l.left+c.left()+h;return g.some({position:"fixed",left:l+"px",top:a+"px"})}return g.none()};
return{update:function(c,d,e,f,h,l){b(c,d,e,f,h,l).each(function(b){var c=v.get(e,"position");v.setAll(e,b);"absolute"===b.position&&c!==b.position?a.trigger.dock():"fixed"===b.position&&c!==b.position&&a.trigger.undock()})},getState:function(a){return"true"===m.get(a,"data-ephox-snap")},events:a.registry}}function EP(a){var b=function(a,b,c){a=B.owner(a);a=Pa.get(a);b-=a.left();c-=a.top();return Ma(b,c)},c=function(a,b,c){a=B.owner(a);a=Pa.get(a);b+=a.left();c+=a.top();return Ma(b,c)};return{locationToFixed:b,
fixedToLocation:c,absoluteToFixed:function(b,c,f){var d=a();b=B.owner(b);b=Pa.get(b);c-=b.left();return Ma(c,d.top()-f)},locationToAbsolute:function(b,c,f){b=a();return Ma(c,f).translate(-b.left(),-b.top())},absoluteToLocation:function(b,c,f){b=a();return Ma(c,f).translate(b.left(),b.top())},fromFixed:function(a,b,f){var d=Ma(b,f);a=c(a,b,f);return Sv(d,a)},fromLocation:function(a,c,f){a=b(a,c,f);c=Ma(c,f);return Sv(a,c)},boundToFixed:function(a,b,c,h,l,r,D){b=c<a.x()?a.fx():c>a.x()+a.w()?a.fx()+
a.w():l;a=h<a.y()?a.fy():h+D>a.y()+a.h()?a.fy()+a.h()-D:r;return Ma(b,a)}}}function Tv(a,b){var c=a.isInline()?a.element():b;return FP(function(){var a=Pa.get();return{x:a.left,y:a.top,w:k(window.innerWidth),h:k(window.innerHeight),fx:k(0),fy:k(0)}},function(){return a.isInline()?Ma(0,0):Wa.absolute(c)},function(){var a=L.descendant(b,".ephox-chameleon-toolbar").getOr(b);return pa.getOuter(a)},c)}function GP(a,b,c){var d=S.div();v.set(d,"position","relative");n.add(d,z.resolve("dragging-container"));
var e=S.div();n.add(e,z.resolve("draggable-container"));var f=a.isInline()?b:e;c=Tv(a,f);var h=Uv.transitions,l=Vv.except([".ephox-pastry-button","."+z.resolve("banner-buttons")+" *",".ephox-polish-ui-container",".ephox-polish-socket",".ephox-polish-widget-container"]),r=Wv.register(c,f,l,h),D=G.create({changed:Q([],r.events.dragend),dock:Q([],r.events.dock),undock:Q([],r.events.undock),appear:q(["container","wrapper"]),disappear:q(["container","wrapper"])});$c.initFade(e);r.events.appear.bind(function(){D.trigger.appear(f,
e)});r.events.disappear.bind(function(){D.trigger.disappear(f,e)});n.add(e,z.resolve("layer-above-editor"));ja.add(r.blocker(),[z.resolve("above-outside"),z.resolve("dragging")]);var x=S.span();T.hidden(x,!0);ja.add(x,[z.resolve("toolbar-drag-handle"),z.resolve("general-drag-handle"),"ephox-textbox-font",z.resolve("icon")]);c=ba.detect();c.browser.isIE()&&10===c.browser.version.major&&n.add(x,z.resolve("ie10"));return{shouldRefresh:k(!0),updateWidth:t($c.updateWidth,f),updateHeight:u,clearWidth:t($c.clearWidth,
f),build:function(a){return[x].concat(a)},width:t($c.width,f),init:function(b,c,d,h,l,D){var x=v.preserve(f,function(){v.set(f,"visibility","hidden");v.remove(f,"display");b.refresh();return pa.get(b.element())});D.toolbar.drag.fold(function(){var b=$c.offsetFrom(a,f,x,l);r.init(b.left,b.top,g.from(l.toolbar.offset).getOr({top:-1*x,left:0}))},r.setState);O.append(e,[b.element(),c.element()])},update:function(){r.update()},state:function(){return{toolbar:{drag:r.state()}}},integrate:function(c,f,h,
l,r){y.append(e,f.element());a.isInline()?(O.append(d,[e,r,l]),y.append(b,d)):O.append(b,[e,r,l])},destroy:function(){r.destroy()},events:D.registry}}function HP(a,b,c){var d=S.div();v.set(d,"position","relative");n.add(d,z.resolve("floating-container"));!0===c.toolbar.sticky&&n.add(d,z.resolve("floating-container-sticky"));!0===c.autoresize&&n.add(d,z.resolve("floating-container-autoresize"));c=S.div();n.add(c,z.resolve("draggable-container"));var e=a.isInline()?b:c;c=Tv(a,a.isInline()?e:d);var f=
Wv.register(c,e,Vv.none,Uv.transitions),h=G.create({changed:Q([],f.events.dragend),dock:Q([],f.events.dock),undock:Q([],f.events.undock),appear:q(["container","wrapper"]),disappear:q(["container","wrapper"])});$c.initFade(e);f.events.appear.bind(function(){h.trigger.appear(e,e)});f.events.disappear.bind(function(){h.trigger.disappear(e,e)});n.add(e,z.resolve("layer-toolbar"));var l=function(){f.update()},r=function(){if(v.getRaw(e,"position").is("fixed")){var b=Wa.absolute(a.element());v.getRaw(e,
"left").is(b.left()+"px")||v.set(e,"left",b.left()+"px")}b=Aa.get(a.element());(v.getRaw(e,"width").isNone()||b!==Aa.get(e))&&v.set(e,"width",b+"px");return b},D=function(){var b=pa.get(e)+"px";v.getRaw(a.element(),"margin-top").is(b)||v.set(a.element(),"margin-top",b)};return{shouldRefresh:function(){return!0},updateWidth:function(b,c){a.isInline()?$c.updateWidth(e,b,c):(r(),D(),l())},updateHeight:function(){a.isInline()||D()},clearWidth:function(){a.isInline()&&$c.clearWidth(e)},build:aa,width:function(b){return a.isInline()?
$c.width(e,b):Aa.get(a.element())},init:function(b,c,d,h,l,k){k=v.preserve(e,function(){v.set(e,"visibility","hidden");v.remove(e,"display");b.refresh();return pa.get(b.element())});d=$c.offsetFrom(a,e,k,l);a.isInline()||(r(),D());l=l.toolbar.sticky?{top:0,left:0}:g.from(l.toolbar.offset).getOr({top:-1*k,left:0});f.init(d.left,d.top,l);O.append(e,[b.element(),c.element(),h])},update:l,state:k({toolbar:{drag:g.none()}}),integrate:function(c,f,h,l,r){y.append(e,f.element());a.isInline()?O.append(d,
[r,l]):O.append(d,[e,l]);y.append(b,d)},destroy:function(){f.destroy()},events:h.registry}}function IP(a,b,c,d,e,f){var h=ba.detect(),l=p.fromTag("div"),r=c.uiContainer(),D=S.div();Xv(d,l);n.add(l,z.resolve("editor-main"));!0===e.autoresize&&n.add(l,Id.autoresize());a.isInline()||h.deviceType.isTouch()?y.append(l,r):(Xv(d,D),n.add(D,z.resolve("external-ui")),d=fa.body(),y.append(d,D),y.append(D,r));var g=JP.setup(a,l,e,f),H=ye.toolbar(g,w.translate);!1===e.toolbar.visible&&n.add(l,"ephox-polish-no-toolbar");
b.events.toolbar.bind(H.enter);H.events.exit.bind(a.focus);var I=Ov(),U=S.div();n.add(U,z.resolve("socket"));var Qa=S.div();n.add(Qa,z.resolve("widget-container"));g.integrate(l,H,I,U,Qa);Yv.build(l,e.sideBar,e.bottomBar);var m=a.isInline()?function(){v.set(I.element(),"min-width",Aa.getOuter(a.element())+"px")}:u;a.events.paint.bind(function(a){H.repaint();c.refresh();m()});g.events.changed.bind(function(){H.refresh()});a.isInline()||!0!==e.toolbar.sticky||(g.events.dock.bind(function(){v.set(r,
"position","absolute");c.refresh()}),g.events.undock.bind(function(){v.set(r,"position","fixed");c.refresh()}));if(a.isInline()||!0===e.toolbar.sticky)g.events.appear.bind(function(b){var c=a.isInline()?[b.container()]:[b.container(),r];$c.fadeIn(c,b.wrapper())}),g.events.disappear.bind(function(b){var c=a.isInline()?[b.container()]:[b.container(),r];$c.fadeOut(c,b.wrapper())});H.events.transitionend.bind(g.updateHeight);return{element:k(l),socket:function(a){a.connect(U)},viewport:k(U),uiContainerParent:k(D),
connect:function(a){y.append(a,l);gi.detect(l);return!0},destroy:function(){H.destroy();g.destroy();I.destroy();E.remove(l);E.remove(D)},toolbar:H,position:function(){m();g.init(H,I,U,Qa,e,f)},refresh:function(){g.update();H.refresh()},banners:I.element,displayBanner:I.display,hideBanner:I.hide,state:g.state,dialogContainer:k(Qa)}}function KP(a){var b=g.none(),c=function(b){return function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];d=a.get()[b];if(null===d||void 0===d)throw"can't find instance method: "+
b;return d.apply(null,c)}},d=function(){var a=b.getOrDie("Cannot reconnect the editor before it has been connected the first time.");c("connect")(a)&&e.trigger.connected()},e=G.create({connected:q([])});return fi.external({activateInline:c("activateInline"),deactivateInline:c("deactivateInline"),content:c("content"),keyboard:c("keyboard"),smartview:c("smartview"),macros:c("macros"),ui:c("ui"),filter:c("filter"),undo:c("undo"),operations:c("operations"),getMode:c("getMode"),element:c("element"),connect:function(a){b=
g.some(a);d()},reconnect:function(){var c=b.getOrDie("Cannot reconnect the editor before it has been connected the first time."),e=v.getRaw(c,"height");a.get().events.loaded.bind(function(){e.fold(function(){v.remove(c,"height")},function(a){v.set(c,"height",a)})});var l=v.get(c,"height");v.set(c,"height",l);d()},focus:c("focus"),getContent:c("getContent"),setContent:c("setContent"),insertHtmlAtCursor:c("insertHtmlAtCursor"),state:c("state"),communication:c("communication"),uploader:c("uploader"),
isDirty:c("isDirty"),setDirty:c("setDirty"),isPrettyPrinting:c("isPrettyPrinting"),events:e.registry})}function Zv(a){var b=Db(N.error,a);return{invalidError:b,different:function(a,d,e,f,h){return 0===d.length?b(f):d===e?b(h):N.value(a)}}}function LP(a){var b=Zv(a);return{changeAlt:function(a,d,e,f){var c=m.get(a,"src");return b.different(a,d,c,e,f).map(function(a){m.set(a,"alt",d);return a})}}}function Ec(a,b,c,d){var e=P.eq(a,c)&&b===d;return{startContainer:k(a),startOffset:k(b),endContainer:k(c),
endOffset:k(d),collapsed:k(e)}}function $v(a){var b=function(b){return a(b).isRtl()?Dk.rtl:Dk.ltr};return{delta:function(a,d){return b(d).delta(a,d)},edge:function(a){return b(a).edge(a)},positions:function(a,d){return b(d).positions(a,d)}}}function MP(a){var b=Zv(a);return{changeCaption:function(a,d,e,f){var c=m.get(a,"summary");return b.different(a,d,c,e,f).map(function(a){jf.setCaption(a,d);return a})},changeSummary:function(a,d,e,f){var c=L.descendant(a,"caption").map(Ca.get).getOr("");return b.different(a,
d,c,e,f).map(function(a){jf.setSummary(a,d);return a})},setHeaders:function(a,d,e,f){return(!0===e&&!0===f?jf.addBothHeaders:!0===e?jf.addRowHeader:!0===f?jf.addColumnHeader:k(b.invalidError("a11y.t4b.repair.errors.none")))(a,d)},setScope:function(a,b){m.set(a,"scope",b);return N.value(a)}}}function NP(a){var b=ya("id description prompts element severity url repair".split(" "),[]),c=ya(["ui","repair"],[]),d=LP(a),e=MP(a),f={I1:g.some(c({ui:[$b.field("image-alt","a11y.i1.repair.info",k(""))],repair:function(a,
b,c){return d.changeAlt(b.element(),c["image-alt"](),"a11y.i1.repair.errors.empty","a11y.i1.repair.errors.duplicate")}})),I2:g.some(c({ui:[$b.field("image-alt","a11y.i2.repair.info",function(a){return m.get(a.element(),"alt")})],repair:function(a,b,c){return d.changeAlt(b.element(),c["image-alt"](),"a11y.i2.repair.errors.empty","a11y.i2.repair.errors.duplicate")}})),T1:g.some(c({ui:[$b.field("table-caption","a11y.t1.repair.info",k(""))],repair:function(a,b,c){return e.changeCaption(b.element(),c["table-caption"](),
"a11y.t1.repair.errors.empty","a11y.t1.repair.errors.duplicate")}})),T2:g.some(c({ui:[$b.field("table-summary","a11y.t2.repair.info",k(""))],repair:function(a,b,c){return e.changeSummary(b.element(),c["table-summary"](),"a11y.t2.repair.errors.empty","a11y.t2.repair.errors.duplicate")}})),T3:g.some(c({ui:[$b.field("table-caption","a11y.t3.repair.info",function(a){return m.get(a.element(),"summary")})],repair:function(a,b,c){return e.changeCaption(b.element(),c["table-caption"](),"a11y.t3.repair.errors.empty",
"a11y.t3.repair.errors.duplicate")}})),T4A:g.none(),T4B:g.some(c({ui:[$b.toggles("table-headers","a11y.t4b.repair.info",[$b.toggle("row-header","ephox-polish-row-header","a11y.t4b.repair.row"),$b.toggle("col-header","ephox-polish-column-header","a11y.t4b.repair.column")])],repair:function(a,b,c){var d=c["row-header"]();c=c["col-header"]();return e.setHeaders(a,b.element(),d,c)}})),T4C:g.some(c({ui:[$b.select("scope-type","a11y.t4c.repair.info",[$b.pair("row","a11y.t4c.repair.scope.row"),$b.pair("col",
"a11y.t4c.repair.scope.col"),$b.pair("rowgroup","a11y.t4c.repair.scope.rowgroup"),$b.pair("colgroup","a11y.t4c.repair.scope.colgroup")])],repair:function(a,b,c){return e.setScope(b.element(),c["scope-type"]())}})),D1:g.some(c({ui:[$b.select("heading-type","a11y.d1.repair.info",[$b.pair("h1","a11y.d1.repair.block.h1"),$b.pair("h2","a11y.d1.repair.block.h2"),$b.pair("h3","a11y.d1.repair.block.h3"),$b.pair("h4","a11y.d1.repair.block.h4"),$b.pair("h5","a11y.d1.repair.block.h5"),$b.pair("h6","a11y.d1.repair.block.h6")])],
repair:function(a,b,c){return aw.convertToHeading(b.element(),c["heading-type"]())}})),D2:g.none(),D3:g.some(c({ui:[],repair:function(a,b,c){return aw.joinLinks(a.content().isRoot,b.element())}})),D4:g.none(),D5:g.none(),O1:g.none(),O2:g.none()};return{convert:function(a,c){var d=function(b){var c=b.repair();return function(b,d){return a.undo().transaction(function(){return c(a,b,d)})}};return F(c,function(a){var c=a.rule(),e=c.id().toUpperCase(),h=void 0!==f[e]?f[e]:g.none(),l=c.desckey();return b({id:e,
description:l,prompts:h.map(function(a){return a.ui()}),element:p.fromDom(a.element()),url:c.url(),severity:c.severity(),repair:h.map(d).getOr(function(){return N.error("no repair")})})})}}}function OP(a){return{audit:function(b){return PP.audit(b,a.rules())}}}function QP(){var a=Ga([]),b=Ga(0),c=M("index","total","detail"),d=function(d){var e=a.get();if(0===e.length)return g.none();var h=b.get();var l=e.length-1;d=h+d;l=d>l?0:0>d?l:d;b.set(l);return g.some(c(l,e.length,e[l]))};return{load:function(d){if(0===
d.length)return g.none();b.set(0);a.set(d);return g.some(c(b.get(),d.length,d[0]))},backwards:function(){return d(-1)},current:function(){var d=a.get();return 0===d.length?g.none():g.some(c(b.get(),d.length,d[b.get()]))},resolve:function(){var d=a.get();if(0===d.length)return g.none();d=d.slice(0,b.get()).concat(d.slice(b.get()+1));var f=Math.min(d.length-1,b.get());b.set(f);a.set(d);return 0===d.length?g.none():g.some(c(b.get(),d.length,d[b.get()]))},forwards:function(){return d(1)}}}function RP(a,
b){var c=S.div();n.add(c,Sa.resolve(b,"assistance"));var d=Sa.resolve(b,"assistance-invalid"),e=g.none(),f=p.fromTag("p");n.add(f,Sa.resolve(b,"repair-error"));m.set(f,"aria-live","polite");var h=function(){n.remove(c,d);E.remove(f)},l=G.create({execute:q([])}),r=ea.dynamic(c,xa.dynamic({})),D=[r];return{element:k(c),keylayouts:k(D),markInvalid:function(a){n.add(c,d);bb.shout(c,a);Ca.set(f,a);y.append(c,f)},markValid:h,getChange:function(){return e.map(function(a){return a.get()})},destroy:function(){e.each(function(a){a.destroy()})},
update:function(d){h();d=d.detail();var f=d.prompts();e.each(function(a){a.destroy()});d=SP.generate(a,f,d,b);e=g.some(d);E.empty(c);O.prepend(c,d.elements());d.events.execute.bind(function(){l.trigger.execute()});r.set(d.keylayouts())},events:l.registry}}function TP(a,b){var c=S.div();n.add(c,Sa.resolve(b,"commands"));var d=S.div();n.add(d,Sa.resolve(b,"commands-buttons"));var e=ze.defaultActionButton(a,[Sa.resolve(b,"repair")],Fc.repairLabel(),Fc.repairText(),b),f=ze.normalButton(a,[Sa.resolve(b,
"ignore")],Fc.ignoreLabel(),Fc.ignoreText(),b),h=ze.defaultActionButton(a,[Sa.resolve(b,"ok")],Fc.okLabel(),Fc.okText(),b),l=function(){O.append(d,[f.element(),e.element()])};l();a=xa.button({execute:function(a){a.dom().click()}});a=[ea.button(f.element(),a),ea.button(e.element(),a),ea.button(h.element(),a)];y.append(c,d);var r=G.create({repair:Q([],e.events.click),ignore:Q([],f.events.click),done:Q([],h.events.click)});return{element:k(c),destroy:function(){e.destroy();f.destroy();h.destroy()},keylayouts:k(a),
focus:function(){var a=e.disabled()?e.element():f.element();Y.focus(a)},update:function(a){E.remove(h.element());a=a.detail();kc.isVisible(f.element())||l();a.prompts().fold(function(){e.disable();ma.disable(e.element())},function(a){e.enable();ma.enable(e.element());bb.speak(fa.body(),Sa.translate(b,Fc.repairAvailable()))})},zero:function(a){E.empty(d);y.append(d,h.element());Y.focus(h.element())},events:r.registry}}function UP(a,b){var c=S.div();n.add(c,Sa.resolve(b,"information"));m.set(c,"data-severity",
"info");a=S.div();n.add(a,Sa.resolve(b,"icon"));var d=S.div();n.add(d,Sa.resolve(b,"description"));y.append(d,p.fromText(""));var e=p.fromTag("a");n.add(e,Sa.resolve(b,"help-icon"));m.set(e,"href","javascript:void(0)");O.append(c,[a,d,e]);var f=J.bind(e,"click",function(){var a=m.get(e,"data-url");window.open(a,"","height=700,width=820,resizable=yes,scrollbars=yes")});a=[ea.single(e,[],g.none())];return{element:k(c),destroy:function(){f.unbind()},keylayouts:k(a),update:function(a){a=a.detail();var f=
a.severity();m.set(c,"data-severity",f);bb.speak(fa.body(),Sa.translate(b,Fc.severity(f)));f=Sa.translate(b,a.description());Ca.set(d,f);bb.speak(fa.body(),f);m.set(e,"title",Sa.translate(b,Fc.issueHelp()));m.set(e,"data-url",a.url());y.after(d,e)},zero:function(){m.set(c,"data-severity","success");var a=Sa.translate(b,Fc.noIssue());Ca.set(d,a);bb.speak(fa.body(),a);E.remove(e)}}}function VP(a,b){a=S.div();var c=S.span();n.add(c,Sa.resolve(b,"spin"));n.add(a,Sa.resolve(b,"loading"));y.append(a,c);
return{element:k(a),destroy:u}}function WP(a,b){var c=Ek("titlebar",g.none(),b),d=Ek("title",g.none(),b),e=Ek("title-text",g.some(Fc.title()),b),f=Ek("issue",g.some(Fc.running()),b);O.append(d,[e,f]);var h=S.div();n.add(h,Sa.resolve(b,"navigation"));e=ze.icon(a,Sa.resolve(b,"previous"),Fc.previous(),b);a=ze.icon(a,Sa.resolve(b,"next"),Fc.next(),b);var l=[e,a];a=G.create({previous:Q([],e.events.click),next:Q([],a.events.click)});O.append(h,F(l,function(a){return a.element()}));y.append(c,d);var r=
xa.button({execute:function(a){a.dom().click()}});e=F(l,function(a){return ea.button(a.element(),r)});var D=function(a){a.disable();ma.disable(a.element())},x=function(a){a.enable();ma.enable(a.element())},H=function(){A(l,D)},I=function(){A(l,x)},U=function(){Ng.preserve(function(){y.after(d,h)},h)};return{element:k(c),update:function(a){var c=a.index()+1;a=a.total();c=Sa.translate(b,Fc.issueCounter(),c,a);Ca.set(f,c);bb.speak(fa.body(),c);(1===a?H:I)();U()},zero:function(){Ca.set(f,"&nbsp;");U();
H()},keylayouts:k(e),destroy:function(){A(l,function(a){a.destroy()})},events:a.registry}}function XP(a,b){var c=S.div();n.add(c,Sa.resolve(b,"widget"));var d=Sa.resolve(b,"loading");n.add(c,d);var e=WP(a,b),f=UP(a,b),h=RP(a,b),l=TP(a,b),r=VP(a,b);O.append(c,[e.element(),r.element()]);var D=G.create({showcase:q(["detail"]),ignored:q(["detail"]),solved:q(["detail"]),done:q([])}),g=function(a){A([e,f,h,l],function(b){b.update(a)});D.trigger.showcase(a.detail());Ng.preserve(function(){y.after(e.element(),
f.element());y.after(f.element(),h.element());y.after(h.element(),l.element())},c)},H=function(a){a.fold(function(){y.after(e.element(),f.element());y.after(f.element(),l.element());E.remove(h.element());e.zero();f.zero();l.zero()},g)},I=Ga(QP());e.events.previous.bind(function(){I.get().backwards().each(g)});e.events.next.bind(function(){I.get().forwards().each(g)});a=function(){var a=h.getChange().getOr({});I.get().current().each(function(b){var c=b.detail();c.repair()(c,a).fold(function(a){h.markInvalid(a)},
function(a){h.markValid();a=I.get().resolve();D.trigger.solved(c);H(a);l.focus()})})};h.events.execute.bind(a);l.events.repair.bind(a);l.events.ignore.bind(function(){I.get().current().each(function(a){var b=I.get().resolve();D.trigger.ignored(a.detail());H(b)})});l.events.done.bind(function(){D.trigger.done()});a=Kb([e.keylayouts(),f.keylayouts(),h.keylayouts(),l.keylayouts()]);return{element:k(c),destroy:function(){A([e,f,h,l],function(a){a.destroy()})},load:function(a){E.remove(r.element());n.remove(c,
d);a=I.get().load(a);H(a)},open:function(){y.append(c,r.element());n.add(c,d)},skip:function(){var a=I.get().resolve();H(a)},keylayouts:k(a),events:D.registry}}function YP(a){var b=Xo.ignoreAttr(),c={prefix:k("accessibility-check"),translate:bw.translate,tnames:k("a11y")},d=XP(ZP,c);c=$P.all();c=aQ({rules:c});var e=OP(c),f=NP(bw.translate),h=Xo.manager(a.content()),l=function(c){c=e.audit(c.dom());c=f.convert(a,c);return ka(c,function(a){var c=a.element();c=Ae.read(c,b);return!V(c,a.id())})};d.events.showcase.bind(function(b){a.content().body().each(function(c){c=
b.detail().element();fa.inBody(c)?(h.moveTo(c,b.detail().severity()),Zf.elementIntoView(a.content(),c)):d.skip()})});d.events.ignored.bind(function(a){a=a.detail();h.ignore(a.element(),a.id(),a.severity())});d.events.solved.bind(function(a){a=a.detail();h.solve(a.element(),a.id(),a.severity())});c=G.create({done:Q([],d.events.done)});return{element:d.element,anchorName:k("a11y-widget-anchor"),textkey:k("action.a11ycheck"),dialogTextkey:k("a11y.widget.title"),destroy:function(){d.destroy()},keylayouts:d.keylayouts,
openWidget:function(){a.content().hideInlineSelection();d.open();a.content().body().each(function(a){a=l(a);h.start(a);d.load(a)})},closeWidget:function(){h.stop()},events:c.registry}}function bQ(a,b){var c=G.create({open:q([]),close:q([])}),d=p.fromTag("div");n.add(d,na.resolve("layer-menus"));n.add(d,na.resolve("toolstrip"));y.append(a(),d);a=function(){v.getRaw(d,"opacity").isNone()&&(e.cancel(),v.remove(d,"display"),c.trigger.close())};var e=pi(a,1E3),f=J.bind(d,"transitionend",a);return{element:function(){return d},
destroy:function(){f.unbind();E.remove(d)},open:function(){v.set(d,"display","block");v.reflow(d);c.trigger.open();v.set(d,"opacity","1")},close:function(){v.remove(d,"opacity");e.throttle()},setContent:function(a){y.append(d,a)},events:c.registry}}function cw(a,b,c,d){var e=a.content(),f=a.ui().tabstrip.element(),h=[b.element()],l="."+z.resolve(c)+", ."+na.resolve("more-button"),r=function(){var a=ca.descendants(f,l);return h.concat(a)},D=Uc.api(),g=G.create({abort:q([]),open:q([]),close:q([])}),
k=function(){e.events.mousedown.unbind(I);D.clear();U.off()},I=function(){D.isSet()&&(b.closeWidget(),D.run(function(a){a.close()}))},U=Bv(I,r);b.events.done.bind(function(){I()});var m=ea.multiple(b.element(),b.keylayouts());m.events.exit.bind(function(){g.trigger.abort()});return{destroy:function(){k();m.destroy();b.destroy();U.off()},events:g.registry,open:function(){U.on();b.openWidget();var c=bQ(a.ui().dialogContainer,r);c.setContent(b.element());n.add(c.element(),d);var f=c.element();ja.add(f,
[z.resolve(b.anchorName()),z.resolve("side-widget-anchor")]);T.dialog(f,w.translate(b.dialogTextkey()));c.open();c.events.close.bind(function(){e.focus();g.trigger.close();k()});D.set(c);m.enter();g.trigger.open();e.events.mousedown.bind(I)},close:I,isOpen:D.isSet}}function cQ(a){var b=a.filter();Xo.configure(b);var c=Uc.api(),d=function(){var b=YP(a);b=cw(a,b,"a11y-check",dQ);b.events.abort.bind(b.close);b.events.close.bind(f);c.set(b);b.open()},e=function(){c.run(function(a){a.close()})},f=function(){c.clear()};
return{ui:ob.ui({"a11ycheck.general":{toggle:!1,hasPopup:!1,value:"a11y-check",textkey:w.key("action.a11ycheck"),action:function(){(c.isSet()?e:d)()},updateGeneral:function(a){n.add(a.element(),z.resolve("a11y-check"))},icon:!0,tooltip:ib.get}}),destroy:f}}function Yo(a){return{change:function(b,c){return(a.directionAt(b).isRtl()?dw.rtl:dw.ltr).change(b,c)}}}function eQ(a){var b=a.property(),c=function(a,c){return b.parent(a).map(b.name).map(function(a){return!V(c,a)}).getOr(!1)};return{validateText:function(a){return b.isText(a)&&
c(a,fQ)}}}function gQ(a,b){return{is:function(c){return v.get(c,a)===b},remove:function(b){v.remove(b,a)},set:function(c){v.set(c,a,b)}}}function hQ(a){var b=a.content(),c=a.keyboard(),d=a.shortcuts(),e=a.context(),f=G.create({analytics:q(["message","properties"])}),h=t(Jd.indent,a),l=t(Jd.outdent,a),r=t(Jd.blockquote,a);d.events.indent.bind(h);d.events.outdent.bind(l);d.events.blockquote.bind(r);var D=function(a){var c=a.stopper();Fk.context(b).bind(function(b){Fk.cata(b,u,function(b){(a.shift()?
l:h)();c()})})},x=c.editor();x.on();x.events.tab.bind(D);e.events.preLinebreak.bind(function(b){Zo.atQuoteBreak(a.content()).each(function(c){Jd.breakQuote(a,c.quote(),c.element());b.handler().handle()})});var H=M("value","icon","textkey");c=H("justifyleft",g.some(na.resolve("justifyleft")),w.key("alignment.left"));d=H("justifycenter",g.some(na.resolve("justifycenter")),w.key("alignment.center"));e=H("justifyright",g.some(na.resolve("justifyright")),w.key("alignment.right"));var I=H("justifyfull",
g.some(na.resolve("justifyfull")),w.key("alignment.justify")),U=H("justifyleft",g.some(na.resolve("justifyleft")),w.key("alignment.left")),m=H("justifycenter",g.some(na.resolve("justifycenter")),w.key("alignment.center"));H=H("justifyright",g.some(na.resolve("justifyright")),w.key("alignment.right"));var jc=[c,d,e,I],n=[U,m,H],p=function(){return lc.detect(b.getSelection()).fold(function(){return jc},function(a){return n})},Jg={justifyleft:t(Jd.imageLeft),justifycenter:t(Jd.imageCentre),justifyright:t(Jd.imageRight)},
v={justifyleft:Jd.justifyLeft,justifycenter:Jd.justifyCentre,justifyright:Jd.justifyRight,justifyfull:Jd.justifyFull},A=function(a){return a.toLowerCase()},y=g.none();return{ui:ob.ui({"indent.general":{value:"indent",textkey:w.key("action.indent"),action:h,updateGeneral:aa,tooltip:ib.get,toggle:!1},"outdent.general":{value:"outdent",textkey:w.key("action.outdent"),action:l,updateGeneral:aa,tooltip:ib.get,toggle:!1},"blockquote.general":{value:"blockquote",textkey:w.key("action.blockquote"),action:r,
updateGeneral:function(a){Zo.read(b).quoted().fold(a.deselect,u,a.select)},tooltip:ib.get,toggle:!0},"alignment.dropdown":{name:"alignment",textkey:w.key("alignment.toolbar"),menuTextkey:w.key("alignment.menu"),action:function(c){var d=lc.detect(b.getSelection()).fold(k(v),k(Jg));(void 0!==d[c]?d[c]:u)(a)},updateDropdown:function(a){var c=p(),d=Zo.read(b).alignment().fold(function(){return 0<c.length?wa.on(c[0].value()):wa.off()},wa.unchanged,wa.on);a.populate([{label:g.none,items:k(c)}]);Gk.updateMenu(a,
d.map(A),wa.on(),c,y)},values:jc,render:y,tooltip:ib.get,toggle:!1,describe:function(a){return w.translate("alignment.describe",w.get(a.textkey()))}}}),events:f.registry,destroy:function(){x.off();x.events.tab.unbind(D);x.destroy()}}}function iQ(a,b){var c=function(a,b,c){var d=p.fromText(b);a(c,d);return g.some({element:k(d),cleanup:function(){E.remove(d)},splits:k([])})},d=function(a){return{none:g.none,start:t(c,y.before,a),end:t(c,y.after,a),middle:function(b,d,e){return c(y.after,a,d)}}},e=function(a){var b=
function(a){return function(b,c){y.appendAt(b,c,a)}};return{prepend:t(c,y.prepend,a),before:t(c,y.before,a),after:t(c,y.after,a),insertAt:function(d,e){return c(b(e),a,d)},append:t(c,y.append,a)}};return{before:{text:d(a),element:{hasPrevious:e(a).insertAt,first:e(a).prepend,empty:e(a).before,otherwise:e(a).append}},after:{text:d(b),element:{hasNext:e(b).insertAt,rightEdge:e(b).append,empty:e(b).after,otherwise:e(b).append}},general:{insertBefore:e(a).before,insertAfter:e(b).after}}}function ew(a,
b,c,d){c=[b].concat(c);var e=t($o.nuTag,b),f=t($f.relatedTags,c),h=uc.tagList(c),l=$f.queriesTag(b),r={nu:e,matches:f,purifiers:k(h)},D=function(a){var b=p.fromText(fb());Hk.atStartOf(a.startContainer(),a.startOffset(),b);return Lb.hare(b,0,b,1)},x=function(a,b,c){return C.isText(b)&&c===Oa.get(b).length?mc.after(b,a).fold(function(){return W.point(b,c)},function(a){return W.point(a,0)}):W.point(b,c)},H=function(a,b,c){return C.isText(b)&&0===c?mc.before(b,a).fold(function(){return W.point(b,c)},
function(a){return W.point(a,oa.getEnd(a))}):W.point(b,c)},I=function(a,b){return b.map(function(b){var c=x(a,b.start(),b.soffset());b=H(a,b.finish(),b.foffset());return Lb.fussy(c.element(),c.offset(),b.element(),b.offset())})};c={nu:e,purifiers:k(h),isStyled:k(!0)};var U=["font-size"],m=function(a){return a.getSelection().map(function(a){var c=jb(d);c=No(c,U);return kb(c,function(c){return $f.queryStyleOn(c,d[c],[b],a)})}).getOr(!1)};return{run:function(a,c){var d=c.doc();return ap.detect(c,l.queryOn).fold(function(){return g.none()},
function(b){b=D(b);Kd.doRemoveUpto(a,h,b,f);return g.some(Lb.fromHare(b))},function(a){a=D(a);var c=p.fromTag(b,d.dom());n.add(c,Eb.styleSpan());y.wrap(a.startContainer(),c);return g.some(Lb.fussy(a.startContainer(),1,a.startContainer(),1))},function(b){b=Kd.doRemoveUpto(a,h,b,f);return I(a,b)},function(b){return bp.run(c.doc(),a,b,r)})},query:function(a){return l.query(a)||m(a)},deferred:k(c),name:k(a)}}function fw(a,b){return{element:k(b),wrap:function(c){a.insert().append(b,c)}}}function Ik(a,
b,c,d,e,f){var h=t($o.nu,d,e,b),l=t($f.relatedStyle,d,e,c),r=uc.cssAndTag(c,d,e),D=$f.queriesStyle(d,e,c),x=k(!0),H=function(b,c){Be.generic(b,u,x,function(b){n.add(b,Eb.styleSpan());v.set(b,d,c);m.set(b,Eb.overrideSpan(),a);v.reflow(b)});return g.none()};b={nu:h,purifiers:k(r),isStyled:function(a){return"span"===C.name(a)&&qi.rawState(a,d,e)},matches:l};return{run:function(a,b){return ap.detect(b,D.queryOn).fold(function(){return g.none()},function(a){return H(b,f)},function(a){return H(b,e)},function(b){return Kd.doRemoveUpto(a,
r,b,l)},function(c){return bp.run(b.doc(),a,c,{nu:h,matches:l,purifiers:k(r)})})},query:function(b){var c="["+Eb.overrideSpan()+'="'+a+'"]';return b.getSelection().bind(function(a){return L.closest(a.startContainer(),c).bind(function(b){return L.closest(a.endContainer(),c).bind(function(a){return P.eq(b,a)?v.getRaw(b,d).map(function(a){return a===e}):g.none()})})}).getOrThunk(function(){return D.query(b)})},deferred:k(b),name:k(a)}}function jQ(a){var b=a.content(),c=a.shortcuts(),d=a.undo(),e=G.create({analytics:q(["message",
"properties"])}),f=function(a,c){var d=kQ.read(b);(void 0!==d[a]?d[a]():wa.unchanged()).fold(c.deselect,u,c.select)},h=function(c){var e=function(a){return c(b.isRoot,a)};return function(){Pb.cata(a.selections().get(),u,Jk.multiple(b,d,e),Jk.single(b,d,e));b.uiChanged()}},l=h(ad.bold),r=h(ad.italic),D=h(ad.underline),g=h(ad.strikethrough),k=h(ad.subscript),I=h(ad.superscript);h=h(ad.removeformat);c.events.bold.bind(l);c.events.italic.bind(r);c.events.underline.bind(D);return{ui:ob.ui({"bold.general":{toggle:!0,
value:"bold",textkey:w.key("action.bold"),action:l,updateGeneral:t(f,"bold"),icon:!0,tooltip:ib.get},"italic.general":{toggle:!0,value:"italic",textkey:w.key("action.italic"),action:r,updateGeneral:t(f,"italic"),icon:!0,tooltip:ib.get},"underline.general":{toggle:!0,value:"underline",textkey:w.key("action.underline"),action:D,updateGeneral:t(f,"underline"),icon:!0,tooltip:ib.get},"strikethrough.general":{toggle:!0,value:"strikethrough",textkey:w.key("action.strikethrough"),action:g,updateGeneral:t(f,
"strikethrough"),icon:!0,tooltip:ib.get},"removeformat.general":{toggle:!1,value:"removeformat",textkey:w.key("action.removeformat"),action:h,updateGeneral:aa,icon:!0,tooltip:ib.get},"subscript.general":{toggle:!0,value:"subscript",textkey:w.key("action.subscript"),action:k,updateGeneral:t(f,"subscript"),icon:!0,tooltip:ib.get},"superscript.general":{toggle:!0,value:"superscript",textkey:w.key("action.superscript"),action:I,updateGeneral:t(f,"superscript"),icon:!0,tooltip:ib.get}}),events:e.registry,
destroy:u}}function gw(a){var b=function(b,d,e,f){var c=e.join(",");b=a.up().closest(b,c,f);d=a.up().closest(d,c,f);return b.isSome()&&d.isSome()?(f=b.getOrDie("Just checked it was some."),d=d.getOrDie("Just checked it was some."),a.eq(f,d)?va(e,t(a.is,f)):g.none()):g.none()};return{query:function(a,d,e){d=d.concat(lQ.tags());return b(a.startContainer(),a.endContainer(),d,e)},queryAll:b}}function hw(a,b){var c=M("base","value","textkey","icon","styles","tag"),d=a.styles;a=b.map(t(mQ,a.showDocumentStyles)).getOr([]);
d=d.concat(a);d=F(d,function(a){return{name:a.rule,text:g.from(a.text).map(w.raw),style:void 0===a.style?{}:a.style}});var e={};A(d,function(a){nQ.decipher(a).each(function(b){e[a.name]=b})});d=xb;a=Sc;b=function(a,b,c,d){return function(e){return kf.cata(e,a,b,c,d)}};var f=se(e),h=ka(f,b(a,a,a,d)),l=ka(f,b(a,a,d,a)),r=ka(f,b(a,d,a,a)),D=ka(f,b(d,a,a,a));d=function(){var a=h.concat(r).concat(l).concat(D);return F(a,function(a){return kf.cata(a,function(a,b,c){return"."+a},function(a,b,c,d){return a+
"."+b},function(a,b,c){return a},function(a,b,c,d){return a+"."+b})})}();var x=function(a){return void 0!==e[a]?g.some(e[a]):g.none()},H=function(a){return kf.cata(a,function(a,b,d){return c("span","."+a,b,g.none(),d,"span")},function(a,b,d,e){return c(a,a+"."+b,d,g.none(),e,"span")},function(a,b,d){return c(a,a,b,g.none(),d,a)},function(a,b,d,e){return c(a,a+"."+b,d,g.none(),e,a)})};a=function(){var a=se(e);return F(a,H)}();return{candidateByName:function(a){return x(a).map(H)},toCandidate:H,ruleByName:x,
divisions:function(){return{classblocks:k(h),blocks:k(l),objects:k(r),inlines:k(D)}},backup:function(a){return c(a,a,w.key("block."+a),g.none(),{},"span")},selectors:k(d),everything:k(a)}}function oQ(a,b,c){var d=c(void 0===b||"default"===b?g.none():g.some(b)),e=p.fromTag("div");n.add(e,z.resolve("list-style-option"));c=void 0===b||"default"===b?pQ(e,"ul"===a?"list.unordered.default":"list.ordered.default"):qQ(a,b);y.append(e,c);a=w.translate(("ul"===a?"list.unordered.":"list.ordered.")+b);m.set(e,
"title",a);T.label(e,a);T.menuItemCheckbox(e);var f=bb.describe(e,w.translate("aria.widget.navigation"));y.append(e,f);var h=G.create({action:q(["type","element"])}),l=function(){ma.checked(e,!0);n.add(e,z.resolve("list-style-selected"))},r=function(){ma.checked(e,!1);n.remove(e,z.resolve("list-style-selected"))},D=J.bind(e,"click",function(a){h.trigger.action(d,g.some(e))});return{element:k(e),instance:d,style:b,update:function(a){(d.query(a)&&d.queryStyle(a)?wa.on(!0):wa.off()).fold(r,u,l)},select:l,
deselect:r,events:h.registry,destroy:function(){D.unbind();E.remove(e);E.remove(f)}}}function rQ(a,b,c){var d=G.create({action:q(["type"])}),e=S.div();n.add(e,z.resolve("list-style-palette"));var f=F(a,function(a){return oQ("bullist"===b?"ul":"ol",a,c)});A(f,function(a){a.events.action.bind(function(a){a.element().each(l);d.trigger.action(a.type())});y.append(e,a.element())});var h=function(){var a=Math.floor(f.length/4)+(0<f.length%4?1:0);return ea.grid(e,{cell:k("."+z.resolve("list-style-option"))},
a,4,xa.grid({trigger:function(a){a.dom().click();return g.some(a)}}))}(),l=function(a){L.sibling(a,"["+Kk+'="default"]').filter(function(b){return b!==a}).each(function(b){m.remove(b,Kk);m.set(a,Kk,"default")})};return{enter:h.enter,element:k(e),update:function(a){A(f,function(b){b.update(a)})},events:d.registry,destroy:function(a){h.isFocused()&&h.exit();h.destroy();A(f,function(a){a.destroy()});E.remove(e)},findDefault:function(){return va(f,function(a){return m.has(a.element(),Kk)}).map(function(a){return a.instance})}}}
function iw(a){var b=a.region(),c=a.content(),d=a.undo(),e=a.keyboard(),f=a.listConstructor(),h=a.type(),l=a.styles(),r=a.textkey(),D=a.menuTextkey(),g=f("default"),H=ba.detect(),I=e.all();I.swallowKeys([R.ESCAPE()]);var U=G.create({abort:q([]),done:q([]),close:q([]),analytics:q(["message"])});I.events.escape.bind(function(a){U.trigger.abort()});var m=function(e,f){var h=Og.list(function(a,c,d,h,l){return e.apply(a,c,d,h,l,Yo(b),f)},b,c,d,a.selections());U.trigger.done();c.focus();return h},jc=function(){L.descendant(n.element(),
'[data-ephox-polish-list-style="default"]').each(function(a){Y.focus(a)})},n=rQ(l,h,f);n.events.action.bind(function(a){m(a.type(),!1)});return{action:function(){var a=n.findDefault().getOr(g);m(a,!0)},element:n.element,shortcut:!1,textkey:k(r),menuTextkey:k(D),label:k(!1),name:k(h),tooltip:ib.get,toggle:!0,value:h,updateWidget:function(a){c.getSelection().each(function(b){var c=g.query(b)?wa.on(!0):wa.off();c.fold(a.deselect,u,a.select);c.fold(a.release,u,a.press);n.update(b)})},open:function(){H.deviceType.isTouch()||
jc();I.on()},close:function(){I.off();U.trigger.close()},icon:!0,events:U.registry,enter:n.enter,destroy:function(){I.off();I.destroy();n.destroy()}}}function sQ(a,b,c){var d=function(b){if("p"===C.name(b))return jw.replace(a,b,"li");var c=p.fromTag("li");y.before(b,c);y.append(c,b);return c},e=function(a){var d=p.fromTag(b);c.each(function(a){v.set(d,"list-style-type",a)});y.before(a[0],d);O.append(d,a);g.from(m.get(a[0],"dir")).each(function(a){m.set(d,"dir",a)});return d},f=function(a){var d=Gc.mutate(a,
b);c.fold(function(){v.remove(d,"list-style-type")},function(a){v.set(d,"list-style-type",a)});return d},h=function(a){var b=k(!0),c=k(!1);return a.fold(b,c,c)},l=function(a,b){return function(c){return ri.cata(c,function(c){var d=ca.descendants(c,"li");return 0<d.length?(c=d[0],d=d[d.length-1],c=ac.first(c).getOr(c),d=ac.last(d).getOr(d),cp.outdent(a,c,0,d,oa.getEnd(d),b).map(function(a){return a.all()})):g.none()},g.none,g.none).getOr([])}},r=function(a){return ri.cata(a,function(a){return[a]},
function(a){return[f(a)]},function(a){a=F(a,d);e(a);return a})};return{apply:function(a,d,e){e=tQ.categorise(e,b,c);a=kb(e,h)?l(a,d):r;return ia(e,a)}}}function uQ(a,b){var c=G.create({analytics:q(["message"])}),d=hw(b,g.none()),e=a.region(),f=a.content(),h=a.undo();f.events.stylesheetLoad.bind(function(a){d=hw(b,g.some(a.sheets()));f.uiChanged()});var l=g.some(kw.format),r=f.isRoot,D=function(a){vQ.deviceType.isiOS()&&A(Lk(Td(F(a,function(a){return L.ancestor(a,"ul,ol",r)})),function(a){return a.dom()}),
function(a){var b=v.get(a[0],"list-style-type");v.set(a[0],"list-style-type","none");setTimeout(function(){v.set(a[0],"list-style-type",b)},0)})},x=function(){return Pb.cata(a.selections().get(),k([]),function(a){return 0<a.length?lw.groups(d,a[0]):[]},function(a,b){return lw.groups(d,a.startContainer(),r)})},H=function(a){var b=Ud.hasSelection(f),c=wQ.read(f,d),e=x();a.populate(e);Gk.updateMenu(a,c.tag(),b.content(),d.everything(),g.none())},I=function(b){d.ruleByName(b).each(function(b){kf.cata(b,
function(b,c,d){Og.inline(e,f,h,a.selections(),b)},function(b,c,d,l){Og.setClass(e,f,h,a.selections(),b,c)},function(b,c,d){Og.transform(e,f,h,a.selections(),b).each(function(a){A(a,function(a){m.remove(a,"class")});D(a)})},function(b,c,d,l){Og.transform(e,f,h,a.selections(),b).each(function(a){A(a,function(a){m.set(a,"class",c)});D(a)})});f.uiChanged()})},U=ya("region content undo selections keyboard listConstructor type styles textkey menuTextkey".split(" "),[]),Qa=U({region:e,content:f,undo:h,
selections:a.selections(),keyboard:a.keyboard(),listConstructor:t(Mk.unordered,r),type:"bullist",styles:["default","disc","circle","square"],textkey:w.key("action.bullist"),menuTextkey:w.key("list.unordered.menu")});U=U({region:e,content:f,undo:h,selections:a.selections(),keyboard:a.keyboard(),listConstructor:t(Mk.ordered,r),type:"numlist",styles:"default decimal upper-alpha lower-alpha upper-roman lower-roman lower-greek".split(" "),textkey:w.key("action.numlist"),menuTextkey:w.key("list.ordered.menu")});
var jc=function(a){return w.translate("block.describe",w.get(a.textkey()))};Qa=t(iw,Qa);U=t(iw,U);return{ui:ob.ui({"blocktag.dropdown":function(){return{name:"blocktag",textkey:w.key("block.styles"),menuTextkey:w.key("block.menu"),updateDropdown:H,action:I,values:d.everything(),render:l,tooltip:ib.get,toggle:!1,describe:jc}},"bullist.widget":Qa,"numlist.widget":U,"bullist.general":k(mw.ul(a)),"numlist.general":k(mw.ol(a))},aa),events:c.registry,destroy:u}}function db(a,b,c,d){return{context:a,profile:b,
action:c,label:k(d)}}function xQ(a){var b=a.content(),c=Uc.destroyable();return{ui:ob.ui({"bookmark.general":{toggle:!1,value:"bookmark",textkey:w.key("insert.bookmark"),action:function(){b.getSelection().each(function(a){var c=p.fromTag("span"),d=b.getSelectedText().fold(function(){return Nk.generate("textbox-bookmark")},function(a){a=50<a.length?a.substr(0,50):a;return Nk.generate(rd.getAnchorValue(a,"textbox-bookmark"))});m.set(c,"id",d);a=Vc.after(a.startContainer(),a.startOffset(),a.endContainer(),
a.endOffset())?Ec(a.endContainer(),a.endOffset(),a.endContainer(),a.endOffset()):Ec(a.startContainer(),a.startOffset(),a.startContainer(),a.startOffset());var h=p.fromText(fb());bd.insertAt(b,a,[c,h]).each(function(a){var c=B.nextSibling(a.element()).filter(function(a){return oa.isCursorPosition(a)&&!P.eq(h,a)}).getOrThunk(function(){var b=p.fromText(" ");y.after(a.element(),b);return b});b.win().each(function(a){Na.setExact(a,c,0,c,0)})})})},updateGeneral:u,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),
destroy:function(){c.clear()}}}function yQ(a,b){return{is:function(c){return m.get(c,a)===b},remove:function(b){m.remove(b,a)},set:function(c){m.set(c,a,b)}}}function zQ(a){var b=a.content(),c=G.create({analytics:q(["message","properties"])}),d=function(a,c){nw.readDir(b).map(function(b){return b[a]}).fold(wa.unchanged,pb).fold(c.deselect,u,c.select)};return{ui:ob.ui({"ltrdir.general":{value:"ltrdir",textkey:w.key("directionality.ltrdir"),action:t(ow.dirLtr,a),updateGeneral:t(d,"ltrdir"),toggle:!0},
"rtldir.general":{value:"rtldir",textkey:w.key("directionality.rtldir"),action:t(ow.dirRtl,a),updateGeneral:t(d,"rtldir"),toggle:!0}}),events:c.registry,destroy:u}}function pw(a,b){return qw(document.createElement("canvas"),a,b)}function rw(a){return a.getContext("2d")}function qw(a,b,c){a.width=b;a.height=c;return a}function sw(a,b){return new (vc.getOrDie("Blob"))(a,b)}function dp(){return new (vc.getOrDie("FileReader"))}function tw(a){return new (vc.getOrDie("Uint8Array"))(a)}function uw(a){return new sd(function(b,
c){function d(){l();b(h)}function e(){l();c("Unable to load data of type "+a.type+": "+f)}var f=URL.createObjectURL(a),h=new Image,l=function(){h.removeEventListener("load",d);h.removeEventListener("error",e)};h.addEventListener("load",d);h.addEventListener("error",e);h.src=f;h.complete&&d()})}function vw(a){return new sd(function(b,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="blob";d.onload=function(){200==this.status&&b(this.response)};d.onerror=function(){if(0===this.status){var a=
Error("No access to download image");a.code=18;a.name="SecurityError"}else a=Error("Error "+this.status+" downloading image");c(a)};d.send()})}function ww(a){var b=a.split(",");a=/data:([^;]+)/.exec(b[0]);if(!a)return g.none();a=a[1];b=Ok.atob(b[1]);for(var c=b.length,d=Math.ceil(c/1024),e=Array(d),f=0;f<d;++f){for(var h=1024*f,l=Math.min(h+1024,c),r=Array(l-h),D=0;h<l;++D,++h)r[D]=b[h].charCodeAt(0);e[f]=tw(r)}return g.some(sw(e,{type:a}))}function ep(a){return new sd(function(b,c){ww(a).fold(function(){c("uri is not base64: "+
a)},b)})}function xw(a){return new sd(function(b){var c=new dp;c.onloadend=function(){b(c.result)};c.readAsDataURL(a)})}function fp(a,b,c){function d(b,c){return a.then(function(a){return Wc.canvasToDataURL(a,b,c)})}return{getType:k(b.type),toBlob:function(){return sd.resolve(b)},toDataURL:function(){return c},toBase64:function(){return c.split(",")[1]},toAdjustedBlob:function(b,c){return a.then(function(a){return Wc.canvasToBlob(a,b,c)})},toAdjustedDataURL:d,toAdjustedBase64:function(a,b){return d(a,
b).then(function(a){return a.split(",")[1]})},toCanvas:function(){return a.then(Hc.clone)}}}function yw(a){return Wc.blobToDataUri(a).then(function(b){return fp(Wc.blobToCanvas(a),a,b)})}function AQ(a){var b=G.create({insertAssets:q(["assets"]),insertHtml:q(["html"])}),c=a.content(),d=g.none(),e=function(a){c.win().each(function(b){Na.getAtPoint(b,a.x(),a.y()).each(function(a){Na.setExact(b,a.start(),a.soffset(),a.finish(),a.foffset())})})},f=function(a){e(a);b.trigger.insertAssets(a.assets())},h=
function(b){e(b);b=b.html();a.undo().save();b=te.fromHtml(b);bd.insertAtCursor(c,b)};c.events.ready.bind(function(a){var b=g.none();d=g.some(BQ.forImages(a.api().canvas(),b,!0));d.each(function(a){a.events.dragndropimages.bind(f);a.events.dragndrophtml.bind(h)})});return{events:b.registry,destroy:function(a){d.each(function(a){a.destroy()})}}}function Pk(a,b){var c=void 0!==b?b:36E5,d=M("result","timestamp"),e={},f=function(a,b,c){e[a]=d(b,c)};b=function(a){var b=si.now();Wb(a,function(a,d){b-a.timestamp<
c&&f(d,a.result,a.timestamp)})};Zb(a)&&b(a);return{set:f,get:function(a,b){return g.from(e[b]).filter(function(b){return a-b.timestamp()<c}).map(function(a){return a.result()})},dump:function(){return Wb(e,function(a){return{result:a.result(),timestamp:a.timestamp()}})}}}function CQ(a){return Ba.nu(function(b){var c=dp();c.onload=function(a){b(a.target.result)};c.readAsText(a)})}function DQ(a,b,c){var d=Pk(c),e=Qk.get("ephox.media.service.one",gp.requestOne(),a+"/1/embed?url=${url}&maxWidth=${maxWidth}",
b);return{checkOne:function(a,b,c){var f=si.now();c=Rk.single(function(c,d){return e.execute({url:encodeURIComponent(a),maxWidth:b,fresh:d})},d,b+"&"+a,f,void 0!==c?c:!1);return Ce.foldSync(c,zw.failed,zw.success)},dumpCache:d.dump}}function EQ(a,b,c){var d=hp.embedChecking(),e=a.internalevents(),f=a.communication(),h=DQ(c.url,f.newHeaders(),b.cache),l=a.undo(),r=a.content();a=a.filter();hp.configure(a);var D=["img","video","audio"],g=function(a,b){y.after(a,b);E.remove(a)},k=function(a,b){n.add(a,
d);var e=h.checkOne(b,400);Ce.handle(e,function(b){n.remove(a,d)},function(e){n.remove(a,d);l.save();var f=p.fromHtml(e.recommended().html().trim());V(D,C.name(f))||m.set(f,"data-ephox-embed-iri",b);var h=p.fromTag("div");y.append(h,f);c.inlineStyles&&r.doc().each(function(a){Aw.inlinePrefixedStyles(a,h,".ephox-summary-card")});r.getSelection().fold(function(){g(a,f)},function(b){var c=P.eq(b.startContainer(),a)||P.contains(a,b.startContainer());g(a,f);var d=B.nextSibling(f).filter(oa.isCursorPosition).getOrThunk(function(){var a=
p.fromTag("br");y.after(f,a);return a});(c||B.parent(f).filter(function(a){return b.collapsed()&&(P.eq(b.startContainer(),a)||P.contains(a,b.startContainer()))}).isSome())&&r.setSelection(d,0,d,0)})})},I=function(a){var b=a.command(),c=a.data();m.has(c,lb.bookmarkAnchorDataAttr())||"insertLink"!==b&&"updateLink"!==b||B.parent(c).each(function(a){var b=Mb.get(a).replace(fb(),""),d=m.get(c,"href");if(b===d||"http://"+b===d)k(c,d);else{var e=B.children(a),f=va(Ld(e),function(a){return"br"===C.name(a)&&
Sk.documentPositionPreceding(c.dom(),a.dom())}).map(function(a){a=zc(e,a).getOr(-1);return e.slice(a+1,e.length)}).getOr(e);a=va(e,function(a){return"br"===C.name(a)&&Sk.documentPositionPreceding(a.dom(),c.dom())}).map(function(a){a=zc(f,a).getOr(0);return f.slice(0,a)}).getOr(f);a=hb(a,function(a,b){return a+Mb.get(b)},"").replace(fb(),"");a!==d&&"http://"+a!==d||k(c,d)}})};e.events.internal.bind(I);return{destroy:function(){e.events.internal.unbind(I)},state:function(){return{cache:h.dumpCache()}}}}
function Bw(a){var b=function(){return null===a.project.apiKey?{}:{"textbox-api-key":a.project.apiKey}},c=function(a){var b=a+(-1===a.indexOf("?")?"?":"&")+"url=";return function(a){return g.some(b+encodeURIComponent(a))}};c=void 0===a.imageEdit.proxy?g.none:c(a.imageEdit.proxy);return{headers:function(){return{headers:b(),xhrFields:{withCredentials:!0}}},newHeaders:b,proxy:c,destroy:u}}function FQ(a){var b="true"===m.get(a,"contenteditable");m.set(a,"contenteditable","true");var c=J.bind(a,"keydown",
function(a){z.trigger.keydown(a)}),d=J.bind(a,"keyup",function(a){z.trigger.keyup(a)}),e=J.bind(a,"keypress",function(a){z.trigger.keypress(a)}),f=J.bind(a,"mousedown",function(a){z.trigger.mousedown(a)}),h=J.bind(a,"mouseout",function(a){z.trigger.mouseout(a)}),l=J.bind(a,"mouseup",function(a){z.trigger.mouseup(a)}),r=J.bind(a,"contextmenu",function(a){z.trigger.contextmenu(a)}),D=J.bind(a,"cut",function(a){z.trigger.cut(a)}),x=J.bind(a,"copy",function(a){z.trigger.copy(a)}),H=J.bind(a,"paste",function(a){z.trigger.paste(a)}),
I=J.bind(p.fromDom(document),"selectionchange",function(a){z.trigger.selectionchange(a)}),U=function(){z.trigger.paint()},Qa=J.capture(a,"load",U);Cw.bind(a,U);var jc=Dw.browser.isFirefox()?"focus":"focusin",t=J.bind(a,jc,function(a){z.trigger.focus(a)}),v=J.bind(a,"focusout",function(a){z.trigger.focusOut(a)}),y=J.bind(a,"dblclick",function(a){z.trigger.dblclick(a)}),w=function(b){return P.eq(a,b)};jc={loaded:Ba.pure(N.error("no iframe in inline mode")),stylesheetLoad:Ba.pure(g.none())};var z=G.create({keydown:q(["original"]),
keyup:q(["original"]),keypress:q(["original"]),mousedown:q(["original"]),mouseup:q(["original"]),mouseout:q(["original"]),contextmenu:q(["original"]),cut:q(["original"]),copy:q(["original"]),paste:q(["original"]),focus:q(["original"]),dblclick:q(["original"]),focusOut:q(["original"]),selectionchange:q(["original"]),paint:q([])});return{win:k(window),doc:k(p.fromDom(document)),body:k(a),get:function(){return Ca.get(a)},set:function(b){Ca.set(a,b)},focus:function(){Dw.browser.isIE()?a.dom().setActive(!0):
Y.focus(a)},focused:function(){return document.activeElement===a.dom()},blur:function(){a.dom().blur()},destroy:function(){b||m.remove(a,"contenteditable");A([c,d,e,f,l,h,r,D,x,H,t,v,y,I,Qa],function(a){a.unbind()});Cw.unbind(a,U)},events:z.registry,futures:jc,background:u,foreground:u,hasRange:function(a){return Da.closest(a.startContainer(),w).isSome()&&Da.closest(a.endContainer(),w).isSome()},isActive:function(){return n.has(a,Id.active())}}}function Ew(a,b,c){var d=t(P.eq,b),e=function(c){var e=
Xa.freefallRtl(b).element();return L.ancestor(e,"table",d).filter(GQ(a,c)).map(Fw.above)},f=function(b,d,e,f,g){b.kill();Na.setExact(a,d,e,f,g);c()};return function(c){var h=c.y();e(h).orThunk(function(){var c=Xa.freefallLtr(b).element();return L.ancestor(c,"table",d).filter(HQ(a,h)).map(Fw.below)}).fold(function(){if("html"===C.name(c.target())){var e=c.x(),h=c.y();Na.getAtPoint(a,e,h).each(function(a){var e=function(a){return L.closest(a,'[contenteditable="false"]',d).isSome()},h=e(a.start());e=
e(a.finish());(h||e)&&Tk.browser.isIE()||Y.focus(b);if(Tk.browser.isIE()&&1===B.childNodesCount(b)&&(h=B.children(b)[0],"p"===C.name(h)&&0===B.childNodesCount(h))){y.append(h,p.fromTag("br"));f(c,h,0,h,0);return}f(c,a.start(),a.soffset(),a.finish(),a.foffset())})}},function(a){var b=p.fromHtml("<p><br /></p>");a.fold(function(a){y.after(a,b)},function(a){y.before(a,b)});f(c,b,0,b,0)})}}function Gw(a){var b=null,c=function(){b=null;Qb.get(a.win()).each(function(b){b.collapsed()&&a.focused()&&d.trigger.loiter(b.startContainer(),
b.startOffset())})},d=G.create({loiter:q(["node","offset"])});return{reset:function(){null!==b&&(clearTimeout(b),b=null);b=setTimeout(c,1E3)},destroy:function(){null!==b&&(clearTimeout(b),b=null)},events:d.registry}}function Hw(a,b){var c=g.none(),d=nd.tap(function(){d.control.block();var f=a();f.filter(function(a){return fa.inBody(a.startContainer())}).each(function(a){var d=function(){e.trigger.nodeChanged(a.startContainer(),a.startOffset(),c.map(function(a){return a.startContainer()}))};c.fold(d,
function(c){var e=P.eq,f=a.startContainer(),h=a.endContainer(),l=c.startContainer(),r=c.endContainer(),g=c.startOffset()!==a.startOffset();c=c.endOffset()!==a.endOffset();(!e(l,f)||!e(r,h)||!C.isText(f)&&g||!C.isText(h)&&c)&&!1===IQ([a.startContainer()],b)&&d()})});c=f;d.control.unblock()}),e=G.create({nodeChanged:q(["node","offset","prev"])});return{update:function(){d.instance()},clear:function(){c=g.none()},destroy:function(){c=g.none();d.control.block()},events:e.registry}}function JQ(){var a=
g.none();return{get:function(){return a},restore:function(b){a.each(b)},update:function(b){a=b.or(a)},clear:function(){a=g.none()}}}function KQ(a,b){var c=function(){return U().orThunk(f.get)},d=J.bind(a.body(),"click",Ew(a.win(),a.body(),u)),e=Hw(c,b),f=JQ(),h=function(){e.update();I()},l=function(){f.restore(function(a){m(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})};e.events.nodeChanged.bind(function(a){w.trigger.nodeChanged(a.node(),a.offset(),a.prev());w.trigger.uiStale()});
a.events.keyup.bind(function(a){w.trigger.keyup(a.original());h();r.reset();w.trigger.interaction()});a.events.mouseout.bind(function(a){I()});a.events.mouseup.bind(function(a){w.trigger.mouseup(a.original());h();r.reset();w.trigger.interaction()});var r=Gw(a);r.events.loiter.bind(function(a){w.trigger.loiter(a.node(),a.offset())});var g=function(){U().isNone()?l():I()},x=function(){a.isActive()&&(g(),Iw.focus(a,c,n))},k=function(){w.trigger.domChanged()},I=function(){var a=U();f.update(a)},U=function(){return Qb.get(window).filter(a.hasRange)},
m=function(a,b,c,d){try{Qb.setExact(window,a,b,c,d)}catch(bfa){console.log("Skipping restoring invalid cursor position")}},jc=function(b){v(function(c){a.isActive()&&b();h()},ip.build(a.focused,g,x,p.fromDom(document)))},n=function(a,b,c,d){jc(function(){m(a,b,c,d)})},t=function(a,b){var c=Qb.get(window);l();a=a(b);b.toOld();c.each(function(a){m(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset());LQ.browser.isEdge()&&(b.isSet()||b.toOld())});return a},v=function(a,b){a=a(b);b.toOld();
return a},A=function(b){var c=ip.build(a.focused,g,x,p.fromDom(document));return(U().isSome()?v:t)(b,c)};b=function(a){return function(){var b=arguments;return A(function(c){c.toEditor();return a(b)})}}(function(a){document.execCommand.apply(document,a);I()});var y=function(a,b){return Ma(a,b)},w=G.create({nodeChanged:q(["node","offset","prev"]),loiter:q(["node","offset"]),uiStale:q([]),domChanged:q([]),interaction:q([]),keyup:q(["original"]),mouseup:q(["original"]),keydown:Q(["original"],a.events.keydown),
keypress:Q(["original"],a.events.keypress),mousedown:Q(["original"],a.events.mousedown),contextmenu:Q(["original"],a.events.contextmenu),cut:Q(["original"],a.events.cut),copy:Q(["original"],a.events.copy),paste:Q(["original"],a.events.paste),focus:Q(["original"],a.events.focus),focusOut:Q(["original"],a.events.focusOut),dblclick:Q(["original"],a.events.dblclick),selectionchange:q(["original"]),paint:Q([],a.events.paint)});a.events.selectionchange.bind(function(a){U().each(function(){w.trigger.selectionchange(a.original())})});
return{win:a.win,doc:a.doc,body:a.body,canvas:a.body,getContent:a.get,setContent:a.set,resetContent:function(b){a.set(b);f.clear();e.clear();b=Xa.freefallLtr(a.body());n(b.element(),b.offset(),b.element(),b.offset());k()},blur:a.blur,focus:function(){ip.toEditor(a.focused,g,x,p.fromDom(document))},uiChanged:function(){A(function(){w.trigger.uiStale()})},domChanged:k,clearSelection:function(){Qb.clearAll(window)},getSelection:c,setSelection:n,setRelativeSelection:function(a,b){jc(function(){Qb.setRelative(window,
a,b)})},backupSelection:I,replaceSelection:function(a){U().fold(function(){l();U().each(function(){Qb.replace(window,a);h()})},function(b){Qb.replace(window,a);h()})},execCommand:b,destroy:function(){a.destroy();r.destroy();d.unbind();e.destroy()},events:w.registry,futures:a.futures,background:a.background,foreground:a.foreground,translateScreen:y,translateLocation:y}}function jp(){var a=null,b=[],c=function(){return null!==a},d=function(){A(b,function(a){e(a)})},e=function(b){setTimeout(function(){b.apply(null,
a)},0)};return{get:function(a){c()?e(a):b.push(a)},set:function(){a=Array.prototype.slice.call(arguments);d();b=[]},isSet:c}}function MQ(a,b,c){var d=p.fromTag("div");T.presentation(d);v.set(d,"display","none");var e=Ca.get(a);(function(b){var c=B.owner(a);A(b,function(a){NQ.addLinkIfMissing(c,a)})})(b);b=jp();var f=FQ(a),h=KQ(f,c);b.set(h);return{element:function(){return a},onCanvas:function(a){a(h.canvas())},initial:k(e),placeholder:function(){return d},tabindex:function(b){m.set(a,"tabindex",
b)},destroy:function(){E.remove(d);h.destroy()},loaded:b.get,isInline:k(!0)}}function OQ(a,b){var c=a.doc();return{execCommand:function(a){var d=arguments,f=a.toLowerCase(),h=yb("This should not be in hare.");h={fontsize:h,forecolor:h,fontname:h,bgcolor:h,inserthtml:h,blockquote:h};(void 0!==h[f]?h[f]:function(){c.dom().execCommand.apply(c.dom(),d)})();b.update()}}}function PQ(a){var b=function(){return Qb.get(a.win())},c=function(b,c,f,h){b=Ec(b,c,f,h);Qb.set(a.win(),b)};return{clearSelection:function(){Qb.clearAll(a.win())},
getSelection:b,replaceSelection:function(b){Qb.replace(a.win(),b)},setSelection:c,setRelativeSelection:function(b,c){Qb.setRelative(a.win(),b,c)},restore:u,backup:u,nativeCall:pb,focus:function(){Iw.focus(a,b,c)},destroy:u,clear:u}}function QQ(a,b){var c=g.none(),d=J.bind(b,"blur",function(a){f()}),e=function(){c=g.none()},f=function(){Qb.get(a.win()).fold(u,function(a){c=g.some(a)})},h=function(b,d){try{d(a.win(),b),c=g.some(b)}catch(I){Jw()}},l=function(a){h(a,Qb.set)},r=function(){c.each(l)},D=
function(a){var b=document.activeElement;a=a();null!==b&&void 0!==b&&b!==document.activeElement&&void 0!==b.focus&&b.focus();return a};return{clearSelection:function(){Y.hasFocus(b)&&Qb.clearAll(a.win())},getSelection:function(){return Y.hasFocus(b)?Qb.get(a.win()):c},replaceSelection:function(c){Y.hasFocus(b)||r();Qb.replace(a.win(),c)},setSelection:function(a,c,d,e){D(function(){var f=Ec(a,c,d,e);Y.hasFocus(b)?l(f):h(f,u)})},setRelativeSelection:function(b,c){D(function(){e();try{Qb.setRelative(a.win(),
b,c)}catch(I){Jw()}f()})},restore:r,backup:f,nativeCall:function(a){return D(function(){Y.hasFocus(b)||r();return a()})},focus:function(){if(document.activeElement!==b.dom()){var d=c;a.focus();d.each(l)}else Qb.get(a.win()).fold(r,u)},destroy:function(){d.unbind()},clear:e}}function RQ(a,b,c){var d=ba.detect(),e=d.browser.isIE()||d.browser.isEdge()?QQ(a,b):PQ(a),f=J.bind(a.doc(),"click",Ew(a.win(),a.body(),e.backup)),h=function(){return e.getSelection()},l=Hw(h,c),r=OQ(a,l);(d.browser.isChrome()||
d.browser.isSafari())&&r.execCommand("defaultParagraphSeparator",!1,"p");l.events.nodeChanged.bind(function(a){m.trigger.nodeChanged(a.node(),a.offset(),a.prev());m.trigger.uiStale()});a.events.keyup.bind(function(a){e.backup();l.update(a)});var g=De(l.update,300);a.events.mouseup.bind(function(a){e.backup();g.throttle(a)});var x=Gw(a);x.events.loiter.bind(function(a){m.trigger.loiter(a.node(),a.offset())});c=function(){x.reset();m.trigger.interaction()};a.events.keyup.bind(c);a.events.mouseup.bind(c);
a.events.paint.bind(function(a){return m.trigger.paint()});var k=function(){m.trigger.domChanged()},I=function(a,b,c,d){e.setSelection(a,b,c,d);l.update()},U=function(a,c){return Wa.absolute(b).translate(a,c)},m=G.create({nodeChanged:q(["node","offset","prev"]),loiter:q(["node","offset"]),uiStale:q([]),domChanged:q([]),interaction:q([]),keydown:Q(["original"],a.events.keydown),keyup:Q(["original"],a.events.keyup),keypress:Q(["original"],a.events.keypress),mousedown:Q(["original"],a.events.mousedown),
mouseup:Q(["original"],a.events.mouseup),contextmenu:Q(["original"],a.events.contextmenu),cut:Q(["original"],a.events.cut),copy:Q(["original"],a.events.copy),paste:Q(["original"],a.events.paste),focus:Q(["original"],a.events.focus),focusOut:Q(["original"],a.events.focusOut),dblclick:Q(["original"],a.events.dblclick),selectionchange:Q(["original"],a.events.selectionchange),paint:q([])});return{win:a.win,doc:a.doc,body:a.body,canvas:a.doc,getContent:a.get,setContent:a.set,resetContent:function(b){a.set(b);
e.clear();l.clear();b=Xa.freefallLtr(a.body());I(b.element(),b.offset(),b.element(),b.offset());k()},blur:a.blur,focus:function(){e.focus()},uiChanged:function(){m.trigger.uiStale()},domChanged:k,clearSelection:function(){e.clearSelection()},getSelection:h,setSelection:I,setRelativeSelection:function(a,b){e.setRelativeSelection(a,b);l.update()},backupSelection:function(){e.backup()},replaceSelection:function(a){e.replaceSelection(a);l.update()},execCommand:function(){var a=arguments;e.nativeCall(function(){r.execCommand.apply(null,
a);m.trigger.uiStale()})},destroy:function(){e.destroy();a.destroy();x.destroy();f.unbind();l.destroy()},events:m.registry,futures:a.futures,background:a.background,foreground:a.foreground,translateScreen:U,translateLocation:function(b,c){var d=Pa.get(a.doc());return U(b,c).translate(-d.left(),-d.top())}}}function SQ(a){return{background:u,foreground:u,focus:u,keydown:u,mousedown:g.some,mouseup:g.some,selectionchange:function(a){return De(a,300).throttle}}}function TQ(a,b){return{background:u,foreground:u,
focus:function(a,d,e){Pa.preserve(p.fromDom(document),function(){Pa.preserve(B.owner(e),function(){b.browser.isEdge()&&window.getSelection().removeAllRanges();e.dom().focus()})})},keydown:u,mousedown:g.some,mouseup:g.some,selectionchange:k(u)}}function UQ(a){var b=function(a){return"body"===C.name(a.target())||"html"===C.name(a.target())?g.none():g.some(a)};return{background:function(a,b,e){B.owner(b).dom().defaultView.focus()},foreground:function(a,b,e){void 0!==a.focus&&a.focus()},focus:u,keydown:function(a){void 0!==
a.focus&&a.focus()},mousedown:function(a){return b(a)},mouseup:function(a){return b(a)},selectionchange:k(u)}}function VQ(a,b){var c=a.dom().contentWindow,d=Kw.doc(a),e=L.descendant(d,"body").getOrDie();ja.add(e,[Id.base(),Id.active()]);b.autoresize&&n.add(B.documentElement(e),Id.autoresize());var f=WQ.browser.isFirefox(),h=G.create({keydown:q(["original"]),keyup:q(["original"]),keypress:q(["original"]),mousedown:q(["original"]),mouseup:q(["original"]),contextmenu:q(["original"]),cut:q(["original"]),
copy:q(["original"]),paste:q(["original"]),focus:q(["original"]),dblclick:q(["original"]),focusOut:q(["original"]),paint:q([]),selectionchange:q(["original"])}),l=XQ.get(h),r=function(){return ka(d.dom().styleSheets,function(a){try{return 0<=a.cssRules.length}catch(cfa){return b.needStyles&&console.warn("Unable to access rules from "+a.href),!1}})},D={stylesheetLoad:Ba.nu(function(a){var b=0,d=setInterval(function(){50<b||0>=c.stillToLoad?(clearInterval(d),a(g.some(r()))):b++},100)})},x=J.bind(d,
"keydown",function(a){l.keydown(c);h.trigger.keydown(a)}),H=J.bind(d,"keyup",function(a){h.trigger.keyup(a)}),I=J.bind(d,"keypress",function(a){h.trigger.keypress(a)}),U=J.bind(d,"mousedown",function(a){l.mousedown(a).fold(function(){a.kill()},h.trigger.mousedown)}),m=J.bind(d,"mouseup",function(a){l.mouseup(a).fold(function(){a.kill()},h.trigger.mouseup)}),p=J.bind(d,"contextmenu",function(a){h.trigger.contextmenu(a)}),u=J.bind(d,"cut",function(a){h.trigger.cut(a)}),t=J.bind(d,"copy",function(a){h.trigger.copy(a)}),
v=J.bind(d,"paste",function(a){h.trigger.paste(a)}),w=J.bind(d,f?"focus":"focusin",function(a){h.trigger.focus(a)}),y=J.bind(d,"focusout",function(a){h.trigger.focusOut(a)}),z=J.bind(d,"dblclick",function(a){h.trigger.dblclick(a)}),C=l.selectionchange(function(a){h.trigger.mouseup(a)}),E=J.bind(d,"selectionchange",function(a){C(a);h.trigger.selectionchange(a)}),F=J.bind(d,"touchstart",function(a){h.trigger.mousedown(a)}),K=J.bind(d,"touchend",function(a){h.trigger.mouseup(a);O()}),M=function(){h.trigger.paint()},
P=J.capture(d,"load",M),N=function(){c.addEventListener("resize",M,!1);return{unbind:function(){c.removeEventListener&&c.removeEventListener("resize",M,!1)}}}(),O=function(){l.foreground(c,a,e)};return{win:k(c),doc:k(d),body:k(e),get:function(){return Ca.get(e)},set:function(a){Ca.set(e,a)},focus:function(){l.focus(c,a,e)},focused:function(){return document.activeElement===a.dom()},blur:function(){e.dom().blur()},destroy:function(){A([x,H,I,U,m,p,u,t,v,w,y,E,z,F,K,P,N],function(a){a.unbind()})},events:h.registry,
futures:D,background:function(){l.background(c,a,e)},foreground:O}}function YQ(a){var b=p.fromTag("iframe");n.add(b,ZQ.resolve("content-iframe"));var c=g.none(),d=jp(),e=J.bind(b,"load",function(){e.unbind();var f=$Q(a);Lw.write(b,f);f=Mw.onShow(b,function(){c.each(pb);c=g.none();fa.inBody(b)&&d.set(VQ(b,a))});c=g.some(f)});return{element:function(){return b},tabindex:function(a){m.set(b,"tabindex",a)},destroy:function(){E.remove(b);e.unbind();c.each(pb)},loaded:d.get}}function aR(a,b){var c=YQ(a),
d=jp(),e=u;c.loaded(function(f){var h=ba.detect().browser.isIE(),l=RQ(f,c.element(),b),r=c.element(),g=B.parent(r).fold(function(){return 0},function(a){return parseInt(v.get(a,"min-height"))}),x=function(a){v.remove(l.body(),"min-height");a=pa.get(B.documentElement(l.body()));var b=pa.get(r);a!==b&&(b=parseInt(v.get(r,"margin-top")),b=g-b,a=a>b?a:b,v.set(r,"min-height",a+"px"),150>a?v.set(r,"height",a+"px"):v.remove(r,"height"))},k=function(a){a=pa.get(l.body());var b=pa.get(c.element());a!==b&&
pa.set(l.body(),b)},I=pi(x,0);h=h?I.throttle:x;h=a.autoresize?h:k;x=a.autoresize?x:k;l.events.uiStale.bind(t(h,"uiStale"));l.events.domChanged.bind(t(h,"domChanged"));l.events.paint.bind(t(h,"paint"));f.events.keyup.bind(t(x,"keyup"));f.events.mouseup.bind(t(x,"mouseup"));setTimeout(function(){d.set(l);e=l.destroy},0)});return{element:c.element,onCanvas:function(a){d.get(function(b){a(b.canvas())})},initial:k(""),placeholder:c.element,tabindex:c.tabindex,destroy:function(){e();c.destroy()},loaded:d.get,
isInline:k(!1)}}function bR(a){var b=g.none(),c=g.none(),d=function(){b.each(function(b){a.setSelection(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())});c.each(function(a){a.restore()})},e=function(){b=g.none();c=g.none()};return{restore:function(){d();e()},save:function(){b=a.getSelection();c=a.doc().map(Pa.capture)},get:function(){return b},clear:e,attempt:function(a){b=a.or(b)}}}function kp(){var a=G.create({fail:q(["url","image"]),success:q(["url","image"]),start:q(["url"])}),
b=function(a,b,c){var d=a.dom();d.addEventListener(b,c,!1);return{unbind:function(){d.removeEventListener(b,c,!1)}}},c=function(c){var d=m.get(c,"src"),f=b(c,"load",function(){f.unbind();h.unbind();(!0===c.dom().complete?a.trigger.success:a.trigger.fail)(d,c)}),h=b(c,"error",function(){f.unbind();h.unbind();a.trigger.fail(d,c)})};return{go:function(b){a.trigger.start(b);var d=new Image;d.src=b;c(p.fromDom(d))},monitor:c,events:a.registry}}function cR(a){var b=Ga({}),c=Ga([]),d={},e=g.none();return{structure:b.get,
all:c.get,main:function(){return c.get()[0]},update:function(f){A(c.get(),function(a){E.remove(a)});e=g.some(f);var h=jb(d);Ra(d,function(a){a.assign(e)});var l=Wb(d,function(a,b){return a.situation(f)}),r=dR.derive(a,h,l),D=eR.derive(a,h,l);h=zb(h,function(a,b){return ra(a,l[b].submenus())},{});if(0===r.length)c.set([]);else{var x=qb.mainmenu(a,z.resolve("main-context-menu"),[]);O.append(x,r);T.menu(x,w.translate("aria.context.menu.generic"));r=[x].concat(D);A(r,function(a){n.add(a,z.resolve("layer-menus"))});
c.set(r);b.set(h)}},handle:function(a){var b=lp.type(a);b=d[b];void 0!==b&&b.handle(a)},register:function(a,b){d[a]=b}}}function fR(a,b,c,d,e,f){var h=[],l={register:function(a,b){h=h.concat([{name:a,feature:b}])},destroy:u};b.events.ready.bind(function(r){l=gR(a,b,c,d,e,f);A(h,function(a){l.register(a.name,a.feature)})});return{register:function(a,b){l.register(a,b)},destroy:function(){l.destroy()}}}function hR(a,b,c,d){var e=function(c){b.get().fold(u,function(b){c.stopper();d.transaction(function(){A(b,
iR)});a.domChanged();a.toEditing();va(b,function(a){return za.is(a,Vd.lastSelectedSelector())}).bind(ac.first).each(function(b){a.setSelection(b,0,b,0)})},u)},f=c.editor();f.events.del.bind(e);f.events.backspace.bind(e);f.on();return{destroy:function(){f.off()}}}function jR(){var a=!0;return{isHandled:function(){return a},handle:function(){a=!1}}}function kR(a,b){var c=G.create({preLinebreak:q(["handler"]),postLinebreak:q([])});lR.listen(a);var d=function(d){b.save();a.getSelection().each(function(b){var e=
jR();c.trigger.preLinebreak(e);a.getSelection().each(function(b){e.isHandled()&&(Nw.preLinebreak(a),(d?Ow.soft:Ow.hard)(b,a.isRoot).each(function(b){a.setRelativeSelection(b.start(),b.finish());a.domChanged();a.cursorIntoView()}));c.trigger.postLinebreak()})})},e=Ud.isTextArea;a.events.keydown.bind(function(a){Md.isEnter(a)&&!e(a.original().target())&&(a.original().raw().preventDefault(),d(a.original().raw().shiftKey))});return{linebreak:d,destroy:u,events:c.registry}}function mp(a,b){return{find:function(b){return ca.descendants(b,
a)},cleaner:b}}function mR(){var a=[];return{add:function(b){a.push(b)},get:function(){return a.slice(0)}}}function nR(){var a={},b=function(b){return g.from(a[b])};return{get:b,getOrInit:function(b){var c=a[b];void 0===c&&(a[b]=mR(),c=a[b]);return c},filterDom:function(a,d){b(a).each(function(a){Uk.filterDom(d,a.get())})},filterHtml:function(a,d){return b(a).fold(function(){return d},function(a){return Uk.filterHtml(d,a.get())})}}}function oR(a,b){return{find:function(b){return Cc.descendants(b,
a)},cleaner:b}}function pR(a){var b=nR(),c=k("output"),d=k("input"),e=k("history"),f=k("internal"),h=k("paste"),l=[],r=function(a,c,d){a=b.getOrInit(a);c=mp(c,d);a.add(c)},g=function(a,c,d){a=b.getOrInit(a);c=oR(c,d);a.add(c)};a=sv(a,r,g);return{add:function(a,b,c){r(a,"."+b,c)},addSelector:r,addPredicate:g,filterHtml:b.filterHtml,filterDom:b.filterDom,internal:f,output:c,input:d,paste:h,history:e,customFilters:k(a),state:a.state,destroy:u,addExcludedContext:function(a){l=l.concat(a)},includeContext:function(a){return!Va(l,
t(za.is,a))}}}function qR(a,b,c){var d=!1,e=G.create({maximize:q(["layout"]),restore:q(["layout"]),analytics:q(["message"]),select:q([]),deselect:q([])}),f=function(){e.trigger.maximize(c.alternate)},h=function(){e.trigger.restore(c.alternate)},l=function(a){d?a.select():a.deselect()},r=function(){e.trigger.analytics("fullscreen_"+(d?"off":"on"));a.focus();(d?h:f)()},g=function(a,b){a=w.key(d?"action.toggle.fullscreen":"action.fullscreen");return ib.get(a,b)};b.events.fullscreen.bind(r);b=ob.ui({"fullscreen.general":function(){return{toggle:!0,
value:"fullscreen",textkey:w.key("action.fullscreen"),tooltip:g,action:r,updateGeneral:l,icon:!0,shortcut:!0,selected:d}}},aa);var x=ob.actions({maximize:f,restore:h});return{ui:b,actions:x,select:function(){d=!0},deselect:function(){d=!1},destroy:u,events:e.registry}}function rR(){var a={inputLinks:"insertLink"},b=G.create({internal:q(["command","data"])}),c=function(c,e){g.from(a[c]).fold(function(){throw Error("invalid internal event: "+c);},function(a){A(e,function(c){b.trigger.internal(a,c)})})};
return{input:function(a){a=rd.many(a);c("inputLinks",a)},destroy:u,events:b.registry}}function sR(a,b,c){var d=ki(),e=[J.bind(b,"keydown",d.keydown),J.bind(b,"keypress",d.keypress),J.bind(c,"keydown",d.keydown),J.bind(c,"keypress",d.keypress)],f=function(a){d.keydown(a.original())},h=function(a){d.keypress(a.original())};a.events.keydown.bind(f);a.events.keypress.bind(h);return{off:d.off,on:d.on,swallowShortcuts:d.swallowShortcuts,yieldShortcuts:d.yieldShortcuts,swallowChars:d.swallowChars,yieldChars:d.yieldChars,
swallowKeys:d.swallowKeys,yieldKeys:d.yieldKeys,destroy:function(){A(e,function(a){a.unbind()});a.events.keydown.unbind(f);a.events.keypress.unbind(h)},events:d.events}}function tR(a){var b=ki(),c=function(a){b.keydown(a.original())},d=function(a){b.keypress(a.original())};a.events.keydown.bind(c);a.events.keypress.bind(d);return{off:b.off,on:b.on,swallowShortcuts:b.swallowShortcuts,yieldShortcuts:b.yieldShortcuts,swallowChars:b.swallowChars,yieldChars:b.yieldChars,swallowKeys:b.swallowKeys,yieldKeys:b.yieldKeys,
events:b.events,destroy:function(){a.events.keydown.unbind(c);a.events.keypress.unbind(d)}}}function uR(a){var b=ki(),c=J.bind(a,"keydown",b.keydown),d=J.bind(a,"keypress",b.keypress);return{off:b.off,on:b.on,swallowShortcuts:b.swallowShortcuts,yieldShortcuts:b.yieldShortcuts,swallowChars:b.swallowChars,yieldChars:b.yieldChars,swallowKeys:b.swallowKeys,yieldKeys:b.yieldKeys,destroy:function(){c.unbind();d.unbind()},events:b.events}}function vR(a,b){return{all:function(){return sR(a,b.element(),b.uiContainerParent())},
container:function(a){return uR(a)},editor:function(){return tR(a)},destroy:u}}function Pw(a){return{backup:aa,restore:k(g.none()),element:k(a)}}function wR(a,b){var c=z.resolve("ops-eph-cursor");a.add(a.internal(),c,Ka.remove);a.add(a.output(),c,Ka.remove);a.addExcludedContext(["."+c]);var d=function(a){var d=function(d){d=Qw.diagnose(b.isRoot,d)(c,a);d.cursor().each(function(a){fa.inBody(a.startContainer())&&fa.inBody(a.endContainer())&&b.getSelection().each(function(c){b.setSelection(a.startContainer(),
a.startOffset(),a.endContainer(),a.endOffset())})});return d.result()};return function(){return b.getSelection().fold(a,d)}};return{destroy:u,run:function(a){return d(a)()}}}function xR(a,b){var c=wR(a,b),d=function(a,c){a=a();var d=Rw.handle(c);b.getSelection().forall(function(a){return!P.eq(a.startContainer(),d.startContainer())||!P.eq(a.endContainer(),d.endContainer())||a.startOffset()!==d.startOffset()||a.endOffset()!==d.endOffset()})&&b.setSelection(d.startContainer(),d.startOffset(),d.endContainer(),
d.endOffset());return a},e=function(a){return C.isText(a)||"br"===C.name(a)};return{destroy:function(){},run:c.run,preserve:t(Zf.preserve,b),lightweightWith:function(a,b){return e(b.startContainer())&&e(b.endContainer())||lc.detect(g.some(b)).isSome()?d(a,b):c.run(a)},adapt:function(a){b.getSelection().each(function(b){c.run(function(){a(b.startContainer(),b.endContainer())})})},pure:function(a){b.getSelection().each(function(b){a(b.startContainer(),b.endContainer())})},atomic:function(a){return c.run(a)}}}
function Sw(){var a=G.create({back:q([]),abort:q([])});return{ui:ob.ui({"back.general":{toggle:!1,value:"mobile-back",textkey:w.key("toolbar.backbutton"),action:function(){a.trigger.back()},updateGeneral:u,icon:!0,label:!0}}),events:a.registry,destroy:u}}function Ee(a,b){return N.error({small:k(a),big:k(b)})}function yR(a,b,c,d,e){var f=function(a,b){return a()?b:{feature:g.none()}};c=f(function(){return!a&&nc.isLargeDesktop()},{feature:c.ui(),command:"fullscreen",type:"general",unsupported:"Fullscreen is not supported in inline mode"});
e=nc.choice([ti(nc.isLargeDesktop,{feature:d.fileupload().ui(),command:"fileupload",type:"general"}),ti(nc.isLargeTouch,{feature:d.fileupload().ui(),command:"fileupload",type:"menu"})],np.make({feature:d.fileupload().ui(),command:"fileupload"},e.allowLocalImages?["camera"]:[]));var h=f(nc.isLargeDesktop,{feature:d.accessibility().ui(),command:"a11ycheck",type:"general"});f=f(nc.isLarge,{feature:d.specialchar().ui(),command:"specialchar",type:"general"});var l=nc.choice([ti(nc.isLarge,{feature:d.blocktag().ui(),
command:"bullist",type:"split-widget"})],{feature:d.blocktag().ui(),command:"bullist",type:"general"}),r=nc.choice([ti(nc.isLarge,{feature:d.blocktag().ui(),command:"numlist",type:"split-widget"})],{feature:d.blocktag().ui(),command:"numlist",type:"general"}),D={feature:d.formatting().ui(),command:"superscript",type:"general"},x={feature:d.formatting().ui(),command:"subscript",type:"general"},k={feature:d.formatting().ui(),command:"strikethrough",type:"general"},I={feature:d.font().ui(),command:"fontface",
type:"dropdown"},U=nc.choice([ti(nc.isTouch,{feature:d.font().ui(),command:"fontsize",type:"general"})],{feature:d.font().ui(),command:"fontsize",type:"inline-widget"}),m={feature:d.font().ui(),command:"fontcolor",type:"widget"},n={feature:d.spelling().hasAutocorrect()?d.macros().ui():g.none(),command:"autocorrect",type:"general"},p={feature:d.spelling().ui(),command:"spelling",type:d.spelling().hasDropdown()?"dropdown":"general"},q={feature:d.macros().ui(),command:"capitalisation",type:"general"},
u={feature:d.help().ui(),command:"help",type:"general"},t={feature:d.wordcount().ui(),command:"wordcount",type:"general"};return{link:{feature:d.link().ui(),command:"link",type:"general"},wordcount:t,media:{feature:d.media().ui(),command:"media",type:"general"},hr:{feature:d.horizontalrule().ui(),command:"horizontalrule",type:"general"},specialchar:f,fileupload:e,table:{feature:d.table().ui(),command:"table",type:"widget"},undo:{feature:b.ui(),command:"undo",type:"general"},redo:{feature:b.ui(),command:"redo",
type:"general"},styles:{feature:d.blocktag().ui(),command:"blocktag",type:"dropdown"},language:{feature:d.parlance().ui(),command:"parlance",type:"dropdown"},ltrdir:{feature:d.directionality().ui(),command:"ltrdir",type:"general"},rtldir:{feature:d.directionality().ui(),command:"rtldir",type:"general"},bold:{feature:d.formatting().ui(),command:"bold",type:"general"},italic:{feature:d.formatting().ui(),command:"italic",type:"general"},underline:{feature:d.formatting().ui(),command:"underline",type:"general"},
bookmark:{feature:d.bookmark().ui(),command:"bookmark",type:"general"},strikethrough:k,superscript:D,subscript:x,ul:l,ol:r,removeformat:{feature:d.formatting().ui(),command:"removeformat",type:"general"},alignment:{feature:d.alignindent().ui(),command:"alignment",type:"dropdown"},outdent:{feature:d.alignindent().ui(),command:"outdent",type:"general"},indent:{feature:d.alignindent().ui(),command:"indent",type:"general"},blockquote:{feature:d.alignindent().ui(),command:"blockquote",type:"general"},
"font-menu":{name:"font",textkey:w.key("font.menu-button"),menuTextkey:w.key("font.menu"),type:"submenu",contentFocus:!0,commands:[{category:"Font-menu",items:[I,U,m,D,x,k]}]},"font-face":I,"font-size":U,"font-color":m,fullscreen:c,find:{feature:d.findreplace().ui(),command:"find",type:"general"},accessibility:h,usersettings:{name:"usersettings",textkey:w.key("cog.menu-button"),menuTextkey:w.key("cog.menu"),type:"submenu",flatten:np.never(),contentFocus:!0,commands:[{category:"a",items:[t]},{category:"b",
items:[p,n,q]},{caetgory:"",items:[u]}]}}}function Tw(){var a={id:"insert",label:w.key("insert.menu-button"),menuLabel:w.key("insert.menu"),items:[["link","bookmark","fileupload","media","table"],["specialchar","hr"]]};return{undo:{label:w.key("category.undo"),items:["undo","redo"]},insert:{label:w.key("category.insert"),items:[a]},style:{label:w.key("category.style"),items:["styles"]},language:{label:w.key("category.language"),items:["language","ltrdir","rtldir"]},emphasis:{label:w.key("category.emphasis"),
items:["bold","italic","underline"]},align:{label:w.key("category.align"),items:["alignment"]},listindent:{label:w.key("category.listindent"),items:["ul","ol","outdent","indent","blockquote"]},format:{label:w.key("category.format"),items:["font-menu","removeformat"]},tools:{label:w.key("category.tools"),items:["find","accessibility","fullscreen","usersettings"]},"table-tools":{label:w.key("category.table"),items:["table-tools"]},"image-tools":{label:w.key("category.image"),items:["image-tools","crop-tools"]}}}
function Vk(a){return{closeMenus:function(b){b=b?b.target():a;Uw.target(b,"mousedown")}}}function zR(a){return function(b,c){var d=J.bind(a,"touchmove",b.move),e=J.bind(a,"touchend",b.drop);return{element:k(a),start:u,stop:u,destroy:function(){d.unbind();e.unbind()}}}}function Vw(a,b,c,d){var e=Ga(g.none());c=Wk.mode({compare:op.compare,extract:op.extract,sink:c,mutate:function(a,c){e.get().each(function(a){op.resize(b,a,c)})}});var f=oi.transform({},{mode:c}),h=J.bind(a,"touchstart",function(a){"img"===
C.name(a.target())&&2===a.raw().touches.length&&(e.set(g.some(a.target())),f.on(),f.go(b))});f.events.stop.bind(function(){e.get().each(function(a){v.remove(a,"transform")});d()});return{destroy:function(){h.unbind();f.destroy()}}}function AR(a,b,c){var d=c.toolbar.element(),e=Ww.tag(),f=[],h=p.fromDom(document),l=Vk(d),r=null,D=Uc.api(),x=g.none(),k=function(){D.run(function(a){a.toEditing()})},I=function(){l.closeMenus()},U=function(){a.getSelection().each(function(a){a=a.collapsed()?"0px":"23px";
v.set(d,"margin-top",a)})},m=function(a){v.set(d,"margin-top","0px")},jc=function(){var c=[J.bind(d,"touchmove",l.closeMenus)];f=a.doc().map(function(a){return b||!0===BR?[]:[J.bind(a,"selectionchange",U),J.bind(h,"focusin",m)]}).getOr([]).concat(c)},q=function(){A(f,function(a){a.unbind()})};return{enter:function(){a.body().each(function(b){a.doc().each(function(c){a.win().each(function(d){Y.focus(b);r=Pg.onChange();var e=zR(c);e=Vw(c,b,e,u);x=g.some(e);d=CR.setup(window,d);D.set(d);a.events.toEditing.bind(k);
r.events.change.bind(I)})})});n.add(d,"ephox-polish-mobile-show");c.toolbar.refresh();e.maximize();jc()},exit:function(){D.clear();a.events.toEditing.unbind(k);r.events.change.unbind(I);null!==r&&r.destroy();e.restore();q()},destroy:function(){x.each(function(a){a.destroy()});q()}}}function Xw(){var a=p.fromTag("div");n.add(a,z.resolve("disabled-mask"));var b=!1,c=S.div();n.add(c,z.resolve("content-container"));var d=S.div();T.hidden(d,!0);n.add(d,z.resolve("tap-icon"));y.append(c,d);var e=S.div();
n.add(e,z.resolve("disclosure"));y.append(e,p.fromText(w.translate("taptoedit")));y.append(c,e);y.append(a,c);T.textButton(a,c);var f=G.create({fullscreen:q([])}),h=function(b){var c=a.dom().getClientRects()[0];return kb(b,function(a){return a.pageY>=c.top&&a.pageY<=c.top+c.height&&a.pageX>=c.left&&a.pageX<=c.left+c.width})},l=[J.bind(a,"touchmove",function(a){b=!0}),J.bind(a,"touchend",function(a){var c=a.raw().changedTouches;h(c)&&!b&&(a.kill(),f.trigger.fullscreen())}),J.bind(a,"touchstart",function(a){b=
!1}),J.bind(a,"click",function(a){a.kill();f.trigger.fullscreen()})];return{element:k(a),events:f.registry,destroy:function(){A(l,function(a){a.unbind()});E.remove(d);E.remove(e);E.remove(c);E.remove(a)},show:function(){v.remove(a,"display")},hide:function(){v.set(a,"display","none")}}}function Yw(a,b,c,d,e,f){var h=f.element(),l=AR(a,e.fillscreen,f),r=function(){l.enter();d.actions().maximize()},g=function(){var a=Xw();y.append(f.element(),a.element());a.events.fullscreen.bind(function(a){d.actions().maximize()})};
return{init:function(){f.socket(a);a.events.scrollToCursor.bind(function(){Zf.cursorIntoView(a)})},loaded:function(){var a=!0===e.fillscreen;(n.has(h,z.resolve("fullscreen-maximized"))||a?r:g)()},restoreEditor:function(){d.actions().restore();l.exit()},destroy:function(){a.body().each(Y.blur)}}}function DR(a,b,c,d,e){var f=d.toolbar.items,h=function(h){var l=Yw(a,b,c,e,d,h),g=Sw();h=ui.config({items:[["back"]].concat(f),contextual:[]},{back:{feature:g.ui(),command:"back",type:"general"}},{allowLocalImages:d.allowLocalImages});
g.events.back.bind(function(){l.restoreEditor()});return{init:l.init,loaded:l.loaded,config:h,destroy:function(){l.destroy();g.destroy()}}};return{tabbed:h,full:h,destroy:u}}function ER(a,b,c,d,e){var f=d.toolbar.items,h=function(h){var l=Yw(a,b,c,e,d,h);h=ui.config({items:f,contextual:[]},{},{allowLocalImages:d.allowLocalImages});return{init:l.init,loaded:l.loaded,config:h,destroy:function(){l.destroy()}}};return{tabbed:h,full:h,destroy:u}}function FR(a,b,c,d){b=function(b){return{init:function(){b.socket(a);
a.events.scrollToCursor.bind(function(){Zf.cursorIntoView(a)});a.events.toEditing.bind(a.focus)},loaded:u,config:ui.config(d.toolbar,{},{allowLocalImages:d.allowLocalImages}),destroy:u}};return{tabbed:b,full:b,destroy:u}}function GR(a,b){var c=Ww.tag(),d=g.none(),e=Xw();return{maximize:function(){d=g.some(document.body.scrollTop);v.set(e.element(),"display","none");n.add(a,z.resolve("fullscreen-maximized"));Zw.clobberStyles(a,b);c.maximize()},restore:function(){Zw.restoreStyles();n.remove(a,z.resolve("fullscreen-maximized"));
c.restore();v.remove(e.element(),"display");d=d.bind(function(a){document.body.scrollTop=a;return g.none()})},destroy:function(){e.destroy()},mask:k(e)}}function HR(a,b){var c=a.document,d=p.fromTag("div");n.add(d,Wd.resolve("unfocused-selections"));y.append(p.fromDom(c.documentElement),d);var e=J.bind(d,"touchstart",function(c){c.prevent();pp.resume(a,b);h()}),f=function(a){var b=p.fromTag("span");ja.add(b,[Wd.resolve("layer-editor"),Wd.resolve("unfocused-selection")]);v.setAll(b,{left:a.left+"px",
top:a.top+"px",width:a.width+"px",height:a.height+"px"});return b},h=function(){E.empty(d)};return{update:function(){h();var b=qp.getRectangles(a);b=F(b,f);O.append(d,b)},isActive:function(){return 0<B.children(d).length},destroy:function(){e.unbind();E.remove(d)},clear:h}}function IR(a){var b=Ga(Fe.pure({}));return{start:function(c){var d=Fe.nu(function(b){return a(c).get(b)});d.get(aa);b.set(d)},idle:function(a){b.get().get(function(){a()})}}}function JR(a){return function(b,c){var d=J.bind(a,"touchmove",
b.move),e=J.bind(a,"touchend",b.drop),f=J.bind(a,"gesturestart",function(a){"img"===C.name(a.target())&&a.prevent()});return{element:k(a),start:u,stop:u,destroy:function(){d.unbind();e.unbind();f.unbind()}}}}function KR(a,b,c,d,e,f,h,l){var r=[],D=f.toolbar.element(),x=f.banners(),k=f.viewport(),I=g.none(),U=Vk(D),m=null,q=Uc.api(),u=g.none(),t=Ic.event(k),w=ya("cWin ceBody socket toolstrip toolbar contentElement cursor keyboardType isScrolling".split(" "),[]),y=function(){q.run(function(a){a.highlightSelection()})},
B=function(){q.run(function(a){a.refreshSelection()})},C=function(a){var b=Wa.absolute(a).top()-k.dom().scrollTop;q.run(function(c){c.scrollIntoView(b,b+pa.get(a))})},E=function(){$w.insertAtCursor(d,a,function(a){var b=a.absolute().top()-k.dom().scrollTop;q.run(function(c){c.scrollIntoView(b,b+a.height())})})},F=function(a){E();q.run(function(a){a.syncHeight()})},G=function(a){var b=pa.get(D);q.run(function(a){a.setViewportOffset(b)});B();F()},K=function(a){C(a.element())},M=De(F,300),O=function(){U.closeMenus()},
N=function(){W();var a=setInterval(function(){0===window.pageYOffset&&(clearInterval(a),F())},100)},Q=function(){q.run(function(a){a.clearSelection()})},R=function(){Q();M.throttle()},S=function(){q.run(function(a){a.toEditing()})},T=function(){q.run(function(a){a.toReading()})},V=function(a){q.run(function(b){b.onToolbarTouch(a)})},W=function(){(Pg.get().isPortrait()?n.remove:n.add)(f.element(),z.resolve("mobile-landscape"))},X=function(a){var b=v.get(a,"background-color");void 0!==b&&""!==b&&v.set(a,
"-webkit-tap-highlight-color",b)},Z=function(b){var c=a.win().getOrDie(),d=function(a){Y.focus(b);a=a.raw().changedTouches[0];Na.getAtPoint(c,a.pageX,a.pageY).each(function(a){Na.setExact(c,a.start(),a.soffset(),a.finish(),a.foffset())})},e=a.doc().map(function(a){var c=JR(a);c=Vw(a,b,c,F);u=g.some(c);var e=p.fromDom(a.dom().documentElement);return[J.bind(a,"touchend",function(a){(P.eq(e,a.target())||P.eq(b,a.target()))&&d(a)})]}).getOr([]),f=[J.capture(D,"touchstart",function(a){y();V(a)}),J.bind(b,
"touchstart",Q),Xk.handle(b,aa),J.bind(D,"touchmove",U.closeMenus)];r=e.concat(f)},aa=function(a){a.kill()};return{exit:function(){a.body().each(function(b){v.remove(x,"display");v.set(f.viewport(),"overflow","hidden");I=I.bind(function(a){a.unbind();return g.none()});n.remove(D,z.resolve("mobile-show"));q.clear();Y.blur(b);v.remove(b,"padding-top");A(r,function(a){a.unbind()});h.restore();a.events.keyup.unbind(R);a.events.domChanged.unbind(M.throttle);a.events.scrollToCursor.unbind(M.throttle);a.events.scrollToElement.unbind(K);
a.events.domChanged.unbind(B);a.events.nodeChanged.unbind(B);a.events.toEditing.unbind(S);a.events.toReading.unbind(T);m.events.change.unbind(O);m.events.ready.unbind(N);f.toolbar.events.transitionend.unbind(G);null!==m&&m.destroy()})},enter:function(b){a.body().each(function(b){a.win().each(function(d){m=Pg.onChange();h.maximize();Z(b);Y.focus(b);I=g.some(ax.exclusive(c,"."+Ic.scrollable()));v.getRaw(D,"overflow-x").is("auto")&&L.descendant(D,".ephox-chameleon-toolbar").each(function(a){ax.markAsHorizontal(a);
Ic.register(a)});X(b);W();document.body.scrollTop=0;n.add(D,z.resolve("mobile-show"));f.toolbar.refresh();v.set(x,"display","block");L.descendant(D,".ephox-chameleon-toolbar").each(function(c){q.set(LR.setup(w({cWin:d,ceBody:b,socket:k,toolstrip:D,toolbar:c,contentElement:a.element(),cursor:a.cursor(),keyboardType:MR.stubborn,isScrolling:t.isScrolling})))});a.events.keyup.bind(R);a.events.domChanged.bind(M.throttle);a.events.scrollToCursor.bind(M.throttle);a.events.scrollToElement.bind(K);a.events.domChanged.bind(B);
a.events.nodeChanged.bind(B);a.events.toEditing.bind(S);a.events.toReading.bind(T);m.events.change.bind(O);m.events.ready.bind(N);f.toolbar.events.transitionend.bind(G);F()})})},destroy:function(){u.each(function(a){a.destroy()});I.each(function(a){a.unbind()});t.destroy()}}}function bx(a,b,c,d,e){var f=GR(e.element(),a),h=p.fromDom(document),l=a.element(),r=k(!0===d.fillscreen),g=KR(a,b,h,c,l,e,f,r),x=function(a){var b=B.children(a),c;if(!(c=0===b.length)){if(b=1===b.length)b=Ca.get(a),b=10===b.charCodeAt(0)&&
10===b.charCodeAt(1);c=b}c&&(b=p.fromHtml("<p><br></p>"),y.append(a,b));g.enter()},H=function(a){y.append(e.element(),f.mask().element());f.mask().events.fullscreen.bind(function(a){g.enter()})},I=function(a){(r()?x:H)(a)};return{init:function(){e.socket(a)},loaded:function(){a.body().each(I)},restoreEditor:function(){a.body().each(Y.blur);a.element().dom().focus();a.element().dom().blur();g.exit();Y.focus(f.mask().element())},destroy:function(){a.body().each(Y.blur);g.destroy();f.destroy()}}}function NR(a,
b,c,d){var e=d.toolbar.items;return{tabbed:function(f){var h=bx(a,b,c,d,f),l=Sw();f=ui.config({items:[["back"]].concat(e),contextual:[]},{back:{feature:l.ui(),command:"back",type:"general"}},{allowLocalImages:d.allowLocalImages});l.events.back.bind(function(){h.restoreEditor()});return{init:h.init,loaded:h.loaded,config:f,destroy:function(){h.destroy();l.destroy()}}},full:yb("mobile does not support fullscreen layout"),destroy:u}}function OR(a,b,c,d){var e=d.toolbar.items;return{tabbed:function(f){var h=
bx(a,b,c,d,f);f=ui.config({items:e,contextual:[]},{},{allowLocalImages:d.allowLocalImages});return{init:h.init,loaded:h.loaded,config:f,destroy:function(){h.restoreEditor();h.destroy()}}},full:yb("mobile does not support fullscreen layout"),destroy:u}}function PR(a,b,c,d,e){return(cx.deviceType.isiOS()?!0===e.fillscreen?OR:NR:cx.deviceType.isAndroid()?!0===e.fillscreen?ER:DR:FR)(a,b,c,e,d)}function vi(a,b){b=rp.readOr(a,b);var c=Ga(b),d=function(a){c.set(a)};return{setAndCache:function(b){d(b);rp.write(a,
b)},set:d,get:function(){return c.get()}}}function QR(a){var b=vi("native.spelling",a.nativeSpelling),c=vi("spelling",a.spelling),d=vi("autocorrect",a.autocorrect),e=vi("linkpreviews",a.linkpreviews),f=vi("capitalisation",a.capitalisation);return{spelling:k(c),nativeSpelling:k(b),autocorrect:k(d),linkpreviews:k(e),capitalisation:k(f),state:function(){return{nativeSpelling:b.get(),spelling:c.get(),autocorrect:d.get(),linkpreviews:e.get(),capitalisation:f.get()}},destroy:u}}function RR(a,b,c){var d=
b.all();d.on();var e=[];d.events.backspace.bind(function(){sp.get(a,e,wi.left).each(E.remove)});b=function(b){var d=b.stopper();sp.get(a,e,wi.left).each(function(b){d();dx.upOrLeft(a,c,b)})};d.events.right.bind(function(b){var d=b.stopper();sp.get(a,e,wi.right).each(function(b){d();dx.right(a,c,b)})});d.events.left.bind(b);d.events.up.bind(b);return{registerSkip:function(a){e.push(a)},destroy:function(){d.destroy()}}}function SR(a,b){(b.error?g.some(b.error):g.none()).map(function(a){return ii(Ge.get(a.name,
[a]))}).each(a.displayBanner);return{destroy:u}}function ex(a){return{elementFromPoint:function(b,c){return p.fromPoint(p.fromDom(a.document),b,c)},getRect:function(a){return a.dom().getBoundingClientRect()},getRangedRect:function(b,c,d,e){b=wc.exact(b,c,d,e);return Na.getFirstRect(a,b).map(function(a){return Wb(a,pb)})},getSelection:function(){return Na.get(a).map(function(b){return Qg.convertToRange(a,b)})},fromSitus:function(b){b=wc.relative(b.start(),b.finish());return Qg.convertToRange(a,b)},
situsFromPoint:function(b,c){return Na.getAtPoint(a,b,c).map(function(a){return{start:k(ha.on(a.start(),a.soffset())),finish:k(ha.on(a.finish(),a.foffset()))}})},clearSelection:function(){Na.clear(a)},setSelection:function(b){Na.setExact(a,b.start(),b.soffset(),b.finish(),b.foffset())},setRelativeSelection:function(b,c){Na.setRelative(a,b,c)},selectContents:function(b){Na.setToElement(a,b)},getInnerHeight:function(){return a.innerHeight},getScrollY:function(){return Pa.get(p.fromDom(a.document)).top()},
scrollBy:function(b,c){Pa.by(b,c,p.fromDom(a.document))}}}function TR(a,b,c,d){var e=g.none(),f=function(){e=g.none()};return{mousedown:function(a){d.clear(b);e=fx(a.target(),c)},mouseover:function(f){e.each(function(e){d.clear(b);fx(f.target(),c).each(function(f){lf.identify(e,f,c).each(function(c){var h=c.boxes().getOr([]);if(1<h.length||1===h.length&&!P.eq(e,f))d.selectRange(b,h,c.start(),c.finish()),a.selectContents(f)})})})},mouseup:function(){e.each(f)}}}function UR(a){var b=function(b){return!a.isRoot(b)&&
(xi.isBlock(b)||"li"===C.name(b))},c=function(a){return C.isText(a)&&0===Oa.get(a).trim().length},d=function(b,c,d,e){return Da.closest(b,function(b){return B.parent(b).exists(a.isRoot)},a.isRoot).fold(function(){return W.point(b,c)},function(a){return d(a,b,c)?e(a):W.point(b,c)})},e=function(e,f){var h=function(b){return mc.before(b,a.isRoot).fold(function(){return W.point(e,f)},function(a){return c(a)?h(a):W.point(a,oa.getEnd(a))})};return Da.closest(e,function(a){return b(a)&&B.prevSibling(a).isSome()},
a.isRoot).fold(function(){return d(e,f,ag.isAtLeftEdge,h)},function(a){return b(e)||ag.isAtLeftEdge(a,e,f)?h(a):W.point(e,f)})},f=function(e,f){var h=function(b){return mc.after(b,a.isRoot).fold(function(){return W.point(e,f)},function(a){return c(a)?h(a):W.point(a,0)})};return Da.closest(e,function(a){return b(a)&&B.nextSibling(a).isSome()},a.isRoot).fold(function(){return d(e,f,ag.isAtRightEdge,h)},function(a){return b(e)||ag.isAtRightEdge(a,e,f)?h(a):W.point(e,f)})},h=function(a,b){return P.eq(a.element(),
b.element())?a.offset()<=b.offset():Vc.after(a.element(),a.offset(),b.element(),b.offset())};return{getSelection:function(a){return a.getSelection().bind(function(a){var b=a.startContainer();var c=a.endContainer();P.eq(b,c)?(c=B.child(b,a.startOffset()),b=B.child(b,a.endOffset()),b=c.filter(la.isList).isSome()||b.filter(la.isList).isSome()):b=!0;if(b){if(Vc.after(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()))return b=Xa.toLeaf(a.startContainer(),a.startOffset()),a=Xa.toLeaf(a.endContainer(),
a.endOffset()),b=oa.isStart(b.element(),b.offset())?e(b.element(),b.offset()):W.point(b.element(),b.offset()),a=oa.isEnd(a.element(),a.offset())?f(a.element(),a.offset()):W.point(a.element(),a.offset()),a=h(b,a)?g.some(Ec(b.element(),b.offset(),a.element(),a.offset())):g.some(Ec(a.element(),a.offset(),b.element(),b.offset())),a;b=Xa.toLeaf(a.startContainer(),a.startOffset());a=Xa.toLeaf(a.endContainer(),a.endOffset());b=oa.isEnd(b.element(),b.offset())?f(b.element(),b.offset()):W.point(b.element(),
b.offset());a=oa.isStart(a.element(),a.offset())?e(a.element(),a.offset()):W.point(a.element(),a.offset());a=h(b,a)?g.some(Ec(a.element(),a.offset(),b.element(),b.offset())):g.some(Ec(b.element(),b.offset(),a.element(),a.offset()));return a}return g.some(a)})}}}function VR(a,b,c){WR.configure(b);var d=UR(c),e=G.create({beforeScan:q([]),afterScan:q([])}),f=gx.byClass(Vd);b=function(){c.body().each(function(a){c.getSelection().each(function(b){He.sharedOne(mb.table,[b.startContainer(),b.endContainer()]).fold(function(){f.clear(a)},
u)})})};(hx.browser.isChrome()||hx.browser.isSafari())&&c.events.contextmenu.bind(b);c.events.nodeChanged.bind(b);var h=Ga([]);c.runOrOnLoaded(function(b){var d=B.defaultView(b).dom(),l=ix.mouse(d,b,c.isRoot,f),r=ix.keyboard(d,b,c.isRoot,f);h.set([Yk.leftDown.bind(b,l.mousedown),Yk.leftPressedOver.bind(b,l.mouseover),Yk.leftUp.bind(b,l.mouseup),J.bind(b,"keyup",function(a){a.raw().shiftKey&&td.isNavigation(a.raw().which)&&c.getSelection().each(function(b){r.keyup(a,b.startContainer(),b.startOffset(),
b.endContainer(),b.endOffset()).each(function(b){g(a,b)})},u)}),J.bind(b,"keydown",function(b){c.getSelection().each(function(c){e.trigger.beforeScan();var d=a.directionAt(c.endContainer()).isRtl()?td.rtl:td.ltr;r.keydown(b,c.startContainer(),c.startOffset(),c.endContainer(),c.endOffset(),d).each(function(a){g(b,a)});e.trigger.afterScan()})})]);var g=function(a,b){b.kill()&&a.kill();b.selection().each(function(a){c.setRelativeSelection(a.start(),a.finish())})}});var l=function(a){return{win:a.win,
doc:a.doc,execCommand:a.execCommand,getSelection:function(){return d.getSelection(a)},setSelection:a.setSelection,setRelativeSelection:a.setRelativeSelection,focus:a.focus}},r=function(a,b){return{doc:b.doc,win:b.win,execCommand:b.execCommand,focus:b.focus,setSelection:u,setRelativeSelection:u,getSelection:function(){return g.some(D(a))}}},D=function(a){return{startContainer:k(a),startOffset:k(0),endContainer:k(a),endOffset:k(oa.getEnd(a))}};return{get:function(){return c.on(function(a){return c.body().fold(Pb.none,
function(b){return jx.retrieve(b,Vd.selectedSelector()).fold(function(){return a.getSelection().fold(Pb.none,function(b){b=d.getSelection(a).getOr(b);return Pb.single(b,l(a))})},function(b){var c=F(b,function(b){return r(b,a)});return Pb.multiple(b,c)})})}).getOrThunk(Pb.none)},surround:D,events:e.registry,destroy:function(){var a=h.get();A(a,function(a){a.unbind()})}}}function XR(a){a=ra({scopes:[p.fromDom(document)],shortcuts:[],swallow:!1},a);var b=ki(a),c=[],d=[];A(a.scopes,function(a){c.push(J.bind(a,
"keydown",b.keydown).unbind);d.push(J.bind(a,"keypress",b.keypress).unbind)});return{off:b.off,on:b.on,destroy:function(){A(c,pb);A(d,pb)},events:b.events,swallowShortcuts:b.swallowShortcuts,yieldShortcuts:b.yieldShortcuts,swallowChars:b.swallowChars,yieldChars:b.yieldChars,swallowKeys:b.swallowKeys,yieldKeys:b.yieldKeys}}function YR(a,b){var c=G.create({undo:q([]),redo:q([]),context:q([]),toolbar:q([]),plaincode:q([]),bold:q([]),italic:q([]),underline:q([]),indent:q([]),outdent:q([]),link:q([]),
blockquote:q([]),search:q([]),help:q([]),fullscreen:q([])}),d=ZR(c),e=[d.undo,d.redo,d.context,d.toolbar];d=[d.plaincode,d.bold,d.italic,d.underline,d.indent,d.outdent,d.link,d.search,d.blockquote,d.help,d.fullscreen];e=(b=!0===b.features)?e.concat(d):e;var f=ia(e,function(a){return a.keys()}),h=F(e,function(a){return $R(a.keys(),a.trigger())}),l=g.none();a.onCanvas(function(a){a=XR({scopes:[a],shortcuts:f});l=g.some(a);a.swallowShortcuts(f);a.events.command.bind(function(a){var b=a.command();oc(h,
function(a){return a(b)}).each(pb)});a.on()});return{isHelpShortcutEnabled:k(b),events:c.registry,destroy:function(){l.each(function(a){a.destroy()})}}}function aS(){var a=[],b=function(){a=ka(a,function(a){return kc.isVisible(a.popup().panel())})};return{recalculate:function(){b();F(a,function(a){a.anchor().recalculate(a.popup())})},dismiss:function(){b();F(a,function(a){a.anchor().isAnchored()||a.popup().close()})},update:function(b,d){a=bS.put(a,b,d,cS,function(a){return a.popup()===b})},destroy:function(){}}}
function dS(a,b,c,d){var e=aS(),f=a.isInline()?u:Xb(function(){var b=function(b){e.dismiss();a.focus()},c=!0===d.autoresize?p.fromDom(document):a.doc().getOrDie();h=kx.bind(c,b);!0!==d.autoresize&&!0===d.toolbar.sticky&&(l=kx.bind(p.fromDom(document),b))}),h=null,l=null,r=S.div();ja.add(r,[z.resolve("ui-container"),z.resolve("layer-above-editor")]);d.editorName.each(function(a){m.set(r,"data-ephox-editor",a)});var g=J.bind(r,"keydown",function(a){var b;if(b=V(R.BACKSPACE(),a.raw().which))b=a.target(),
b=t(za.is,b),b=!Va(["textarea","input",'[contenteditable="true"]'],b);b&&a.kill()});return{uiContainer:k(r),uiOrigin:function(){return Rg.relativeOrigin(r)},refresh:e.recalculate,bounds:b,show:function(a,b){f();e.update(a,b);b.place(a)},destroy:function(){null!==h&&h.unbind();null!==l&&h.unbind();e.destroy();g.unbind();E.remove(r)}}}function eS(a,b,c){a=xv(c,a);c=function(){var a=setTimeout(function(){clearTimeout(a);d.trigger.expired()},b);return{clear:function(){clearTimeout(a)}}};var d=G.create({expired:q([]),
close:q([])}),e=0<b?c():{clear:u};a.events.close.bind(function(){e.clear();d.trigger.close()});return{element:a.element,action:a.action,destroy:a.destroy,events:d.registry}}function fS(a,b,c,d,e,f,h,l){var r=h.layout.build(a,b,c,d,e,f,h,l);b=function(a){tb.closest(a.target(),'input,div[contenteditable="true"],textarea,.ephox-polish-dialog.ephox-polish-help-modal,select,.ephox-polish-bottom-bar,.ephox-polish-side-bar')||a.prevent()};var g=[J.bind(r.element(),"mousedown",b),J.bind(c.uiContainer(),"mousedown",
b)];(function(){var b=n.toggler(r.element(),z.resolve("content-ltr")),c=n.toggler(r.element(),z.resolve("content-rtl")),d=n.toggler(r.uiContainerParent(),z.resolve("content-ltr")),e=n.toggler(r.uiContainerParent(),z.resolve("content-rtl")),h=function(){b.off();d.off()},l=function(){b.on();d.on()},g=function(){c.off();e.off()},D=function(){c.on();e.on()},k=function(){var a=f.uiDirection().isRtl(),b=a?D:g;(a?h:l)();b()};a.events.uiStale.bind(function(){nw.readDir(a).fold(k,function(a){a.ltrdir().fold(h,
u,l);a.rtldir().fold(g,u,D);b.isOn()===c.isOn()&&k()})})})();return{element:r.element,connect:r.connect,viewport:r.viewport,uiContainerParent:r.uiContainerParent,socket:r.socket,showMessage:function(a,b,c){a=eS(a,b,c);b=t(r.hideBanner,a);a.events.expired.bind(b);r.displayBanner(a);return b},displayBanner:r.displayBanner,hideBanner:r.hideBanner,init:r.init,refocus:r.tabstrip.refocus,tabstrip:r.tabstrip,refresh:r.refresh,position:r.position,state:r.state,destroy:function(){r.destroy();A(g,function(a){a.unbind()})},
dialogContainer:r.dialogContainer}}function yi(a){var b=void 0!==a?a.slice(0):[];return{pop:function(){return g.from(b.pop())},push:function(a){b.push(a)},peek:function(){return g.from(b[b.length-1])},pushAll:function(a){b=b.concat(a)},clear:function(){b=[]},isEmpty:function(){return 0===b.length},size:function(){return b.length},state:function(){return b.slice(0)}}}function lx(a){var b=G.create({changed:q([]),reset:q([])}),c=a.initial,d=yi(a.undo),e=yi(a.redo),f=function(a){d.isEmpty()&&d.push(c);
d.push(a);b.trigger.changed()},h=function(a,b){b(d.peek().getOr(c),a)?(d.pop(),d.push(a)):(f(a),e.clear())};return{save:h,checkChanged:function(a,b){return!b(d.peek().getOr(c),a)},undo:function(a,c){h(a,c);return d.pop().bind(function(a){d.isEmpty()||(e.push(a),b.trigger.changed());return d.peek()})},redo:function(a,b){b(d.peek().getOr(c),a)||e.clear();return e.pop().bind(function(a){f(a);return d.peek()})},reset:function(a){c=a;d.clear();e.clear();b.trigger.reset()},state:function(){return{initial:c,
undo:d.state(),redo:e.state()}},rewrite:function(a){var f=a(c),h=F(d.state(),a);a=F(e.state(),a);c=f;d=yi(h);e=yi(a);d.isEmpty()&&e.isEmpty()||b.trigger.changed()},events:b.registry}}function gS(a,b,c,d,e){var f=hS.fromState(mx(e,iS)),h=G.create({changed:Q([],f.events.changed),reset:Q([],f.events.reset),undo:q([]),redo:q([])}),l=function(b,c){var d;(d=""===b.raw()&&jS.isDefaultEmpty(c.raw()))||(b=a.filterHtml(a.internal(),b.raw()),c=a.filterHtml(a.internal(),c.raw()),d=b===c);return d},r=function(){var c=
a.filterHtml(a.history(),b.getContent()),d=a.filterHtml(a.history(),b.serialize());return Zk(c,d)},g=function(a){return b.deserialize(a.marked())};e=function(){var a=r();f.undo(a,l).each(g);b.domChanged();b.toEditing();h.trigger.undo()};var x=function(){var a=r();f.redo(a,l).each(g);b.domChanged();b.toEditing();h.trigger.redo()},H=nd.tap(function(a,b){a()&&(a=r(),f.save(a,b))}),I=function(){H.instance(function(){return b.getSelectionStart().exists(fa.inBody)},l)},U=function(a){var b=H.control.isBlocked();
H.control.block();a=a();b||H.control.unblock();return a},m=c.editor();m.events.enter.bind(I);m.on();d.events.undo.bind(e);d.events.redo.bind(x);b.events.undoChanged.bind(I);b.events.loiter.bind(I);c=ob.ui({"undo.general":{toggle:!1,value:"undo",textkey:w.key("action.undo"),action:e,shortcut:!0,updateGeneral:aa,tooltip:ib.get},"redo.general":{toggle:!1,value:"redo",textkey:w.key("action.redo"),action:x,shortcut:!0,updateGeneral:aa,tooltip:ib.get}});return{undo:e,redo:x,save:I,checkChanged:function(){var a=
r();return f.checkChanged(a,l)},reset:function(a){f.reset(Zk(a,a))},destroy:function(){m.off();m.destroy()},state:function(){return mx(f.state(),kS)},rewrite:function(a,b){f.rewrite(function(c){return Zk(c.raw().replace(a,b),c.marked().replace(a,b))})},transaction:function(a){I();a=U(a);I();return a},disable:U,replaceTop:function(){H.instance(k(!0),k(!0))},ui:c,events:h.registry}}function lS(a,b){var c=Uc.unbindable(),d=G.create({onChange:q([])}),e=pi(function(){d.trigger.onChange()},1E3),f=function(){a.runOrOnLoaded(function(d){(b?
g.some(p.fromDom(document)):a.doc()).each(function(a){c.set(J.bind(a,"scroll",function(a){e.throttle()}));e.throttle()})})};a.isInline()||f();var h=function(){return a.body().bind(function(c){return(b?g.some(window):a.win()).map(function(d){var e=a.element().dom().getBoundingClientRect(),f=d.innerHeight,h=B.children(c);return Ta(h,function(a){if(!C.isElement(a))return!1;a=a.dom().getBoundingClientRect();var c=b?a.bottom+e.top:a.bottom;return(b?a.top+e.top:a.top)<f&&0<c}).map(function(a){var c=Ta(h.slice(a+
1),function(a){if(!C.isElement(a))return!1;a=a.dom().getBoundingClientRect();var c=b?a.bottom+e.top:a.bottom;return!((b?a.top+e.top:a.top)<f&&0<c)}).map(function(b){return a+1+b}).getOr(h.length);return h.slice(a,c)}).getOr([c])})}).getOr([])};return{sections:function(){return h()},setOn:f,setOff:function(){c.clear()},viewport:function(){return{assess:function(b){if(!C.isElement(b))return bg.inView(b);var c=a.win().map(function(a){return a.innerHeight}).getOr(0),d=b.dom().getBoundingClientRect();
c=0>d.bottom?bg.aboveView:d.top>c?bg.belowView:bg.inView;return c(b)}}},destroy:function(){c.clear();e.cancel()},events:d.registry}}function nx(){var a=ox.single(),b=G.create({upload:q(["assets"])});a.events.upload.bind(function(a){Xd.multiple(a.files()).get(function(a){b.trigger.upload(a)})});return{element:a.element,open:a.open,destroy:a.destroy,events:b.registry}}function tp(a){var b=g.none(),c=function(c){d();c=ii(c);c.events.close.bind(function(){b=g.none()});b=g.some(c);a().displayBanner(c)},
d=function(){b.each(a().hideBanner);b=g.none()};return{show:c,showKey:function(a){var b=Ge.get.apply(void 0,arguments);c(b)},hide:d,reset:function(){b=g.none()}}}function px(a,b){a=ra({layerClass:void 0,zindex:void 0,padding:"0px"},a);var c=G.create({exiting:q([])}),d=p.fromTag("div");T.presentation(d);n.add(d,bc.resolve("modal"));n.add(d,bc.resolve("modal-hidden"));v.setAll(d,{position:"fixed",left:a.padding,top:a.padding,right:a.padding,bottom:a.padding});void 0!==a.background&&v.set(d,"background",
a.background);void 0!==a.zindex&&v.set(d,"z-index",a.zindex);void 0!==a.layerClass&&n.add(d,a.layerClass);var e=void 0!==b?b:L.first("body").getOrDie();y.append(e,d);return{element:function(){return d},content:function(a){E.empty(d);y.append(d,a)},show:function(){n.add(e,bc.resolve("modal-active"));n.remove(d,bc.resolve("modal-hidden"));n.add(d,bc.resolve("modal-show"))},hide:function(){n.remove(e,bc.resolve("modal-active"));n.add(d,bc.resolve("modal-hidden"));n.remove(d,bc.resolve("modal-show"))},
destroy:function(){E.remove(d);n.remove(e,bc.resolve("modal-active"))},events:c.registry}}function mS(a,b){var c=Pg.onChange(),d=G.create({exiting:q([])});a=ra({layerClass:null,zindex:null,padding:"0px",background:"rgba(0, 0, 0, 0.5)"},a);var e=p.fromTag("div");T.presentation(e);n.add(e,bc.resolve("moodal"));n.add(e,bc.resolve("moodal-hidden"));v.setAll(e,{left:a.padding,top:a.padding,right:a.padding,bottom:a.padding});a.background&&v.set(e,"background",a.background);a.zindex&&v.set(e,"z-index",a.zindex);
a.layerClass&&n.add(e,a.layerClass);var f=void 0!==b?b:L.first("body").getOrDie();y.append(f,e);var h=p.fromTag("div");T.presentation(h);n.add(h,bc.resolve("moodal-flexor"));y.append(e,h);var l=function(){v.setAll(h,{top:window.scrollY+"px",height:window.innerHeight+"px"})},r=function(){g.unbind();c.destroy();E.remove(e);n.remove(f,bc.resolve("modal-active"))},g=J.bind(e,"click",function(){d.trigger.exiting();r()});c.events.ready.bind(function(){l()});return{element:k(e),content:function(a){E.empty(h);
y.append(h,a)},show:function(){n.add(f,bc.resolve("moodal-active"));n.remove(e,bc.resolve("moodal-hidden"));n.add(e,bc.resolve("moodal-show"));l()},hide:function(){n.remove(f,bc.resolve("moodal-active"));n.add(e,bc.resolve("moodal-hidden"));n.remove(e,bc.resolve("moodal-show"))},destroy:r,events:d.registry}}function nS(a){var b=cb({layerClass:void 0,zindex:void 0,modal:{}},a);a=void 0!==a.container?a.container:L.first("body").getOrDie();var c=(ba.detect().os.isiOS()?mS:px)(b.modal,a),d=c.element(),
e=G.create({exiting:Q([],c.events.exiting)});void 0!==b.zindex&&v.set(d,"z-index",b.zindex);void 0!==b.layerClass&&n.add(d,b.layerClass);n.add(d,bc.resolve("centered-dialog"));y.append(a,d);return{content:c.content,show:function(){c.show()},hide:function(){c.hide()},destroy:function(){E.remove(d);c.destroy()},events:e.registry}}function oS(){var a=function(a,b){n.add(a,z.resolve(b));return a},b=a(S.div(),"dialog"),c=a(S.div(),"top"),d=a(S.span(),"dialog-title"),e=a(S.span(),"dialog-close"),f=a(S.div(),
"dialog-content"),h=a(S.div(),"dialog-controls");m.set(b,"tabindex",-1);m.set(e,"tabindex",-1);T.button(e,w.translate("button.close"));var l=J.bind(e,"click",function(){r.trigger.close()});O.append(b,[c,f,h]);O.append(c,[d,e]);var r=G.create({close:q([])});return{element:function(){return b},focus:function(){Y.focus(b)},setTitle:function(a){E.empty(d);y.append(d,p.fromText(a));pS||(T.dialog(b,a),a=Za("ephox-aria"),m.set(d,"id",a),T.labelledBy(b,a))},setContent:function(a){E.empty(f);y.append(f,a);
a=Za("ephox-aria");m.set(f,"id",a);T.describedBy(b,a)},setControls:function(a){E.empty(h);y.append(h,a)},close:function(){r.trigger.close()},destroy:function(){E.remove(b);l.unbind()},events:r.registry}}function Ie(a){var b=oS(),c=g.none(),d=nS({container:a,layerClass:z.resolve("layer-dialog"),modal:{layerClass:z.resolve("layer-below-dialog")}});d.content(b.element());d.events.exiting.bind(function(){Ic.unlock([fa.body()]);b.close()});var e=function(){d.hide();Ic.unlock([fa.body()])};return{element:b.element,
destroy:function(){b.destroy();c.each(function(a){a.unbind()});e();d.destroy()},setTitle:b.setTitle,setContent:b.setContent,setControls:b.setControls,show:function(){d.content(b.element());d.show();b.focus();qS.deviceType.isTouch()&&(c=g.some(J.bind(b.element(),"click",function(a){a.stop()})));Ic.lock([fa.body()])},hide:e,events:b.events}}function qx(a,b,c,d,e,f){var h=ud.okCancel("file-upload"),l=d(e),r=null,g=ba.detect(),k=G.create({close:q([]),analytics:q(["message"]),escaped:q([]),insertAssets:q(["assets"]),
opened:q([])}),H=function(){r.unbind();m.hide();k.trigger.close();k.trigger.analytics("insert_image_closed");I()},I=function(){l.reset();h.ok().disable()},m=Ie(c);m.setTitle(w.translate("fileupload.title"));m.setContent(l.element());m.setControls(h.element());m.events.close.bind(H);n.add(m.element(),z.resolve("imageupload-dialog"));var Qa=f(m.element(),l.keylayouts(),xa.dialog({cancel:h.cancel().element(),ok:h.ok().element(),execute:Nb.click,index:0}));l.events.upload.bind(function(a){k.trigger.insertAssets(a.assets());
H()});l.events.dragndrop.bind(function(a){k.trigger.insertAssets(a.assets());H()});l.events.success.bind(function(a){h.ok().enable()});l.events.lookup.bind(function(a){h.ok().disable()});l.events.setActive.bind(function(a){I()});h.events.ok.bind(function(){l.selected().each(function(a){k.trigger.insertAssets([a]);H()})});h.events.cancel.bind(H);I();return{show:function(){g.deviceType.isiOS()&&(T.hidden(b.element(),!0),setTimeout(function(){l.focus();T.hidden(b.element(),!1)},250));m.show();Qa.enter();
k.trigger.analytics("insert_image_opened");k.trigger.opened();var c=p.fromDom(window);r=J.bind(c,"orientationchange",function(){a.foreground()})},element:m.element,events:k.registry,destroy:function(){Qa.exit();Qa.destroy();m.hide();m.destroy();l.destroy();h.destroy()}}}function rS(a){var b=G.create({success:q(["assets"]),invalidUrl:q(["url"]),empty:q([]),lookup:q([])}),c=[],d=S.div(),e=n.toggler(d,Fb.resolve("url-indicator-loading")),f=kp();f.events.start.bind(function(){e.on()});f.events.fail.bind(function(a){e.off();
b.trigger.invalidUrl(a.url());c=[]});f.events.success.bind(function(a){e.off();var d=da.get(D);a.url()===d?Xd.fromImages([a.image()]).get(function(a){c=a;b.trigger.success(c)}):f.go(d)});var h=S.div();n.add(h,Fb.resolve("url-selector"));var l=p.fromTag("label");a=p.fromText(a("fileupload.web.url"));var r=Za(Fb.resolve("input-id"));m.set(l,"for",r);n.add(l,Fb.resolve("url-input-label"));y.append(l,a);var D=p.fromTag("input");m.setAll(D,{id:r,type:"url",placeholder:"http://www.example.com/image.jpg"});
n.add(D,Fb.resolve("url-input"));rx.os.isAndroid()&&m.set(D,"autofocus","true");rx.browser.isSafari()&&m.setAll(D,{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"});T.required(D);a=p.fromHtml("<span role=presentation>*</span>");n.add(a,Fb.resolve("url-input-required"));y.append(l,a);O.append(h,[l,D,d]);var x=De(function(a){""!==a&&f.go(a)},1E3),H=J.bind(D,"input",function(){var a=da.get(D);""===a.trim()?(b.trigger.empty(),x.throttle("")):(b.trigger.lookup(),x.throttle(a))});
return{element:k(h),input:k(D),events:b.registry,reset:function(){e.off();da.set(D,"")},focus:function(){Y.focus(D)},selected:function(){return g.from(c[0])},destroy:function(){H.unbind()}}}function sx(a){var b=G.create({lookup:q([]),success:q([])}),c=S.span(),d=p.fromHtml('<div role=presentation><span role=presentation class="'+Fb.resolve("url-input-required")+'">*</span> '+a("fileupload.weburlhelp")+"</div>"),e=Za(Fb.resolve("help-message"));m.set(d,"id",e);n.add(d,Fb.resolve("fileupload-weburl-help"));
var f=p.fromHtml("<div role=presentation><div role=presentation>"+a("fileupload.invalid1")+"</div><div role=presentation>"+a("fileupload.invalid2")+"</div><div role=presentation>"+a("fileupload.invalid3")+"</div></div>");n.add(f,Fb.resolve("fileupload-weburl-help"));n.add(f,Fb.resolve("fileupload-weburl-help-invalid"));var h=function(a){E.empty(x);y.append(x,a)},l=function(a){var b=p.fromTag("img");y.append(x,b);sS.previewAsset(a,b)},r=S.div();n.add(r,Fb.resolve("web-url-container"));var g=rS(a),
x=S.div();n.add(x,Fb.resolve("image-preview-container"));a=Za("ephox-hermes-url-state");T.live(x,a,"polite");T.controls(g.input(),a);T.describedBy(g.input(),e);e=S.div();n.add(e,Fb.resolve("hbox"));O.append(e,[g.element(),x,d]);y.append(r,e);g.events.lookup.bind(function(a){b.trigger.lookup();E.empty(x)});g.events.success.bind(function(a){A(a.assets(),l);b.trigger.success()});g.events.invalidUrl.bind(function(){h(f)});g.events.empty.bind(function(){h(c)});h(c);return{element:k(r),selected:g.selected,
input:g.input,events:b.registry,focus:g.focus,reset:function(){h(c);g.reset()},destroy:function(){g.destroy()}}}function tS(a){a=S.div();var b=sx(w.translate),c=G.create({upload:q(["assets"]),dragndrop:q(["assets"]),dragover:q([]),dragleave:q([]),drop:q([]),setActive:q(["item"]),lookup:Q([],b.events.lookup),success:Q([],b.events.success)}),d=[function(){var a=b.input();return ea.input(a,xa.input({}))}()];y.append(a,b.element());return{element:k(a),events:c.registry,keylayouts:k(d),reset:function(){b.reset()},
focus:b.focus,selected:b.selected,destroy:function(){b.destroy()}}}function uS(a,b,c,d,e){var f=G.create({insertAsset:q(["asset"]),open:q([]),done:q([]),abort:q([])}),h=p.fromDom(document);d=qb.mainmenu(h,"file-upload-menu",[]);var l=function(a,b){a=qb.item(h,a,w.get(b)+"...");T.menuItem(a,g.some(w.get(b)),g.none());return a},r=l("from-url",w.key("image.from-url"));l=l("from-camera",w.key("image.from-camera"));r=!0===e.allowLocalImages?[r,l]:[r];var D=nx();D.events.upload.bind(function(a){g.from(a.assets()[0]).each(function(a){H();
f.trigger.insertAsset(a)})});var x=function(a){a=a.assets();A(a,function(a){f.trigger.insertAsset(a)})},H=function(){Uw.target(c.uiContainer(),"mousedown")};O.append(d,r);d={name:"image",textkey:w.key("image.menu-button"),menuTextkey:w.key("image.menu"),icon:g.none,tooltip:ib.get,contentFocus:!1,toggle:!1};r=[[{handlers:k({"from-url":function(d){f.trigger.open();var h=qx(a,b,c.uiContainer(),tS,e,ea.dialog);h.events.insertAssets.bind(x);d=function(){a.focus();h.destroy()};h.events.opened.bind(H);h.events.close.bind(d);
h.events.escaped.bind(d);h.show()},"from-camera":function(){f.trigger.open();D.open()}}),destroyer:u,refreshMenu:u,structure:k({}),submenus:k([]),items:k(r),events:f.registry}]];d=ye.menu(d,r,w.get,mi.menu({focusActive:!0}));r={label:k(!1),hasDialog:!0};return ra(d,r)}function vS(a){var b=p.fromTag("button");m.set(b,"type","button");n.add(b,eb.resolve("independent-button"));return Lo(b,g.none(),a)}function wS(a){var b=ox.multiple(),c=S.div();n.add(c,Fb.resolve("drop-container"));var d=tx.register(c,
g.some(Fb.resolve("drop-active")),!1),e=vS();e.content(Rc(a("fileupload.chooseimage")));n.add(e.element(),Fb.resolve("default-action"));n.add(e.element(),Fb.resolve("file-selector-trigger"));var f=p.fromTag("p");n.add(f,Fb.resolve("help-text-drop-icon"));var h=p.fromTag("p");n.add(h,Fb.resolve("help-text-drop"));ma.disable(h);y.append(h,p.fromText(a("fileupload.dropimages")));O.append(c,[f,h,e.element(),b.element()]);return{container:k(c),dropper:k(d),picker:k(b),button:k(e),focus:function(){Y.focus(e.element())},
destroy:function(){b.destroy();d.destroy();e.destroy()}}}function xS(a){var b=wS(a);a=b.picker();var c=b.container(),d=b.dropper(),e=b.button(),f=G.create({upload:q(["assets"]),dragndrop:q(["assets"]),dragover:Q([],d.events.dragover),dragleave:Q([],d.events.dragleave),drop:Q([],d.events.drop)}),h=function(a){return function(b){Xd.multiple(b.files()).get(function(b){a(b)})}};a.events.upload.bind(h(f.trigger.upload));d.events.dragndropimages.bind(h(f.trigger.dragndrop));e.events.click.bind(a.open);
return{element:k(c),button:k(e),input:a.element,focus:b.focus,events:f.registry,destroy:function(){b.destroy()}}}function ux(a,b,c){var d=[],e=M("view","item","container"),f=G.create({setActive:q(["item"])}),h=S.div();n.add(h,eb.resolve("tablayout-wrapper"));n.add(h,eb.resolve("tablayout-wrapper-"+a));void 0!==c&&n.add(h,c);var l=S.div();n.add(l,eb.resolve("tablayout-body"));var r=p.fromTag("div");n.add(r,eb.resolve("tablayout-menu"));O.append(h,[r,l]);var g=function(a){var b=Mo(a);b.content(Rc(a));
n.add(b.element(),eb.resolve("tablayout-item"));return b},x=[],H=F(b,function(a){var b=g(a.heading());m.set(b.element(),"data-ephox-pastry-tablayout-tab",a.heading());y.append(r,b.element());var c=p.fromTag("div");n.add(c,eb.resolve("tablayout-content"));m.set(c,"data-ephox-pastry-tablayout-view",a.heading());y.append(l,c);x.push(c);var f=e(a,b,c);d.push(f);b.events.click.bind(function(){I(f)});return b}),I=function(a){A(d,function(b){var c=b.view(),d=b.item(),e=b.container();b===a?(n.add(e,eb.resolve("tablayout-active")),
d.select(),c.renderer().render(e),f.trigger.setActive(d)):(n.remove(e,eb.resolve("tablayout-active")),d.deselect())})};I(d[0]);return{element:function(){return h},tabs:k(H),body:k(l),menu:k(r),tabContent:k(x),destroy:function(){A(H,function(a){a.destroy()})},events:f.registry}}function vx(a){return{render:function(b){E.empty(b);y.append(b,a)}}}function yS(a){var b=S.div(),c=xS(w.translate),d=sx(w.translate),e=function(a,b){a=w.translate(a);b=vx(b);return cg(a,b)},f=e("fileupload.tabweburl",d.element());
a=(a.allowLocalImages?[e("fileupload.tablocal",c.element())]:[]).concat(f);var h=ux(up.top(),a,"file-upload");T.hidden(c.input(),!0);e=function(){var a=c.button();n.add(a.element(),z.resolve("dialog-button-default"));var b=ba.detect().browser.isFirefox(),d={execute:Nb.button};b=b?ra(d,{process:u}):d;b=xa.button(b);return ea.button(a.element(),b)}();T.tabList(h.menu());f=function(){var a=d.input();return ea.input(a,xa.input({}))}();var l=ea.flow(h.menu(),{item:k(".ephox-pastry-statebutton")},xa.flow({trigger:Nb.button,
executeOnArrow:!0}));e=[l].concat(e).concat(f);var r=h.tabs();A(h.tabContent(),function(a){T.tabPanel(a)});A(a,function(a,b){var c=r[b];T.tabButton(c.element(),a.heading());n.add(c.element(),z.resolve("tab-button"));c.events.click.bind(function(){l.clickFocus(c.element())})});A(h.tabContent(),function(a,b){b=r[b];var c=Za("ephox-aria");m.set(b.element(),"id",c);T.labelledBy(a,c)});a=G.create({upload:Q(["assets"],c.events.upload),dragndrop:Q(["assets"],c.events.dragndrop),dragover:Q([],c.events.dragover),
dragleave:Q([],c.events.dragleave),drop:Q([],c.events.drop),lookup:Q([],d.events.lookup),success:Q([],d.events.success),setActive:Q(["item"],h.events.setActive)});h.events.setActive.bind(function(a){a=m.get(a.item().element(),"data-ephox-pastry-tablayout-tab");a===w.translate("fileupload.tablocal")?c.focus():a===w.translate("fileupload.tabweburl")&&d.focus()});y.append(b,h.element());return{element:k(b),events:a.registry,focus:d.focus,keylayouts:k(e),reset:function(){d.reset()},selected:d.selected,
destroy:function(){h.destroy();c.destroy();d.destroy()}}}function Nd(a,b,c){a=parseFloat(a);a>c?a=c:a<b&&(a=b);return a}function mf(a,b){var c,d,e,f,h=[],l=Array(10);for(c=0;5>c;c++){for(d=0;5>d;d++)h[d]=b[d+5*c];for(d=0;5>d;d++){for(e=f=0;5>e;e++)f+=a[d+5*e]*h[e];l[d+5*c]=f}}return l}function vp(a,b){b=Nd(b,0,1);return a.map(function(a,d){a=0===d%6?1-(1-a)*b:a*b;return Nd(a,0,1)})}function $k(a,b){return a.toCanvas().then(function(c){var d=a.getType(),e=Hc.get2dContext(c),f=e.getImageData(0,0,c.width,
c.height),h=f.data,l,r=b[0],g=b[1],k=b[2],H=b[3],I=b[4],m=b[5],n=b[6],q=b[7],p=b[8],u=b[9],t=b[10],v=b[11],w=b[12],y=b[13],A=b[14],z=b[15],B=b[16],C=b[17],E=b[18],F=b[19];for(l=0;l<h.length;l+=4){var G=h[l];var J=h[l+1];var L=h[l+2];var K=h[l+3];h[l]=G*r+J*g+L*k+K*H+I;h[l+1]=G*m+J*n+L*q+K*p+u;h[l+2]=G*t+J*v+L*w+K*y+A;h[l+3]=G*z+J*B+L*C+K*E+F}e.putImageData(f,0,0);return Yd.fromCanvas(c,d)})}function wx(a,b){return a.toCanvas().then(function(c){return zS(c,a.getType(),b)})}function zS(a,b,c){var d=
Hc.get2dContext(a);var e=d.getImageData(0,0,a.width,a.height);var f=d.getImageData(0,0,a.width,a.height);f=function(a,b,c){function d(a,b,c){a>c?a=c:a<b&&(a=b);return a}var e,f,h,l,r,g;var k=Math.round(Math.sqrt(c.length));var m=Math.floor(k/2);var n=a.data;var q=b.data;var p=a.width;var u=a.height;for(e=0;e<u;e++)for(a=0;a<p;a++){for(g=f=h=l=0;g<k;g++)for(r=0;r<k;r++){var t=d(a+r-m,0,p-1);var v=d(e+g-m,0,u-1);t=4*(v*p+t);v=c[g*k+r];f+=n[t]*v;h+=n[t+1]*v;l+=n[t+2]*v}t=4*(e*p+a);q[t]=d(f,0,255);q[t+
1]=d(h,0,255);q[t+2]=d(l,0,255)}return b}(e,f,c);d.putImageData(f,0,0);return Yd.fromCanvas(a,b)}function xx(a){return function(b,c){return b.toCanvas().then(function(d){var e=b.getType(),f=Hc.get2dContext(d),h,l=Array(256);for(h=0;h<l.length;h++)l[h]=a(h,c);h=f.getImageData(0,0,d.width,d.height);var r=h.data,g;for(g=0;g<r.length;g+=4)r[g]=l[r[g]],r[g+1]=l[r[g+1]],r[g+2]=l[r[g+2]];f.putImageData(h,0,0);return Yd.fromCanvas(d,e)})}}function Sg(a){return function(b,c){return $k(b,a(Je.identity(),c))}}
function yx(a){return function(b){return wx(b,a)}}function zx(a,b,c){var d=Tg.getWidth(a),e=Tg.getHeight(a);d=b/d;var f=c/e;e=!1;if(.5>d||2<d)d=.5>d?.5:2,e=!0;if(.5>f||2<f)f=.5>f?.5:2,e=!0;a=AS(a,d,f);return e?a.then(function(a){return zx(a,b,c)}):a}function AS(a,b,c){return new sd(function(d){var e=Tg.getWidth(a),f=Tg.getHeight(a),h=Math.floor(e*b),l=Math.floor(f*c),r=Hc.create(h,l);Hc.get2dContext(r).drawImage(a,0,0,e,f,0,0,h,l);d(r)})}function BS(a,b,c,d,e){var f=a.content(),h=a.smartview(),l=
a.ui().tabstrip,r=tp(a.ui),g=zi.processResults(r.showKey),x=function(d){a.undo().save();d=CS.validate(d);(d.failure()?t(r.showKey,"fileupload.invalidimages"):r.hide)();c.assets(d.assets()).bind(Ax.maybeDoRotate).map(g).get(function(a){wp.insertAssets(f,b,a)})},H=function(a){x(a.assets())};d.events.insertAssets.bind(function(a){e.allowLocalImages?x(a.assets()):Ge.getOrLog("errors.dragdrop.images.disallowed")});var I=f.cursor();d=G.create({analytics:q(["message"])});return{ui:ob.ui({"fileupload.general":k({value:"image",
textkey:w.key("insert.image"),icon:!0,updateGeneral:aa,action:function(){var b=qx(f,l,h.uiContainer(),yS,e,ea.dialog);b.events.insertAssets.bind(H);b.events.close.bind(function(){f.focus();b.destroy()});b.events.escaped.bind(function(){f.focus();b.destroy()});a.content().hideInlineSelection();b.show()},hasDialog:!0}),"fileupload.menu":function(){var c=uS(f,l,h,a.ui(),e);c.events.insertAsset.bind(function(a){I.get().bind(function(c){wp.insertMobileAssets(f,c,b,[a.asset()])})});c.events.open.bind(function(a){f.getSelection().each(I.save)});
return c},"camera.general":function(){var a=nx();a.events.upload.bind(function(a){I.get().bind(function(c){wp.insertMobileAssets(f,c,b,a.assets())})});return{value:"image",textkey:w.key("image.from-camera"),icon:!0,updateGeneral:aa,action:function(){f.getSelection().each(I.save);f.toReading();a.open()},hasDialog:!0}}},aa),events:d.registry,destroy:function(){}}}function Bx(a,b,c){var d=function(){b.counter.update(0,0)},e=function(e){e.all.fold(d,function(d){b.counter.update(e.pos+1,d.length);d=d[e.pos][0];
a.setSelection(d,0,d,0);c.element(d)})},f=function(){c.cursor();d()},h=function(a,b,c){Ke.clear(a);Ke.search(a,b,c).fold(f,e);return g.some(b)},l=function(a,b){a=(!0===b?Ke.prev:Ke.next)(a);a.fold(f,e);return a},r=function(b){a.body().each(function(c){Ke.replace(c,b).fold(f,e);a.domChanged();a.undoChanged()})},D=g.none(),x=function(){D=g.none()};b.events.search.bind(function(b){a.body().each(function(a){h(a,b.term(),b.matchcase())})});b.events.next.bind(function(){a.body().each(function(a){l(a,!1)})});
b.events.prev.bind(function(){a.body().each(function(a){l(a,!0)})});b.events.replace.bind(function(a){r(a.value())});b.events.replaceAll.bind(function(b){a.body().each(function(c){Ke.replaceAll(c,b.value()).fold(f,e);a.undoChanged()})});b.events.interactive.bind(function(b){a.body().each(function(a){D=h(a,b.term(),b.matchcase())})});b.events.encase.bind(function(b){a.body().each(function(a){D.each(function(c){h(a,c,b.matchcase())})})});b.events.clear.bind(function(b){a.body().each(function(a){Ke.clear(a);
x()})});return{zeroCount:d,updateMatch:e,enterSearchAction:function(c,d){a.body().each(function(a){var e=b.getCase();D=D.filter(function(a){return c===a}).fold(function(){return h(a,c,e)},function(b){return l(a,d.isShift()).fold(function(){return h(a,c,e)},k(D))})});(0===c.length?b.counter.hide:b.counter.show)()},enterReplaceAction:r,clearLastSearch:x}}function Cx(a){var b=a.content();a=function(a){b.elementIntoView(a)};var c=function(){b.cursorIntoView()};a={element:Dx?a:t(Zf.elementIntoView,b),
cursor:Dx?c:t(Zf.cursorIntoView,b)};return{get:k(a)}}function Ex(){var a=S.div();n.add(a,z.resolve("search-widget"));var b=al.searchField(),c=(nc.isSmallTouch()?al.dummyCounter:al.counter)(b.input()),d=al.replaceDrawer(),e=d.element(),f=G.create({next:Q([],b.events.next),prev:Q([],b.events.previous),replace:q(["value"]),replaceAll:q(["value"]),search:q(["term","matchcase","isShift"]),interactive:q(["term","matchcase"]),encase:q(["matchcase"]),clear:q([])});ma.setPressed(d.matchcase.element(),d.matchcase.selected());
var h=Jv(e);T.linkElements(b.moreToggle.element(),e);Fx(h.visible(),b.moreToggle.element(),e);b.moreToggle.events.click.bind(function(){(h.visible()?h.hide:h.show)()});b.events.input.bind(function(){var a=da.get(b.input()),d=pa.get(b.element());v.set(c.element(),"height",d+"px");3<=a.length?r.throttle(a):(f.trigger.clear(),c.hide(),c.update(0,0))});d.replace.events.click.bind(function(){var a=da.get(d.input.element());f.trigger.replace(a)});d.replaceAll.events.click.bind(function(){var a=da.get(d.input.element());
f.trigger.replaceAll(a)});d.matchcase.events.click.bind(function(){ma.setPressed(d.matchcase.element(),d.matchcase.selected());f.trigger.encase(l())});var l=function(){return d.matchcase.selected()},r=De(function(a){c.show();f.trigger.interactive(a,l())},500),g=J.bind(e,"transitionend",function(a){"opacity"===a.raw().propertyName&&n.remove(e,"ephox-chameleon-toolbar-more-open");Fx(h.visible(),b.moreToggle.element(),e)});O.append(a,[c.element(),b.element(),d.element()]);return{element:k(a),search:b,
focus:function(){b.focus()},drawer:d,counter:c,getCase:l,destroy:function(){g.unbind();b.destroy();d.destroy();c.destroy();h.destroy();E.remove(a)},events:f.registry}}function DS(a){var b=a.content(),c=Ex();a=Cx(a);var d=Bx(b,c,a.get()),e=function(a){var c=a.endContainer();a=a.endOffset();b.setSelection(c,a,c,a)};a=xa.button({execute:Nb.button});a=[ea.input(c.search.input(),xa.input({execute:function(a,b){d.enterSearchAction(a,b)}})),ea.button(c.search.previous(),a),ea.button(c.search.next(),a),ea.button(c.search.moreToggle.element(),
a),ea.input(c.drawer.input.element(),xa.input({execute:function(a,b){d.enterReplaceAction(a)}})),ea.button(c.drawer.matchcase.element(),a),ea.button(c.drawer.replace.element(),a),ea.button(c.drawer.replaceAll.element(),a)];var f=G.create({done:q([])});return{element:c.element,anchorName:k("search-widget-anchor"),textkey:k("action.search"),dialogTextkey:k("search.menu"),destroy:function(){c.destroy()},keylayouts:k(a),openWidget:function(){d.enterSearchAction(da.get(c.search.input()),vd.shiftKeyState(!1))},
closeWidget:function(){b.body().each(function(a){b.getSelection().each(e);Ke.clear(a)});d.clearLastSearch()},events:f.registry}}function ES(a,b){var c=a.content(),d=Ex();a=Cx(a);var e=Bx(c,d,a.get());a=G.create({toEditor:q([])});b=Ai.text(d.search.element(),d.search.input());return{element:d.element,addEscape:function(a){y.append(d.search.element(),a.element())},open:function(){e.enterSearchAction(da.get(d.search.input()),vd.shiftKeyState(!1));setTimeout(d.focus,250)},close:function(){c.body().each(function(a){Ke.clear(a).fold(e.zeroCount,
e.updateMatch)});e.clearLastSearch()},execute:function(a){if(Y.hasFocus(d.search.input())){a=vd.shiftKeyState(!0===a.raw().shiftKey);var b=da.get(d.search.input());e.enterSearchAction(b,a)}else a=da.get(d.drawer.input.element()),e.enterReplaceAction(a)},type:k(b),events:a.registry,destroy:function(){d.destroy()}}}function bl(a,b){FS(b);var c=a.content(),d=a.ui().tabstrip.element();n.add(b.element(),z.resolve("slick-widget"));GS.browser.isSafari()&&A(ca.descendants(b.element(),"input,textarea"),function(a){m.setAll(a,
{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"})});var e=function(){var a=ca.descendants(b.element(),"input,textarea");Ta(a,Y.hasFocus).each(function(b){b=(b+1)%a.length;0<=b&&b<a.length&&Y.focus(a[b])})},f=Ai.cata(b.type(),function(a,c){n.add(a,z.resolve("slick-widget-field"));n.add(c,z.resolve("slick-widget-input"));var d=J.bind(b.element(),"keydown",function(a){var c={original:k(a)};Md.isEnter(c)?(b.execute(a),a.kill()):Md.isTab(c)?(e(),a.kill()):Md.isEscape(c)&&
(x(),a.kill())}),f=J.bind(c,"blur",function(a){g.from(a.raw().relatedTarget).each(function(a){!0===Da.ancestor(p.fromDom(a),function(a){return n.has(a,"ephox-polish-mobile-toolbar-hide")}).isSome()&&xp.refreshInput(c)})});return{destroy:function(){d.unbind();f.unbind()}}});a=Dc("shizniz");var h=w.translate("toolbar.backbutton"),l=ve([na.resolve("icon")]);a.content(l);m.set(a.element(),"title",h);T.toolbarButton(a.element(),h,!1,!1);b.addEscape(a);var r=Ga(!1);y.prepend(d,b.element());var D=G.create({done:q([]),
abort:q([]),open:q([]),close:q([])}),x=function(){I();c.toEditing()};b.events.toEditor.bind(x);var H=Xb(function(a){return ca.children(d,"."+na.resolve("toolbar"))}),I=function(){b.close();r.set(!1);A(H(),function(a){n.remove(a,z.resolve("mobile-toolbar-hide"))});n.remove(b.element(),z.resolve("mobile-toolbar-show"));n.add(b.element(),z.resolve("mobile-toolbar-hide"));D.trigger.close()};c.events.mousedown.bind(I);I();a.events.click.bind(function(){x();D.trigger.abort()});return{element:b.element,
destroy:function(){c.events.mousedown.unbind(I);f.destroy();b.destroy()},events:D.registry,open:function(){var a=J.bind(d,"transitionend",function(){b.open();D.trigger.open();a.unbind()});r.set(!0);A(H(),function(a){n.remove(a,z.resolve("mobile-toolbar-show"));n.add(a,z.resolve("mobile-toolbar-hide"))});n.remove(b.element(),z.resolve("mobile-toolbar-hide"));n.add(b.element(),z.resolve("mobile-toolbar-show"))},close:I,isOpen:function(){return r.get()}}}function HS(a){var b=a.filter();vd.configure(b);
var c=G.create({analytics:q(["message"])}),d=Xb(function(){var b=IS(a);b.events.open.bind(function(){c.trigger.analytics("search_tool_open")});b.events.abort.bind(b.close);return b});b=function(){var a=d();(a.isOpen()?a.close:a.open)()};a.shortcuts().events.search.bind(b);return{ui:ob.ui({"find.general":{toggle:!1,hasPopup:!1,value:"search",textkey:w.key("action.search"),action:b,updateGeneral:function(a){n.add(a.element(),z.resolve("search"))},icon:!0,tooltip:ib.get}}),events:c.registry,destroy:function(){d().destroy()}}}
function Bi(a,b){var c=Dc();ja.add(c.element(),a);T.button(c.element(),w.translate(b));m.set(c.element(),"title",w.translate(b));return c}function JS(a,b){var c=KS(cl.configuration()),d=c.i18nNamespace(),e=c.cssNamespace();b=S.div();n.add(b,z.resolve("fontsize-widget"));var f=S.span();n.add(f,z.resolve("fontsize-widget-field"));var h=S.div();n.add(h,z.resolve("fontsize-widget-exit"));var l=p.fromTag("input");n.add(l,z.resolve("fontsize-widget-input"));T.label(l,w.translate(d+".stepper.input"));var r=
function(b){n.remove(l,z.resolve("slick-widget-invalid-input"));T.invalid(l,!1);da.set(l,b);nf.partialSize(a.content(),a.undo(),a.selections(),b);bb.speak(fa.body(),b)},g=function(){n.add(l,z.resolve("slick-widget-invalid-input"));T.invalid(l,!0);bb.speak(fa.body(),w.translate("aria.input.invalid"));Y.focus(l)},x=function(a){return function(){var b=da.get(l);b=a(c.specials(),b);of.validate(b,c.tag(),c.property()).fold(g,r)}},H=x(dl.decrease);x=x(dl.increase);var I=function(a,b){return Bi([z.resolve(e+
a),z.resolve("stepper-button")],d+b)},m=I("-stepper-decrease",".stepper.decrease");I=I("-stepper-increase",".stepper.increase");m.events.click.bind(H);I.events.click.bind(x);O.append(f,[m.element(),l,I.element()]);y.append(b,f);y.append(b,h);f=Ai.text(f,l);var Qa=G.create({toEditor:q([]),size:q(["value"])}),t=function(){da.set(l,"")},v=function(a){a=of.sanitise(a);of.validate(a,c.tag(),c.property()).fold(g,function(a){n.remove(l,z.resolve("slick-widget-invalid-input"));T.invalid(l,!1)});da.set(l,
a)};return{element:k(b),addEscape:function(a){y.append(h,a.element())},open:function(){Y.focus(l)},close:u,execute:function(){var a=da.get(l);of.validate(a,c.tag(),c.property()).fold(g,function(a){r(a);Qa.trigger.toEditor()})},destroy:u,type:k(f),represent:function(a){a.fold(t,v,v)},events:Qa.registry}}function LS(a,b){var c=a.content(),d=Ga(g.none()),e=function(){var c=JS(a,b),e=bl(a,c);c={represent:c.represent,refreshValue:c.refreshValue,open:e.open,close:e.close,isOpen:e.isOpen};d.set(g.some(c));
return c},f={toggle:!1,value:"size",textkey:w.key("font.size"),action:function(){var b=d.get().getOrThunk(e);if(b.isOpen())b.close();else{var f=el.getState(a.selections(),c);b.open();b.represent(f.readState.size())}},updateGeneral:u,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!1};return{general:k(f)}}function Gx(a){var b=a.hex(),c=p.fromTag("span");n.add(c,z.resolve("palette-detail-action"));m.set(c,"title",w.get(a.name()));T.option(c,w.get(a.name()),!1,!1);var d=G.create({selected:q(["value"])}),e=
J.bind(c,"click",function(){Y.focus(c);d.trigger.selected(b)});return{element:function(){return c},value:k(b),destroy:function(){e.unbind();E.remove(c)},events:d.registry}}function MS(){var a=[],b=S.div(),c=p.fromTag("span");T.listBox(c);n.add(c,z.resolve("palette-detail-actions"));n.add(c,z.resolve("palette-color-options"));T.label(c,w.translate("aria.font.palette"));y.append(b,c);var d=sk.create(),e=G.create({selected:q(["value"])});return{element:function(){return b},add:function(b){a.push(b.destroy);
y.append(c,b.element());d.bind(b.events.selected,function(a){e.trigger.selected(a.value())})},remove:function(a){E.remove(a.element());d.unbind(a.events.selected)},show:function(){n.add(b,z.resolve("palette-detail-active"));ma.showPanel(b);v.remove(b,"display")},hide:function(){n.remove(b,z.resolve("palette-detail-active"));ma.hidePanel(b);v.set(b,"display","none")},count:function(){return a.length},destroy:function(){A(a,pb);E.remove(b);a=[]},events:e.registry}}function Hx(a,b){a=Ci.makeLayout(b,
".ephox-polish-palette-detail-action.ephox-polish-palette-color-option:not(.ephox-polish-palette-color-option-spacer)",{isValid:NS});b=a.layout();return{isFocused:b.isFocused,enterGrid:b.enter,grid:b,refresh:a.refresh,destroy:b.destroy,clear:b.clear}}function OS(){var a=p.fromTag("div");PS()?T.presentation(a):T.menuItem(a,g.none(),g.none());n.add(a,z.resolve("color-widget"));var b=p.fromTag("div");n.add(b,z.resolve("color-widget-controls"));T.tabList(b);var c=p.fromTag("div");n.add(c,z.resolve("color-widget-palettes"));
T.toolbarGroup(c);var d=Hd("text-color");n.add(d.element(),z.resolve("tab-button"));d.content(Rc(w.translate("font.color")));T.tabButton(d.element(),w.translate("aria.font.color"));var e=Hd("highlight-color");n.add(e.element(),z.resolve("tab-button"));e.content(Rc(w.translate("font.highlight")));T.tabButton(e.element(),w.translate("aria.font.highlight"));y.append(b,d.element());y.append(b,e.element());y.append(a,b);y.append(a,c);return{element:k(a),colorToggle:k(d),highlightToggle:k(e),content:k(c),
controls:k(b),destroy:function(){d.destroy();e.destroy();E.remove(c);E.remove(b)}}}function QS(a){var b=Ci.create(a.colors.buttons),c=Ci.create(a.colors.buttons),d=G.create({color:Q(["value"],b.events.selected),highlight:Q(["value"],c.events.selected),abort:q([])}),e=OS(),f=e.colorToggle(),h=e.highlightToggle();T.linkTabToPanel(f.element(),b.element());T.linkTabToPanel(h.element(),c.element());y.append(e.content(),b.element());y.append(e.content(),c.element());var l=Hx(e,b.element()),r=Hx(e,c.element()),
g=ea.flow(e.controls(),{item:k(".ephox-pastry-statebutton")},xa.flow({trigger:function(a,b){return L.descendant(a,".ephox-pastry-button").map(function(a){a.dom().click();return a})},executeOnArrow:!0})),x=ea.multiple(e.element(),[g,l.grid,r.grid]);x.events.exit.bind(function(a){d.trigger.abort()});var H=function(){c.hide();f.select();h.deselect();ma.tabSelected(f.element(),[h.element()]);l.refresh();r.refresh();b.show()};f.events.click.bind(function(){g.clickFocus(f.element());H()});h.events.click.bind(function(){g.clickFocus(h.element());
b.hide();f.deselect();ma.tabSelected(h.element(),[f.element()]);c.show()});return{element:e.element,destroy:function(){b.destroy();x.destroy();c.destroy();e.destroy()},open:function(){x.clear();x.refresh();f.click();H();x.enter()},close:function(){x.exit()},events:d.registry}}function RS(){var a=g.none(),b=function(b){a.each(function(a){a[b]()})};return{enter:t(b,"enter"),exit:t(b,"exit"),destroy:t(b,"destroy"),set:function(b){a=g.some(b)}}}function SS(a,b){var c=b.i18nNamespace();b=b.cssNamespace();
var d=G.create({plus:q([]),minus:q([]),validate:q([]),abort:q([])}),e=Dc(),f=Dc(),h=S.div(),l=S.div(),r=p.fromTag("input");T.label(r,w.translate(c+".stepper.input"));T.toolbarButton(e.element(),w.translate(c+".stepper.increase"),!1,!1);T.toolbarButton(f.element(),w.translate(c+".stepper.decrease"),!1,!1);m.set(r,"tabindex","-1");m.set(e.element(),"tabindex","-1");m.set(f.element(),"tabindex","-1");n.add(l,z.resolve(b+"-stepper-input"));n.add(h,z.resolve(b+"-stepper-options"));n.add(e.element(),z.resolve("stepper-button"));
e.content(ve([z.resolve(b+"-stepper-increase")]));n.add(f.element(),z.resolve("stepper-button"));f.content(ve([z.resolve(b+"-stepper-decrease")]));y.append(l,r);O.append(h,[e.element(),f.element()]);O.append(a,[l,h]);e.events.click.bind(function(){Y.focus(e.element());d.trigger.plus()});f.events.click.bind(function(){Y.focus(f.element());d.trigger.minus()});var D=function(){r.dom().setSelectionRange(0,da.get(r).length)},x=J.capture(a,"click",function(a){P.eq(a.target(),l)&&H.enter()}),H=RS(),I=n.toggler(r,
z.resolve("invalid-"+b+"-size"));return{destroy:function(){e.destroy();f.destroy();H.destroy();x.unbind();E.remove(r)},highlight:function(){I.on();m.set(r,"title",w.translate("aria.stepper.input.invalid"));bb.shout(r,w.translate("aria.stepper.input.invalid"))},dehighlight:function(){I.off();m.remove(r,"title")},input:k(r),focus:function(){Y.focus(r);D()},enter:H.enter,exit:H.exit,initLayout:function(){var b=ea.single(r,[Z.basic(R.ENTER()[0],function(){d.trigger.validate();return g.some(!0)})],g.none());
b.events.enter.bind(D);var c=xa.button({execute:function(a){a.dom().click();Y.focus(a);return g.some(a)}});b=ea.multiple(a,[b,ea.button(e.element(),c),ea.button(f.element(),c)]);b.events.exit.bind(function(){B.parent(l).each(Y.focus);d.trigger.abort()});H.set(b)},events:d.registry}}function fl(a){var b=TS(a),c=S.div(),d=SS(c,b);n.add(c,z.resolve(b.cssNamespace()+"-size-widget"));var e=function(){return da.get(d.input())},f=function(a){var b=e();a=a(b);a=of.sanitise(a);da.set(d.input(),a);h.trigger.action(a);
d.dehighlight()};d.events.validate.bind(function(a){a=e();of.validate(a,b.tag(),b.property()).fold(function(){d.highlight()},function(a){da.set(d.input(),a);h.trigger.action(a);d.dehighlight();h.trigger.close()})});d.events.plus.bind(function(a){f(t(dl.increase,b.specials()))});d.events.minus.bind(function(a){f(t(dl.decrease,b.specials()))});var h=G.create({close:q([]),action:q(["value"]),abort:Q([],d.events.abort)}),l=J.bind(c,"click",function(a){(P.eq(a.target(),c)||P.eq(a.target(),d.input()))&&
d.enter()});return{element:k(c),input:d.input,getCurrentValue:e,focus:d.focus,enter:d.enter,initLayout:d.initLayout,destroy:function(){l.unbind();d.destroy();E.remove(c)},updateInlineWidget:function(a,e){var f=function(a){of.validate(a,b.tag(),b.property()).each(function(a){da.set(d.input(),a);d.dehighlight()})};a.size().fold(function(){f(e);n.add(c,z.resolve("default-"+b.cssNamespace()+"-size"))},u,function(a){f(a);n.remove(c,z.resolve("default-"+b.cssNamespace()+"-size"))})},open:u,close:u,events:h.registry}}
function US(a,b,c,d){var e=c();c=ud.okCancel("font-size");var f=Ie(b),h=null,l=G.create({close:q([]),open:q([]),analytics:q(["message"]),ok:q(["value"])});b=function(){h.unbind();f.hide();l.trigger.close()};f.setTitle(w.translate("font.size"));f.setContent(e.element());f.setControls(c.element());f.events.close.bind(b);c.events.ok.bind(function(){l.trigger.ok(e.getCurrentValue())});c.events.cancel.bind(b);n.add(f.element(),z.resolve("widget-dialog"));return{show:function(){f.show();var b=p.fromDom(window);
h=J.bind(b,"orientationchange",function(){a.foreground()});l.trigger.open()},element:f.element,contents:e,events:l.registry,destroy:function(){f.hide();f.destroy();e.destroy()}}}function VS(a,b){var c=a.content(),d=a.undo(),e={},f=function(a){return F(a.split(/,\s?/g),function(a){return a.trim().replace(/^['"](.*)['"]$/,"$1")}).join(",")},h=(0===b.faces.length?g.none():g.some(b.faces)).fold(Ix.faces,function(a){return F(a,function(a){var b=f(a.value);e[b]=a.value;return Ug.face(w.raw(a.text),b,g.none())})}),
l=ba.detect().deviceType.isiOS(),r=G.create({analytics:q(["message","properties"])}),D=g.some(kw.face),x=function(a){var b=f(a);a=va(h,function(a){return a.value()===b});var c=Ug.face(w.raw(b),b,g.none());return a.getOr(c)},H=l?WS:XS;l=LS(a,b);return{ui:ob.ui({"fontface.dropdown":k({name:"fontface",textkey:w.key("font.face"),menuTextkey:w.key("font.menu"),updateDropdown:function(b){var c=YS.face(a.selections()).map(x);b.populate([{label:g.none,items:k(h)}]);Gk.updateMenu(b,c,wa.on(),h,D)},action:function(b){b=
e.hasOwnProperty(b)?e[b]:b;nf.face(c,d,a.selections(),b)},values:h,render:D,describe:function(a){return w.translate("font.describe",w.get(a.textkey()))},hasPopup:!0}),"fontcolor.widget":function(c){return ZS.widget(a,b)},"fontsize.widget":function(b){return H.widget(a,b)},"fontsize.general":l.general},aa),events:r.registry,destroy:u}}function Jx(a,b,c){var d=ux(a,b,c);T.tabList(d.menu());F(d.tabs(),function(a){var b='.ephox-pastry-tablayout-content[data-ephox-pastry-tablayout-view="'+a.name()+'"]';
m.set(a.element(),"tabindex","-1");n.add(a.element(),z.resolve("tab-button"));L.descendant(d.body(),b).each(function(b){var c=Za("ephox-aria");m.set(a.element(),"id",c);T.tabButton(a.element(),a.name());T.tabPanel(b);T.linkTabToPanel(a.element(),b);T.labelledBy(b,c)})});return{element:d.element,tabs:d.tabs,body:d.body,menu:d.menu,destroy:d.destroy,events:d.events}}function $S(a){var b=2===jb(a.integration).length,c=pf.aboutTags(b,a.integration);return{content:function(a){return hb(c,function(a,b){return a.replace(b.str(),
b.replace())},a)},dom:b?function(a){L.descendant(a,".ephox-polish-help-integration").each(function(a){v.set(a,"display","block")})}:u}}function Di(a,b,c){var d=g.none(),e=g.none(),f=aT(c),h=function(a,c){c=b.content(c.trim());d=g.some(c);l(a,c)},l=function(a,c){c=p.fromHtml(c.trim());b.dom(c);E.empty(a);n.remove(a,z.resolve("tablayout-loading"));r(c);var d=p.fromTag("div");T.document(d);y.append(d,c);y.append(a,d)},r=function(a){x();e=L.descendant(a,".ephox-license-link").map(function(a){return J.bind(a,
"click",function(a){window.open(f,"","height=700,width=620,resizable=yes,scrollbars=yes")})})},k=function(b){a.get(function(a){a.fold(function(a){b("&nbsp;");console.error("Unable to download help article",a)},b)})},x=function(){e.each(function(a){a.unbind()})};return{render:function(a){d.fold(function(){n.add(a,z.resolve("tablayout-loading"));k(t(h,a))},function(b){l(a,b)})},destroy:function(){x()}}}function bT(a){var b={content:aa,dom:u},c=ba.detect();if(!0===a.source){var d=a.baseUrl+"/help/"+
Le.get()+"/";d={about:Zd.get(d+"about.html",$d.text(),Od.xhr()),accessibility:Zd.get(d+"accessibility.html",$d.text(),Od.xhr()),a11ycheck:Zd.get(d+"a11ycheck.html",$d.text(),Od.xhr()),markdown:Zd.get(d+"markdown.html",$d.text(),Od.xhr()),shortcuts:Zd.get(d+"shortcuts.html",$d.text(),Od.xhr())}}else d=cT(a.baseUrl+"/help_"+Le.get()+".js?"+pf.resourceParam());c=!c.deviceType.isTouch();a=[Ei(c,cg(w.translate("help.dialog.shortcuts"),Di(d.shortcuts,b,a))),Ei(c,cg(w.translate("help.dialog.accessibility"),
Di(d.accessibility,b,a))),Ei(!0,cg(w.translate("help.dialog.markdown"),Di(d.markdown,b,a))),Ei(c,cg(w.translate("help.dialog.a11ycheck"),Di(d.a11ycheck,b,a))),Ei(!0,cg(w.translate("help.dialog.about"),Di(d.about,$S(a),a)))];return Td(a)}function dT(a,b){var c=G.create({close:q([])}),d=Ie(a),e=bT(b),f=Jx(up.left(),e,"help");m.set(f.body(),"tabindex","-1");n.add(d.element(),z.resolve("help-modal"));a=B.children(f.element());A(a,Ic.register);d.setTitle(w.translate("cog.help"));d.setContent(f.element());
var h=eT(f);a=fT(f);var l=ea.multiple(d.element(),[h,a]);f.events.setActive.bind(function(a){h.clickFocus(a.item().element())});var r=function(){d.hide()};d.events.close.bind(function(){l.exit();r()});l.events.exit.bind(function(){r();c.trigger.close()});return{element:d.element,open:function(){d.show();l.enter()},destroy:function(){f.destroy();d.destroy();l.destroy();A(e,function(a){a.renderer().destroy()})},hide:r,events:c.registry}}function gT(a,b){var c=dT(a,b),d=function(){e.trigger.analytics("help_screen_hide");
e.trigger.close();f()},e=G.create({close:q([]),analytics:q(["message"])});c.events.close.bind(d);var f=function(){c.events.close.unbind(d);c.destroy()};return{show:function(){e.trigger.analytics("help_screen_show");c.open()},destroy:f,events:e.registry}}function hT(a,b){var c=a.content(),d=a.smartview(),e=a.shortcuts(),f=G.create({analytics:q(["message"])}),h=Uc.destroyable(),l=function(){var e=gT(d.uiContainer(),b);h.set(e);e.events.close.bind(function(){c.toEditing();h.clear()});e.events.analytics.bind(function(a){f.trigger.analytics(a.message())});
c.toReading();a.content().hideInlineSelection();e.show()};e.events.help.bind(l);return{ui:ob.ui({"help.general":{toggle:!1,value:"help",textkey:w.key("cog.help"),action:l,updateGeneral:u,icon:!0,hasPopup:!1,hasDialog:!0,tooltip:ib.get}}),events:f.registry,destroy:function(){h.clear()}}}function iT(a,b,c){var d=a.filter(),e=a.content(),f=a.operations();Me.configure(d);var h=void 0===c.external?[]:F(c.external,function(a){return jT(a.prefix,a.suffix,a.style)});A(h,function(a){var c=mv(a.prefix(),a.suffix(),
function(b){var c=p.fromTag("span");ja.add(c,[Me.highlightClass()]);v.setAll(c,a.style());var d=p.fromTag("div");y.append(c,p.fromText(a.prefix()+b+a.suffix()));y.append(d,c);return Ca.get(d)});b.customMacros().add(c)});a=function(a){e.getSelection().each(function(b){a.prev().each(function(a){L.ancestor(a,"."+Me.placeholderClass()).each(function(a){Kx.rehighlight(f,h,a)})});L.ancestor(b.startContainer(),"."+Me.highlightClass()).each(function(a){Kx.unhighlight(f,a)})})};return 0<h.length?(e.events.nodeChanged.bind(a),
{run:function(){kT.run(e,h)},destroy:u}):{run:u,destroy:u}}function lT(a){var b=a.content();return{ui:ob.ui({"horizontalrule.general":{toggle:!1,value:"horizontalrule",textkey:w.key("insert.horizontalrule"),action:function(){bd.insertAtCursor(b,[p.fromTag("hr")]).each(function(a){a=ha.after(a.element());b.setRelativeSelection(a,a);b.toEditing()})},updateGeneral:u,icon:!0,shortcut:!1,hasPopup:!1}}),destroy:u}}function Lx(a){var b=z.resolve("dialog-float-selected"),c=p.fromTag("fieldset");m.set(c,"role",
"radiogroup");a=p.fromHtml("<legend>"+w.translate(a)+"</legend>");var d=Za("ephox-aria");m.set(a,"id",d);m.set(c,"aria-labelledby",d);var e=S.div();n.add(e,z.resolve("dialog-float-options"));O.append(c,[a,e]);var f=function(){A(h,function(a){n.remove(a.element(),b);ma.checked(a.element(),!1)})},h=F(["none","center","left","right"],function(a){var c=Dc(),d=w.translate("align."+a);m.setAll(c.element(),{tabindex:"-1","data-float-value":a,title:d,"aria-label":d,role:"radio"});a=S.div();d=S.div();var e=
S.div(),h=S.div();T.hidden(a,!0);n.add(d,z.resolve("dialog-float-icon-inner-left"));n.add(e,z.resolve("dialog-float-icon-inner-center"));n.add(h,z.resolve("dialog-float-icon-inner-right"));O.append(a,[d,e,h]);c.events.click.bind(function(){f();n.add(c.element(),b);ma.checked(c.element(),!0);Y.focus(c.element())});n.add(c.element(),z.resolve("dialog-float-container"));n.add(a,z.resolve("dialog-float-icon"));y.append(c.element(),a);return c});O.append(e,F(h,function(a){return a.element()}));var l=Nb.radio(c,
"."+z.resolve("dialog-float-container"),"."+z.resolve("dialog-float-selected"));return{element:function(){return c},get:function(){return L.child(e,"."+b).map(function(a){return m.get(a,"data-float-value")})},select:function(a){f();a.each(function(a){L.child(e,'span[data-float-value="'+a+'"]').or(B.firstChild(e)).each(function(a){n.add(a,b);ma.checked(a,!0)})});l.refresh()},keylayout:k(l),destroy:function(){A(h,function(a){a.destroy()})}}}function mT(){var a=S.div(),b=S.div(),c=S.div(),d=S.div();
n.add(c,z.resolve("image-url-controls"));n.add(d,z.resolve("image-size-controls"));var e=Lx("image.dialog.fields.align"),f=Jc.input("image-url","image.dialog.fields.url"),h=Jc.input("image-alt","image.dialog.fields.alt"),l=Jc.input("image-width","image.dialog.fields.width"),r=Jc.input("image-height","image.dialog.fields.height"),D=p.fromTag("input");m.set(D,"type","hidden");var x=Hd("lock");n.add(x.element(),z.resolve("dialog-button"));var H=ve([z.resolve("icon"),z.resolve("image-lock-button")]);
m.set(x.element(),"title",w.translate("image.dialog.fields.constrain.on"));T.toolbarButton(x.element(),w.translate("image.dialog.fields.constrain.label"),!1,!0);ma.press(x.element());x.select();x.content(H);x.events.click.bind(function(){Y.focus(x.element());var a=x.selected()?"on":"off";m.set(x.element(),"title",w.translate("image.dialog.fields.constrain."+a));(x.selected()?ma.press:ma.release)(x.element())});H=S.div();n.add(H,z.resolve("form-group"));n.add(H,z.resolve("form-group-lock"));var I=
p.fromHtml("<label>"+w.translate("image.dialog.fields.constrain.label")+"</label>"),U="constrain"+Za("");m.set(x.element(),"id",U);m.set(I,"for",U);var q=function(a){a.isLocal()?(m.set(f.input(),"disabled","disabled"),da.set(f.input(),w.translate("image.dialog.fields.urllocal"))):(m.remove(f.input(),"disabled"),da.set(f.input(),a.url()))},u=function(a,b,c){var d=parseFloat(da.get(D));a=da.get(a);da.set(b,c(d,a).getOrThunk(function(){return da.get(b)}));xc.dehighlight(b)};U=function(a){xc.validateField(a.target(),
"width",g.some("px")).fold(function(){xc.highlight(a.target())},function(b){xc.dehighlight(a.target());b=a.target();x.selected()&&(P.eq(b,l.input())?u(l.input(),r.input(),yp.fromWidth):P.eq(b,r.input())&&u(r.input(),l.input(),yp.fromHeight))})};var v=function(a){if(m.has(a.target(),"placeholder")){var b=m.get(a.target(),"placeholder");""===da.get(a.target())&&da.set(a.target(),b)}},y=J.bind(l.input(),"input",U),A=J.bind(r.input(),"input",U),B=J.bind(l.input(),"focus",v),C=J.bind(r.input(),"focus",
v);O.append(H,[I,x.element()]);O.append(b,[e.element()]);O.append(c,[f.element(),h.element()]);O.append(d,[l.element(),r.element(),H]);O.append(a,[c,d,b]);b=[ea.input(f.input(),xa.input({})),ea.input(h.input(),xa.input({})),ea.input(l.input(),xa.input({})),ea.input(r.input(),xa.input({})),ea.button(x.element(),xa.button({execute:Nb.button})),e.keylayout()];return{element:k(a),destroy:function(){x.destroy();y.unbind();A.unbind();B.unbind();C.unbind();e.destroy()},dehighlight:t(xc.clearHighlights,a),
highlight:xc.highlight,keylayouts:k(b),set:function(a){q(a);da.set(h.input(),a.alt());da.set(l.input(),a.width());da.set(r.input(),a.height());var b=a.computedWidth().bind(function(b){return a.computedHeight().bind(function(a){return yp.calculate(b,a)})}).getOr(1);a.computedWidth().each(t(m.set,l.input(),"placeholder"));a.computedHeight().each(t(m.set,r.input(),"placeholder"));da.set(D,b);e.select(a.align())},get:function(){return xc.validate([xc.rule(l.input(),"width",g.some("px")),xc.rule(r.input(),
"height",g.some("px"))]).map(function(a){return gl.properties({url:da.get(f.input()),alt:da.get(h.input()),width:a.width(),height:a.height(),isLocal:m.has(f.input(),"disabled"),align:e.get()})})}}}function nT(a){var b=G.create({ok:q(["image","properties"]),close:q([])}),c=Ga(g.none()),d=Ie(a),e=ud.okCancel("image-properties"),f=mT();d.setContent(f.element());n.add(d.element(),z.resolve("dialog-narrow"));a=function(){var a=f.get();f.dehighlight();a.fold(function(a){f.highlight(a)},function(a){c.get().each(function(c){b.trigger.ok(c,
a)})})};e.events.ok.bind(a);e.events.cancel.bind(function(){d.hide();b.trigger.close()});d.setTitle(w.translate("image.dialog.title"));d.setControls(e.element());d.events.close.bind(function(){b.trigger.close()});var h=Nb.setup(d,e,f.keylayouts());return{element:d.element,open:function(){d.show();h.enter()},hide:function(){h.exit();d.hide()},destroy:function(){d.destroy();h.destroy();e.destroy();f.destroy()},represent:function(a){var b=gl.divine(a);c.set(g.some(a));f.set(b)},execute:a,events:b.registry}}
function oT(a,b){b=Mx.image(a.content().imageExcludes);var c=G.create({changed:q(["image"]),contextmenu:Q(["image"],b.events.contextmenu)}),d=function(b){var d=a.content(),e=nT(a.smartview().uiContainer()),l=Nx.generate(a.keyboard(),e,["image","properties"]);l.events.ok.bind(function(a){gl.apply(a.image(),a.properties());c.trigger.changed(a.image());l.destroy();d.domChanged();d.focus();d.uiChanged()});l.events.close.bind(function(a){l.destroy();d.focus()});l.represent(b);l.open()};b.events.properties.bind(function(a){d(a.image())});
return{destroy:u,situation:b.situation,handle:b.handle,assign:b.assign,events:c.registry}}function pT(a){var b=function(b){return Zd.get(b,$d.blob(),Od.xhr(),a.newHeaders())},c=function(a){return!(zp.local(a)||zp.sameDomain(a,String(qf.location)))};return{getImage:function(d){var e=m.get(d,"src");return(c(e)?a.proxy(e):g.none()).fold(function(){return La.fromPromise(Fi.imageToBlob(d.dom()))},b)}}}function qT(a,b,c){var d=g.none();return{setTarget:function(a){d=g.some(a)},clearTarget:function(){d=
g.none()},mutate:function(e,f){d.each(function(d){var h=ub.delta({top:f,left:e}),r=dg.updatePosition(c,function(b){return d(a,b,h)});dg.drawAtOrigin(c,a);b.update(r)})}}}function rT(a){var b=G.create({reposition:q(["direction","delta"])}),c=rf("top","n",g.none()),d=rf("bottom","s",g.none()),e=rf("right","e",g.none()),f=rf("left","w",g.none()),h=rf("top-left","nw",g.some(a("image.crop.handle.nw"))),l=rf("top-right","ne",g.some(a("image.crop.handle.ne"))),r=rf("bottom-right","se",g.some(a("image.crop.handle.se"))),
D=rf("bottom-left","sw",g.some(a("image.crop.handle.sw"))),x=Fe.nu(function(a){setTimeout(function(){v.reflow(c);var b=Aa.get(c),d=pa.get(c);a(k(3*b+2*d))},0)}),H=b.trigger.reposition;a=[c,d,e,f,l,h,r,D];H=[ea.single(h,Gi.navigation("nw",H),g.none()),ea.single(l,Gi.navigation("ne",H),g.none()),ea.single(r,Gi.navigation("se",H),g.none()),ea.single(D,Gi.navigation("sw",H),g.none())];return{elements:k(a),keylayouts:k(H),events:b.registry,refresh:function(a,b){a=Ox.calculate(a,b);sf(c,a.n());sf(d,a.s());
sf(e,a.e());sf(f,a.w());sf(h,a.nw());sf(D,a.sw());sf(r,a.se());sf(l,a.ne());x.get(function(a){Px([c,d],b.width,a);Px([e,f],b.height,a)})}}}function sT(){var a=hl("left"),b=hl("top"),c=hl("right"),d=hl("bottom");return{elements:k([a,b,c,d]),refresh:function(e,f){e=tT.derive(e,f);il(a,e.leftRim());il(b,e.topRim());il(c,e.rightRim());il(d,e.bottomRim())}}}function uT(a,b,c,d){var e=p.fromTag("div");n.add(e,Qx.magicBox());eg.base(e,d("image.crop.begin"));jl.effect(e,"execute");var f=p.fromTag("div");
m.set(f,"role","row");var h=sT(),l=rT(d),r=function(a){v.setAll(e,{top:a.top()+"px",left:a.left()+"px"})};d=function(b){var c=a();r(c);h.refresh(c,b);l.refresh(c,b);D.trigger.updated(b)};O.append(f,Kb([h.elements(),[b],l.elements()]));y.append(e,f);var D=G.create({updated:q(["newBounds"]),reposition:Q(["direction","delta"],l.events.reposition)});d(c);b=l.keylayouts();return{element:k(e),bitsbox:k(f),keylayouts:k(b),move:r,update:d,destroy:function(){E.remove(e)},events:D.registry,tryMovement:function(a){return L.closest(a,
"."+nb.resolve("corner-wrapper")).bind(function(a){a=m.get(a,"data-"+nb.resolve("direction"));return void 0!==kl[a]?g.some(kl[a]):g.none()})}}}function vT(a,b,c,d){var e=p.fromTag("div");ja.add(e,[nb.resolve("panel-central"),nb.resolve("side-panel")]);m.set(e,"tabindex","-1");eg.cell(e,d("image.crop.handle.shade"));jl.grab(e,!1);var f=wT(a());dg.writePosition(e,f);dg.drawAtOrigin(e);var h=uT(a,e,f,d);y.append(b,h.element());var l=qT(a(),h,e),r=oi.transform(l),D=J.bind(e,"dblclick",function(){t.trigger.apply()}),
x=xT.bind(h.element(),function(a){h.tryMovement(a).orThunk(function(){return L.closest(a,"."+nb.resolve("panel-central")).map(function(){return kl.translate})}).each(H)}),H=function(a){r.off();l.clearTarget();l.setTarget(a);r.on();r.go(c)},I=function(b,c){var d=dg.updatePosition(e,function(d){return kl[b](a(),d,c)});dg.drawAtOrigin(e);h.update(d)};d=Kb([h.keylayouts(),[ea.single(e,Gi.navigation("translate",I),g.none())]]);var U=function(){var c=a();return J.bind(B.defaultView(b),"resize",function(){var b=
a();if(b.height()!==c.height()||b.width()!==c.width())t.trigger.cancel();else if(b.top()!==c.top()||b.left()!==c.left())h.move(b),c=b})}();f=function(a){return function(){Y.active(B.owner(b)).each(function(b){jl.grab(b,a)})}};var n=f("true"),u=f("false");A(d,function(a){a.events.enter.bind(n);a.events.exit.bind(u)});h.events.reposition.bind(function(a){I(a.direction(),a.delta())});var t=G.create({updated:Q(["newBounds"],h.events.updated),apply:q([]),cancel:q([])});return{element:h.element,keylayouts:k(d),
destroy:function(){r.destroy();U.unbind();x.unbind();D.unbind();h.destroy()},boxes:function(){return{box:a,magic:h.element,shade:k(e)}},get:function(){return dg.readPosition(e)},events:t.registry}}function yT(a,b,c,d,e){var f=t(zT,a),h=vT(f,b,c,e);return{element:h.element,keylayouts:h.keylayouts,crop:function(){var b=h.get();var c=Aa.get(a),e=pa.get(a);b=AT({cropX:b.left(),cropY:b.top(),cropWidth:b.width(),cropHeight:b.height(),displayWidth:c,displayHeight:e});return d.animate(h.boxes().magic(),a,
h.boxes(),b)},destroy:function(){h.destroy()},events:h.events}}function BT(a){var b=a.content(),c=G.create({ok:q(["cropAction","image","cleanup"])}),d=Uc.value(),e=Uc.value(),f=function(a){var f=b.body().getOrDie();bb.speak(fa.body(),w.translate("image.crop.announce"));var h=B.documentElement(a),g=yT(a,h,h,CT.slide(),w.translate),k=De(function(a,b){bb.speak(fa.body(),w.translate("aria.image.crop.size",a,b))},500);g.events.updated.bind(function(a){a=a.newBounds();k.throttle(a.width(),a.height())});
var H=function(){d.clear();t.exit();t.destroy();u.unbindAll();p.clear()},m=function(){H();e.clear();g.destroy()},U=function(){m();Ne.select(b,a)},n=function(){H();g.crop().get(function(b){p.clear();bb.speak(fa.body(),w.translate("image.crop.apply"));var d=fg.crop(b.cropX(),b.cropY(),b.cropWidth(),b.cropHeight()),e=Ap.changedBounds(a);c.trigger.ok(function(a){return zi.resampleAction(e,a,d)},a,function(a){m();return a})})};d.set(n);e.set(m);DT(b,a);var q=function(){bb.speak(fa.body(),w.translate("image.crop.cancel"));
U()},p=Uc.unbindable();setTimeout(function(){p.set(J.bind(f,"focus",function(a){q()}))});var t=ea.inlineDialog(h,g.keylayouts(),xa.inlineDialog({ok:n,cancel:q}));t.enter();var u=sk.create();u.bind(b.events.domChanged,U);u.bind(b.events.nodeChanged,function(a){fa.inBody(a.node())&&U()});u.bind(g.events.apply,n);u.bind(g.events.cancel,U)};return{apply:function(){d.on(pb)},open:function(){lc.detect(b.getSelection()).each(function(a){f(a.image())})},destroy:function(){e.on(pb)},isActive:d.isSet,events:c.registry}}
function ET(a){a=FT.parse(a.preferredWidth,a.preferredHeight);var b=a.fold(GT,zi.instance),c=a.fold(HT,function(){return IT(b)});return{assets:function(a){return ae(a,b)},correlated:function(a){return ae(a,c)}}}function JT(a,b,c){var d=pT(a.communication()),e=tp(a.ui),f=a.content(),h=function(c){return function(d){d.fold(function(a){a=Bp.diagnoseImageEdit(a,m.get(c,"src"));e.show(a.bannerMessage());console.error("Image edit operation failed: ",a.consoleMessage())},function(c){b.uploadAssets([c]);
f.focus();a.undo().save();f.domChanged()});Ne.select(f,c);return d}},l=function(b,c){a.undo().save();var e=Cp.applyEdit(b);return Cp.run(d,c,e)(b)},r=BT(a);r.events.ok.bind(function(a){var b=a.image(),c=a.cropAction();a=a.cleanup();var d=Oe.updater(Oe.keepCrop,b);l(b,c).map(d).map(a).get(h(b))});var g=function(){return lc.detectForEditing(f.getSelection(),f.imageExcludes)},x=function(a,b){return function(){g().each(function(c){c=c.image();var d=aa,e=Oe.updater(b,c);l(c,a).map(e).map(d).get(h(c))})}},
H=[Vg.make("crop-begin","image.crop.begin",r.open),Vg.make("rotate-left","image.toolbar.rotateleft",x(fg.rotateLeft,Oe.keepRotate)),Vg.make("rotate-right","image.toolbar.rotateright",x(fg.rotateRight,Oe.keepRotate)),Vg.make("flip-horizontal","image.toolbar.fliphorizontal",x(fg.flipHorizontal,Oe.keepFlip)),Vg.make("flip-vertical","image.toolbar.flipvertical",x(fg.flipVertical,Oe.keepFlip))],I=[Vg.make("crop-apply","image.crop.apply",r.apply)];x=ob.ui({"edit.palette":t(Rx.edit,a.ui().refresh,g,r.isActive,
H),"crop.palette":t(Rx.crop,a.ui().refresh,r.isActive,I)},aa);H=Mx.imageEdit(r.isActive,I,H,f.imageExcludes);c=ET(c);return{destroy:function(){r.destroy()},ui:x,insertResample:k(c),situation:H.situation,handle:H.handle,assign:H.assign,name:k("imageEdit")}}function KT(a,b){var c=z.resolve("cursor-pointer"),d=b.os.isOSX(),e=g.none(),f=function(b){return a.isInline()?Wa.absolute(b).top():0},h=function(b){var c=m.get(b,"href");if("top"===m.get(b,lb.bookmarkAnchorDataAttr()))a.doc().each(function(b){a.body().each(function(a){var c=
Pa.get(b);Pa.to(c.left(),f(a),b)})});else if("bottom"===m.get(b,lb.bookmarkAnchorDataAttr()))a.win().each(function(b){a.doc().each(function(c){a.body().each(function(a){var d=f(a),e=Pa.get(c);a=d+pa.get(a)-b.innerHeight;Pa.to(e.left(),a,c)})})});else if(/^#/.test(c)){var d=c.substr(1);a.body().each(function(b){rd.anchorTarget(b,d).each(function(b){a.win().each(function(a){Pa.setToElement(a,b)})})})}else window.open(c)},l=function(a,b){var c=d?R.META():R.CTRL();V(c,a)&&b()};b=p.fromDom(window);var r=
g.none();a.events.ready.bind(function(a){a=a.api().body();var b=Xk.handle(a,function(a){var b=a.target();(d?a.raw().metaKey:a.raw().ctrlKey)&&L.closest(b,"a[href]").each(function(b){a.prevent();h(b)})});r=g.some(b);e=g.some(n.toggler(a,c))});var k=function(){e.each(function(a){a.on()})},x=function(){e.each(function(a){a.off()})},H=function(a){l(a.original().raw().which,x)};a.events.keyup.bind(H);var I=J.bind(b,"keyup",function(a){l(a.raw().which,x)}),U=function(a){l(a.original().raw().which,k)};a.events.keydown.bind(U);
var q=J.bind(b,"keydown",function(a){l(a.raw().which,k)});return{follow:h,destroy:function(){r.each(function(a){a.unbind()});a.events.keyup.unbind(H);a.events.keydown.unbind(U);I.unbind();q.unbind()}}}function LT(a,b,c,d){var e=p.fromTag("div");T.dialog(e,w.get(d));ja.add(e,[z.resolve("expandable-inline-popup")]);d=S.div();n.add(d,z.resolve("inline-popup-content"));var f=S.div();ja.add(f,[z.resolve("inline-popup-content-expand"),Hi]);var h=S.div();n.add(h,z.resolve("inline-popup-controls"));var l=
S.div();n.add(l,z.resolve("inline-popup-expand-button-wrapper"));var r=p.fromTag("span");ja.add(r,[z.resolve("inline-popup-expand-button"),z.resolve("icon")]);var g=w.translate("aria.label.more");m.set(r,"title",g);T.button(r,g);T.group(f);T.linkElements(r,f);y.append(l,r);g=S.div();n.add(g,z.resolve("inline-popup-body"));O.append(g,[d,f,l]);O.append(e,[g,h]);O.append(d,a);O.append(f,b);O.append(h,c);n.add(e,Hi);var x="0px",H=function(){n.remove(e,Hi);n.add(f,z.resolve("expand-close"));T.hidden(f,
!0);v.setAll(f,{opacity:"0",height:"0px",visibility:"hidden"});ma.collapsed(r)},I=J.bind(f,"transitionend",function(a){ja.remove(f,[z.resolve("expand-close"),z.resolve("expand-open")])}),U=J.bind(r,"click",function(a){n.has(e,Hi)?H():(n.add(e,Hi),n.add(f,z.resolve("expand-open")),T.hidden(f,!1),v.setAll(f,{opacity:"1",height:x,visibility:"visible"}),ma.expanded(r))});a=[ea.button(r,xa.button({execute:Nb.click}))];return{element:k(e),keylayouts:k(a),destroy:function(){E.remove(e);U.unbind();I.unbind()},
show:function(){x=pa.getOuter(f)+"px";H();v.reflow(e);n.add(e,z.resolve("enable-transition"))}}}function MT(a){var b=NT();a.url().each(function(a){da.set(b.input(),a)});var c=Jc.input("text-to-display","link.properties.text.label"),d=Ga(!1);n.add(c.element(),z.resolve("text-to-display"));m.setAll(c.input(),{placeholder:w.translate("link.properties.text.placeholder"),autocomplete:"off",autocorrect:"off"});a.text().each(function(a){da.set(c.input(),a)});var e=Jc.input("title-text","link.properties.title.label");
n.add(e.element(),z.resolve("title-container"));m.setAll(e.input(),{placeholder:w.translate("link.properties.title.placeholder"),autocomplete:"off",autocorrect:"off"});a.title().each(function(a){da.set(e.input(),a)});var f=OT.target(a),h=J.bind(c.input(),"input",function(){d.set(!0)});return{url:k(b),text:k(c),textChanged:d.get,title:k(e),target:k(f),keylayouts:function(){return[ea.input(b.input(),xa.input({})),ea.input(c.input(),xa.input({})),ea.input(e.input(),xa.input({})),ea.button(f.input(),
xa.button({execute:Nb.click,process:u}))]},destroy:function(){h.unbind()}}}function PT(a){var b=df(a)?a:1E4,c=rp.access("local.linkCache");a=c.read();var d=function(a){return 0>b-a.length?a.slice(0,b):a}(Gb(a)?a:[]),e=function(a){d.splice(a,1)},f=function(){return d.slice(0)};return{add:function(a){"#"!==a.charAt(0)&&(d.length>=b&&d.pop(),zc(d,a).each(e),d.unshift(a))},state:f,destroy:function(){c.write(f())}}}function QT(a,b){return{position:function(c,d){c=c.isRtl()?Wg.allRtl():Wg.all();var e=Lg(0,
0);d=Rg.element(a,d);ll.simple(d,b,e,c,{})}}}function RT(a,b,c,d){var e=G.create({change:q([])}),f=function(){var a=b.body().map(rd.all).getOr([]);a=ia(a,function(a){var b=m.get(a,"href");return Ab(b,"#")||m.has(a,lb.bookmarkAnchorDataAttr())?[]:[b]});a=d.state().concat(a);a=ST(a);return F(a,function(a){var b=g.none();return TT(a,k(!1),b,u)})},h=function(a,b,c){var d=rd.getAnchorValue(a,Nk.generate("textbox-heading"));return g.some(Sx("#"+d,c,function(){m.set(b,"id",d)}))},l=function(a){var b="h1"!==
C.name(a),c=Mb.get(a);return m.has(a,"id")||m.has(a,"name")?(a=m.has(a,"id")?m.get(a,"id"):m.get(a,"name"),g.some(Sx("#"+a,b,u))):0===c.trim().length?g.none():h(c,a,b)},r=function(a){m.remove(a,lb.bookmarkAnchorDataAttr())},D=function(a){var b=lb.reservedUrls()[a.toLowerCase()];return function(a){m.set(a,lb.bookmarkAnchorDataAttr(),b)}},x=function(){var a=b.body().map(rd.findLinkTargets).getOr([]),c=1E3<a.length;a=F(a,function(a){return l(a).map(function(b){var d=(c?rd.linkTargetFastText:rd.linkTargetText)(50,
a);return Dp(b.url(),b.indent(),b.action(),d.before(),d.innerText(),d.after())})});a=Td(a);var d=D(lb.topAnchorUrl());d=Dp(lb.topAnchorUrl(),!1,d,"","\u2014 "+lb.topAnchorUrl()+" \u2014","");var e=D(lb.bottomAnchorUrl());e=Dp(lb.bottomAnchorUrl(),!1,e,"","\u2014 "+lb.bottomAnchorUrl()+" \u2014","");return[d].concat(a).concat([e])};return{predict:function(b,d,h){var l=Xb(function(){var a=f(),d=x();a=ml.config({container:c,translate:w.translate,sections:[ml.section({id:"recent",highlight:"strong",contentLimit:50,
items:a,itemLimit:10,render:Tx.anchors,extractors:[Ii.title,Ii.url]}),ml.section({id:"anchors",highlight:"strong",contentLimit:50,items:d,render:Tx.standard,extractors:[Ii.innerText,Ii.url]})]});var e=ml.init(b,a);ja.add(e.element(),[z.resolve("layer-menus"),z.resolve("tarot-inline")]);e.events.click.bind(function(a){e.hide();H(b,a.item())});a=Aa.get(b);v.setAll(e.element(),{"min-width":a+"px","box-sizing":"border-box"});return e}),k=Ga(g.none()),H=function(a,b){var c=b.url();da.set(a,c);UT&&a.dom().click();
k.set(g.some(b));e.trigger.change()},m=h.container(b);m.swallowKeys([R.UP(),R.DOWN()]);m.events.up.bind(function(a){a.stopper()();a=l();I(a);a.moveup()});m.events.down.bind(function(a){a.stopper()();a=l();I(a);a.movedown()});m.events.escape.bind(function(a){var b=l();b.isShowing()&&(b.hide(),a.stopper()())});m.events.enter.bind(function(a){l().getSelectedData().each(function(c){a.stopper()();var d=l();d.hide();d.reset();H(b,c)})});m.on();var I=function(c){if(!c.isShowing()){var d=da.get(b);""===d?
c.resetFull():c.filter(d);c.isShowing()||c.show(a.uiDirection())}},U=[J.bind(b,"input",function(c){e.trigger.change();c=l();k.set(g.none());var d=da.get(b);0<d.length?(c.filter(d),c.isShowing()||c.show(a.uiDirection())):(c.reset(),c.hide())}),J.bind(b,"focus",function(a){l()}),J.bind(b,"blur",function(a){var c=l().hide;Y.active().fold(c,function(a){P.eq(a,b)||c()})}),J.bind(c,"click",function(a){l().hide()}),J.bind(d,"click",function(a){a.stop();a=l();a.isShowing()?a.hide():I(a)})];return{destroy:function(){l().destroy();
m.destroy();A(U,function(a){a.unbind()})},getSelectedValue:function(){return k.get().fold(function(){var a=da.get(b),c=lb.isReservedUrl(a)?D(a):r;return Ux(a,c)},function(a){return Ux(a.url(),a.action())})}}},events:e.registry}}function VT(a,b,c,d,e,f,h){var l=PT(1337),r=MT(f),k=h();h=[r.url().element()];var x=[r.text().element(),r.title().element(),r.target().element()],H=LT(h,x,k.elements(),k.dialogTitle());n.add(H.element(),z.resolve("inline-link-dialog"));var I=ye.popup(d.uiContainer,d.bounds,
a,[],Xf.editorContainer()).initMenu(H.element());n.add(I.element(),z.resolve("bubble-box"));h=I.element();h=RT(a,c,h,l);var U=h.predict(r.url().input(),r.url().dropArrow(),b);f.invalid()&&(r.url().showInvalid(),h.events.change.bind(function(){r.url().hideInvalid()}));var p={before:function(){v.set(I.panel(),"visibility","hidden");I.open()},after:function(){v.remove(I.panel(),"visibility");v.remove(I.panel(),"display")}},t=G.create({remove:Q([],k.events().remove),cancel:q([]),execute:Q([],k.events().execute)}),
w=function(a){var b=a.command();a=a.data();m.has(a,lb.bookmarkAnchorDataAttr())||"insertLink"!==b&&"updateLink"!==b||(b=m.get(a,"href"),l.add(b))};e.events.internal.bind(w);b=function(){t.trigger.cancel()};k.events().cancel.bind(b);I.events.close.bind(b);b=Kb([r.keylayouts(),H.keylayouts(),k.keylayouts()]);var y=ea.inlineDialog(H.element(),b,xa.inlineDialog({ok:k.execute.click,cancel:u}));y.events.exit.bind(function(){I.close();t.trigger.cancel()});return{showPopup:function(b){p.before();Ng.preserve(function(){b.showExpandable(a,
c,d,I,H);p.after();H.show();y.enter()},H.element())},hide:function(){I.closed()||y.exit()},getValues:function(){var a=U.getSelectedValue(),b=da.get(r.text().input()).trim(),c=da.get(r.title().input());return Xg.properties({url:""===a.url()?g.none():g.some(a.url()),textChanged:r.textChanged(),text:g.some(b),title:g.some(c),target:Ep.getValue(r.target().input()),action:g.some(a.action()),invalid:!1})},destroy:function(){l.destroy();e.events.internal.unbind(w);U.destroy();r.destroy();y.destroy();k.destroy();
I.destroy();H.destroy()},events:t.registry}}function WT(a,b){var c=a.filter(),d=a.content(),e=a.smartview(),f=Vx.enabled(d),h=a.internalevents(),l=ba.detect();Xg.configure(c);var r=KT(d,l);c=function(){d.getSelection().each(function(a){d.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})};var k=l.browser.isIE()?c:u,x=G.create({insert:q(["properties"]),update:q(["properties"]),unlink:q([])}),H=Uc.destroyable(),I=function(b,c){b=VT(a.region(),a.keyboard(),d,e,h,b,c);b.events.remove.bind(function(a){x.trigger.unlink();
U()});b.events.cancel.bind(function(a){d.focus();U();k()});H.set(b);d.events.mousedown.bind(U);return b},U=function(){H.clear();d.events.mousedown.unbind(U)},p=function(a){var b=I(a,Wx.update);b.events.execute.bind(function(a){x.trigger.update(b.getValues());U()});b.showPopup(Fp)};f.events.properties.bind(function(a){a=a.link();var b=m.has(a,lb.bookmarkAnchorDataAttr())?lb.getReservedUrl(m.get(a,lb.bookmarkAnchorDataAttr())):m.get(a,"href"),c=g.from(Mb.get(a).trim());a=Xg.properties({url:g.from(b),
textChanged:!1,text:c,title:g.from(m.get(a,"title")),target:g.from(m.get(a,"target")),action:g.none(),invalid:n.has(a,be.validationHighlight())});p(a)});f.events.follow.bind(function(a){d.focus();setTimeout(function(){r.follow(a.link())},0)});f.events.ignore.bind(function(a){b.ignore(a.link())});f.events.remove.bind(function(){x.trigger.unlink()});return{showContext:p,showInsert:function(a){var b=I(a,Wx.insert);b.events.execute.bind(function(a){x.trigger.insert(b.getValues());U()});b.showPopup(Fp)},
situation:f.situation,handle:f.handle,assign:f.assign,events:x.registry,destroy:function(){U();r.destroy()}}}function XT(a){var b=Ga(g.none());a=S.div();n.add(a,z.resolve("link-widget"));var c=S.span();n.add(c,z.resolve("link-widget-field"));var d=p.fromTag("input");n.add(d,z.resolve("link-widget-input"));T.label(d,w.translate("link.properties.url.placeholder"));y.append(c,d);m.set(d,"type","url");m.set(d,"placeholder",w.translate("link.dialog.tooltip"));var e=Ai.text(c,d),f=Bi([z.resolve("link-widget-insert")],
"insert.link"),h=Bi([z.resolve("link-widget-update")],"link.dialog.update"),l=Bi([z.resolve("link-widget-remove")],"link.dialog.remove");y.append(a,c);var r=G.create({insert:q(["properties"]),update:q(["properties"]),unlink:q([]),toEditor:q([])}),D=function(a,b){return Xg.properties({url:g.some(a),textChanged:b.isSome(),text:b,title:g.none(),target:g.none(),action:g.none(),invalid:!1})},x=function(){var a=da.get(d),c=b.get().fold(function(){return D(a,a)},function(b){return b.text().fold(function(){return D(a,
g.some(a))},function(b){b=g.from(b).filter(function(a){return""!==a.trim()});return D(a,b)})});r.trigger.insert(c);b.set(g.none());r.trigger.toEditor()},H=function(){var a=da.get(d);r.trigger.update(D(a,g.none()));b.set(g.none());r.trigger.toEditor()};f.events.click.bind(x);h.events.click.bind(H);l.events.click.bind(function(){r.trigger.unlink();r.trigger.toEditor()});return{element:k(a),addEscape:function(a){y.append(c,a.element())},type:k(e),execute:function(){kc.isVisible(f.element())?x():kc.isVisible(h.element())&&
H()},open:function(){Y.focus(d)},close:u,destroy:u,represent:function(a){A([f.element(),h.element(),l.element()],E.remove);a.url().fold(function(){da.set(d,"http://");y.after(d,f.element())},function(a){O.after(d,[h.element(),l.element()]);da.set(d,a)});b.set(g.some(a))},events:r.registry}}function YT(a){var b=XT(a),c=bl(a,b);a=Vx.disabled();var d=G.create({insert:q(["properties"]),update:q(["properties"]),unlink:q([])});b.events.insert.bind(function(a){d.trigger.insert(a.properties())});b.events.update.bind(function(a){d.trigger.update(a.properties())});
b.events.unlink.bind(function(a){d.trigger.unlink()});return{showContext:function(a){b.represent(a);c.open()},showInsert:function(a){b.represent(a);c.open()},situation:a.situation,handle:a.handle,assign:a.assign,events:d.registry,destroy:function(){c.close();c.destroy()}}}function ZT(a,b){var c=a.content(),d=a.undo(),e=a.shortcuts(),f=ba.detect().deviceType.isTouch()?YT(a):WT(a,b),h=G.create({analytics:q(["message"])});f.events.insert.bind(function(b){d.transaction(function(){var d=Gp.insert(c,b.properties());
a.internalevents().input(d)});c.domChanged();c.cursorIntoView();h.trigger.analytics("link_inserted")});f.events.update.bind(function(a){d.transaction(function(){var b=a.properties();Gp.update(c,b)});c.domChanged();c.cursorIntoView()});f.events.unlink.bind(function(a){d.save();Gp.unlink(c);c.domChanged();c.cursorIntoView()});b=function(){c.getSelection().each(function(a){rd.sharedLinkOrClosest(a,c.isRoot).fold(function(){c.selectWord();var a=c.getSelectedText().map(function(a){return a.trim()});f.showInsert(Xg.properties({url:g.none(),
textChanged:!1,text:a,title:g.none(),target:g.none(),action:g.none(),invalid:!1}))},function(a){var b=g.from(Mb.get(a).trim());f.showContext(Xg.properties({url:g.from(m.get(a,"href")),textChanged:!1,text:b,title:g.from(m.get(a,"title")),target:g.from(m.get(a,"target")),action:g.none(),invalid:n.has(a,be.validationHighlight())}))})})};var l=ob.ui({"link.general":{toggle:!1,value:"link",textkey:w.key("insert.link"),action:b,updateGeneral:u,icon:!0,shortcut:!0,hasPopup:!1,hasDialog:!0}});e.events.link.bind(b);
return{ui:l,situation:f.situation,handle:f.handle,assign:f.assign,events:h.registry,destroy:function(){f.destroy()}}}function $T(a,b,c){var d=Pk(c),e=Qk.get("ephox.link.service.one",Xx.one(),a+"/1/check?url=${url}&fresh=${fresh}",b),f=Qk.post("ephox.link.service.many",Xx.many(),a+"/1/check",b),h=function(a){return{url:a.url,result:Yx.derive(a.url,a.result)}};return{checkOne:function(a,b){var c=si.now();b=Rk.single(function(b,c){return e.execute({url:encodeURIComponent(a),fresh:c})},d,a,c,void 0!==
b?b:!1);return Ce.mapSync(b,h)},checkMany:function(a,b){var c=si.now();a=Rk.multiple(function(a,b){return f.execute({urls:a})},d,a,function(a){return aU(a.results,"url")},function(a){return a.url},c,void 0!==b?b:!1);return Ce.mapSync(a,function(a){return Wb(a,h)})},dumpCache:d.dump}}function bU(a){var b=a.slice(0),c=function(a){var c=m.get(a,"href");if(Ab(c,"#")||m.has(a,lb.bookmarkAnchorDataAttr()))a=N.error(a);else{var d=B.owner(a).dom().baseURI;d=g.from(d).getOr(window.location);d=Zx.resolve(d,
a.dom().href);if(V(b,d))a=N.error(a);else{var h=Yg.parse(d).protocol;a="https"===h||"http"===h?N.value(cU(c,d)):N.error(a)}}return a};return{extract:c,ignore:function(a){c(a).each(function(a){b.push(a.resolved())})},state:function(){return b.slice(0)}}}function dU(a,b,c){var d=a.content(),e=a.filter(),f=a.communication(),h=a.undo(),l=a.viewablearea(),r=l.viewport(),k=bU(b.ignore),x=be.validationHighlight(),H=be.invalidLink(),m=be.unknownLink();be.configure(e);var U=$T(c.url,f.newHeaders(),b.cache),
q=function(a){a=F(a,function(a){return bg.cata(r.assess(a),g.none,Db(g.some,k.extract),g.none)});a=Td(a);a=Ji.partition(a);A(a.errors,w);var b=eU.generate(a.values);a=jb(b);a=F(a,function(a){return{url:a}});a=U.checkMany(a);t(a,function(a){Ra(a,function(a){var c=b[a.url];void 0===c?console.warn("Link validator response from server was unknown: ",a.url,a.result):A(c,function(b){B(a.result,b)})})})};a=function(){var a=l.sections();a=rd.many(a);a=ka(a,function(a){return!n.has(a,hp.embedChecking())});
q(a)};var p=De(a,500).throttle;l.events.onChange.bind(p);d.events.domChanged.bind(p);var t=function(a,b){Ce.handle(a,function(a){console.error("Link Validation server failure: ",a)},function(a){b(a)})},v=function(a){return d.body().map(function(b){return rd.hrefUrl(b,a)})},y=function(a,b){v(a).each(function(a){A(a,function(a){n.has(a,be.validationHighlight())||ja.add(a,[x,b])})})},w=function(a){n.has(a,be.validationHighlight())&&ja.remove(a,be.allClasses())},z=function(a){v(a).each(function(a){A(a,
w)})},B=function(a,b){Yx.cata(a,function(a){y(b,H)},function(a){y(b,m)},function(a){z(b)})};h.events.undo.bind(a);h.events.redo.bind(a);return{destroy:u,refresh:p,ignore:function(a){h.save();k.ignore(a);p();d.focus();d.domChanged();d.cursorIntoView()},state:function(){return{ignore:k.state(),cache:U.dumpCache()}}}}function fU(a,b,c){return{patterns:function(){return[/(\W)(\w+)(\W*)$/gi,/(^)(\w+)(\W*)$/gi]},useCursor:k(!0),generate:function(a,b){a=p.fromText(b.text());return Gd.species({elements:k([a]),
cursor:g.none,dictation:k(g.some(function(){return c(b.text())})),notify:g.none})},derive:function(a){var c=a.index+a[1].length,d=c+a[2].length;return b(a[2]).map(function(a){return{startIndex:k(c),finishIndex:k(d),text:k(a)}})},label:a}}function Hp(a,b){var c=sb.sanitise(a);return{patterns:function(){return[new RegExp("("+c+")","gi")]},useCursor:k(!0),generate:function(a,c){a=p.fromTag("span",a.dom());a.dom().innerHTML=b;return Gd.species({elements:k([a]),cursor:g.none,dictation:g.none,notify:g.none})},
derive:function(a){var b=a.index;a=b+a[0].length;return g.some({startIndex:k(b),finishIndex:k(a)})}}}function gg(a,b,c){var d=sb.sanitise(b);return{patterns:function(){return[new RegExp("^("+d+"\\s)(.+)","gi")]},useCursor:Sc,generate:function(b,d){var e=p.fromTag(a,b.dom());v.set(e,"list-style-type",c);var f=p.fromTag("li",b.dom()),r=p.fromTag("li",b.dom());y.append(r,p.fromTag("br",b.dom()));O.append(e,[f,r]);O.append(f,d.clones());return Gd.species({elements:k([e]),cursor:k(g.some(W.point(r,0))),
dictation:g.none,notify:g.none})},derive:function(a){var b=a[1];return g.some({startIndex:k(a.index),finishIndex:k(a.index+b.length)})}}}function nl(a,b,c,d){var e=sb.sanitise(b),f=sb.sanitise(c);return{patterns:function(){return[new RegExp(e+"([^\\s].*?[^\\s])"+f,"gi"),new RegExp(e+"([^\\s])"+f,"gi")]},useCursor:xb,generate:function(a,b){a=p.fromTag(d,a.dom());b=p.fromText(b.text());y.append(a,b);return Gd.species({elements:k([a]),cursor:g.none,dictation:g.none,notify:g.none})},derive:function(a){return g.some({startIndex:k(a.index),
finishIndex:k(a.index+a[0].length),text:k(a[1])})}}}function gU(a,b){var c=sb.sanitise(a);return{patterns:function(){return[new RegExp("("+c+")","gi")]},useCursor:xb,generate:function(a,c){return Gd.species({elements:k([p.fromTag(b,a.dom())]),cursor:g.none,dictation:g.none,notify:g.none})},derive:function(a){return g.some({startIndex:k(a.index),finishIndex:k(a.index+a[0].length)})}}}function hU(a,b,c){var d=c.allowed.fold(iU,function(a){return function(b,c){return V(a,b)?c:[]}}),e=function(a){return{derive:a.derive,
generate:a.generate,patterns:a.patterns,useCursor:a.useCursor,allowed:k(!0)}},f=function(a,b){return{derive:a.derive,generate:a.generate,patterns:a.patterns,useCursor:a.useCursor,allowed:function(a){return!1===tb.closest(a,b)}}};c=d("headings",[e(Zg.spaced("######","h6")),e(Zg.spaced("#####","h5")),e(Zg.spaced("####","h4")),e(Zg.spaced("###","h3")),e(Zg.spaced("##","h2")),e(Zg.spaced("#","h1"))]);var h=d("lists",[e(gg("ul","*","disc")),e(gg("ol","1.","decimal")),e(gg("ol","a.","lower-alpha")),e(gg("ol",
"i.","lower-roman")),e(gg("ol","1)","decimal")),e(gg("ol","a)","lower-alpha")),e(gg("ol","i)","lower-roman"))]),l=d("semantics",[e(nl("bold","**","**","strong")),e(nl("bold","__","__","strong")),e(nl("italic","*","*","em")),e(nl("italic","_","_","em"))]),r=d("entities",[e(Hp("(c)","&copy;")),e(Hp("--","&mdash;")),e(Hp("-","&mdash;"))]),g=[e($x.normalise()),e($x.capitalise())],x=function(a){return w.translate("aria.autocorrect.announce",a)};a=a.hasAutocorrect()?[e(fU("autocorrect",a.lookup,x))]:[];
x=d("hr",[e(gU("---","hr"))]);var H=Xb(function(a){a.runOrOnLoaded(function(b){var c=Xb(function(){B.owner(b).dom().execCommand("AutoUrlDetect",!1,!1)});a.events.focus.bind(function(){c()})});return d("link",[f(jU,"a")])});return{headings:k(c),semantics:k(l),entities:k(r),cases:k(g),lists:k(h),dynCustoms:function(){var a=b.get();return F(a,e)},link:H,hr:k(x),corrections:k(a)}}function kU(a,b,c,d,e,f,h,l){var r=g.none(),k=g.none(),x=hU(e,f,l),H=Kb([x.link(b),x.hr(),x.semantics(),x.entities()]),m=function(){return Kb([H,
a.autocorrect().get()?x.corrections():[],a.capitalisation().get()?x.cases():[],x.dynCustoms()])},U=x.headings().concat(x.lists()),n=function(a,b,c,d){var e=ay.descend(b,c),f=lU.get(e.element(),e.offset());c=ka(d,function(a){return a.allowed(b)});return oc(c,function(b){return a(f,b,e.element(),e.offset())})},p=function(a,c){b.undoOperation(function(){a(function(){return c.execute(b,h)}).each(function(a){b.setSelection(a.element(),a.offset(),a.element(),a.offset())});b.domChanged()})};return{spaceDown:function(){b.getSelection().map(function(a){a.collapsed()&&
(r=n(Ip.inline,a.startContainer(),a.startOffset(),m()))})},spaceUp:function(){var a=t(p,d.run);r.each(a);r=g.none()},enterDown:function(){b.getSelection().map(function(a){a.collapsed()&&(k=n(Ip.block,a.startContainer(),a.startOffset(),U.concat()));k=k.orThunk(function(){return n(Ip.inline,a.startContainer(),a.startOffset(),m())})})},enterUp:function(){var a=t(p,pb);k.each(a);k=g.none()}}}function mU(a,b,c,d){var e=a.profile(),f=a.content(),h=a.undo(),l=a.context(),r=a.operations(),g=a.internalevents(),
x=G.create({analytics:q(["message"])}),H=Io(c.customs),m=kU(e,f,h,r,b,H,g,d);f.events.keydown.bind(function(a){Md.isSpace(a)&&m.spaceDown()});f.events.keyup.bind(function(a){Md.isSpace(a)&&m.spaceUp()});l.events.preLinebreak.bind(function(a){m.enterDown()});l.events.postLinebreak.bind(function(a){m.enterUp()});var U=function(a){return function(){var b=a.get();a.setAndCache(!b)}},n=function(a){return function(b){(!0===a.get()?b.select:b.deselect)()}};b=function(a,b,c){return{toggle:!0,value:a,textkey:w.key(b),
action:U(c),updateGeneral:n(c),icon:!1,tooltip:ib.get}};return{ui:ob.ui({"capitalisation.general":b("capitalisation","cog.capitalisation",a.profile().capitalisation()),"autocorrect.general":b("autocorrect","cog.autocorrect",a.profile().autocorrect())}),destroy:u,events:x.registry,customMacros:k(H),state:function(){return{customs:H.state()}}}}function nU(){var a=G.create({insert:q(["embed"]),input:q(["raw"])}),b=p.fromTag("span"),c=Jc.textarea("media-embed","media.embed"),d=w.translate("media.placeholder"),
e=bb.describe(c.textarea(),d);y.append(c.element(),e);e=S.span();T.hidden(e,!0);n.add(e,z.resolve("media-icon"));m.set(e,"alt",w.translate("media.insert"));var f=Dc(),h=w.translate("media.insert");f.content(Rc(h));n.add(f.element(),z.resolve("media-insert"));ud.makeDefault(f.element());T.button(f.element(),h);m.set(c.textarea(),"placeholder",d);by(f);a.registry.input.bind(function(){var a=da.get(c.textarea());f.disabled()?""!==a&&(f.enable(),ma.enable(f.element())):""===a&&by(f)});var l=J.bind(c.textarea(),
"input",a.trigger.input);O.append(b,[e,c.element(),f.element()]);var r=function(){var b=da.get(c.textarea());a.trigger.insert(b);oU&&Y.blur(c.textarea())};d=[ea.input(c.textarea(),xa.input({})),ea.button(f.element(),xa.button({execute:Nb.click}))];f.events.click.bind(function(){r()});return{element:k(b),execute:r,empty:function(){da.set(c.textarea(),"")},keylayouts:k(d),events:a.registry,destroy:function(){l.unbind();f.destroy();E.remove(b)}}}function pU(a){var b=a.region(),c=a.content(),d=a.smartview(),
e=nU(),f=ea.inlineDialog(e.element(),e.keylayouts(),xa.inlineDialog({ok:e.execute,cancel:u}));T.dialog(e.element(),w.translate("insert.media"));var h=ye.popup(d.uiContainer,d.bounds,b,[],Xf.editorContainer()).initMenu(e.element());ja.add(e.element(),[z.resolve("media-embed-dialog"),z.resolve("inline-dialog")]);f.events.exit.bind(function(){l()});var l=function(){h.closed()||(h.close(),e.empty(),c.focus(),f.exit())};a=G.create({insert:Q(["embed"],e.events.insert)});return{element:e.element,showPopup:function(a){h.open();
a.show(b,c,d,h,e);f.enter()},isClosed:h.closed,events:a.registry,destroy:function(){l();f.destroy();e.destroy();h.destroy()}}}function qU(a){a=S.div();n.add(a,z.resolve("media-widget"));var b=S.span();n.add(b,z.resolve("media-widget-field"));var c=p.fromTag(nc.isLarge()?"textarea":"input");n.add(c,z.resolve("media-widget-input"));var d=w.translate("media.placeholder");m.set(c,"placeholder",d);m.set(c,"title",d);y.append(b,c);d=Bi([z.resolve("media-widget-insert")],"insert.media");y.append(b,d.element());
y.append(a,b);var e=Ai.text(b,c),f=G.create({insert:q(["embed"]),toEditor:q([])}),h=function(){var a=da.get(c);a=rU?a.replace(/=\u201c([^\u201d]*)\u201d/g,'="$1"'):a;f.trigger.insert(a);f.trigger.toEditor()};d.events.click.bind(function(){h()});return{element:k(a),addEscape:function(a){y.append(b,a.element())},open:function(){da.set(c,"");Y.focus(c)},close:u,execute:function(){h()},destroy:u,type:k(e),events:f.registry}}function sU(a){var b=a.content(),c=function(){var c=Uc.destroyable(),d=function(){c.clear();
b.events.mousedown.unbind(d)};return{open:function(){var e=pU(a);e.events.insert.bind(function(c){c=c.embed();a.insertFilteredHtmlAtCursor(c);b.cursorIntoView();d()});e.showPopup(Fp);b.events.mousedown.bind(d);c.set(e)},destroy:function(){d()}}},d=function(){var c=qU(a);c.events.insert.bind(function(c){c=c.embed();a.insertFilteredHtmlAtCursor(c);b.cursorIntoView()});return bl(a,c)},e=(ba.detect().deviceType.isTouch()?d:c)();return{ui:ob.ui({"media.general":{toggle:!1,value:"media",textkey:w.key("insert.media"),
action:e.open,updateGeneral:u,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:function(){e.destroy()}}}function tU(a,b){var c=p.fromTag("div");n.add(c,z.resolve("mentions-business-card"));var d=a.initMenu(c),e=null,f=function(a,b,e){E.empty(c);y.append(c,e);d.open();a(b,d)};return{showFull:function(a){return function(b,c){clearTimeout(e);e=setTimeout(function(){f(a,b,c)},500)}}(b.showUnder),showMini:t(f,b.showAtSide),hide:function(){clearTimeout(e);d.close()},destroy:function(){clearTimeout(e);
d.destroy()}}}function uU(a){var b=g.none();return{fetch:function(b,d){a.fetch(b,function(a,b){a=cy("fetch()",a,b);d(a)})},fetchExtra:function(b,d,e){a.menuExtra(b,d,function(a,b){a=cy("menuExtra()",a,b);e(a)})},menuHover:function(c,d){b=g.some(c.userid);a.menuHover(c,function(a){a=Jp("menuHover() callback",a);b.is(c.userid)&&d(a)})},hover:function(b,d){a.hover(b.dom(),function(a){a=Jp("hover() callback",a);d(a)})},menuComplete:function(b){b=a.menuComplete(b);return Jp("menuComplete result",b)},hoverSelector:function(){return a.hoverSelector},
isTrigger:function(a){return 64===a}}}function vU(a){var b=qb.mainmenu(p.fromDom(document),z.resolve("mentions-list"),[]),c=Ga({}),d=function(a){return a.userid},e=function(a){return a.name},f=function(a,b){L.child(a,".ephox-gopher-item-text").each(function(a){Ca.set(a,b)})},h=function(a){return F(a,function(a){var b=qb.item(p.fromDom(document),a.userid,a.name);f(b,a.name);return b})},l=function(a){return zb(a,function(a,b){var c={};c[b.userid]=b;return ra(a,c)},{})},r=function(a,b){a=h(a);b=F(b,
function(a){return qb.item(p.fromDom(document),a.key,a.value)});return a.concat(b)},D=function(a){var b=m.get(a,"data-ephox-gopher-item-value"),d=c.get();return void 0!==d[b]?Kp.fetched(d[b].userid,d[b].name,d[b].rawname,d[b],a):V([dy,ey],b)?Kp.none(a):Kp.extra(b,a)};return{element:k(b),selected:function(){return L.descendant(b,".ephox-gopher-item-selected")},setData:function(d,e){var f=l(d);c.set(ra(c.get(),f));d=0===d.length?[{userid:ey,name:a.get("mentions.lookahead.noresults")}]:d;e=r(d,e);E.empty(b);
O.append(b,e)},getInfo:D,getUserId:function(a){return D(a).fold(g.none,g.none,Db(g.some,d))},setLoading:function(){var c=[{userid:dy,name:a.get("mentions.lookahead.searching")}];c=r(c,[]);E.empty(b);O.append(b,c)},getName:function(a){return D(a).fold(g.none,g.none,Db(g.some,e))},refind:function(a){a=m.get(a,"data-ephox-gopher-item-value");return void 0!==a&&null!==a?L.descendant(b,'[data-ephox-gopher-item-value="'+a+'"]'):g.none()},isOpen:function(){return kc.isVisible(b)}}}function wU(a,b,c){var d=
function(a){bb.speak(fa.body(),a)},e=vU(c);a.setView(e.element());var f=Ga(""),h=function(b){r(b.rawData(),b.extra());a.reposition(g.none())},l=function(a){var b=e.selected();a();return b.bind(e.refind)},r=function(b,f){d(c.get("mentions.lookahead.open"));a.updateItems(l,function(){e.setData(b,f)})},k=function(a){return e.isOpen()&&2<=a.length?Lp.refetch(a):2<=a.length?Lp.open(a):Lp.nothing()},x=function(a){a.fold(I,h)},m=G.create({accept:q(["information"]),menuHover:q(["element","info"]),none:q([])}),
I=function(){a.cancel()};return{setData:r,isOpen:function(){return e.isOpen()},lookup:function(c,d){c=Ab(c,"@")?c.substring(1):c;f.set(c);var h=u;k(c).fold(h,function(a){b.fetch(a,x)},function(c){e.setLoading();a.open(d);b.fetch(c,x)})},close:function(){a.close()},onClick:function(a){e.getInfo(a).fold(function(){m.trigger.none()},function(a,c){b.fetchExtra(a,f.get(),x)},function(a,b,d,e,f){bb.speak(fa.body(),c.get("mentions.lookahead.selected",d));m.trigger.accept(e)})},onHover:function(a){d(Mb.get(a));
e.getInfo(a).fold(u,u,function(a,b,c,d,e){m.trigger.menuHover(e,d)})},events:m.registry}}function xU(a,b,c,d){var e=p.fromTag("div");n.add(e,z.resolve("mentions-lookahead-container"));var f=c.initMenu(e),h=Ga(g.none()),l=G.create({close:q([])}),r=function(){return kc.isVisible(e)};c=function(){h.set(g.none());f.close()};f.events.close.bind(function(){b.close();l.trigger.close()});a.events.mousedown.bind(c);return{element:k(e),destroy:function(){h.set(g.none());f.destroy()},setView:function(a){E.empty(e);
y.append(e,a)},updateItems:function(a,c){a(c).fold(function(){b.setActiveMenu(e)},function(a){b.select(a)})},reposition:function(a){a.isSome()&&h.set(a);r()&&h.get().each(function(a){d.showUnder(a,f)})},open:function(c){a.body().each(function(a){f.open();d.showUnder(c,f);h.set(g.some(c));b.open([b.sandbox()],a)})},isOpen:r,cancel:function(){h.set(g.none());l.trigger.close()},close:c,events:l.registry}}function yU(a,b,c,d,e,f){var h=xU(a,b,c,d),l=wU(h,e,f);a=G.create({menuHover:Q(["element","info"],
l.events.menuHover),accept:Q(["information"],l.events.accept),close:Q([],h.events.close)});l.events.none.bind(h.close);return{onHover:l.onHover,onClick:l.onClick,close:function(){l.isOpen()&&l.close();h.isOpen()&&h.cancel()},isOpen:h.isOpen,lookup:function(a,b){h.reposition(g.some(b));l.lookup(a,b)},destroy:function(){h.destroy()},events:a.registry}}function zU(a,b){var c=Ga([]),d=null,e=null,f=G.create({contentHover:q(["target"]),stopHover:q([]),menuHover:q(["info"])});a.runOrOnLoaded(function(a){c.set([J.bind(a,
"mouseover",function(a){k(a)}),J.bind(fa.body(),"mouseover",function(a){L.closest(a.target(),Mp).each(l)}),J.bind(a,"mouseout",function(a){x(a)}),J.bind(fa.body(),"mouseout",function(a){m(a)})])});var h=function(a){clearTimeout(d);clearTimeout(e);d=setTimeout(function(){f.trigger.contentHover(a)},300)},l=function(){clearTimeout(e)},r=function(){clearTimeout(d);e=setTimeout(function(){f.trigger.stopHover()},300)},k=function(a){L.closest(a.target(),b).each(function(a){h(a);f.trigger.contentHover(a)})},
x=function(a){if(!tb.closest(a.target(),b))return!1;g.from(a.raw().relatedTarget||a.raw().toElement).map(p.fromDom).filter(function(a){return tb.closest(a,b)}).isNone()&&r()},m=function(a){if(!tb.closest(a.target(),Mp))return!1;g.from(a.raw().relatedTarget||a.raw().toElement).map(p.fromDom).filter(function(a){return tb.closest(a,Mp)}).isNone()&&r()};return{destroy:function(){A(c.get(),function(a){a.unbind()})},events:f.registry}}function AU(a){return{get:function(b){var c=a[b];return ta(c)?BU(c,Array.prototype.slice.call(arguments,
1)):w.translate.apply(void 0,arguments)}}}function fy(a){return{show:function(b,c,d,e,f){c=Lg(0,0);b=b.directionAt(a);b=ol.mainmenu(d,k(a),c,b);d.show(e,b);e.setComponents([a,f.element()])},showWith:function(b,c,d,e,f){b=b.directionAt(a);b=ol.submenu(d,k(a),b);d.show(e,b);e.setComponents([a,f.element()])}}}function CU(a,b,c,d){return{showAtSide:function(d,f){fy(d).showWith(a,b,c,f,{element:k(f.element())})},showUnder:function(d,f){fy(d).show(a,b,c,f,{element:k(f.element())})}}}function DU(a,b){var c=
AU(b.aria),d=a.content(),e=a.smartview(),f=a.region(),h=a.operations(),l=uU(b),r=ye.menuSystem(e.uiContainer,k("mentions"),mi.menu({focusActive:!1}));v.set(r.sandbox(),"z-index",String(void 0!==b.zIndex?b.zIndex:1E6));b=ye.popup(r.sandbox,e.bounds,f,[],Xf.editorContainer());e=CU(f,d,e,r.sandbox());var g=yU(d,r,b,e,l,c),x=tU(b,e);EU.configure(a.filter());var m=zU(d,l.hoverSelector());g.events.menuHover.bind(function(a){l.menuHover(a.info(),function(b){b.fold(u,function(b){kc.isVisible(a.element())&&
x.showMini(a.element(),b)})})});m.events.contentHover.bind(function(a){l.hover(a.target(),function(b){b.fold(u,function(b){g.close();x.showFull(a.target(),b)})})});m.events.stopHover.bind(function(a){x.hide()});r.events.itemHover.bind(function(a){a=a.item();g.onHover(a);d.backupSelection();Y.focus(a);d.focus()});r.events.itemAction.bind(function(a){g.onClick(a.item())});d.events.nodeChanged.bind(function(a){d.getSelection().each(function(b){b.collapsed()&&($g.detectOn(b,l).fold(g.close,g.close,u,
g.close),a.prev().each(function(a){Np.validatePrevious(a,b.startContainer())}))})});d.events.keyup.bind(function(a){d.getSelection().each(function(b){b.collapsed()&&(V(I,a.original().raw().which)||$g.withinIncomplete(b.startContainer()).each(function(a){var b=Cc.descendants(a,C.isText);b=F(b,Oa.get).join("");g.lookup(b,a);x.hide()}))})});d.events.keypress.bind(function(a){var b=a.original();l.isTrigger(b.raw().which)&&d.getSelection().each(function(a){gy.isValidMention(a.startContainer(),a.startOffset())&&
(a=function(){var a=Np.create();bd.insertAtCursor(d,[a]).each(function(a){d.setSelection(a.element(),a.offset(),a.element(),a.offset())});b.kill();bb.speak(fa.body(),c.get("mentions.initiated"))},$g.detect(d,l).fold(a,a,u,u))})});var I=Kb([R.ENTER(),R.DOWN(),R.UP()]);a.context().events.preLinebreak.bind(function(a){n(function(b,c){g.isOpen()?a.handler().handle():w()},u)});d.events.keydown.bind(function(a){var b=a.original().raw().which;V(R.ESCAPE(),b)?n(function(){w();a.original().kill()},u):V(I,
b)&&g.isOpen()&&(r.simulateKey(a.original()),a.original().kill())});var n=function(a,b){$g.detect(d,l).fold(b,b,a,b)},q=function(a){n(function(b,c){l.menuComplete(a).each(function(a){y.after(c,a);E.remove(c);var b=p.fromText(fb());y.after(a,b);d.setRelativeSelection(ha.after(b),ha.after(b));t()})},t)},t=function(){x.hide();g.close()},w=function(){n(function(a,b){bb.speak(fa.body(),c.get("mentions.lookahead.cancelled"));h.atomic(function(){Np.cancel(b)});t()},t)};g.events.close.bind(w);g.events.accept.bind(function(a){q(a.information())});
return{destroy:function(){g.destroy();x.destroy();m.destroy();r.destroy()}}}function FU(a){var b=function(a){var b={zh:"zh_cn",pt:"pt_br"};b=void 0===b[a]?a:b[a];b=w.has("parlance."+b)?w.key("parlance."+b):w.raw(b);return GU(b,a,g.none())},c=F(a.languages,b);return{build:function(d){return d.filter(function(b){return!V(a.languages,b)}).fold(function(){return c},function(a){return c.concat([b(a)])})}}}function HU(a,b,c){var d=a.content(),e=a.undo(),f=FU(c),h=function(){return d.on(function(a){return hg.language(a).fold(wa.off,
wa.on)}).getOrThunk(wa.unchanged)};return{ui:ob.ui({"parlance.dropdown":k({name:"parlance",textkey:w.key("parlance.set"),menuTextkey:w.key("parlance.menu"),updateDropdown:function(a){var b=h(),c=b.fold(g.none,g.none,g.some);c=f.build(c);a.populate([{label:g.none,items:k(c)}]);b.fold(a.deactivate,u,a.activate);b.fold(a.untick,u,a.tick)},action:function(c){var f=function(a){return ad.language(d.isRoot,a,c)};b.lock(function(){Pb.cata(a.selections().get(),u,Jk.multiple(d,e,f),Jk.single(d,e,f));d.getSelection().each(function(a){b.check(a.startContainer(),
a.startOffset(),a.endContainer(),a.endOffset())})});setTimeout(function(){d.uiChanged()},0)},values:f.build(g.none()),render:g.none(),toggle:!1,describe:function(){return w.key("parlance.set")}})},aa),destroy:u}}function IU(){var a=p.fromTag("textarea");T.label(a,w.translate("plaincode.dialog.editor"));T.textarea(a);return{element:k(a)}}function JU(a){var b=G.create({execute:q(["html"]),close:q([])}),c=Ie(a);n.add(c.element(),z.resolve("plaincode-modal"));c.setTitle(w.translate("plaincode.dialog.title"));
var d=function(){e();b.trigger.close()},e=function(){c.hide()},f=IU();c.setContent(f.element());a=ud.okCancel("plaincode");a.events.ok.bind(function(){b.trigger.execute(da.get(f.element()));d()});a.events.cancel.bind(function(){d()});c.events.close.bind(function(){h.exit();d()});c.setControls(a.element());var h=Nb.setup(c,a,[ea.single(f.element(),[Z.rule(Z.is(R.ENTER()[0]),function(a){a.raw().stopPropagation();return g.none()})],g.none())]);return{element:c.element,open:function(){c.show();h.enter()},
setHtml:function(a){da.set(f.element(),a)},destroy:function(){c.destroy();h.destroy()},hide:e,events:b.registry}}function KU(a){var b=JU(a),c=function(){d.trigger.close();b.events.close.unbind(c);b.events.execute.unbind(e);b.destroy()},d=G.create({execute:q(["html"]),close:q([])}),e=function(a){d.trigger.execute(a.html())};b.events.close.bind(c);b.events.execute.bind(e);return{show:function(){b.open()},setHtml:b.setHtml,events:d.registry}}function LU(a,b){var c=a.content(),d=a.shortcuts(),e=a.smartview(),
f=b.setContent,h=b.getContent;d.events.plaincode.bind(function(){l()});var l=function(){var a=KU(e.uiContainer());a.events.close.bind(function(){c.toEditing()});a.events.execute.bind(function(a){f(a.html())});c.toReading();a.setHtml(h());a.show()};return{destroy:u}}function MU(){var a=G.create({grow:q(["x","y"])}),b=1,c=1,d=g.none(),e=function(a){return v.getRaw(a,"width").bind(function(a){return ce(a,"px")?g.some(parseInt(a,10)):g.none()}).getOrThunk(function(){return Aa.get(a)})};return{setTarget:function(a){d=
g.some(a);c=Aa.get(a)/(pa.get(a)+0)},setMultiplier:function(a){b=a},clearTarget:function(){d=g.none()},mutate:function(f,h){d.each(function(d){var l=e(d)+b*f,g=1===l?1:Math.floor(l/c);5<=l&&5<=g&&(Aa.set(d,l),pa.set(d,g));a.trigger.grow(f,h)})},events:a.registry,destroy:u}}function NU(a){var b=g.none(),c=MU();c.events.grow.bind(function(){f()});var d=oi.transform(c,{layerClass:z.resolve("layer-below-dialog")});d.events.stop.bind(function(){b.each(function(a){h.trigger.stop(a)})});n.add(d.element(),
z.resolve("resize-eph-block"));var e=OU.create();e.events.click.bind(function(b){c.setMultiplier(b.multiplier());a.body().each(function(a){d.go(B.documentElement(a))})});var f=function(){e.clear();b.each(Op.clean)},h=G.create({stop:q(["target"])});return{showHandles:function(a){var f=B.documentElement(a);c.setTarget(a);b=g.some(a);d.on();e.refresh(f,a)},hideHandles:f,events:h.registry,destroy:function(){e.destroy();c.destroy();d.destroy();b=g.none()}}}function PU(a){var b=a.content(),c=a.undo();a=
a.filter();Op.configure(a);var d=NU(b),e=function(a){lc.detect(b.getSelection()).each(function(d){c.save();Ne.remove(b,d.image());b.domChanged();c.save();a.original().kill()})},f=function(a){lc.detect(b.getSelection()).each(function(c){b.setRelativeSelection(ha.before(c.image()),ha.before(c.image()));a.original().kill()})},h=function(a){lc.detect(b.getSelection()).each(function(c){b.setRelativeSelection(ha.after(c.image()),ha.after(c.image()));a.original().kill()})},l=function(){lc.detectForEditing(b.getSelection(),
b.imageExcludes).fold(function(){d.hideHandles()},function(a){a=a.image();d.showHandles(a);Ne.reselect(b,a)})};b.events.loaded.bind(l);b.events.domChanged.bind(l);b.events.paint.bind(l);b.events.nodeChanged.bind(l);b.events.selectionchange.bind(function(a){lc.detect(b.getSelection()).fold(l,u)});var r=g.none();b.events.ready.bind(function(a){a=a.api().body();r=g.some(Xk.handle(a,function(a){"img"===C.name(a.target())&&Ne.select(b,a.target())}))});b.events.mousedown.bind(function(a){a=a.original().target();
"img"===C.name(a)&&Op.disableNativeResize(a)});b.events.keydown.bind(function(a){Md.isDel(a)||Md.isBackspace(a)?e(a):Md.isLeftOrUp(a)?f(a):Md.isRightOrDown(a)&&h(a)});d.events.stop.bind(function(a){a=a.target();d.showHandles(a);Ne.reselect(b,a)});return{destroy:function(){d.destroy();r.each(function(a){a.unbind()})}}}function QU(a,b){var c=a.content(),d=a.filter(),e=a.selections(),f=t(d.filterDom,d.output());c.events.ready.bind(function(a){a=a.api();var b=RU(a,d),h=function(a,h){Pb.cata(e.get(),u,
function(c){SU(c,f).each(function(d){b(a,d.text,d.html,t(h,function(){TU(c)}))})},function(e,f){UU(e,f,d).each(function(d){b(a,d.text,d.html,t(h,function(){c.insertHtmlAtCursor("")}))})})};a.events.cut.bind(function(a){h(a.original(),pb)});a.events.copy.bind(function(a){h(a.original(),u)})});return{destroy:u}}function VU(a,b){var c=function(a,b,c){a(c,b);return g.some({element:k(b),cleanup:function(){E.remove(b)},splits:k([])})},d=function(a){return{none:g.none,start:t(c,y.before,a),end:t(c,y.after,
a),middle:function(b,d,e){return c(y.after,a,d)}}},e=function(a){var b=function(a){return function(b,c){y.appendAt(b,c,a)}};return{prepend:t(c,y.prepend,a),before:t(c,y.before,a),after:t(c,y.after,a),insertAt:function(d,e){return c(b(e),a,d)},append:t(c,y.append,a)}};return{before:{text:d(a),element:{hasPrevious:e(a).insertAt,first:e(a).prepend,empty:e(a).before,otherwise:e(a).append}},after:{text:d(b),element:{hasNext:e(b).insertAt,rightEdge:e(b).append,empty:e(b).after,otherwise:e(b).append}},general:{insertBefore:e(a).before,
insertAfter:e(b).after}}}function WU(a){var b=pl.fromUnsafe(a),c=p.fromTag("span"),d=p.fromTag("span");A([c,d],a.markAsEphemeral);var e=VU(c,d);return{backup:function(){a.getSelection().each(function(f){f.collapsed()?(bd.insertAtCursor(a,[c]),E.unwrap(d),b.begin()):hy.both(e,f.startContainer(),f.startOffset(),f.endContainer(),f.endOffset())})},insert:function(e,h,l){a.setRelativeSelection(ha.after(c),fa.inBody(d)?ha.before(d):ha.after(c));bd.insertAtCursorWith(a,e,h,l).each(function(b){!tb.ancestor(b.element(),
"table")||"td"!==C.name(b.element())&&"th"!==C.name(b.element())?a.setRelativeSelection(ha.after(b.element()),ha.after(b.element())):a.setSelection(b.element(),0,b.element(),0)});b.end();Zf.cursorIntoView(a);A([c,d],E.unwrap)},cancel:function(){A([c,d],E.unwrap)}}}function iy(a,b,c){return function(c,e,f){var d=function(a){c.receive(a)},l=function(a,b,c){c=void 0!==c?c:a.type()===rb.END_ELEMENT_TYPE;return rb.token(b,c,{})},r={emit:d,emitTokens:function(a){A(a,d)},receive:function(b){a(r,b,l)},document:window.document};
b(r);return r}}function Pp(a,b,c){return{pred:a,action:b,label:k(c)}}function jy(a,b,c){var d=ky(a+" :: FALLBACK --- ",c);c=function(c,f,h){va(b,function(a){return a.pred(f,h)}).fold(k(d),function(b){var c=b.label();return void 0===c?b.action:ky(a+" :: "+c,b.action)})(c,f,h)};c.toString=function(){return"Handlers for "+a};return c}function XU(a,b){var c=cc.state(0,void 0,[],[]),d=function(c){A(c.result(),function(c){c=c(b);a.emit(c)})};return{closeAllLists:function(){var a=ly.closeAllLists(c,0);c=
a.state();d(a)},openItem:function(a,b,h){h&&("UL"===h.tag&&YU[a-1]===h.type&&(h={tag:"UL"}),a=ly.openItem(c,a,b,h),c=a.state(),d(a))},getCurrentListType:function(){return c.type()},getCurrentLevel:function(){return c.level()}}}function my(a,b){var c=G.create({cancel:q([]),error:q(["message"]),insert:q(["elements","assets","correlated","isInternal"])}),d=function(d,e,l){d=ny.choose(a,b,d);d.capture()&&l();l=F(d.steps(),function(a){return a(e)});ny.run(l,d.input()).get(function(a){var b=a.bundle().isInternal().getOr(!1);
Ya.cata(a.response(),function(a){c.trigger.error(a)},function(a,d){c.trigger.insert(a,oy(d),d,b)},function(){c.trigger.cancel()},function(a,d,e){c.trigger.insert(a,oy(d),d,b);c.trigger.error(e)})})},e=nd.tap(function(a){Na.getExact(a.target.ownerDocument.defaultView).each(function(b){n.has(b.start(),py.bin())||(b=ZU.fromEvent(a),qy.willBlock()&&(e.control.block(),a.preventDefault()),d(b,e.control,function(){a.preventDefault()}))})});return{paste:e.instance,pasteCustom:function(a){var b=nd.tap(u);
d(a,b.control,u)},isBlocked:e.control.isBlocked,destroy:u,events:c.registry}}function ql(){return function(a,b){return Fa.sync(function(a){var c=function(){Fa.call(a,{response:b.response(),bundle:b.bundle()})},e=function(c,d){ae(c,$U).get(function(c){Fa.call(a,{response:d(c),bundle:b.bundle()})})};Ya.cata(b.response(),c,function(a,b){e(b,function(b){return Ya.paste(a,b)})},c,function(a,b,c){e(b,function(b){return Ya.incomplete(a,b,c)})})})}}function ry(a){return function(b,c){return Fa.sync(function(b){var d=
function(){Fa.call(b,{response:c.response(),bundle:c.bundle()})},f=function(a){var d=aV(a),e=ae(d,function(a){return a.asset()}),f=F(d,function(a){return a.image()});e.get(function(d){d=Pe.updateSources(d,f);Fa.call(b,{response:Ya.paste(a,d),bundle:c.bundle()})})},h=function(e,h,g){!1===a.allowLocalImages?(h=ka(sy(e),ty),A(h,E.remove),Fa.call(b,{response:0<h.length?bV(e):c.response(),bundle:c.bundle()})):0===h.length?f(e):d()};Ya.cata(c.response(),d,h,d,h)})}}function uy(a){var b=a.translations,c=
G.create({insert:q(["elements","correlated"]),incomplete:q(["elements","correlated","message"])});return{events:c.registry,processRtf:function(a,e,f,h){f=Qe.images(f);var d=Ki.find(a);cV.convert(d,f,function(b,d){var f=B.children(a);b=b.concat(e);d?c.trigger.incomplete(f,b,"errors.imageimport.failed"):c.trigger.insert(f,b);h()},b)}}}function dV(a,b){var c=G.create({insert:q(["elements","correlated"]),incomplete:q(["elements","correlated","message"])}),d=uy(b);d.events.incomplete.bind(function(a){c.trigger.incomplete(a.elements(),
a.correlated(),a.message())});d.events.insert.bind(function(a){c.trigger.insert(a.elements(),a.correlated())});return{events:c.registry,gordon:function(e,f){var h=function(a){d.processRtf(e,f,a.rtf(),a.hide())},l=function(a){var b=Ki.find(e);A(b,E.remove);c.trigger.incomplete(B.children(e),f,a)},g=function(){var a=Ki.find(e);A(a,E.remove);c.trigger.insert(B.children(e),f)},k=function(a){l(a.message())};if(!0===b.allowLocalImages&&!0===b.enableFlashImport){var x=a(b);x.events.response.bind(h);x.events.cancel.bind(g);
x.events.failed.bind(k);x.events.error.bind(k);x.open()}else l("errors.local.images.disallowed")}}}function vy(a,b){var c=dV(a,b),d=Ga(g.none()),e=function(a){d.get().each(function(b){Fa.call(b,{response:a,bundle:Ob.nu({})})})};c.events.insert.bind(function(a){e(Ya.paste(a.elements(),a.correlated()))});c.events.incomplete.bind(function(a){e(Ya.incomplete(a.elements(),a.correlated(),a.message()))});return function(a,b){return Fa.sync(function(a){var e=function(){Fa.call(a,{response:b.response(),bundle:b.bundle()})},
f=function(b,f,h){d.set(g.some(a));var l=p.fromTag("div");O.append(l,b);Ki.exists(l)?c.gordon(l,f,h):e()};Ya.cata(b.response(),e,f,e,f)})}}function eV(a,b){var c=b.translations,d=function(a,b,c){c(g.some(ra(b,{officeStyles:a,htmlStyles:a})))},e=function(b,e){var f=p.fromTag("div");n.add(f,cd.resolve("styles-dialog-content"));var h=p.fromTag("p"),k=te.fromHtml(c("cement.dialog.paste.instructions"));O.append(h,k);y.append(f,h);h={text:c("cement.dialog.paste.clean"),tabindex:0,className:cd.resolve("clean-styles"),
click:function(){x.destroy();d(!1,b,e)}};k={text:c("cement.dialog.paste.merge"),tabindex:1,className:cd.resolve("merge-styles"),click:function(){x.destroy();d(!0,b,e)}};var x=a(!0);x.setTitle(c("cement.dialog.paste.title"));x.setContent(f);x.setButtons([h,k]);x.events.close.bind(function(){e(g.none());x.destroy()});x.show()};return{get:function(a,c){a=b[a?"officeStyles":"htmlStyles"];"clean"===a?d(!1,b,c):"merge"===a?d(!0,b,c):e(b,c)},destroy:u}}function fV(a){return{play:function(b,c,d){var e=p.fromTag("div"),
f=p.fromTag("iframe");v.setAll(e,{display:"none"});var h=J.bind(f,"load",function(){h.unbind();Lw.write(f,b);var a=f.dom().contentWindow.document;if(void 0===a)throw"sandbox iframe load event did not fire correctly";var g=p.fromDom(a);a=a.body;if(void 0===a)throw"sandbox iframe does not have a body";a=p.fromDom(a);g=c(g,a);E.remove(e);setTimeout(t(d,g),0)});y.append(e,f);y.append(a,e)}}}function gV(a,b,c,d,e){return function(f,h){var l=Kc.asEvent(f).getOrDie("Must pass through event type").nativeEvent(),
g=e(),k=h.response();return Fa.sync(function(e){var f=a(c);f.events.after.bind(function(a){a=a.container();if(Qp.browser.isSafari()&&tb.descendant(a,'img[src^="webkit-fake-url"]'))a=Qp.deviceType.isWebView()?"webview.imagepaste":"safari.imagepaste",Fa.call(e,{response:Ya.error(a),bundle:Ob.nu({})});else{b(a);n.add(a,wy.binStyle());var c=hV.isWord(Qp,a),f=B.children(a);f=d.findClipboardTags(f).isSome();Fa.call(e,{response:k,bundle:Ob.nu({isWord:c,isInternal:f,proxyBin:a,backgroundAssets:g})})}});g.convert(l);
f.run()})}}function iV(a,b){var c=uy(a),d=Ga(g.none()),e=function(a){d.get().each(function(b){Fa.call(b,{response:a,bundle:Ob.nu({})})})};c.events.insert.bind(function(a){e(Ya.paste(a.elements(),a.correlated()))});c.events.incomplete.bind(function(a){e(Ya.incomplete(a.elements(),a.correlated(),a.message()))});return function(f,h){var l=Kc.asWord(f).getOrDie("Word input required for rtf data"),r=function(a){return Fa.sync(function(b){var f=function(){Fa.call(b,{response:h.response(),bundle:h.bundle()})},
l=function(f,h){d.set(g.some(b));var l=p.fromTag("div");O.append(l,f);a.fold(function(){var a=function(){A(c,E.remove);var a=B.children(l);e(Ya.incomplete(a,h,"errors.local.images.disallowed"))},b=function(){var a=B.children(l);e(Ya.paste(a,h))},c=Ki.find(l);return 0<c.length?a():b()},function(a){c.processRtf(l,h,a,u)})};Ya.cata(h.response(),f,l,f,l)})};return rl.match(l.rtf(),{getFromFlash:function(a){return b(f,h)},disabled:function(){return r(g.none())},fromClipboard:function(b){return r(!0===
a.allowLocalImages?g.some(b.rtf()):g.none())}})}}function jV(a,b,c){var d=p.fromTag("div"),e="flashbin-wrapper-"+(kV.os.isOSX()?"cmd":"ctrl");n.add(d,cd.resolve(e));try{var f=void 0!==navigator.plugins["Shockwave Flash"]}catch(h){f=!1}a=(f?lV:mV)(d,a,b,c.translations);return{element:k(d),reset:a.reset}}function nV(a,b,c){var d=function(a){return kb(b,function(b){return wb(a[b])})},e=!0,f=setInterval(function(){var b=a.dom();wb(b.PercentLoaded)&&100===b.PercentLoaded()&&d(b)&&(h(),c())},500),h=function(){e&&
(clearInterval(f),e=!1)};return{stop:h}}function oV(a){var b=G.create({response:q(["rtf"]),spin:q([]),cancel:q([]),error:q(["message"]),reset:q([]),hide:q([]),failed:q(["message"])}),c=!1,d=p.fromTag("div");n.add(d,cd.resolve("flashbin-target"));var e=pV.responsive();e.events.crashed.bind(function(){b.trigger.failed("flash.crashed")});e.events.timeout.bind(function(){b.trigger.failed("flash.crashed")});var f=function(){I.stop();if(!c){c=!0;try{var a=x.dom();Ra(k,function(b,c){var d=a[c];if(void 0===
d)throw'Flash object does not have the method "'+c+'"';d.call(a,b)});b.trigger.reset();clearTimeout(t);n.remove(d,cd.resolve("flash-activate"));m();U()}catch(Jg){console.log("Flash dialog - Error during load: ",Jg)}}},h=tf.permanent(f),l=function(){return!fa.inBody(x)},g=function(){return!x.dom().SetVariable},k={setSpinCallback:tf.permanent(function(){e.start(1E3,10,l,g);b.trigger.spin()}),setPasteCallback:tf.permanent(function(a){e.stop();setTimeout(function(){""===a?b.trigger.error("flash.crashed"):
b.trigger.response(unescape(a))},0)}),setEscapeCallback:tf.permanent(b.trigger.cancel),setErrorCallback:tf.permanent(function(a){e.stop();b.trigger.error(a)}),setStartPasteCallback:tf.permanent(u)},x=function(){var b=a.replace(/^https?:\/\//,"//"),c='    <param name="allowscriptaccess" value="always">    <param name="wmode" value="opaque">    <param name="FlashVars" value="onLoad='+h+'">';if(Rp.browser.isIE()&&10===Rp.browser.version.major){var d=Za("flash-bin");return p.fromHtml('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="'+
d+'"><param name="movie" value="'+b+'">'+c+"</object>")}return p.fromHtml('<object type="application/x-shockwave-flash" data="'+b+'">'+c+"</object>")}(),m=function(){v.setAll(x,{width:"2px",height:"2px"})};m();var I=nV(x,jb(k),f);y.append(d,x);var U=function(){Rp.browser.isFirefox()&&window.getSelection().removeAllRanges();Y.focus(x)},t=null,w=function(){n.add(d,cd.resolve("flash-activate"));v.remove(x,"height");v.remove(x,"width");b.trigger.hide()},z=function(){v.set(d,"display","none");qV.each(function(a){A(a,
function(a){a.unbind()})})};return{focus:U,element:function(){return d},activate:function(){t=setTimeout(w,3E3);b.trigger.spin();v.set(d,"display","block");U()},deactivate:z,destroy:function(){z();A(se(k),function(a){tf.unregister(a)});tf.unregister(h);I.stop()},events:b.registry}}function rV(a,b){var c=b.translations,d=G.create({response:q(["rtf","hide"]),cancel:q([]),error:q(["message"]),failed:q(["message"])});return{open:function(){var e=oV(b.swf);e.deactivate();var f=p.fromDom(window),h=J.bind(f,
"mouseup",e.focus),l=function(){x()};f=function(){x();d.trigger.cancel()};e.events.cancel.bind(f);e.events.response.bind(function(a){d.trigger.response(a.rtf(),l)});e.events.error.bind(function(a){x();d.trigger.error(a.message())});e.events.failed.bind(function(a){x();d.trigger.failed(a.message())});var g=a();g.setTitle(c("cement.dialog.flash.title"));var k=jV(e,g.reflow,b);k.reset();g.setContent(k.element());g.events.close.bind(f);g.show();e.activate();var x=function(){h.unbind();e.destroy();g.destroy()}},
events:d.registry}}function Sp(a,b,c,d){var e=P.eq(a,c)&&b===d;return{startContainer:k(a),startOffset:k(b),endContainer:k(c),endOffset:k(d),collapsed:k(e)}}function sV(a){var b=p.fromTag("br"),c=g.none();return{cleanup:function(){E.remove(b)},toOn:function(b,e){var d=B.owner(e).dom().defaultView;c.each(function(c){var e=B.childNodesCount(b),f=P.eq(b,c.startContainer())&&e<c.startOffset()?e:c.startOffset;e=P.eq(b,c.endContainer())&&e<c.endOffset()?e:c.endOffset;c=Sp(c.startContainer(),f,c.endContainer(),
e);a.set(d,c)})},toOff:function(d,e){d=B.owner(e).dom().defaultView;y.append(e,b);c=a.get(d,Sp);a.set(d,Sp(b,0,b,0))}}}function tV(a,b){var c=p.fromTag("div");m.setAll(c,b);m.setAll(c,{contenteditable:"true","aria-hidden":"true"});v.setAll(c,{position:"fixed",top:"0px",width:"100px",height:"100px",overflow:"hidden",opacity:"0"});ja.add(c,[xy,yy]);var d=function(a){return n.has(a,yy)};return{attach:function(a){E.empty(c);v.set(c,"left",uV(a));y.append(a,c)},focus:function(){L.ancestor(c,"body").each(function(b){a.toOff(b,
c)})},contents:function(){vV.consolidate(c,d);var a=M("elements","html","container"),b=B.children(c),h=Ca.get(c);return a(b,h,c)},container:function(){return c},detach:function(){E.remove(c)}}}function wV(a,b,c){var d=tV(a,c),e=function(){a.cleanup();var b=d.contents();d.detach();h.trigger.after(b.elements(),b.html(),d.container())},f=nd.tap(function(){h.trigger.before();d.attach(b);d.focus();qy.run(B.owner(b),f,e)}),h=G.create({before:q([]),after:q(["elements","html","container"])});c=u;return{instance:k(function(){f.instance()}),
destroy:c,events:h.registry}}function xV(a){return function(b){var c=G.create({after:q(["container"])}),d=sV(yV),e=wV(d,b,a);e.events.after.bind(function(a){d.toOn(b,a.container());c.trigger.after(a.container())});return{run:function(){e.instance()()},events:c.registry}}}function zV(){return my([ig.text()],ig.none())}function AV(a,b){return function(c){var d=G.create({close:q([])}),e=Ie(a);e.events.close.bind(function(){d.trigger.close()});n.add(e.element(),z.resolve("external-dialog"));c&&n.add(e.element(),
z.resolve("dialog-vertical-controls"));var f=p.fromTag("div"),h=Ga([]),l=function(a){var b=Dc();if(void 0===a.text)throw"dialog button did not specify text";b.content(Rc(a.text));T.button(b.element(),a.text);void 0!==a.tabindex&&m.set(b.element(),"tabindex",a.tabindex);void 0!==a.className&&n.add(b.element(),a.className);void 0!==a.click&&b.events.click.bind(a.click);n.add(b.element(),z.resolve("dialog-button"));return b};return{element:e.element,events:d.registry,setTitle:e.setTitle,setContent:e.setContent,
setButtons:function(a){E.empty(f);a=F(a,l);O.append(f,F(a,function(a){return a.element()}));h.set(a);e.setControls(f)},reflow:u,show:function(){b.hideInlineSelection();e.show();var a=F(h.get(),function(a){return ea.button(a.element(),xa.button({execute:Nb.click}))}),c=ea.multipleAll(e.element(),a);c.events.exit.bind(function(){d.trigger.close()});setTimeout(function(){c.enter()},0)},destroy:function(){A(h.get(),function(a){a.destroy()});h.set([]);e.destroy()}}}}function BV(a,b,c){var d={"errors.imageimport.unsupported":"errors.images.import.unsupported",
"errors.imageimport.invalid":"errors.images.import.invalid"};return{baseUrl:c.baseUrl,enableFlashImport:c.enableFlashImport,swf:c.swf,officeStyles:c.officeStyles,htmlStyles:c.htmlStyles,translations:function(b){var c=Array.prototype.slice.call(arguments,1);return a.translate.apply(void 0,[void 0!==d[b]?d[b]:b].concat(c))},allowLocalImages:c.allowLocalImages,intraFlag:b}}function CV(a,b,c,d){var e=a.filter(),f=a.content(),h=a.undo(),l=a.smartview(),r=a.region(),k=a.internalevents(),x=!0===d.forceText?
zV:DV(l,e,d,f),H=g.none(),I=G.create({analytics:q(["message"])}),n=function(a){var b=V(["flash.clipboard.no.rtf","safari.imagepaste"],a.message())?"info":"error";t(a.message(),b)},t=function(b,c){Ge.getOrLog(b,[]).each(function(b){b=ii(b,c);a.ui().displayBanner(b)});u()},u=function(){Ic.unblock();f.focus()};e.add(e.history(),wy.binStyle(),Ka.remove);e.addSelector(e.history(),"[data-ephox-polish-cement-inserted]",Ka.removeAttr("data-ephox-polish-cement-inserted"));f.events.ready.bind(function(a){var d=
Tp.get(f,l,a.api().doc()),D=EV.rules(f,r,d),q=WU(f),U=a.api(),v=x(U.body());H=g.some(v);U.events.paste.bind(function(a){U.getSelection().filter(function(a){return kb(Li.ignoreSelectors(),function(b){return!1===tb.closest(a.startContainer(),b,f.isRoot)})}).each(function(b){v.isBlocked()||(q.backup(),Ic.block());v.paste(a.original().raw())})});v.events.cancel.bind(function(){u();q.cancel()});var w=zi.processResults(t);v.events.error.bind(n);v.events.insert.bind(function(a){c.correlated(a.correlated()).bind(Ax.maybeDoRotate).map(w).get(function(c){u();
h.save();var d=p.fromTag("div");O.append(d,a.elements());e.filterDom(e.input(),d);d=B.children(d);A(d,function(a){C.isElement(a)&&m.set(a,"data-ephox-polish-cement-inserted",!0)});q.insert(d,[D.collapsed()],[D.ranged()]);f.body().each(function(a){a=ca.descendants(a,"[data-ephox-polish-cement-inserted]");A(a,function(a){m.remove(a,"data-ephox-polish-cement-inserted")});k.input(a)});f.domChanged();I.trigger.analytics("paste_action");b.pasteUpload();b.uploadAssets(c)})})});return{destroy:function(){H.each(function(a){a.destroy()})},
events:I.registry}}function FV(a,b,c,d){var e=QU(a,d.copy),f=CV(a,b,c,d.paste);return{destroy:function(){e.destroy();f.destroy()}}}function GV(){var a={latin:[{start:"A",finish:"Z"},{start:"a",finish:"z"},{start:"\u00c0",finish:"\u00ff"}],punctuation:[{start:"!",finish:"/"},{start:":",finish:"@"},{start:"[",finish:"`"},{start:"{",finish:"~"},{start:"\u00a1",finish:"\u00bf"},{start:"\u2010",finish:"\u2027"},{start:"\u2030",finish:"\u205e"}],currency:[uf("$"),{start:"\u00a2",finish:"\u00a5"},{start:"\u20a0",
finish:"\u20bd"},uf("\u5186"),uf("\u5143"),uf("\u5713"),uf("\u5706")],"extended-latin-a":[{start:"\u0100",finish:"\u017f"}],"extended-latin-b":[{start:"\u0180",finish:"\u024f"}],arrows:[{start:"\u2190",finish:"\u21ff"},uf("\u2794"),{start:"\u2798",finish:"\u27af"},{start:"\u27b1",finish:"\u27be"}],mathematical:[{start:"\u2795",finish:"\u2797"},{start:"\u2200",finish:"\u22ff"}],miscellaneous:[{start:"\u2701",finish:"\u275e"},{start:"\u2761",finish:"\u2793"},uf("\u27b0"),uf("\u27bf")]},b={};Ra(a,function(a,
d,e){b[d]=ia(a,HV)});return b}function IV(a){var b=G.create({insert:q(["string"]),close:q([])}),c=Ie(a);a=GV();a=JV.generateItems(a);var d=Jc.input("specialchar","specialchar.selects"),e=Jx(up.left(),a,z.resolve("specialchars"));n.add(e.body(),z.resolve("specialchar-body"));n.add(c.element(),z.resolve("specialchar-dialog"));A(B.children(e.element()),Ic.register);var f=J.bind(c.element(),"click",function(a){a=a.target();L.closest(a,"[data-ephox-polish-special-char]").each(function(a){Y.focus(a);a=
m.get(a,"data-ephox-polish-special-char");var b=d.input(),c=da.get(b);da.set(b,c+a)})}),h=KV.controls("specialchar");c.setTitle(w.translate("specialchar.dialog"));c.setContent(e.element());c.setControls(h.element());y.after(e.element(),d.element());a=function(){c.hide();da.set(d.input(),"");b.trigger.close()};var l=LV(e),g=MV(e),k=Nb.setup(c,h,[l,g,ea.input(d.input(),xa.input({}))]);e.events.setActive.bind(function(a){l.clickFocus(a.item().element())});c.events.close.bind(function(){k.exit();b.trigger.close()});
h.events.cancel.bind(a);c.events.close.bind(a);h.events.insert.bind(function(){b.trigger.insert(da.get(d.input()))});return{element:c.element(),events:b.registry,open:function(){c.show();k.enter()},destroy:function(){f.unbind();c.destroy();e.destroy();h.destroy();k.destroy()},close:function(){c.hide();da.set(d.input(),"")}}}function NV(a,b){var c=IV(b),d=G.create({insert:Q(["string"],c.events.insert),close:q([])}),e=function(){d.trigger.close();c.close()};c.events.close.bind(e);return{show:function(){a.toReading();
c.open()},close:e,destroy:function(){c.events.close.unbind(e);c.destroy()},events:d.registry}}function OV(a){var b=a.content(),c=a.smartview(),d=function(a){a=p.fromText(a.string());bd.insertAtCursor(b,[a]).each(function(a){a=ha.after(a.element());b.setRelativeSelection(a,a);b.focus();b.toEditing()})},e=Uc.destroyable(),f=function(){e.clear()};return{ui:ob.ui({"specialchar.general":{toggle:!1,value:"specialchar",textkey:w.key("specialchar.open"),action:function(){var h=NV(b,c.uiContainer());e.set(h);
h.events.close.bind(function(){b.focus();f()});h.events.insert.bind(function(a){d(a);f()});a.content().hideInlineSelection();h.show()},updateGeneral:u,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:f}}function PV(a,b,c,d,e){var f=a.content(),h=a.profile().nativeSpelling(),l=function(a){m.set(a,"spellcheck","false")},r=function(a){m.set(a,"spellcheck","true")};f.runOrOnLoaded(function(){var a=h.get()?r:l;f.body().each(a)});a=ob.ui({"spelling.general":{toggle:!0,value:"spellcheck",textkey:w.key("cog.spellcheck"),
action:function(){var a=!h.get();h.setAndCache(a);a=a?r:l;f.body().each(a)},updateGeneral:function(a){(h.get()?a.select:a.deselect)()},icon:!0,tooltip:ib.get}});return Jo({events:md(["analytics"]),init:u,hasDropdown:k(!1),hasAutocorrect:k(!1),check:u,scanView:u,lock:pb,situation:Tf.noSituation,handle:u,assign:u,destroy:function(){f.body().each(function(a){m.remove(a,"spellcheck")})},state:k({}),ui:a,lookup:k(g.none()),name:k("spelling-disabled")})}function QV(a,b,c){var d=G.create({change:q(["language"])});
a=c?RV(a,d):SV(a,b,d);return{ui:ob.ui(a),hasDropdown:k(c),events:d.registry}}function TV(){var a=[],b=!1,c=function(){b=!0;g.from(a.shift()).fold(function(){b=!1},function(a){a.f()(a.area(),c)})};return{enqueue:function(d,e){a.push(UV(d,e));b||c()},destroy:function(){a=[]}}}function VV(a,b){var c=Ga(a),d=TV(),e=function(a,d,e,g){e=sl.cata(e,function(a){return fa.inBody(a)?tl.single(a,c.get(),b):tl.empty()},function(a,d,e,f){return fa.inBody(a)&&fa.inBody(e)?tl.range(a,d,e,f,c.get(),b):tl.empty()});
d(a,e,c.get(),g)};return{run:function(a,b,c){e(a,b,c,aa)},setLang:c.set,schedule:function(a,b,c,g){d.enqueue(c,function(c,d){void 0!==g&&g()?d():e(a,b,c,d)})},destroy:function(){d.destroy()}}}function WV(a,b){var c=function(b){return F(b,function(b){var c=zy.getInCache(a,b.lang(),b.words());return{zone:k(b),words:k(c),lang:b.lang}})},d=function(a,b,c){A(b,function(b){XV.highlight(a,b.zone(),b.words(),c)})};return{local:function(a,b,h,l){b=b.zones();b=c(b);d(a,b,h);l()},remote:function(c,f,h,l){f=
f.zones();YV.scan(a,b,f).get(function(a){d(c,a,h);l()})},destroy:u}}function ZV(a,b,c){var d=Ay.initCaches(c),e=Qk.post("ephox.spelling.service.many",$V.many(),a,b);return{checkMany:function(a,b,c){c=si.now();return Ay.execute(e,d,a,b,c)},dumpCache:function(){return Wb(d,function(a){return a.dump()})}}}function aW(a,b,c,d,e){var f=bW.spelling(b),h=ZV(f+"correction",a.newHeaders(),e),l=G.create({failed:q(["resource"])}),g=Zd.get(f+"autocorrect?language="+c,$d.json(),Od.xhr(),a.newHeaders()),D=Fe.nu(function(a){g.get(function(b){b.fold(function(){a(b)},
function(b){h.checkMany(c,["startup"],!0).get(a)})})});D.get(function(a){a.fold(function(a){console.error("Unable to communicate with the spelling service:",Bp.consoleMessage(a));l.trigger.failed(b)},u)});return{correction:function(a,b,e,f){D.get(function(l){l.fold(f,function(){h.checkMany(d?b:c,a.words).get(function(a){a.fold(function(a){console.error("Error response from the spelling service:",Bp.consoleMessage(a));f(a)},function(a){e(a)})})})})},autocorrect:k(g),events:l.registry,state:function(){return h.dumpCache()}}}
function cW(a){var b=a.content(),c=a.profile(),d=aW(a.communication(),a.url(),a.language(),a.multilingual(),a.fromServiceState()),e=a.autocorrectOn()?By.active(d):By.inactive(),f=G.create({failed:q(["resource"])}),h=function(a){f.trigger.failed(a.resource())};d.events.failed.bind(h);var l=VV(a.language(),a.viewable().viewport()),g=WV(a.cache(),d),k=function(a){b.body().each(function(b){Uk.filterDom(b,[mp("."+a,Ka.unwrap)])})},x=function(){return!Re.isOn(c.spelling().get())},m=function(){k("ephox-cram-annotation-wrap")};
return{run:function(a,b){var d=c.spelling().get();Re.isOn(d)&&(l.setLang(d),l.run(a,g.local,b),l.schedule(a,g.remote,b,x))},refresh:function(){var a=c.spelling().get();Re.isOn(a)||m()},clear:m,lookup:e.lookup,destroy:function(){d.events.failed.unbind(h);l.destroy();g.destroy()},state:d.state,events:f.registry}}function dW(){var a=G.create({incorrect:q(["substitution"])}),b=g.none(),c={};c[de.spelling()]=function(c){b.each(function(b){b=Up.substitute(b,m.get(c,de.value()));a.trigger.incorrect(b)})};
return{assign:function(a){b=a},run:function(a){var b=m.get(a,de.type());b=c[b];void 0!==b&&b(a)},events:a.registry}}function eW(a,b,c){var d=dW();d.events.incorrect.bind(function(c){b.save();a.focus();a.domChanged();c.substitution().each(function(b){Cy.selectEnd(a,b)})});var e=t(function(a,b,c,d){return a.marker(d).bind(a.detail).bind(function(a){return c(a).map(function(a){return F(a,function(a){var c={};c[de.type()]=b;c[de.value()]=a;return fW(a,a,c)})})})},Up,de.spelling(),function(a){return c.suggestions(a.lang(),
a.word())});return{assign:d.assign,handle:function(a){d.run(a)},situation:function(a){a=e(a).getOr([]);return gW.generate(a,4)},destroy:u}}function hW(a,b){var c=G.create({lookup:q(["element"])}),d=function(){a.getSelection().each(function(a){c.trigger.lookup(a.startContainer())})};a.events.keyup.bind(function(a){Md.isSpace(a)&&d()});a.events.nodeChanged.bind(function(a){a.prev().each(c.trigger.lookup)});return{events:c.registry,destroy:u}}function iW(a,b,c,d,e,f,h,l,g){var r=eW(b,e,l),k=hW(b,c),
m=function(a){b.getSelection().each(function(b){var c=Xa.toLeaf(b.endContainer(),b.endOffset()),e=Xa.toLeaf(b.startContainer(),b.startOffset()),f;(f=b.collapsed())||(f=!Dy.isIE())||(f=Vc.after(b.endContainer(),b.endOffset(),b.startContainer(),b.startOffset()));b=f&&!Dy.isFirefox()?Ec(e.element(),e.offset(),c.element(),c.offset()):b;return(f?d.lightweightWith:pb)(a,b)})},I=nd.tap(function(a){a=a.element();"body"!==C.name(a)&&(a=sl.single(a),n(a))});k.events.lookup.bind(function(a){I.instance(a)});
var n=function(a){g.run(m,a)};return{destroy:function(){r.destroy();k.destroy()},scan:n,situation:r.situation,lock:function(a){var b=I.control.isBlocked();I.control.block();a();b||I.control.unblock()},assign:r.assign,handle:r.handle}}function jW(a,b,c,d,e){e=b.language.getOr(e);var f=a.communication(),h=a.profile(),l=a.filter(),r=a.content(),D=a.operations(),x=a.undo(),H=a.smartview(),I=a.shortcuts(),n=a.context(),p=a.viewablearea();Vp.configure(l);a.profile().spelling().set(e);var t=kW(b.words),
v=cW(lW({communication:f,profile:h,content:r,undo:x,viewable:p,cache:t,url:c.url,autocorrectOn:c.autocorrect,language:d,fromServiceState:b.service,multilingual:c.multilingual})),w=g.none();b=G.create({analytics:q(["message"])});v.events.failed.bind(function(b){b=Ge.get("error.code.spelling.not.found",[b.resource()]);b=ii(b);a.ui().displayBanner(b)});r.events.ready.bind(function(a){r.body().each(function(a){m.set(a,"spellcheck",!1)});a=a.api().doc();a=iW(a,r,n,D,x,I,H,t,v);v.refresh();w=g.some(a)});
d=QV(a,d,c.menu);d.events.change.bind(function(a){(Re.isOn(a.language())?z:v.clear)();r.uiChanged();r.domChanged()});var y=function(a){A(a,function(a){a=sl.single(a);C(a)})},z=c.scanView?function(){var a=p.sections();y(a)}:v.clear;c.scanView&&p.events.onChange.bind(z);var C=function(a){w.each(function(b){b.scan(a)})};return Jo({events:b.registry,destroy:function(){r.body().each(function(a){m.remove(a,"spellcheck")});w.each(function(a){a.destroy()});t.destroy();v.destroy()},state:function(){return{words:t.state(),
service:v.state(),language:g.some(a.profile().spelling().get())}},init:u,hasDropdown:d.hasDropdown,hasAutocorrect:k(c.autocorrect),ui:d.ui,check:function(a,b,c,d){a=Vp.isWrap(a)?Xa.toLeaf(a,b):W.point(a,b);c=Vp.isWrap(c)?Xa.toLeaf(c,d):W.point(c,d);c=sl.range(a.element(),a.offset(),c.element(),c.offset());C(c)},scanView:z,situation:function(a){var b={primary:k([]),secondary:k([]),submenus:k({})};return w.fold(k(b),function(b){return b.situation(a)})},lock:function(a){return w.fold(function(){return a()},
function(b){return b.lock(a)})},assign:function(a){w.each(function(b){b.assign(a.bind(B.firstChild).or(a))})},handle:function(a){w.each(function(b){b.handle(a)})},lookup:v.lookup,name:k("spelling")})}function mW(a,b,c,d,e){return(!0===c.service?jW:PV)(a,b,c,d,e)}function Ey(a){var b=Hd(a);n.add(b.element(),z.resolve("choice-button"));var c=S.span();m.set(b.element(),"title",w.translate("table."+a));m.set(b.element(),"tabindex","-1");T.button(b.element(),w.translate("table."+a),!1);var d=bb.describe(b.element(),
w.translate("aria.table.headerdescription"));y.append(b.element(),d);b.events.click.bind(function(){Y.focus(b.element());ma.pressed(b)});ja.add(c,[z.resolve(a),"ephox-pastry-icon-content","ephox-polish-icon"]);b.content({element:k(c)});return b}function nW(a,b){var c=!1,d=function(a,b,c){var d=c.full();d.row()===b.rows()&&d.column()===b.columns()||a.setSize(d.row(),d.column());a=a.setSelection(c.selection().row(),c.selection().column());Y.focus(a)};return{on:function(){c=!0},off:function(){c=!1},
mousemove:function(e,f,h,l){if(c){var g=Aa.get(e.element());var k=pa.get(e.element());g=Ha.dimensions(g,k);k=Wa.absolute(e.element());k=Ha.coords(k.left(),k.top());h=Ha.coords(h,l);h=a.pickerCell(k,g,f,h);h=Fy.resize(h,b);d(e,f,h)}},manual:function(a,f,h,l){c&&(h=Fy.grow(f,h,l,b),d(a,f,h))}}}function oW(a,b,c){var d=G.create({select:q(["rows","cols","rowHeaders","columnHeaders"])}),e=p.fromTag("table");T.presentation(e);T.hidden(e,!0);n.add(e,jg.table());var f=p.fromTag("tbody");y.append(e,f);var h=
0,l=0,g=function(a,b){h=b;l=a;D()},D=function(){E.empty(f);var a=c.ids();Pd.repeat(l,function(b){var c=p.fromTag("tr");n.add(c,jg.row());var d=Pd.repeat(h,function(c){var d=p.fromTag("td");n.add(d,dd.resolve("cell-"+c+"-"+b));n.add(d,jg.cell());var e=p.fromTag("button");m.set(e,"type","button");m.set(e,"aria-labelledby",a[b][c]);n.add(e,jg.button());y.append(d,e);return d});O.append(c,d);y.append(f,c)})},x=function(a,b){var c=vf.cells(e);A(c,function(a){n.remove(a,dd.resolve("picker-selected"))});
c=vf.rows(e).slice(0,a);A(c,function(a,c){a=vf.cells(a).slice(0,b);A(a,function(a,b){var d=vf.grid(e,"data-picker-header-row","data-picker-header-col");b=c<d.rows()||b<d.columns()?[dd.resolve("picker-selected"),dd.resolve("picker-header")]:[dd.resolve("picker-selected")];ja.add(a,b)})});m.set(e,"data-picker-col",b-1);m.set(e,"data-picker-row",a-1);a=vf.cells(c[c.length-1]).slice(0,b);return vf.button(a[a.length-1])},H=function(){var a=parseInt(m.get(e,"data-picker-col"),10)+1,b=parseInt(m.get(e,"data-picker-row"),
10)+1;return Ha.grid(b,a)},I={element:k(e),setSelection:x,setSize:g},U=nW(a,b),u=J.bind(e,"mousemove",function(a){U.mousemove(I,Ha.grid(l,h),a.raw().pageX,a.raw().pageY)}),v=function(a,b){U.manual(I,H(),a,b)},w=Yk.realClick.bind(e,function(a){z();a.raw().preventDefault()}),z=function(){var a=vf.grid(e,"data-picker-row","data-picker-col"),b=vf.grid(e,"data-picker-header-row","data-picker-header-col");d.trigger.select(a.rows()+1,a.columns()+1,b.rows(),b.columns())};return{element:function(){return e},
destroy:function(){w.unbind();u.unbind();E.remove(e)},setSize:g,setHeaders:function(a,b){m.set(e,"data-picker-header-row",a);m.set(e,"data-picker-header-col",b)},setSelection:x,on:U.on,off:U.off,reset:function(){g(b.minRows,b.minCols);var a=x(1,1);Y.focus(a)},refresh:function(){var a=H();D();return x(a.rows(),a.columns())},events:d.registry,sendLeft:t(v,a.isRtl()?1:-1,0),sendRight:t(v,a.isRtl()?-1:1,0),sendUp:t(v,0,-1),sendDown:t(v,0,1),sendExecute:z}}function pW(a,b){var c=eg.createHelp(b.maxRows,
b.maxCols,{row:function(a){return w.translate("table.picker.rows",a)},col:function(a){return w.translate("table.picker.cols",a)}}),d=oW(a,b,c);T.label(d.element(),w.translate("table.picker.label"));b=bb.describe(d.element(),w.translate("table.picker.describepicker"));var e=p.fromTag("div");m.set(e,"tabIndex","-1");T.group(e);ja.add(e,[z.resolve("insert-table"),z.resolve("toolbar-menu")]);a=p.fromTag("div");n.add(a,z.resolve("table-controls"));T.toolbarGroup(a,w.translate("table.picker.header"));var f=
Ey("row-header"),h=Ey("column-header");O.append(a,[f.element(),h.element()]);O.append(e,[a,d.element(),b,c.help()]);var l=function(){d.setHeaders(f.selected()?1:0,h.selected()?1:0);var a=Y.active(),b=d.refresh();a.each(function(a){Y.hasFocus(a)||Y.focus(b)})};c=function(a,b){return function(){b();return g.some(!0)}};c=ea.single(d.element(),[Z.basic(R.LEFT()[0],c("left",d.sendLeft)),Z.basic(R.RIGHT()[0],c("right",d.sendRight)),Z.basic(R.UP()[0],c("up",d.sendUp)),Z.basic(R.DOWN()[0],c("down",d.sendDown)),
Z.rule(Z.inSet(R.SPACE().concat(R.ENTER())),c("execute",d.sendExecute))],g.none());c.events.enter.bind(function(){Y.focus(d.element())});var r=ea.flow(a,{item:k(".ephox-pastry-statebutton")},xa.flow({trigger:function(a){return L.descendant(a,".ephox-pastry-button").map(function(a){a.dom().click();return a})}})),D=ea.multiple(e,[c,r]);f.events.click.bind(function(){r.clickFocus(f.element());l()});h.events.click.bind(function(){r.clickFocus(h.element());l()});c=G.create({select:Q(["rows","cols","rowHeaders",
"columnHeaders"],d.events.select),exit:Q([],D.events.exit)});return{element:function(){return e},destroy:function(){D.destroy();f.destroy();h.destroy();d.destroy()},setSize:d.setSize,setSelection:d.setSelection,on:function(){d.on();D.enter()},off:function(){d.off();D.isFocused()&&D.exit()},reset:function(){d.setHeaders(0,0);f.deselect();ma.release(f.element());h.deselect();ma.release(h.element());d.reset()},events:c.registry}}function qW(a,b){var c=G.create({enabled:q(["enabled"]),select:q(["rows",
"cols","rowHeaders","columnHeaders"]),insert:q(["table"]),done:q([]),abort:q([])});b=ra({minCols:7,maxCols:10,minRows:4,maxRows:10},b);var d=pW(a,b);d.events.select.bind(function(a){ba.detect().browser.isIE()?(c.trigger.select(a.rows(),a.cols(),a.rowHeaders(),a.columnHeaders()),c.trigger.done(),e()):(e(),c.trigger.done(),c.trigger.select(a.rows(),a.cols(),a.rowHeaders(),a.columnHeaders()))});d.events.exit.bind(function(){e();c.trigger.abort()});var e=function(){d.off()};return{element:d.element,open:function(){d.reset();
d.on()},close:e,destroy:function(){d.destroy()},events:c.registry}}function rW(){var a=p.fromTag("fieldset"),b=p.fromHtml("<legend>"+w.translate("table.border")+"</legend>");y.append(a,b);var c=Za("");b=function(a){var b=p.fromTag("input");m.setAll(b,{type:"radio",id:"tableborder"+a+c,value:a,name:c});return b};var d=b("1"),e=b("0");O.append(a,[d,p.fromHtml('<label for="tableborder1'+c+'">'+w.translate("border.on")+"</label>"),e,p.fromHtml('<label for="tableborder0'+c+'">'+w.translate("border.off")+
"</label>")]);var f=Nb.radio(a,'input[type="radio"]',"input:checked");return{element:function(){return a},get:function(){return Mi.find(a).map(function(a){return da.get(a)})},select:function(a){Mi.set(e,!1);Mi.set(d,!1);a.each(function(a){"0"===a?Mi.set(e,!0):"1"===a&&Mi.set(d,!0)});f.refresh()},keylayout:k(f),destroy:function(){E.remove(a)}}}function sW(){var a=S.div();n.add(a,z.resolve("table-size-controls"));var b=Jc.input("table-width","table.width"),c=Jc.input("table-height","table.height");
F([b,c],function(a){m.set(a.input(),"placeholder","Auto")});O.append(a,[b.element(),c.element()]);var d=[ea.input(b.input(),xa.input({})),ea.input(c.input(),xa.input({}))],e=function(a){var b=a.target();xc.validateField(b,"width",g.some("px")).fold(function(){xc.highlight(b)},function(a){xc.dehighlight(b)})},f=[J.bind(b.input(),"input",e),J.bind(c.input(),"input",e)];return{element:function(){return a},get:function(){return xc.validate([xc.rule(b.input(),"width",g.some("px")),xc.rule(c.input(),"height",
g.some("px"))])},set:function(a){a.width().bind(t(da.set,b.input()));a.height().bind(t(da.set,c.input()))},keylayouts:k(d),highlight:xc.highlight,dehighlight:t(xc.clearHighlights,a),destroy:function(){E.remove(a);A(f,function(a){a.unbind()})}}}function tW(a,b){var c=G.create({ok:q(["properties"]),close:q([])}),d=Ie(b);d.setTitle(w.translate("table.dialog"));n.add(d.element(),z.resolve("dialog-narrow"));b=S.div();var e=Lx("table.float"),f=Jc.input("tablesummary","table.summary"),h=Jc.input("tablecaption",
"table.caption"),l=sW(),r=rW();O.append(b,[h.element(),f.element(),r.element(),l.element(),e.element()]);var D=ud.okCancel("table");D.events.ok.bind(function(){I()});D.events.cancel.bind(function(){d.hide();c.trigger.close()});d.events.close.bind(function(){d.hide();c.trigger.close()});d.setContent(b);d.setControls(D.element());var x=Nb.setup(d,D,[ea.input(h.input(),xa.input({})),ea.input(f.input(),xa.input({})),r.keylayout()].concat(l.keylayouts()).concat([e.keylayout()])),m=function(){return l.get().map(function(a){a=
{width:k(g.some(a.width())),height:k(g.some(a.height()))};return Wp.properties({floatval:e.get(),caption:da.get(h.input()).trim(),summary:da.get(f.input()).trim(),border:r.get(),dimensions:a})})},I=function(){m().fold(function(a){l.highlight(a)},function(a){c.trigger.ok(a)})};return{element:d.element,events:c.registry,open:function(){d.show();x.enter()},represent:function(b){b=Wp.divine(a,b);e.select(b.floatval());void 0!==b.summary()&&da.set(f.input(),b.summary());void 0!==b.caption()&&da.set(h.input(),
b.caption());l.set(b.dimensions());r.select(b.border())},execute:I,destroy:function(){e.destroy();l.destroy();r.destroy();D.destroy();d.destroy();x.destroy()},hide:function(){x.exit();d.hide()}}}function uW(a,b,c,d,e,f,h,l){var r=g.none(),D={"tablemenu-delete-table":pc.erase,"delete-row":pc.execute(b,dc.eraseRows,u,l),"delete-column":pc.execute(b,dc.eraseColumns,u,l),"make-header-column":pc.execute(b,dc.makeColumnHeader,u,l),"make-header-row":pc.execute(b,dc.makeRowHeader,u,l),"unmake-header-column":pc.execute(b,
dc.unmakeColumnHeader,u,l),"unmake-header-row":pc.execute(b,dc.unmakeRowHeader,u,l),"insert-row-before":pc.execute(b,dc.insertRowBefore,u,l),"insert-row-after":pc.execute(b,dc.insertRowAfter,u,l),"insert-column-before":pc.execute(b,dc.insertColumnBefore,Xp.halve,l),"insert-column-after":pc.execute(b,dc.insertColumnAfter,Xp.halve,l),"tablemenu-table-properties":function(b,d,l){b=tW(a,h);var k=Nx.generate(e,b,["properties"]);k.events.ok.bind(function(a){c.activate();r.each(function(b){mb.table(b.element(),
c.isRoot).each(function(b){wd.runTransaction(c,f,function(){Wp.apply(b,a.properties())})})});k.destroy()});k.events.close.bind(function(a){k.destroy();c.activate();c.focus()});c.deactivate();k.represent(d);k.open();return g.none()},"cell-merge":pc.execute(b,dc.mergeCells,u,l),"cell-unmerge":pc.execute(b,dc.unmergeCells,u,l),"cell-split-cols":pc.execute(b,dc.splitCellIntoColumns,Xp.halve,l),"cell-split-rows":pc.execute(b,dc.splitCellIntoRows,u,l)},x=M("value","text","attrs"),H=gx.byClass(Vd);return{handle:function(a){c.doc().each(function(b){r.each(function(b){var d=
b.element();mb.table(d,c.isRoot).each(function(d){var e=m.get(a,"data-ephox-gopher-item-value"),h=D[e];void 0!==h&&wd.runTransaction(c,f,function(){h(c,d,b).each(function(a){c.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset());H.clear(d)})})})})})},assign:function(a){r=a.bind(function(a){return mb.cell(a,c.isRoot).bind(function(a){return L.ancestor(a,"table").map(function(b){return ul.forMenu(d,b,a)})}).orThunk(function(){return mb.notCell(a,c.isRoot).map(function(a){return ul.notCell(a)})})})},
situation:function(a){a=r.map(function(a){var b=a.element();b=mb.cell(b,c.isRoot).isSome();return Kb([b?[x("tablemenu-row",w.translate("table.context.row.menu"),{})]:[],b?[x("tablemenu-column",w.translate("table.context.column.menu"),{})]:[],[x("tablemenu-table",w.translate("table.context.table.menu"),{})],a.mergable().isSome()?[x("cell-merge",w.translate("table.context.cell.merge"),{})]:[],a.unmergable().isSome()?[x("cell-unmerge",w.translate("table.context.cell.unmerge"),{})]:[],b&&1===a.selection().length&&
a.mergable().isNone()&&a.unmergable().isNone()?[x("cell-split-cols",w.translate("table.context.cell.split-cols"),{}),x("cell-split-rows",w.translate("table.context.cell.split-rows"),{})]:[]])}).getOr([]);var b=r.map(function(a){var b=a.element();a=function(a,c,d){var e=a+"-menu",f="th"===C.name(b)?"unmake":"make",h="make"===f?"header":"normal";c=[x("insert-"+a+"-before",w.translate("table.context."+a+"."+c),{}),x("insert-"+a+"-after",w.translate("table.context."+a+"."+d),{}),x("delete-"+a,w.translate("table.context.common.delete"),
{}),x(f+"-header-"+a,w.translate("table.context.common."+h),{})];return{textkey:k(w.key("table.context."+a+".title")),value:k(e),items:k(c)}};var c={textkey:k(w.key("table.context.table.title")),value:k("table-menu"),items:k([x("tablemenu-table-properties",w.translate("table.context.table.properties"),{}),x("tablemenu-delete-table",w.translate("table.context.common.delete"),{})])};return Kb([[a("row","insertabove","insertbelow")],[a("column","insertleft","insertright")],[c]])}).getOr([]);return{primary:k(a),
secondary:k(b),submenus:k({"tablemenu-row":"row-menu","tablemenu-column":"column-menu","tablemenu-table":"table-menu"})}},destroy:u}}function vW(){var a=G.create({drag:q(["xDelta","yDelta"])});return{mutate:function(b,c){a.trigger.drag(b,c)},events:a.registry}}function wW(){var a=G.create({drag:q(["xDelta","yDelta","target"])}),b=g.none(),c=vW();c.events.drag.bind(function(c){b.each(function(b){a.trigger.drag(c.xDelta(),c.yDelta(),b)})});return{assign:function(a){b=g.some(a)},get:function(){return b},
mutate:c.mutate,events:a.registry}}function xW(a,b,c){var d=wW(),e=oi.transform(d,{}),f=g.none(),h=function(a,b){return g.from(m.get(a,b))};d.events.drag.bind(function(a){h(a.target(),"data-row").each(function(b){b=xd.getInt(a.target(),"top");v.set(a.target(),"top",b+a.yDelta()+"px")});h(a.target(),"data-column").each(function(b){b=xd.getInt(a.target(),"left");v.set(a.target(),"left",b+a.xDelta()+"px")})});var l=function(a,b){var c=xd.getInt(a,b);a=parseInt(m.get(a,"data-initial-"+b),10);return c-
a};e.events.stop.bind(function(){d.get().each(function(d){f.each(function(e){h(d,"data-row").each(function(a){var b=l(d,"top");m.remove(d,"data-initial-top");I.trigger.adjustHeight(e,b,parseInt(a,10))});h(d,"data-column").each(function(a){var b=l(d,"left");m.remove(d,"data-initial-left");I.trigger.adjustWidth(e,b,parseInt(a,10))});ee.refresh(a,e,c,b)})})});var r=function(b,c){I.trigger.startAdjust();d.assign(b);m.set(b,"data-initial-"+c,parseInt(v.get(b,c),10));n.add(b,yW);v.set(b,"opacity","0.2");
e.go(a.parent())},k=J.bind(a.parent(),"mousedown",function(a){ee.isRowBar(a.target())&&r(a.target(),"top");ee.isColBar(a.target())&&r(a.target(),"left")}),x=function(b){return P.eq(b,a.view())},H=J.bind(a.view(),"mouseover",function(d){"table"===C.name(d.target())||tb.closest(d.target(),"table",x)?(f="table"===C.name(d.target())?g.some(d.target()):L.ancestor(d.target(),"table",x),f.each(function(d){ee.refresh(a,d,c,b)})):fa.inBody(d.target())&&ee.destroy(a)}),I=G.create({adjustHeight:q(["table","delta",
"row"]),adjustWidth:q(["table","delta","column"]),startAdjust:q([])});return{destroy:function(){k.unbind();H.unbind();e.destroy();ee.destroy(a)},refresh:function(d){ee.refresh(a,d,c,b)},on:e.on,off:e.off,hideBars:t(ee.hide,a),showBars:t(ee.show,a),events:I.registry}}function zW(a,b){var c=Ni.height;a=xW(a,b,c);var d=G.create({beforeResize:q(["table"]),afterResize:q(["table"]),startDrag:q([])});a.events.adjustHeight.bind(function(a){d.trigger.beforeResize(a.table());var b=c.delta(a.delta(),a.table());
Yp.adjustHeight(a.table(),b,a.row(),c);d.trigger.afterResize(a.table())});a.events.startAdjust.bind(function(a){d.trigger.startDrag()});a.events.adjustWidth.bind(function(a){d.trigger.beforeResize(a.table());var c=b.delta(a.delta(),a.table());Yp.adjustWidth(a.table(),c,a.column(),b);d.trigger.afterResize(a.table())});return{on:a.on,off:a.off,hideBars:a.hideBars,showBars:a.showBars,destroy:a.destroy,events:d.registry}}function AW(a,b){var c=a.content(),d=a.keyboard(),e=a.undo(),f=a.smartview(),h=function(){return v.getOr(Zp.only(c.element()))},
l=uW(a.filter(),a.region(),c,a.selections(),d,e,f.uiContainer(),h),r=function(a,b,d){e.save();A(b,function(b){a(b,d)});e.save();c.focus()},D=t(r,Gy.setBackgroundColor);r=t(r,Gy.setBorderColor);b=ob.ui({"table.widget":t(BW.widget,a,b),"cell.palette":k({items:[{type:"widget",build:t(Hy.widget,a,b,{action:D,shortname:"background",name:"cellbackgroundcolor",textkey:"table.cell.color.background",menuTextkey:"table.cell.color.background"})},{type:"widget",build:t(Hy.widget,a,b,{action:r,shortname:"border",
name:"cellbordercolor",textkey:"table.cell.color.border",menuTextkey:"table.cell.color.border"})},{type:"widget",build:t(CW.widget,a)},{type:"dropdown",build:t(DW.widget,a)}],updatePalette:function(b){var d=Se.selectedCells(a.selections(),c.isRoot),e=t(b.show,g.some(w.translate("table.context.palette.show")));b=t(b.hide,g.some(w.translate("table.context.palette.hide")));(0<d.length?e:b)()&&a.ui().refresh()}})},aa);var x=function(b){var d=b.stopper();Fk.context(c).bind(function(e){Fk.cata(e,function(e){mb.cell(e.startContainer(),
c.isRoot).each(function(e){(b.shift()?Iy.backward:Iy.forward)(a.region(),c,e,h).fold(d,function(a){d();c.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())})})},u)})},m=function(a){Jy.upOrLeft(c)},I=function(a){Jy.right(c)},n=d.editor();n.on();n.events.tab.bind(x);n.events.left.bind(m);n.events.up.bind(m);n.events.right.bind(I);var p=c.cursor(),q=g.none(),v=g.none();c.events.ready.bind(function(b){b=Tp.get(c,f,b.api().doc());v=g.some(b);var d=$v(a.region().directionAt),
h=zW(b,d);h.events.beforeResize.bind(e.save);h.events.afterResize.bind(function(){c.focus();e.save();c.domChanged();p.restore()});h.on();h.events.startDrag.bind(p.save);q=g.some(h);b=a.selections();b.events.beforeScan.bind(function(){h.hideBars()});b.events.afterScan.bind(function(){h.showBars()})});return{ui:b,destroy:function(){l.destroy();q.each(function(a){a.destroy()});n.off();n.events.tab.unbind(x);n.events.left.unbind(m);n.events.up.unbind(m);n.events.right.unbind(I);n.destroy()},handle:l.handle,
assign:l.assign,situation:l.situation,name:k("table")}}function EW(){var a=G.create({pasteUpload:q([]),uploadAssets:q(["assets"])});return{destroy:u,events:a.registry,pasteUpload:a.trigger.pasteUpload,uploadAssets:a.trigger.uploadAssets}}function FW(a,b){a=a().uiContainer();var c=G.create({close:q([])}),d=Ie(a);d.setTitle(w.translate("wordcount.dialog"));ja.add(d.element(),[z.resolve("dialog-wordcount"),z.resolve("dialog-narrow")]);var e=b().body().getOrDie();a=ah.toText(e,k(!1));e=Mb.get(e);b=b().getSelectedText().getOr("");
a=Ky.count(a);e=e.length;b=Ky.count(b);var f=p.fromHtml(Ly('<table class="ephox-polish-tabular ephox-polish-wordcount-table" tabindex="-1">    <thead>        <tr>            <th scope="col"> ${headerCounts}&nbsp;</th>            <th scope="col"> ${headerDocument}&nbsp;</th>            <th scope="col"> ${headerSelection}&nbsp;</th>        </tr>    </thead>    <tbody>        <tr>            <td>${wordCountLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-words">${documentCountWords}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-words">${selectionCountWords}&nbsp;</td>        </tr>        <tr>            <td>${wordCountCharsNoSpacesLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-charsnospaces">${documentCharactersNoSpaces}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-charsnospaces">${selectionCharactersNoSpaces}&nbsp;</td>        </tr>        <tr>            <td>${wordcountCharsLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-chars">${documentCountCharsWithSpaces}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-chars">${selectionCountCharsWithSpaces}&nbsp;</td>        </tr>    </tbody></table>',
{headerCounts:w.translate("wordcount.counts"),headerDocument:w.translate("wordcount.document"),headerSelection:w.translate("wordcount.selection"),wordCountLabel:w.translate("wordcount.words"),wordCountCharsNoSpacesLabel:w.translate("wordcount.charactersnospaces"),wordcountCharsLabel:w.translate("wordcount.characters"),documentCountWords:a.words(),selectionCountWords:b.words(),documentCharactersNoSpaces:a.characters().withoutSpaces(),selectionCharactersNoSpaces:b.characters().withoutSpaces(),documentCountCharsWithSpaces:e,
selectionCountCharsWithSpaces:b.characters().withSpaces()}));d.setContent(f);var h=ea.multiple(d.element(),[]);b=function(){l();c.trigger.close()};var l=function(){d.hide()};d.events.close.bind(b);h.events.exit.bind(b);return{element:d.element,events:c.registry,open:function(){d.show();h.enter();Y.focus(f)},destroy:function(){h.destroy();d.destroy()},hide:l}}function GW(a,b){var c=FW(a,b),d=G.create({close:q([])});c.events.close.bind(function(){d.trigger.close();c.destroy()});return{show:function(){c.open()},
events:d.registry}}function HW(a){var b=a.content,c=a.smartview;return{ui:ob.ui({"wordcount.general":{toggle:!1,value:"wordcount",textkey:w.key("wordcount.open"),action:function(){var d=GW(c,b);d.events.close.bind(function(){a.ui().tabstrip.focused()||b().focus()});a.content().hideInlineSelection();d.show()},updateGeneral:u,icon:!0,shortcut:!1,hasPopup:!1,hasDialog:!0}}),destroy:u}}function vl(a,b,c){var d=function(a,b,c,d){return b.bundled?a.apply(void 0,d.concat([b])):c()},e=IW(a,b,c);b=d(jQ,a.formatting,
Ja.basic,[e]);var f=d(hQ,a.alignindent,Ja.basic,[e]),h=d(xQ,a.bookmark,Ja.basic,[e]),l=d(zQ,a.directionality,Ja.basic,[e]),r=d(AW,a.table,Ja.table,[e]),D=d(uQ,a.blocktag,Ja.basic,[e]),x=d(VS,a.font,Ja.basic,[e]),H=d(HW,a.wordcount,Ja.basic,[e]),I=d(sU,a.media,Ja.basic,[e]),n=d(OV,a.specialchar,Ja.basic,[e]),p=d(dU,a.linkvalidator,Ja.linkvalidator,[e,c.linkvalidator]),t=d(ZT,a.link,Ja.basic,[e,p]),v=d(lT,a.horizontalrule,Ja.basic,[e]),w=d(hT,a.help,Ja.dialog,[e]),y=function(b,c,d,f){var h=a.ui.locale.code;
h=void 0!==h?h:Le.get();return(!0===c.bundled?Re.determine(h):g.none()).fold(function(){return d()},function(a){var d=e.profile().spelling().get(),h=!0===c.menu||d===Re.offKey();return b.apply(void 0,f.concat([c,a,h&&!1!==d?d:a]))})}(mW,a.spelling,Ja.spelling,[e,c.spelling]),z=d(HU,a.parlance,Ja.basic,[e,y]),C=d(PU,a.resize,Ja.basic,[e]),E=d(mU,a.macros,Ja.macros,[e,y,c.macros]),J=d(iT,a.highlighter,Ja.highlighter,[e,E]),L=d(AQ,a.draganddrop,Ja.draganddrop,[e]),K=EW(),M=d(JT,a.imageEdit,Ja.imageEdit,
[e,K]),P=d(oT,a.image,Ja.image,[e]),O=d(BS,a.fileupload,Ja.dialog,[e,K,M.insertResample(),L]),N=d(FV,a.smartclipboard,Ja.basic,[e,K,M.insertResample()]),R=d(DU,a.mentions,Ja.basic,[e]),S=d(HS,a.findreplace,Ja.basic,[e]),T=d(cQ,a.accessibility,Ja.basic,[e]),V=d(EQ,a.embed,Ja.basic,[e,c.embed]);c=function(){var a=e.content();return a.body().fold(a.getContent,function(a){a=Gc.deep(a);return Oi.output(e.filter(),a)})};var W=function(a){var b=e.filter(),c=e.content();a=b.filterHtml(b.input(),a);c.resetContent(a);
J.run();p.refresh();y.scanView();return a};d=d(LU,{getContent:c,setContent:W,bundled:a.plaincodeview.bundled},Ja.basic,[e]);e.contextmenu().register("table",r);e.contextmenu().register("imageEdit",M);e.contextmenu().register("image",P);e.contextmenu().register("spelling",y);e.contextmenu().register("link",t);var Y=JW({formatting:b,alignindent:f,bookmark:h,directionality:l,table:r,font:x,imageEdit:M,parlance:z,blocktag:D,wordcount:H,specialchar:n,media:I,link:t,linkvalidator:p,horizontalrule:v,help:w,
fileupload:O,findreplace:S,accessibility:T,plaincodeview:d,macros:E,spelling:y});e.content().events.ready.bind(function(){e.ui().init(e.keyboard(),e.undo(),Y);y.init(e.content());J.run();p.refresh()});e.content().events.loaded.bind(function(){setTimeout(function(){X.trigger.loaded();Z()},0)});var X=G.create({loaded:q([]),ready:Q([],e.content().events.ready),focus:q([]),change:q([]),dirty:Q([],e.laundry().events.dirty),internal:q(["command","data"]),paint:q(["dimensions"])}),Z=e.content().isInline()?
u:function(){e.content().body().each(function(a){a=B.documentElement(a);var b=e.content().element();X.trigger.paint(vv({width:Aa.get(b),docWidth:Aa.get(a),height:pa.get(b),docHeight:pa.get(a)}))})};e.undo().events.changed.bind(function(){X.trigger.change()});e.undo().events.reset.bind(function(){X.trigger.change()});e.content().events.paint.bind(Z);e.content().events.nodeChanged.bind(Z);e.content().events.focus.bind(function(){X.trigger.focus()});e.internalevents().events.internal.bind(function(a){var b=
a.command();"insertLink"===b&&(a=m.get(a.data(),"href"),X.trigger.internal(b,a))});d=e.content().isInline()?function(){var a=e.ui(),b=e.content(),c=a.state();c=void 0!==c.toolbar&&void 0!==c.toolbar.drag?c.toolbar.drag.isSome():!1;b.activate();b.focus();e.viewablearea().setOn();c||a.position();a.refresh()}:u;b=e.content().isInline()?function(){e.content().deactivate();e.content().blur();e.viewablearea().setOff()}:u;return fi.internal({activateInline:d,deactivateInline:b,element:e.ui().element,viewport:e.ui().viewport,
connect:e.ui().connect,focus:e.content().focus,blur:e.content().blur,getContent:c,toTransfer:Db(ef.changed,c),setContent:function(a){var b=e.undo();b.disable(function(){var c=W(a);b.reset(c)});e.laundry().setDirty(!1)},insertHtmlAtCursor:e.insertFilteredHtmlAtCursor,isDirty:e.laundry().isDirty,setDirty:e.laundry().setDirty,fromTransfer:function(a){var b=e.undo();ef.cata(a,function(a){b.disable(function(){W(a)});b.replaceTop()},function(a){W(a);b.save()})},uploader:k(K),state:function(){var a=e.state();
return ra(a,{spelling:y.state(),macros:E.state(),filters:e.filter().customFilters().state(),linkvalidator:p.state(),embed:V.state()})},destroy:function(){e.content().deactivate();var a=F(se(Y),pb);A(a.concat([V,P,M,y,C,E,J,K,N,R,e,L]),function(a){a.destroy()})},events:X.registry,communication:e.communication,fullscreen:e.fullscreen,content:e.content,ui:e.ui,undo:e.undo,smartview:e.smartview,keyboard:e.keyboard,filter:e.filter,operations:e.operations,macros:k(E),getMode:Yb.pencil,isPrettyPrinting:function(){return!0===
a.content.prettyprint}})}function KW(a,b){var c=Ja.state(b),d=Ga(null),e=p.fromTag("div"),f=function(){Ca.set(e,'<div class="e-p-s-img"></div>');h()},h=void 0===a.content.inline?u:function(){if(!1===a.ui.toolbar.visible)v.set(e,"display","none");else{var b={isInline:k(!0),element:k(a.content.inline)};b=$c.offsetFrom(b,e,pa.get(e),a.ui);v.setAll(e,{position:"absolute",left:b.left+"px",top:b.top-4+"px"})}},l=null;b=yb("API unavailable while the editor is loading");var r={body:k(g.none()),doc:b,execCommand:b,
getSelectedText:b,focus:b,deactivate:u,blur:u},D=void 0===a.content.inline?d.get:function(){return Ca.get(a.content.inline)};return fi.internal({activateInline:h,blur:b,communication:k(Bw(a)),connect:function(a){l=setTimeout(f,1E3);y.append(a,e);$p.add();return!1},content:k(r),deactivateInline:u,destroy:function(){clearTimeout(l);$p.remove();E.remove(e)},element:k(e),events:od.events(),failure:function(){clearTimeout(l);$p.remove();Ca.set(e,"<p>Unable to load editor. See browser console for details.</p>")},
filter:c.filter,focus:b,fromTransfer:function(a){ef.cata(a,d.set,d.set)},fullscreen:Ja.fullscreen,getContent:D,getMode:b,insertHtmlAtCursor:b,isDirty:c.laundry.isDirty,isPrettyPrinting:function(){return!0===a.content.prettyprint},keyboard:od.keyboard,macros:c.macros,operations:od.operations,setContent:function(b){void 0===a.content.inline?d.set(b):Ca.set(a.content.inline,b);c.laundry.setDirty(!1)},setDirty:c.laundry.setDirty,smartview:od.smartview,state:function(){var a=Te.isEmpty(D())?{}:{content:{}};
return c.getState(a)},toTransfer:Db(ef.unchanged,D),ui:od.ui,undo:k(Ja.undo()),uploader:k(Ja.uploader()),viewport:k(e)})}function LW(a,b){return(!0===b.bundled?MW:NW)(a,b)}function OW(a,b){var c=G.create({change:q(["type"])}),d=Ue.removeClasses([z.resolve(Yb.none()),z.resolve(Yb.wait()),z.resolve(Yb.pencil()),z.resolve(Yb.code())]),e=S.div();T.hidden(e,"true");ja.add(e,[z.resolve("html-switch-wrapper"),z.resolve("layer-editor")]);var f=S.div();ja.add(f,[z.resolve("html-switch"),z.resolve("icon")]);
y.append(e,f);var h=function(a){d(f);n.add(f,z.resolve(a));m.set(f,"data-icon",a);m.remove(f,"title")},l=function(a,b){var c=m.get(f,"data-icon");a!==c&&(p=c,h(a),m.set(f,"title",b))},g=function(a){b.showButton&&a!==Yb.none()?l(a,w.translate("toolbar.switch-"+a)):h(Yb.none());x.control.unblock()},k=Uc.unbindable(),x=nd.tap(function(){c.trigger.change(m.get(f,"data-icon"))});b.showButton&&k.set(J.bind(e,"click",x.instance));var H=function(a){y.append(a,e)},I=we.onDirection("right","left"),p=Yb.none();
g(p);return{render:H,destroy:function(){E.remove(e);k.clear()},switchto:g,spin:function(){l(Yb.wait(),w.translate("loading.wait"));x.control.block()},stopSpin:function(){"spin"!==p&&g(p)},init:function(b){var c=a.get();H(c.viewport());c.events.paint.bind(function(a){var b=a.dimensions();a=I(c.element());b="left"===a&&(My.isFirefox()||My.isChrome())?0:b.width()-b.docWidth();v.set(e,a,b+"px")});g(Yb.none())},events:c.registry}}function PW(a,b,c,d,e,f){var h=p.fromTag("div"),l=c.uiContainer(),g=S.div();
d.updateUi(h);d=[Xf.editorContainer(),"ephox-textbox-font",z.resolve("layer-editor"),z.resolve("editor-main"),z.resolve("fullscreen-maximized")];ja.add(h,d);m.set(h,"lang",Le.get());aq.addClasses(h);y.append(h,l);var D=Pv(a,h,{}),x=ye.toolbar(D,w.translate);b.events.toolbar.bind(x.enter);x.events.exit.bind(a.focus);var H=Ov(),I=fa.body(),q=S.div();n.add(q,z.resolve("socket"));var t=F(["dragover","drop"],function(a){return J.bind(q,a,function(a){a.kill()})}),u=S.div();n.add(u,z.resolve("widget-container"));
D.integrate(h,x,H,q,u);Yv.build(h,e.sideBar,e.bottomBar);var v=px({layerClass:z.resolve("layer-below-editor"),background:"rgba(255, 255, 255, 0.92)"}),B=z.resolve("body-fullscreen");a.events.paint.bind(function(a){x.repaint();c.refresh()});return{element:k(h),socket:function(a){y.append(q,a.element())},viewport:k(q),uiContainerParent:k(g),connect:function(a){v.show();n.add(I,B);y.append(a,h);gi.detect(h);return!0},destroy:function(){A(t,function(a){a.unbind()});x.destroy();n.remove(I,B);E.remove(h);
E.remove(g);v.destroy();H.destroy()},banners:H.element,displayBanner:H.display,hideBanner:H.hide,position:function(){D.init(x,H,q,u,e,f)},refresh:function(){D.update();x.refresh()},toolbar:x,dialogContainer:k(u)}}function QW(a){var b=g.none(),c=g.none(),d=G.create({maximize:q([]),restore:q([])}),e=function(c){b=B.parent(a.get().element());b.getOrDie("maximize called on editor that is not in the DOM.");a.swap(vl,{ui:{layout:RW,isFullScreen:!0,autoresize:!1},fullscreen:{layout:void 0!==c.layout()?c.layout():
bq},content:{autoresize:!1}}).destroy();var e=a.get();e.fullscreen().select();e.connect(fa.body());e.events.ready.bind(function(){e.focus();d.trigger.maximize()})},f=function(c){a.swap(vl,{ui:{layout:void 0!==c.layout()?c.layout():bq,isFullScreen:!1}}).destroy();var e=a.get();e.fullscreen().deselect();c=b.getOrDie("restore called on editor that was not previously in the DOM.");a.get().connect(c);e.events.ready.bind(function(){e.focus();d.trigger.restore()})};return{init:function(b){if(wl.goingToDesign(b)){b=
a.get();var d=a.get().element();c.each(function(a){if(P.eq(a,d))throw"Fullscreen init called twice on the same instance";});c=g.some(d);b.fullscreen().events.maximize.bind(e);b.fullscreen().events.restore.bind(f)}},destroy:function(){},events:d.registry}}function SW(){var a=[];return{setCallback:function(b){wb(b)&&a.push(b)},done:function(b){A(a,function(a){a.apply(null,[b])});a=[]}}}function TW(a){var b=function(){var b=a.url,c=b.lastIndexOf("/");b=0<c?b.substr(0,c):b;b=void 0===a.basePath?b:a.basePath;
return ce(b,"/")?b:b+"/"}(),c=function(c,e,f){var d=Pi.getFilename(c,e);e=!0===a.credentials?Od.xhr():Od.none();c=Ny.file(Pi.buildData("image",c,d));Zd.post(a.url,c,$d.text(),e).map(function(a){a.fold(function(a){f(N.error(Pi.failureObject(a.message(),a.status(),a.responseText())))},function(a){try{var c=yd.parse(a);if(ta(c.location))var e=c.location;else{f(N.error(Pi.failureObject("JSON response did not contain a string location",500,a)));return}}catch(H){e=a}a=e.split(/\s+/);a=Zx.resolve(b,1===
a.length&&""!==a[0]?a[0]:d);f(N.value({location:a}))})})};return{upload:function(a,b,f){a=a.imageresult();Lc.imageResultToBlob(a).then(function(a){c(a,b,f)})}}}function UW(a){var b=function(b,d,e,f){var c=function(a){f(N.error(a))},l=function(a){ta(a)?f(N.value({location:a})):(console.error("Image upload result was not a string"),c(""))},g=Pi.getFilename(b,e),k=VW(e,g,b,d);setTimeout(function(){a(k,l,c)},0)};return{upload:function(a,d,e){var c=a.imageresult();Lc.imageResultToBlob(c).then(function(a){b(a,
Lc.imageResultToDataURL(c),d,e)})}}}function WW(){var a={},b=function(a){wf.revokeObjectURL(a.objurl())};return{add:function(b,d,e){d=XW(b,d,e);return a[b]=d},get:function(b){return g.from(a[b])},remove:function(c){var d=a[c];delete a[c];void 0!==d&&b(d)},lookupByData:function(b){return YW(a,function(a){return Lc.imageResultToDataURL(a.imageresult())===b})},destroy:function(){Ra(a,b);a={}}}}function ZW(){var a=[],b=[],c=G.create({complete:q(["response"])}),d=function(d){a=ka(a,function(a,b){return a!==
d});!1===e()&&(c.trigger.complete(b),b=[])},e=function(){return 0<a.length};return{findById:$W,findAll:aX,register:function(b,c){m.set(b,xl,c);a.push(c)},report:function(a,c,e){A(c,function(a){m.remove(a,xl);b.push({success:e,element:a.dom()})});d(a)},inProgress:e,isActive:function(b){return V(a,b)},events:c.registry}}function bX(a,b){var c=WW(),d=SW(),e=ZW(),f=tp(a.ui),h=cX.choose(b,f,a.communication()),l=h.uploader(),r=h.errors(),k=dX.instance(b,c),x=G.create({begin:q([]),finish:q([])}),m=function(a){x.trigger.finish();
d.done(a)};e.events.complete.bind(function(a){m(a.response())});var I=function(a,b,d,f){Qi.handleUpload(l,e,c,a,b,d,function(a){a.fold(function(a){f(a)},p)})},n=function(d){a.content().body().each(function(a){var e=r.instance(),f=Qi.registerAssets(c,a,d.assets());f=Ji.partition(f);A(f.errors,function(a){console.error(a)});0<f.values.length&&!0===b.immediate&&(x.trigger.begin(),A(f.values,function(b){t(a,b,e)}))})},p=function(b,c,d){a.undo().rewrite(d.objurl(),b.location)},t=function(a,c,d){!1!==b.bundled&&
Qi.prepareForUpload(e,c.blobInfo().id(),c.image()).each(function(b){I(a,b,c.blobInfo(),d)})},u=function(a){A(a,function(a){e.report(a,g.none(),!1)})},v=function(a,b){b=Ji.partition(b);var c=b.values;u(b.errors);var d=r.instance();k(c).get(function(b){b=Ji.partition(b);0<b.errors.length&&(f.showKey("imageedit.generic"),console.error("Image resample on upload errors: ",b.errors),u(b.errors));A(b.values,function(b){t(a,b,d)})})},w=function(f){wb(f)&&d.setCallback(f);x.trigger.begin();!0!==b.bundled?
m([]):a.content().body().fold(function(){m([])},function(a){var b=Qi.findBlobs(e,c,a);0!==b.length||e.inProgress()?v(a,b):m([])})};return{init:function(d){wl.goingToDesign(d)&&(d=a.filter(),eX.configure(d,c),a.uploader().events.uploadAssets.bind(n),a.uploader().events.pasteUpload.bind(function(){!0===b.immediate&&w()}));f.reset()},events:x.registry,reconstitute:w,destroy:function(){c.destroy()}}}function fX(a,b,c,d){var e=QW(a),f=bX(b,c.imageupload),h=LW(a,c.codeview),l=OW(a,c.codeview),g=[e,f,l],
k=g.concat([h]);e.events.restore.bind(function(){d.restore();m(k,Yb.code())});e.events.maximize.bind(function(){d.save();m(g,Yb.code())});f.events.begin.bind(l.spin);f.events.finish.bind(l.stopSpin);h.events.change.bind(function(c){a.get().events.loaded.bind(function(){b.focus()});b.reconnect()});l.events.change.bind(function(a){x(a.type())});h.events.ready.bind(function(a){l.switchto(a.type())});var x=function(b){f.reconstitute(function(){a.get().getMode()!==b&&(l.spin(),h.setMode(b))})},m=function(a,
b){A(a,function(a){a.init(b)})};b.events.connected.bind(function(){m(k,wl.alternate(b.getMode()))});return{setMode:x,uploadImages:f.reconstitute,destroy:function(){l.destroy();a.destroy();A(k,function(a){a.destroy()})}}}function gX(a){var b=hX(a);return{directionAt:function(a){return"rtl"===(C.isText(a)?B.parent(a):g.some(a)).map(we.getDirection).getOr("ltr")?Oy:Py},uiDirection:function(){return b?Oy:Py},updateUi:function(a){m.set(a,"dir",b?"rtl":"ltr")},destroy:u}}function iX(a,b){var c=G.create({create:q(["instance"]),
loaded:q([]),focus:q([]),dirty:q([]),change:q([]),internal:q(["command","data"])}),d=Xb(function(){c.trigger.loaded()}),e=function(a){a.events.focus.bind(function(){c.trigger.focus()});a.events.dirty.bind(function(){c.trigger.dirty()});a.events.change.bind(function(){c.trigger.change()});a.events.internal.bind(function(a){c.trigger.internal(a.command(),a.data())});a.events.loaded.bind(d)};e(a);var f=a,h=Db(gX,Le.get);return{get:function(){return f},swap:function(a,d){var l=f;d=cb(b,d);var g=l.state();
a=a(d,h(),g);e(a);c.trigger.create(a);f=a;return{old:k(l),nu:k(a),destroy:function(){l.destroy()}}},destroy:function(){f.destroy()},events:c.registry}}function cq(a,b){var c=jX(a);Ri.setLanguage(c.ui.locale.code);a=cb(Qy.state(),b);b=Ic.capture(p.fromDom(document),window);var d=KW(c,a),e=iX(d,c),f=KP(e);a=fX(e,f,c,b);b=G.create({loaded:Q([],e.events.loaded),focus:Q([],e.events.focus),dirty:Q([],e.events.dirty),change:Q([],e.events.change),connected:Q([],f.events.connected),internal:Q(["command","data"],
e.events.internal)});Ri.waitForLoad().get(function(a){a=Ri.getFailures(a);if(0===a.length){a=e.swap("code"===c.codeview.mode?tv:vl);f.reconnect();var b=function(a){Te.isEmpty(a)||f.setContent(a)},h=a.old().toTransfer();ef.cata(h,b,b);a.destroy()}else A(a,function(a){console.error(a)}),console.error("Required resources are not available. Cancelling editor load."),d.failure()});return fi.external({activateInline:f.activateInline,communication:od.communication,connect:f.connect,content:f.content,deactivateInline:f.deactivateInline,
element:f.element,events:b.registry,filter:f.filter,focus:f.focus,getContent:f.getContent,getMode:f.getMode,insertHtmlAtCursor:f.insertHtmlAtCursor,isDirty:f.isDirty,isPrettyPrinting:f.isPrettyPrinting,keyboard:f.keyboard,macros:f.macros,operations:f.operations,setContent:f.setContent,setDirty:f.setDirty,smartview:f.smartview,state:f.state,ui:f.ui,undo:f.undo,setMode:a.setMode,uploadImages:a.uploadImages,destroy:a.destroy})}function kX(a,b,c){n.add(b,Id.base());return{toolbarShow:function(){n.add(b,
Id.active());v.set(a(),"display","block")},toolbarHide:function(){n.remove(b,Id.active());v.set(a(),"display","none")},isVisible:function(){return n.has(b,Id.active())},restore:function(){ja.remove(b,[Id.base(),Id.active()]);m.setAll(b,c)}}}function lX(a){var b=!1;return{submit:function(){b=!0;a.submit[0]?a.submit[0].click():a.submit.click?a.submit.click():a.submit();b=!1},inprogress:function(){return b}}}function mX(a){var b=function(b,d){var c=Xb(function(){var b=cb,c=void 0!==d?d:{};var e=cb;var g=
nX(c),k=void 0===c.privateapi?{}:c.privateapi;c=Bb(k.ui,[X.func("bounds"),X.bool("showHelpHint"),X.domElement("bottomBar"),X.domElement("sideBar")]);var x=Bb(k.integration,[X.string("type"),X.string("version")]),m=Bb(void 0===k.content?{}:k.content,[X.string("base"),X.arrayOfStrings("imageExcludes")]),n=Ry.paramList(),p=Bb(k.mentions,n),q=jb(p).length;k=Bb(k.output,[X.bool("prettyprint")]);if(0<q){if(q!==n.length)throw Error("Missing @mentions configuration. Expected "+n.length+" objects, was "+q);
p.bundled=!0}c={ui:c,help:{integration:x},content:ra(m,k),mentions:p};e=e(g,c);b=b(e,a);return Sy.setupResources(b)});return{constructors:k(b),options:c}};return{classic:function(a){return b(oX,a)},inline:function(a){a=cb({ui:{toolbar:{draggable:!0}}},a);return b(pX,a)}}}function qX(a){var b=PO(),c=mX(a),d=function(a,c){a=ta(a)?za.one(a).getOrThunk(yb("Selector did not match any elements: "+a)):p.fromDom(a);return b.getOrCreate(a,c)},e=function(a,b){ta(a)?console.error("Selector did not match a "+
b+": ",a):console.error("Element was not a "+b+": ",a);throw Error("Unable to create textbox.io editor");},f=ba.detect(),h=function(a){ta(a)||Jb(a,[X.domElement("element")]);return ta(a)?za.all(a):F(a,p.fromDom)},l=function(a,c){a=h(a);a=F(a,function(a){return b.getOrCreate(a,c)});return Td(a)};return uk.makeReadOnly({replace:function(a,b){Jb(arguments,[X.stringOrDom("element"),yl.object("options")]);return d(a,c.classic(b)).getOrThunk(t(e,a,"div or textarea"))},replaceAll:function(a,b){Jb(arguments,
[X.stringOrArray("elements"),yl.object("options")]);return l(a,c.classic(b))},inline:function(a,b){if(f.deviceType.isTouch())throw Error("Mobile does not not support inline editing");Jb(arguments,[X.stringOrDom("element"),yl.object("options")]);return d(a,c.inline(b)).getOrThunk(t(e,a,"supported tag for inline editing"))},inlineAll:function(a,b){if(f.deviceType.isTouch())throw Error("Mobile does not not support inline editing");Jb(arguments,[X.stringOrArray("elements"),yl.object("options")]);return l(a,
c.inline(b))},get:function(a){Jb(arguments,[X.string("selector")]);return b.get(a)},getActiveEditor:function(){return b.getActiveEditor().getOr(null)},definePlugin:function(a,b){Jb(arguments,[X.string("namespace"),X.object("code")]);Go.get(a).each(function(){throw Error("namespace "+a+" is already defined");});if(void 0===b.initialize||!wb(b.initialize))throw Error("plugin does not have an initialize function");return Go.register(a,b)},version:hv,isSupported:xb})}var u=function(){for(var a=0;a<arguments.length;a++);
},Db=function(a,b){return function(){for(var c=0;c<arguments.length;c++);return a(b.apply(null,arguments))}},k=function(a){return function(){return a}},aa=function(a){return a},t=function(a){for(var b=1;b<arguments.length;b++);var c=Array(arguments.length-1);for(b=1;b<arguments.length;b++)c[b-1]=arguments[b];return function(){for(var b=0;b<arguments.length;b++);b=Array(arguments.length);for(var e=0;e<b.length;e++)b[e]=arguments[e];b=c.concat(b);return a.apply(null,b)}},xf=function(a){return function(){for(var b=
0;b<arguments.length;b++);return!a.apply(null,arguments)}},yb=function(a){return function(){throw Error(a);}},pb=function(a){return a()},Sc=k(!1),xb=k(!0),Si=Sc,dq=xb,kg=function(){return eq},eq=function(){var a=function(a){return a.isNone()},b=function(a){return a()},c=function(a){return a};a={fold:function(a,b){return a()},is:Si,isSome:Si,isNone:dq,getOr:c,getOrThunk:b,getOrDie:function(a){throw Error(a||"error: getOrDie called on none.");},getOrNull:function(){return null},getOrUndefined:function(){},
or:c,orThunk:b,map:kg,ap:kg,each:function(){},bind:kg,flatten:kg,exists:Si,forall:dq,filter:kg,equals:a,equals_:a,toArray:function(){return[]},toString:k("none()")};Object.freeze&&Object.freeze(a);return a}(),zl=function(a){var b=function(){return a},c=function(){return e},d=function(b){return b(a)},e={fold:function(b,c){return c(a)},is:function(b){return a===b},isSome:dq,isNone:Si,getOr:b,getOrThunk:b,getOrDie:b,getOrNull:b,getOrUndefined:b,or:c,orThunk:c,map:function(b){return zl(b(a))},ap:function(b){return b.fold(kg,
function(b){return zl(b(a))})},each:function(b){b(a)},bind:d,flatten:b,exists:d,forall:d,filter:function(b){return b(a)?e:eq},equals:function(b){return b.is(a)},equals_:function(b,c){return b.fold(Si,function(b){return c(a,b)})},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return e},g={some:zl,none:kg,from:function(a){return null===a||void 0===a?eq:zl(a)}},bh=function(a){return function(b){if(null===b)b="null";else{var c=typeof b;b="object"===c&&Array.prototype.isPrototypeOf(b)?
"array":"object"===c&&String.prototype.isPrototypeOf(b)?"string":c}return b===a}},ta=bh("string"),Zb=bh("object"),Gb=bh("array"),fq=bh("boolean"),wb=bh("function"),df=bh("number"),Ty=function(){var a=Array.prototype.indexOf,b=function(b,c){return a.call(b,c)},c=function(a,b){a:{for(var c=0,d=a.length;c<d;++c)if(a[c]===b){a=c;break a}a=-1}return a};return void 0===a?c:b}(),zc=function(a,b){a=Ty(a,b);return-1===a?g.none():g.some(a)},V=function(a,b){return-1<Ty(a,b)},Va=function(a,b){return Ta(a,b).isSome()},
rX=function(a,b){for(var c=[],d=0;d<a.length;d+=b){var e=a.slice(d,d+b);c.push(e)}return c},F=function(a,b){for(var c=a.length,d=Array(c),e=0;e<c;e++)d[e]=b(a[e],e,a);return d},A=function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c,a)},sX=function(a,b){for(var c=a.length-1;0<=c;c--)b(a[c],c,a)},tX=function(a,b){for(var c=[],d=[],e=0,f=a.length;e<f;e++){var h=a[e];(b(h,e,a)?c:d).push(h)}return{pass:c,fail:d}},ka=function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d];b(f,d,a)&&c.push(f)}return c},
Lk=function(a,b){if(0===a.length)return[];for(var c=b(a[0]),d=[],e=[],f=0,h=a.length;f<h;f++){var l=a[f],g=b(l);g!==c&&(d.push(e),e=[]);c=g;e.push(l)}0!==e.length&&d.push(e);return d},zb=function(a,b,c){sX(a,function(a){c=b(c,a)});return c},hb=function(a,b,c){A(a,function(a){c=b(c,a)});return c},va=function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(b(e,c,a))return g.some(e)}return g.none()},Ta=function(a,b){for(var c=0,d=a.length;c<d;c++)if(b(a[c],c,a))return g.some(c);return g.none()},uX=
Array.prototype.push,Kb=function(a){for(var b=[],c=0,d=a.length;c<d;++c){if(!Array.prototype.isPrototypeOf(a[c]))throw Error("Arr.flatten item "+c+" was not an array, input: "+a);uX.apply(b,a[c])}return b},ia=function(a,b){a=F(a,b);return Kb(a)},kb=function(a,b){for(var c=0,d=a.length;c<d;++c)if(!0!==b(a[c],c,a))return!1;return!0},Uy=Array.prototype.slice,Ld=function(a){a=Uy.call(a,0);a.reverse();return a},No=function(a,b){return ka(a,function(a){return!V(b,a)})},RO=function(a,b){for(var c={},d=0,
e=a.length;d<e;d++){var f=a[d];c[String(f)]=b(f,d)}return c},Vy=function(a){return[a]},gq=wb(Array.from)?Array.from:function(a){return Uy.call(a)},qf="undefined"!==typeof window?window:Function("return this;")(),lg=function(a,b){a=a.split(".");b=void 0!==b&&null!==b?b:qf;for(var c=0;c<a.length&&void 0!==b&&null!==b;++c)b=b[a[c]];return b},hq=function(a,b){a=a.split(".");var c=void 0!==b?b:qf;for(b=0;b<a.length;++b){var d=a[b];if(void 0===c[d]||null===c[d])c[d]={};c=c[d]}return c},vc={getOrDie:function(a,
b){b=lg(a,b);if(void 0===b||null===b)throw a+" not available on this browser";return b}},Ti={isPrototypeOf:function(a){var b=lg("ownerDocument.defaultView",a);return vc.getOrDie("HTMLElement",b).prototype.isPrototypeOf(a)}},Ui=function(a,b,c,d,e,f){return{name:k(a),output:k(f||a),required:k(d),validate:function(d){if(!c(d))throw d=e(a,b),Error(d);}}},Vi=function(a,b){return'value of "'+a+'" is not a '+b},mg=function(a,b){return'value of "'+a+'" is not an '+b},Ve=function(a,b,c){return function(d,
e){return Ui(d,a,b,!0,c,e)}},Wy=function(a){return Ti.isPrototypeOf(a)},vX=function(a){return ta(a)||Gb(a)||Zb(a)},iq=Ve("array",Gb,mg),wX=Ve("boolean",fq,Vi),xX=Ve("function",wb,Vi),yX=Ve("number",df,Vi),zX=Ve("object",Zb,mg),AX=Ve("string",ta,Vi),BX=Ve("DOM element",Wy,Vi),CX=Ve("string or an array",function(a){return ta(a)||Gb(a)},mg),DX=Ve("string or a DOM element",function(a){return ta(a)||Wy(a)},mg),X={arrayOfStrings:function(a){return Ui(a,"array of strings",function(b){iq(a,void 0).validate(b);
return kb(b,ta)},!0,mg,void 0)},arrayOfObjects:function(a){return Ui(a,"array of objects",function(b){iq(a,void 0).validate(b);return kb(b,Zb)},!0,mg,void 0)},arrayOfToolbarGroups:function(a){return Ui(a,"array of toolbar groups",function(b){iq(a,void 0).validate(b);return kb(b,vX)},!0,mg,void 0)},bool:wX,domElement:BX,func:xX,number:yX,object:zX,string:AX,stringOrArray:CX,stringOrDom:DX,param:Ui},Ry={paramList:function(){return[X.object("aria"),X.func("fetch"),X.func("menuComplete"),X.func("menuExtra"),
X.func("menuHover"),X.string("hoverSelector"),X.func("hover")]},encodeWithEditorApi:function(){return["menuComplete"]}},EX=Object.prototype.hasOwnProperty,Xy=function(a){return function(){for(var b=Array(arguments.length),c=0;c<b.length;c++)b[c]=arguments[c];if(0===b.length)throw Error("Can't merge zero objects");c={};for(var d=0;d<b.length;d++){var e=b[d],f;for(f in e)EX.call(e,f)&&(c[f]=a(c[f],e[f]))}return c}},cb=Xy(function(a,b){return Zb(a)&&Zb(b)?cb(a,b):b}),ra=Xy(function(a,b){return b}),jb=
Object.keys,Ra=function(a,b){for(var c=jb(a),d=0,e=c.length;d<e;d++){var f=c[d];b(a[f],f,a)}},Wb=function(a,b){return FX(a,function(a,d,e){return{k:d,v:b(a,d,e)}})},FX=function(a,b){var c={};Ra(a,function(d,e){d=b(d,e,a);c[d.k]=d.v});return c},xk=function(a,b){var c=[];Ra(a,function(a,e){c.push(b(a,e))});return c},YW=function(a,b){for(var c=jb(a),d=0,e=c.length;d<e;d++){var f=c[d],h=a[f];if(b(h,f,a))return g.some(h)}return g.none()},se=function(a){return xk(a,function(a){return a})},jq=function(a,
b,c){return F(a,function(a){return b(a,c)})},kq=function(a,b){if(ta(a))return a;if(Gb(a))return jq(a,kq,b);if(Zb(a)&&void 0!==a.action)return b=Db(a.action,b),ra(a,{action:b});b=jq(a.items,kq,b);return cb(a,{items:b})},iv={mentions:function(a,b){var c=Ry.encodeWithEditorApi();return Wb(a,function(a,e){return V(c,e)?function(c){return a(b(),c)}:a})},toolbar:function(a,b){return void 0===a.items?a:{items:jq(a.items,kq,b)}}},Al=function(a){return{is:function(b){return a===b},isValue:xb,isError:Sc,getOr:k(a),
getOrThunk:k(a),getOrDie:k(a),or:function(b){return Al(a)},orThunk:function(b){return Al(a)},fold:function(b,c){return c(a)},map:function(b){return Al(b(a))},each:function(b){b(a)},bind:function(b){return b(a)},exists:function(b){return b(a)},forall:function(b){return b(a)},toOption:function(){return g.some(a)}}},lq=function(a){return{is:Sc,isValue:Sc,isError:xb,getOr:aa,getOrThunk:function(a){return a()},getOrDie:function(){return yb(String(a))()},or:function(a){return a},orThunk:function(a){return a()},
fold:function(b,c){return b(a)},map:function(b){return lq(a)},each:u,bind:function(b){return lq(a)},exists:Sc,forall:xb,toOption:g.none}},N={value:Al,error:lq},BO=function(){var a=(new Date).getTime();return String(a).slice(-6)},Wi=function(a){if(null===a||void 0===a)throw Error("Node cannot be null or undefined");return{dom:k(a)}},p={fromHtml:function(a,b){b=(b||document).createElement("div");b.innerHTML=a;if(!b.hasChildNodes()||1<b.childNodes.length)throw console.error("HTML does not have a single root node",
a),"HTML must have a single root node";return Wi(b.childNodes[0])},fromTag:function(a,b){a=(b||document).createElement(a);return Wi(a)},fromText:function(a,b){a=(b||document).createTextNode(a);return Wi(a)},fromDom:Wi,fromPoint:function(a,b,c){a=a.dom();return g.from(a.elementFromPoint(b,c)).map(Wi)}},Yy=Node.COMMENT_NODE,mq=Node.DOCUMENT_NODE,Xi=Node.ELEMENT_NODE,Zy=Node.TEXT_NODE,za={all:function(a,b){b=void 0===b?document:b.dom();return b.nodeType!==Xi&&b.nodeType!==mq||0===b.childElementCount?
[]:F(b.querySelectorAll(a),p.fromDom)},is:function(a,b){a=a.dom();if(a.nodeType!==Xi)return!1;if(void 0!==a.matches)return a.matches(b);if(void 0!==a.msMatchesSelector)return a.msMatchesSelector(b);if(void 0!==a.webkitMatchesSelector)return a.webkitMatchesSelector(b);if(void 0!==a.mozMatchesSelector)return a.mozMatchesSelector(b);throw Error("Browser lacks native selectors");},one:function(a,b){b=void 0===b?document:b.dom();return b.nodeType!==Xi&&b.nodeType!==mq||0===b.childElementCount?g.none():
g.from(b.querySelector(a)).map(p.fromDom)}},$y=function(a){return a.dom().nodeName.toLowerCase()},nq=function(a){return a.dom().nodeType},oq=function(a){return function(b){return nq(b)===a}},GX=oq(Xi),HX=oq(Zy),IX=oq(mq),C={name:$y,type:nq,value:function(a){return a.dom().nodeValue},isElement:GX,isText:HX,isDocument:IX,isComment:function(a){return nq(a)===Yy||"#comment"===$y(a)}},QO={one:function(a,b,c){var d=C.name(a);return g.from(b[d]).map(function(b){return b.replace(a,c)})}},Sk={documentPositionPreceding:function(a,
b){var c=vc.getOrDie("Node").DOCUMENT_POSITION_PRECEDING;return 0!==(a.compareDocumentPosition(b)&c)},documentPositionContainedBy:function(a,b){var c=vc.getOrDie("Node").DOCUMENT_POSITION_CONTAINED_BY;return 0!==(a.compareDocumentPosition(b)&c)}},Xb=function(a){var b=!1,c;return function(){for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];b||(b=!0,c=a.apply(null,d));return c}},az=function(){return pq(0,0)},pq=function(a,b){return{major:a,minor:b}},Bl={nu:pq,detect:function(a,b){b=String(b).toLowerCase();
if(0===a.length)a=az();else{a:{for(var c=0;c<a.length;c++){var d=a[c];if(d.test(b)){a=d;break a}}a=void 0}a=a?pq(Number(b.replace(a,"$1")),Number(b.replace(a,"$2"))):{major:0,minor:0}}return a},unknown:az},ch=function(a,b){return function(){return b===a}},bz=function(a){var b=a.current;return{current:b,version:a.version,isEdge:ch("Edge",b),isChrome:ch("Chrome",b),isIE:ch("IE",b),isOpera:ch("Opera",b),isFirefox:ch("Firefox",b),isSafari:ch("Safari",b)}},JX=function(){return bz({current:void 0,version:Bl.unknown()})};
k("Edge");k("Chrome");k("IE");k("Opera");k("Firefox");k("Safari");var ng=function(a,b){return function(){return b===a}},cz=function(a){var b=a.current;return{current:b,version:a.version,isWindows:ng("Windows",b),isiOS:ng("iOS",b),isAndroid:ng("Android",b),isOSX:ng("OSX",b),isLinux:ng("Linux",b),isSolaris:ng("Solaris",b),isFreeBSD:ng("FreeBSD",b)}},KX=function(){return cz({current:void 0,version:Bl.unknown()})};k("Windows");k("iOS");k("Android");k("Linux");k("OSX");k("Solaris");k("FreeBSD");var dz=
function(a,b){var c=String(b).toLowerCase();return va(a,function(a){return a.search(c)})},ez={detectBrowser:function(a,b){return dz(a,b).map(function(a){var c=Bl.detect(a.versionRegexes,b);return{current:a.name,version:c}})},detectOs:function(a,b){return dz(a,b).map(function(a){var c=Bl.detect(a.versionRegexes,b);return{current:a.name,version:c}})}},LX=function(a){return""===a?g.none():g.some(a.substr(0,1))},MX=function(a){return""===a?g.none():g.some(a.substring(1))},fz=function(a,b,c){return""===
b?!0:a.length<b.length?!1:a.substr(c,c+b.length)===b},Ly=function(a,b){return a.replace(/\$\{([^{}]*)\}/g,function(a,d){d=b[d];var c=typeof d;return"string"===c||"number"===c?d.toString():a})},Yi=function(a,b){return Ab(a,b)?a.substring(b.length):a},Zi=function(a,b){return ce(a,b)?a.substring(0,a.length-b.length):a},Cb=function(a,b){return-1!==a.indexOf(b)},qq=function(a){return LX(a).bind(function(b){return MX(a).map(function(a){return b.toUpperCase()+a})}).getOr(a)},Ab=function(a,b){return fz(a,
b,0)},ce=function(a,b){return fz(a,b,a.length-b.length)},dh=function(a){return a.replace(/^\s+|\s+$/g,"")},rq=/.*?version\/ ?([0-9]+)\.([0-9]+).*/,yf=function(a){return function(b){return Cb(b,a)}},NX=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(a){return Cb(a,"edge/")&&Cb(a,"chrome")&&Cb(a,"safari")&&Cb(a,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,rq],search:function(a){return Cb(a,"chrome")&&!Cb(a,"chromeframe")}},{name:"IE",
versionRegexes:[/.*?msie ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(a){return Cb(a,"msie")||Cb(a,"trident")}},{name:"Opera",versionRegexes:[rq,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:yf("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/ ?([0-9]+)\.([0-9]+).*/],search:yf("firefox")},{name:"Safari",versionRegexes:[rq,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(a){return(Cb(a,"safari")||Cb(a,"mobile/"))&&Cb(a,"applewebkit")}}],OX=[{name:"Windows",search:yf("win"),
versionRegexes:[/.*?windows nt ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(a){return Cb(a,"iphone")||Cb(a,"ipad")},versionRegexes:[/.*?version\/ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:yf("android"),versionRegexes:[/.*?android ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:yf("os x"),versionRegexes:[/.*?os x ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:yf("linux"),versionRegexes:[]},{name:"Solaris",search:yf("sunos"),
versionRegexes:[]},{name:"FreeBSD",search:yf("freebsd"),versionRegexes:[]}],gz={browsers:k(NX),oses:k(OX)},PX={detect:function(a){var b=gz.browsers(),c=gz.oses();b=ez.detectBrowser(b,a).fold(JX,bz);c=ez.detectOs(c,a).fold(KX,cz);var d=c.isiOS()&&!0===/ipad/i.test(a),e=c.isiOS()&&!d,f=c.isAndroid()&&3===c.version.major,h=c.isAndroid()&&4===c.version.major;f=d||f||h&&!0===/mobile/i.test(a);var l=(h=c.isiOS()||c.isAndroid())&&!f;a=b.isSafari()&&c.isiOS()&&!1===/safari/i.test(a);a={isiPad:k(d),isiPhone:k(e),
isTablet:k(f),isPhone:k(l),isTouch:k(h),isAndroid:c.isAndroid,isiOS:c.isiOS,isWebView:k(a)};return{browser:b,os:c,deviceType:a}}},ba={detect:Xb(function(){return PX.detect(navigator.userAgent)})},hz=function(a,b){return a.dom()===b.dom()},QX=function(a,b){a=a.dom();b=b.dom();return a===b?!1:a.contains(b)},RX=function(a,b){return Sk.documentPositionContainedBy(a.dom(),b.dom())},SX=ba.detect().browser.isIE()?RX:QX,P={eq:hz,isEqualNode:function(a,b){return a.dom().isEqualNode(b.dom())},member:function(a,
b){return Va(b,t(hz,a))},contains:SX,is:za.is},iz=function(a){a=a.dom().body;if(null===a||void 0===a)throw"Body is not available yet";return p.fromDom(a)},fa={body:Xb(function(){return iz(p.fromDom(document))}),getBody:iz,inBody:function(a){a=C.isText(a)?a.dom().parentNode:a.dom();return void 0!==a&&null!==a&&a.ownerDocument.body.contains(a)}},jz=function(a,b,c){a=a.dom();for(c=wb(c)?c:k(!1);a.parentNode;){a=a.parentNode;var d=p.fromDom(a);if(b(d))return g.some(d);if(c(d))break}return g.none()},kz=
function(a,b){return va(a.dom().childNodes,Db(b,p.fromDom)).map(p.fromDom)},lz=function(a,b){var c=function(a){for(var d=0;d<a.childNodes.length;d++){if(b(p.fromDom(a.childNodes[d])))return g.some(p.fromDom(a.childNodes[d]));var f=c(a.childNodes[d]);if(f.isSome())return f}return g.none()};return c(a.dom())},Da={first:function(a){return lz(fa.body(),a)},ancestor:jz,closest:function(a,b,c){return jv(function(a){return b(a)},jz,a,b,c)},sibling:function(a,b){var c=a.dom();return c.parentNode?kz(p.fromDom(c.parentNode),
function(c){return!P.eq(a,c)&&b(c)}):g.none()},child:kz,descendant:lz},ed={any:function(a){return Da.first(a).isSome()},ancestor:function(a,b,c){return Da.ancestor(a,b,c).isSome()},closest:function(a,b,c){return Da.closest(a,b,c).isSome()},sibling:function(a,b){return Da.sibling(a,b).isSome()},child:function(a,b){return Da.child(a,b).isSome()},descendant:function(a,b){return Da.descendant(a,b).isSome()}},M=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return function(){for(var b=
[],d=0;d<arguments.length;d++)b[d]=arguments[d];if(a.length!==b.length)throw Error('Wrong number of arguments to struct. Expected "['+a.length+']", got '+b.length+" arguments");var e={};A(a,function(a,c){e[a]=k(b[c])});return e}},mz=function(a,b){throw Error("All required keys ("+a.slice(0).sort().join(", ")+") were not specified. Specified keys were: "+b.slice(0).sort().join(", ")+".");},nz=function(a){throw Error("Unsupported keys for object: "+a.slice(0).sort().join(", "));},sq=function(a,b){if(!Gb(b))throw Error("The "+
a+" fields must be an array. Was: "+b+".");A(b,function(b){if(!ta(b))throw Error("The value "+b+" in the "+a+" fields was not a string.");})},oz=function(a){var b=a.slice(0).sort();va(b,function(a,d){return d<b.length-1&&a===b[d+1]}).each(function(a){throw Error("The field: "+a+" occurs more than once in the combined fields: ["+b.join(", ")+"].");})},ya=function(a,b){var c=a.concat(b);if(0===c.length)throw Error("You must specify at least one required or optional field.");sq("required",a);sq("optional",
b);oz(c);return function(d){var e=jb(d);kb(a,function(a){return V(e,a)})||mz(a,e);var f=ka(e,function(a){return!V(c,a)});0<f.length&&nz(f);var h={};A(a,function(a){h[a]=k(d[a])});A(b,function(a){h[a]=k(Object.prototype.hasOwnProperty.call(d,a)?g.some(d[a]):g.none())});return h}},pz={toArray:function(a,b){var c=[],d=function(a){c.push(a);return b(a)};a=b(a);do a=a.bind(d);while(a.isSome());return c}},tq=function(a){a=a.dom();return g.from(a.parentNode).map(p.fromDom)},qz=function(a){a=a.dom();return g.from(a.previousSibling).map(p.fromDom)},
rz=function(a){a=a.dom();return g.from(a.nextSibling).map(p.fromDom)},Cl=function(a){a=a.dom();return F(a.childNodes,p.fromDom)},uq=function(a,b){a=a.dom().childNodes;return g.from(a[b]).map(p.fromDom)},sz=M("element","offset"),B={owner:function(a){return p.fromDom(a.dom().ownerDocument)},defaultView:function(a){a=a.dom().ownerDocument.defaultView;return p.fromDom(a)},documentElement:function(a){return p.fromDom(a.dom().ownerDocument.documentElement)},parent:tq,findIndex:function(a){return tq(a).bind(function(b){b=
Cl(b);return Ta(b,function(b){return P.eq(a,b)})})},parents:function(a,b){b=wb(b)?b:k(!1);var c=a.dom();for(a=[];null!==c.parentNode&&void 0!==c.parentNode;){c=c.parentNode;var d=p.fromDom(c);a.push(d);if(!0===b(d))break}return a},siblings:function(a){return tq(a).map(Cl).map(function(b){return ka(b,function(b){return!P.eq(a,b)})}).getOr([])},prevSibling:qz,offsetParent:function(a){a=a.dom();return g.from(a.offsetParent).map(p.fromDom)},prevSiblings:function(a){return Ld(pz.toArray(a,qz))},nextSibling:rz,
nextSiblings:function(a){return pz.toArray(a,rz)},children:Cl,child:uq,firstChild:function(a){return uq(a,0)},lastChild:function(a){return uq(a,a.dom().childNodes.length-1)},childNodesCount:function(a){return a.dom().childNodes.length},hasChildNodes:function(a){return a.dom().hasChildNodes()},leaf:function(a,b){var c=Cl(a);return 0<c.length&&b<c.length?sz(c[b],0):sz(a,b)}},tz=function(a){a.dom().focus()},vq=function(a){a=void 0!==a?a.dom():document;return g.from(a.activeElement).map(p.fromDom)},Y=
{hasFocus:function(a){var b=B.owner(a).dom();return a.dom()===b.activeElement},focus:tz,blur:function(a){a.dom().blur()},active:vq,search:function(a){return vq(B.owner(a)).filter(function(b){return a.dom().contains(b.dom())})},focusInside:function(a){var b=B.owner(a);vq(b).filter(function(b){return ed.closest(b,t(P.eq,a))}).fold(function(){tz(a)},u)}},Dl=function(a,b){B.parent(a).each(function(c){c.dom().insertBefore(b.dom(),a.dom())})},$i=function(a,b){a.dom().appendChild(b.dom())},y={before:Dl,
after:function(a,b){B.nextSibling(a).fold(function(){B.parent(a).each(function(a){$i(a,b)})},function(a){Dl(a,b)})},prepend:function(a,b){B.firstChild(a).fold(function(){$i(a,b)},function(c){a.dom().insertBefore(b.dom(),c.dom())})},append:$i,appendAt:function(a,b,c){B.child(a,c).fold(function(){$i(a,b)},function(a){Dl(a,b)})},wrap:function(a,b){Dl(a,b);$i(b,a)}},O={before:function(a,b){A(b,function(b){y.before(a,b)})},after:function(a,b){A(b,function(c,d){y.after(0===d?a:b[d-1],c)})},prepend:function(a,
b){A(b.slice().reverse(),function(b){y.prepend(a,b)})},append:function(a,b){A(b,function(b){y.append(a,b)})}},wq=function(a){a=a.dom();null!==a.parentNode&&a.parentNode.removeChild(a)},E={empty:function(a){a.dom().textContent="";A(B.children(a),function(a){wq(a)})},remove:wq,unwrap:function(a){var b=B.children(a);0<b.length&&O.before(a,b);wq(a)}},uz=function(a,b,c){if(ta(c)||fq(c)||df(c))a.setAttribute(b,c+"");else throw console.error("Invalid call to Attr.set. Key ",b,":: Value ",c,":: Element ",
a),Error("Attribute value was not simple");},vz=function(a,b,c){uz(a.dom(),b,c)},wz=function(a,b){a=a.dom().getAttribute(b);return null===a?void 0:a},xq=function(a,b){return(a=a.dom())&&a.hasAttribute?a.hasAttribute(b):!1},m={clone:function(a){return hb(a.dom().attributes,function(a,c){a[c.name]=c.value;return a},{})},set:vz,setAll:function(a,b){var c=a.dom();Ra(b,function(a,b){uz(c,b,a)})},get:wz,has:xq,remove:function(a,b){a.dom().removeAttribute(b)},hasNone:function(a){a=a.dom().attributes;return void 0===
a||null===a||0===a.length},transfer:function(a,b,c){C.isElement(a)&&C.isElement(b)&&A(c,function(c){xq(a,c)&&!xq(b,c)&&vz(b,c,wz(a,c))})}},ue={isSupported:function(a){return void 0!==a.style}},yq=function(a,b,c){if(!ta(c))throw console.error("Invalid call to CSS.set. Property ",b,":: Value ",c,":: Element ",a),Error("CSS value must be a string: "+c);ue.isSupported(a)&&a.style.setProperty(b,c)},zq=function(a,b,c){a=a.dom();yq(a,b,c)},xz=function(a,b){return ue.isSupported(a)?a.style.getPropertyValue(b):
""},El=function(a,b){a=a.dom();b=xz(a,b);return g.from(b).filter(function(a){return 0<a.length})},TX=function(a,b,c){El(a,c).each(function(a){El(b,c).isNone()&&zq(b,c,a)})},v={copy:function(a,b){a=a.dom();b=b.dom();ue.isSupported(a)&&ue.isSupported(b)&&(b.style.cssText=a.style.cssText)},set:zq,preserve:function(a,b){var c=m.get(a,"style");b=b(a);(void 0===c?m.remove:m.set)(a,"style",c);return b},setAll:function(a,b){var c=a.dom();Ra(b,function(a,b){yq(c,b,a)})},setOptions:function(a,b){var c=a.dom();
Ra(b,function(a,b){a.fold(function(){ue.isSupported(c)&&c.style.removeProperty(b)},function(a){yq(c,b,a)})})},remove:function(a,b){var c=a.dom();ue.isSupported(c)&&c.style.removeProperty(b);m.has(a,"style")&&""===dh(m.get(a,"style"))&&m.remove(a,"style")},get:function(a,b){var c=a.dom(),d=window.getComputedStyle(c).getPropertyValue(b);a=""!==d||fa.inBody(a)?d:xz(c,b);return null===a?void 0:a},getRaw:El,getAllRaw:function(a){var b={};a=a.dom();if(ue.isSupported(a))for(var c=0;c<a.style.length;c++){var d=
a.style.item(c);b[d]=a.style[d]}return b},isValidValue:function(a,b,c){a=p.fromTag(a);zq(a,b,c);return El(a,b).isSome()},reflow:function(a){return a.dom().offsetWidth},transfer:function(a,b,c){C.isElement(a)&&C.isElement(b)&&A(c,function(c){TX(a,b,c)})}},OO={blur:function(){var a=p.fromHtml('<input type="text" />');v.setAll(a,{"z-index":"-666",background:"transparent",border:"0px",height:"50px",position:"absolute",top:"25%",left:"50%"});y.append(p.fromDom(document.body),a);Y.focus(a);E.remove(a)}},
UX=function(a){return[Wb(a,function(a){return a()})]},EO={create:function(){var a=[];return{eventRegistry:{addListener:function(b){Jb(arguments,[X.func("handler")]);a.push(b)},removeListener:function(b){zc(a,b).each(function(b){a.splice(b,1)})}},eventTrigger:function(b){A(a,function(a){var c=UX(b);a.apply(null,c)})}}}},sk={create:function(){var a=[],b=[];return{bind:function(c,d){if(V(a,c))throw"Invalid key, key already exists.";a.push(c);b.push(d);c.bind(d)},unbind:function(c){zc(a,c).fold(function(){throw"Invalid key, does not exist.";
},function(d){a.splice(d,1);d=b.splice(d,1)[0];c.unbind(d)})},unbindAll:function(){A(a,function(a,d){a.unbind(b[d])});a.splice(0,a.length);b.splice(0,b.length)}}}},yz=function(a){Object.freeze(a);Ra(a,function(a){Zb(a)&&yz(a)});return a},uk={makeReadOnly:yz},Aq=function(a){var b=g.none(),c=[],d=function(a){e()?f(a):c.push(a)},e=function(){return b.isSome()},f=function(a){b.each(function(b){setTimeout(function(){a(b)},0)})};a(function(a){b=g.some(a);A(c,f);c=[]});return{get:d,map:function(a){return Aq(function(b){d(function(c){b(a(c))})})},
isReady:e}},Fe={nu:Aq,pure:function(a){return Aq(function(b){b(a)})}},VX=function(a){return function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];var d=this;setTimeout(function(){a.apply(d,b)},0)}},aj=function(a){var b=function(b){a(VX(b))};return{map:function(a){return aj(function(c){b(function(b){b=a(b);c(b)})})},bind:function(a){return aj(function(c){b(function(b){a(b).get(c)})})},anonBind:function(a){return aj(function(c){b(function(b){a.get(c)})})},toLazy:function(){return Fe.nu(b)},
get:b}},Ba={nu:aj,pure:function(a){return aj(function(b){b(a)})}},tk=function(a,b){return b(function(b){var c=[],e=0,f=function(d){return function(f){c[d]=f;e++;e>=a.length&&b(c)}};0===a.length?b([]):A(a,function(a,b){a.get(f(b))})})},ae=function(a,b){a=F(a,b);return tk(a,Ba.nu)},zz={install:function(a){var b=t(hq,a);hq("callbacks",b());var c=function(a){var b=void 0===a.count?0:a.count;a.count=b+1;return"callback_"+b},d=function(d,h){var f=b(),g=c(f);f.callbacks[g]=function(){h||e(g);d.apply(null,
arguments)};return a+".callbacks."+g},e=function(a){a=a.substring(a.lastIndexOf(".")+1);var c=b();void 0!==c.callbacks[a]&&delete c.callbacks[a]};return{ephemeral:function(a){return d(a,!1)},permanent:function(a){return d(a,!0)},unregister:e}}},WX=function(a,b,c,d,e,f,h){return{target:k(a),x:k(b),y:k(c),stop:d,prevent:e,kill:f,raw:k(h)}},XX=function(a,b){return function(c){if(a(c)){var d=p.fromDom(c.target),e=function(){c.stopPropagation()},f=function(){c.preventDefault()},h=Db(f,e);d=WX(d,c.clientX,
c.clientY,e,f,h,c);b(d)}}},Az=function(a,b,c,d,e){c=XX(c,d);a.dom().addEventListener(b,c,e);return{unbind:t(YX,a,b,c,e)}},YX=function(a,b,c,d){a.dom().removeEventListener(b,c,d)},Bq={bind:function(a,b,c,d){return Az(a,b,c,d,!1)},capture:function(a,b,c,d){return Az(a,b,c,d,!0)}},Bz=k(!0),J={bind:function(a,b,c){return Bq.bind(a,b,Bz,c)},capture:function(a,b,c){return Bq.capture(a,b,Bz,c)}},ZX=zz.install("ephox.henchman.features"),HO={download:function(a){return Fe.nu(function(b){var c=function(){e.unbind();
f.unbind()},d=p.fromTag("script");m.set(d,"src",a);m.set(d,"type","text/javascript");m.set(d,"async","async");m.set(d,"data-main",ZX.ephemeral(function(a){b(N.value(a))}));var e=J.bind(d,"error",function(){c();b(N.error("Error loading external script tag "+a))}),f=J.bind(d,"load",c);y.append(p.fromDom(document.head),d)})}},Cz={addStylesheet:function(a,b){var c=b||p.fromDom(document);b=p.fromTag("link",c.dom());m.setAll(b,{rel:"stylesheet",type:"text/css",href:a});a=p.fromDom(c.dom().head);y.append(a,
b);return b}},GO={download:function(a,b){return Fe.nu(function(c){var d=function(b){A(f,function(a){a.unbind()});c(b.fold(function(b){return N.error(b+'Unable to download editor stylesheets from "'+a+'"')},N.value))},e=Cz.addStylesheet(a),f=[J.bind(e,"load",function(a){a:{try{var c=a.target().dom().sheet.cssRules;var e=Zb(c)&&0===c.length;break a}catch(D){}e=!1}e?d(N.error("")):b(d)}),J.bind(e,"error",t(d,N.error("")))]})}},Dz=kv(),Fl={addStylesheet:function(a,b){return Dz.addStylesheet(a,b)},addScript:function(a,
b){return Dz.addScript(a,b)}},Gl=M("str","replace"),Ez=function(a,b){return"2.4.1"!==a?g.some(b+(void 0===a?"":" version "+a)+" appears to be cached, as it does not match editor version 2.4.1."):g.none()},pf={aboutTags:function(a,b){var c=[Gl("@@FULL_VERSION@@","2.4.1.70"),Gl("@@CLIENT_VERSION@@","2.4.1.130")];a=a?[Gl("@@INTEGRATION_TYPE@@",b.type),Gl("@@INTEGRATION_VERSION@@",b.version)]:[];return Kb([c,a])},strictMatch:Ez,weakMatch:function(a,b){return Ez(a,b).map(function(a){return a+" This may produce unexpected results."})},
resourceParam:k("version=2.4.1"),fullParam:k("version=2.4.1.70")},Ga=function(a){var b=a;return{get:function(){return b},set:function(a){b=a},clone:function(){return Ga(b)}}},$X=function(a){a.each(function(a){pf.weakMatch(a.version,"Code view").each(function(a){console.warn(a)});Fz.set(a.codemirror());Gz.set(a.jsbeautify())});return a},Fz=Ga(null),Gz=Ga(null),vk={use:{codemirror:Fz.get,jsbeautify:Gz.get},load:{codeview:function(a){a=a+"/codeview.js?"+pf.resourceParam();return Fl.addScript(a,$X)}}},
uv={beautify:function(a){return vk.use.jsbeautify().html(a,{indent_size:"2",indent_char:" ",max_preserve_newlines:"5",preserve_newlines:!0,keep_array_indentation:!1,break_chained_methods:!1,indent_scripts:"normal",brace_style:"collapse",space_before_conditional:!0,unescape_strings:!1,jslint_happy:!1,end_with_newline:!1,wrap_line_length:0,indent_inner_html:!1,comma_first:!1,e4x:!1})}},aY=function(a){return a.map(function(a){return a.dom()}).getOr(null)},ld={documentElement:function(a){if(a.content().isInline())throw Error("documentElement called on inline mode");
return aY(a.content().doc())},insertHtmlAtCursor:function(a,b){Jb(arguments,[X.object("polish"),X.string("html")]);a.content().focus();a.insertHtmlAtCursor(b)},uploadImages:function(a,b){Jb(arguments,[X.object("polish"),X.func("callback")]);return a.uploadImages(b)},get:function(a){var b=null!==vk.use.jsbeautify()&&a.isPrettyPrinting();a=a.getContent();return b?uv.beautify(a):a},set:function(a,b){Jb(arguments,[X.object("polish"),X.string("html")]);a.setContent(b)},isDirty:function(a){Jb(arguments,
[X.object("polish")]);return a.isDirty()},setDirty:function(a,b){Jb(arguments,[X.object("polish"),X.bool("state")]);a.setDirty(b)}},sa={generate:function(a){if(!Gb(a))throw Error("cases must be an array");if(0===a.length)throw Error("there must be at least one case");var b=[],c={};A(a,function(d,e){var f=jb(d);if(1!==f.length)throw Error("one and only one name per case");var h=f[0],l=d[h];if(void 0!==c[h])throw Error("duplicate key detected:"+h);if("cata"===h)throw Error("cannot have a case named cata (sorry)");
if(!Gb(l))throw Error("case arguments must be an array");b.push(h);c[h]=function(){var c=arguments.length;if(c!==l.length)throw Error("Wrong number of arguments to case "+h+". Expected "+l.length+" ("+l+"), got "+c);var d=Array(c);for(c=0;c<d.length;c++)d[c]=arguments[c];return{fold:function(){if(arguments.length!==a.length)throw Error("Wrong number of arguments to fold. Expected "+a.length+", got "+arguments.length);return arguments[e].apply(null,d)},match:function(a){var c=jb(a);if(b.length!==c.length)throw Error("Wrong number of arguments to match. Expected: "+
b.join(",")+"\nActual: "+c.join(","));if(!kb(b,function(a){return V(c,a)}))throw Error("Not all branches were specified when using match. Specified: "+c.join(", ")+"\nRequired: "+b.join(", "));return a[h].apply(null,d)},log:function(a){console.log(a,{constructors:b,constructor:h,params:d})}}}});return c}},bY=sa.generate([{inputSelector:["selector","callback"]},{outputSelector:["selector","callback"]},{inputPredicate:["predicate","callback"]},{outputPredicate:["predicate","callback"]}]),ei=ra(bY,{cata:function(a,
b,c,d,e){return a.fold(b,c,d,e)}}),lv=function(a){return function(b){b=F(b,function(a){return a.dom()});a(b)}},JO=function(a){return function(b){return a(b.dom())}},fb=function(){return"\ufeff"},Cq="\\w'\\-\\u0100-\\u017F\\u00C0-\\u00FF"+fb()+"\\u2018\\u2019",cY="[^"+Cq+"]",dY="["+Cq+"]",bj={chars:k(Cq),wordbreak:k(cY),wordchar:k(dY)},Hl={token:function(a){return Eo(a,k(0),k(0),g.none())},word:function(a){a="((?:^'?)|(?:"+bj.wordbreak()+"+'?))"+a+"((?:'?$)|(?:'?"+bj.wordbreak()+"+))";return Eo(a,
function(a){return 1<a.length?a[1].length:0},function(a){return 2<a.length?a[2].length:0},g.none())}},Dq=function(a){return a.replace(/[-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},Eq={sanitise:Dq,word:function(a){a=Dq(a);return Hl.word(a)},token:function(a){a=Dq(a);return Hl.token(a)}},sb={safeword:function(a){return Eq.word(a)},safetoken:function(a){return Eq.token(a)},custom:function(a,b,c,d){return Eo(a,b,c,d)},unsafeword:function(a){return Hl.word(a)},unsafetoken:function(a){return Hl.token(a)},sanitise:function(a){return Eq.sanitise(a)},
chars:function(){return bj.chars()},wordbreak:function(){return bj.wordbreak()},wordchar:function(){return bj.wordchar()}},Ac=function(a,b){return Hz(a,b,{validate:wb,label:"function"})},Hz=function(a,b,c){if(0===b.length)throw Error("You must specify at least one required field.");sq("required",b);oz(b);return function(d){var e=jb(d);kb(b,function(a){return V(e,a)})||mz(b,e);a(b,e);var f=ka(b,function(a){return!c.validate(d[a],a)});if(0<f.length)throw Error("All values need to be of type: "+c.label+
". Keys ("+f.slice(0).sort().join(", ")+") were not.");return d}},Qd=function(a,b){b=ka(b,function(b){return!V(a,b)});0<b.length&&nz(b)},eh=u,Il=function(a,b){return Hz(eh,a,b)},eY=Ac(eh,["elements","cursor","dictation","notify"]),fY=Ac(eh,["elements","cursor","dictation","range","notify"]),Gd={species:eY,applicator:fY},te={fromHtml:function(a,b){b=(b||document).createElement("div");b.innerHTML=a;return B.children(p.fromDom(b))},fromTags:function(a,b){return F(a,function(a){return p.fromTag(a,b)})},
fromText:function(a,b){return F(a,function(a){return p.fromText(a,b)})},fromDom:function(a){return F(a,p.fromDom)}},pv={addSimpleMacro:function(a,b,c,d){Jb(arguments,[X.object("polish"),X.string("startString"),X.string("endString"),X.func("callback")]);var e=mv(b,c,d);return a.macros().customMacros().add(e)},removeMacro:function(a,b){a.macros().customMacros().remove(b)}},Iz=["error","info","warning"],NO={message:function(a,b,c,d){if(!V(Iz,b))throw'Message level: "'+b+'" is not supported. Supported levels are: ['+
Iz.join(", ")+"].";Jb(arguments,[X.object("polish"),X.string("level"),X.number("timeout"),X.string("msg")]);var e=a.ui().showMessage(b,c,d);return{hide:function(){e()}}}},gY=k("pencil"),hY=k("code"),iY=k("spin"),jY=k("none"),Yb={pencil:gY,code:hY,wait:iY,none:jY},ov={get:function(a){return a.getMode()===Yb.pencil()?"design":"code"},set:function(a,b){Jb(arguments,[X.object("polish"),X.string("mode")]);var c=b.toLowerCase();if("code"!==c&&"design"!==c)throw Error('Editor mode "'+b+'" not supported. Must be either design or code.');
a.setMode("design"===c?Yb.pencil():Yb.code())}},LO="body p div article aside figcaption figure footer header nav section ol ul li table thead tbody tfoot caption tr td th h1 h2 h3 h4 h5 h6 blockquote pre address".split(" "),Fq=function(a,b){var c=[];A(B.children(a),function(a){b(a)&&(c=c.concat([a]));c=c.concat(Fq(a,b))});return c},Cc={all:function(a){return Fq(fa.body(),a)},ancestors:function(a,b,c){return ka(B.parents(a,c),b)},siblings:function(a,b){return ka(B.siblings(a),b)},children:function(a,
b){return ka(B.children(a),b)},descendants:Fq},ca={all:function(a){return za.all(a)},ancestors:function(a,b,c){return Cc.ancestors(a,function(a){return za.is(a,b)},c)},siblings:function(a,b){return Cc.siblings(a,function(a){return za.is(a,b)})},children:function(a,b){return Cc.children(a,function(a){return za.is(a,b)})},descendants:function(a,b){return za.all(b,a)}},Jz=function(a,b,c){return Da.ancestor(a,function(a){return za.is(a,b)},c)},L={first:function(a){return za.one(a)},ancestor:Jz,sibling:function(a,
b){return Da.sibling(a,function(a){return za.is(a,b)})},child:function(a,b){return Da.child(a,function(a){return za.is(a,b)})},descendant:function(a,b){return za.one(b,a)},closest:function(a,b,c){return jv(za.is,Jz,a,b,c)}},Gq=nv(C.isText,"text"),Oa={get:function(a){return Gq.get(a)},getOption:function(a){return Gq.getOption(a)},set:function(a,b){Gq.set(a,b)}},kY=M("element","offset"),lY=M("element","deltaOffset"),mY=M("element","start","finish"),nY=M("begin","end"),oY=M("element","text"),W={point:kY,
delta:lY,range:mY,points:nY,text:oY},Jl=k(!1),pY=k(!0),Hq=function(a){return{isBoundary:function(){return a(pY,Jl,Jl)},fold:a,toText:function(){return a(g.none,g.none,function(a,c){return g.some(a)})},is:function(b){return a(Jl,Jl,function(a,d){return d.eq(a,b)})},len:function(){return a(k(0),k(1),function(a,c){return c.property().getText(a).length})}}},Kl={text:function(a,b){return Hq(function(c,d,e){return e(a,b)})},boundary:function(a,b){return Hq(function(c,d,e){return c(a,b)})},empty:function(a,
b){return Hq(function(c,d,e){return d(a,b)})},cata:function(a,b,c,d){return a.fold(b,c,d)}},qY={boundAt:function(a,b,c,d){b=Ta(a,t(d,b)).getOr(0);c=Ta(a,t(d,c)).map(function(a){return a+1}).getOr(a.length);return a.slice(b,c)}},rY={sliceby:function(a,b){b=Ta(a,b).getOr(-1);return a.slice(0,b)}},Iq=sa.generate([{include:["item"]},{excludeWith:["item"]},{excludeWithout:["item"]}]),fh={include:Iq.include,excludeWith:Iq.excludeWith,excludeWithout:Iq.excludeWithout,cata:function(a,b,c,d){return a.fold(b,
c,d)}},Kz=function(a,b){var c=[],d=[];A(a,function(a){var e=b(a);fh.cata(e,function(){d.push(a)},function(){0<d.length&&c.push(d);c.push([a]);d=[]},function(){0<d.length&&c.push(d);d=[]})});0<d.length&&c.push(d);return c},Lz={splitby:function(a,b){return Kz(a,function(a){return b(a)?fh.excludeWithout(a):fh.include(a)})},splitbyAdv:Kz},Mz={splitby:function(a,b){return Lz.splitby(a,b)},splitbyAdv:function(a,b){return Lz.splitbyAdv(a,b)},sliceby:function(a,b){return rY.sliceby(a,b)},boundAt:function(a,
b,c,d){return qY.boundAt(a,b,c,d)}},Ll={count:function(a){return zb(a,function(a,c){return c.len()+a},0)},dropUntil:function(a,b){return Mz.sliceby(a,function(a){return a.is(b)})},gen:function(a,b){return a.fold(g.none,function(a){return g.some(W.range(a,b,b+1))},function(c){return g.some(W.range(c,b,b+a.len()))})},justText:function(a){return ia(a,function(a){return a.fold(k([]),k([]),function(a){return[a]})})}},Ml=function(a,b,c){if(a.property().isText(b))return[Kl.text(b,a)];if(a.property().isEmptyTag(b))return[Kl.empty(b,
a)];if(a.property().isElement(b)){var d=a.property().children(b),e=a.property().isBoundary(b)?[Kl.boundary(b,a)]:[];b=void 0!==c&&c(b)?[]:ia(d,function(b){return Ml(a,b,c)});return e.concat(b).concat(e)}return[]},Nz=function(a,b,c,d,e){a=Ml(a,d,e);b=Ll.dropUntil(a,b);b=Ll.count(b);return W.point(d,b+c)},gh={typed:Ml,items:function(a,b,c){a=Ml(a,b,c);var d=function(a,b){return a};return F(a,function(a){return a.fold(d,d,d)})},extractTo:function(a,b,c,d,e){return a.up().predicate(b,d).fold(function(){return W.point(b,
c)},function(d){return Nz(a,b,c,d,e)})},extract:function(a,b,c,d){return a.property().parent(b).fold(function(){return W.point(b,c)},function(e){return Nz(a,b,c,e,d)})}},sY=function(a,b){return"img"===b.property().name(a)?" ":"\n"},tY={from:function(a,b,c){b=gh.typed(a,b,c);return F(b,function(b){return b.fold(k("\n"),sY,a.property().getText)}).join("")}},uY={make:function(a,b,c){return hb(a,function(a,c){return b(c,a.len).fold(k(a),function(b){return{len:b.finish(),list:a.list.concat([b])}})},{len:void 0!==
c?c:0,list:[]}).list}},Oz=function(a,b){return b>=a.start()&&b<=a.finish()},Pz=function(a,b){return Ta(a,function(a){return a.start()===b})},vY=function(a,b){return a[a.length-1]&&a[a.length-1].finish()===b?a.length+1:-1},Nl={get:function(a,b){return va(a,function(a){return Oz(a,b)})},find:function(a,b){return va(a,b)},inUnit:Oz,sublist:function(a,b,c){b=Pz(a,b);var d=Pz(a,c);return b.bind(function(b){var e=d.getOr(vY(a,c));return-1<e?g.some(a.slice(b,e)):g.none()}).getOr([])}},Qz={translate:function(a,
b){return F(a,function(a){return ra(a,{start:k(a.start()+b),finish:k(a.finish()+b)})})}},wY=function(a,b,c){b=c(a,b);return Qz.translate(b,a.start())},xY={splits:function(a,b,c){return 0===b.length?a:ia(a,function(a){var d=ia(b,function(b){return Nl.inUnit(a,b)?[b-a.start()]:[]});return 0<d.length?wY(a,d,c):[a]})}},zd={generate:function(a,b,c){return uY.make(a,b,c)},get:function(a,b){return Nl.get(a,b)},find:function(a,b){return Nl.find(a,b)},splits:function(a,b,c){return xY.splits(a,b,c)},translate:function(a,
b){return Qz.translate(a,b)},sublist:function(a,b,c){return Nl.sublist(a,b,c)}},yY={find:function(a,b,c,d){a=gh.typed(a,b,d);a=zd.generate(a,Ll.gen);return zd.get(a,c).map(function(a){return W.point(a.element(),c-a.start())})}},zf={extract:function(a,b,c,d){return gh.extract(a,b,c,d)},extractTo:function(a,b,c,d,e){return gh.extractTo(a,b,c,d,e)},all:function(a,b,c){return gh.items(a,b,c)},from:function(a,b,c){return gh.typed(a,b,c)},find:function(a,b,c,d){return yY.find(a,b,c,d)},toText:function(a,
b,c){return tY.from(a,b,c)}},hh=gb(),ah={extract:function(a,b,c){return zf.extract(hh,a,b,c)},extractTo:function(a,b,c,d){return zf.extractTo(hh,a,b,c,d)},all:function(a,b){return zf.all(hh,a,b)},from:function(a,b){return zf.from(hh,a,b)},find:function(a,b,c){return zf.find(hh,a,b,c)},toText:function(a,b){return zf.toText(hh,a,b)}},Rz=function(a){var b=Object.create(null);Ra(a,function(a,d){b[d]=a});return b},zY=Rz({img:!0,br:!0,hr:!0,input:!0}),AY=Rz({script:!0,style:!0,noscript:!0}),BY=/[<>&\u00A0]/g,
CY={"<":"&lt;",">":"&gt;","&":"&amp;","\u00a0":"&nbsp;"},DY=/["<>&]/g,EY={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;"},Sz=function(a,b,c){return a.replace(b,function(a){return c[a]||a})},Tz=function(a){for(var b="",c=0;c<a.length;c++){var d=a[c];d.specified&&"_moz_dirty"!==d.name&&(b+=" "+d.name+'="'+Sz(d.value,DY,EY)+'"')}return b},Vz=function(a){var b="";A(a,function(a){b+=Uz(a)});return b},FY=function(a){var b="";A(a,function(a){b+=a.textContent});return b},Uz=function(a){var b=a.nodeType;if(b===
Xi){b=a.nodeName.toLowerCase();var c=a.childNodes;a=a.attributes;0===c.length&&zY[b]?b="<"+b+Tz(a)+" />":(c=AY[b]?FY(c):Vz(c),b="<"+b+Tz(a)+">"+c+"</"+b+">");return b}if(b===Zy)return Sz(a.textContent,BY,CY);if(b==Yy)return"\x3c!--"+a.data+"--\x3e";throw"unsupported node type "+a.nodeType;},Ol={writeNode:function(a){if(!Zb(a))throw"sugarNode parameter must be an object";return Uz(a.dom())},writeChildren:function(a){if(!Zb(a))throw"sugarNode parameter must be an object";return Vz(a.dom().childNodes)}},
Wz=function(a){var b=new RegExp(fb(),"g");return a.replace(b,"")},Oi={output:function(a,b){a.filterDom(a.output(),b);a=Ol.writeChildren(b);return Wz(a)},zeroWidth:Wz},Pl={toText:function(a){a=F(a,function(a){return ah.toText(a,k(!1))}).join("");return Oi.zeroWidth(a.trim())},toHtml:function(a){a=F(a,Ol.writeNode).join("");return Oi.zeroWidth(a)}},Xz=function(a){return a.dom().innerHTML},Ca={get:Xz,set:function(a,b){var c=B.owner(a).dom(),d=p.fromDom(c.createDocumentFragment());b=te.fromHtml(b,c);
O.append(d,b);E.empty(a);y.append(a,d)},getOuter:function(a){var b=p.fromTag("div");a=p.fromDom(a.dom().cloneNode(!0));y.append(b,a);return Xz(b)}},Mb={get:function(a){return a.dom().textContent},set:function(a,b){a.dom().textContent=b}},Yz=function(a,b){return uk.makeReadOnly({getAttributes:function(){return uk.makeReadOnly(a.getFilteredAttributes(b))},setAttributes:function(c){Jb(arguments,[X.object("attributes")]);Ra(c,function(a,b){if(!ta(a))throw Error("attribute key "+b+" does not have a string value: "+
a);});m.setAll(b,c);a.domChanged();a.undoChanged()},getText:function(){return Pl.toText([b])},setText:function(a){Jb(arguments,[X.string("text")]);Mb.set(b,a)},getHtml:function(){return a.getFilteredContents(b)},setHtml:function(a){Jb(arguments,[X.string("html")]);Ca.set(b,a)},replaceElement:function(c){Jb(arguments,[X.string("html")]);var d=te.fromHtml(c);if(1!==d.length)throw Error("replacement html must be a single node");d=d[0];a.replaceElement(b,d);return Yz(a,d)}})},Fo={getText:function(a){return a.content().getSelectedText().getOr("")},
getHtml:function(a){return a.content().getSelectedHtml().getOr("")},findTagAtCursor:function(a,b){var c=a.content();return c.findTagAtCursor(b).map(function(a){return Yz(c,a)}).getOr(null)}},Zz={},$z=function(a){return g.from(Zz[a])},Go={get:$z,register:function(a,b){return Zz[a]=b},hookup:function(a,b){$z(b).fold(function(){console&&console.error&&console.error('textbox.io Could not find plugin "'+b+'". Have you declared it?')},function(b){a.events.loaded.addListener(function(){b.initialize(a)})})}},
aA={attached:function(a,b){b=b||p.fromDom(document.documentElement);return Da.ancestor(a,t(P.eq,b)).isSome()},windowOf:function(a){var b=a.dom();return b===b.window&&a instanceof Window?a:C.isDocument(a)?b.defaultView||b.parentWindow:null}},bA=function(a,b){return{left:k(a),top:k(b),translate:function(c,d){return bA(a+c,b+d)}}},Ma=bA,Ql=function(a,b){return void 0!==a?a:void 0!==b?b:0},cA=function(a){var b=a.dom(),c=b.ownerDocument,d=c.body;c=p.fromDom(c.documentElement);if(d===b)return Ma(d.offsetLeft,
d.offsetTop);if(!aA.attached(a,c))return Ma(0,0);a=b.getBoundingClientRect();return Ma(a.left,a.top)},Wa={absolute:function(a){var b=a.dom().ownerDocument,c=b.body,d=aA.windowOf(p.fromDom(b)),e=b.documentElement;b=Ql(d.pageYOffset,e.scrollTop);d=Ql(d.pageXOffset,e.scrollLeft);var f=Ql(e.clientTop,c.clientTop);c=Ql(e.clientLeft,c.clientLeft);return cA(a).translate(d-c,b-f)},relative:function(a){a=a.dom();return Ma(a.offsetLeft,a.offsetTop)},viewport:cA},GY=ba.detect().browser.isSafari(),Rl=function(a){a=
void 0!==a?a.dom():document;return Ma(a.body.scrollLeft||a.documentElement.scrollLeft,a.body.scrollTop||a.documentElement.scrollTop)},Sl=function(a,b,c){(void 0!==c?c.dom():document).defaultView.scrollTo(a,b)},Jq=function(a,b){GY&&wb(a.dom().scrollIntoViewIfNeeded)?a.dom().scrollIntoViewIfNeeded(!1):a.dom().scrollIntoView(b)},Pa={get:Rl,to:Sl,by:function(a,b,c){(void 0!==c?c.dom():document).defaultView.scrollBy(a,b)},preserve:function(a,b){var c=Rl(a);b();b=Rl(a);c.top()===b.top()&&c.left()===b.left()||
Sl(c.left(),c.top(),a)},capture:function(a){var b=g.none(),c=function(){b=g.some(Rl(a))};c();return{save:c,restore:function(){b.each(function(b){Sl(b.left(),b.top(),a)})}}},intoView:Jq,intoViewIfNeeded:function(a,b){b=b.dom().getBoundingClientRect();var c=a.dom().getBoundingClientRect();c.top<b.top?Jq(a,!0):c.bottom>b.bottom&&Jq(a,!1)},setToElement:function(a,b){b=Wa.absolute(b);a=p.fromDom(a.document);Sl(b.left(),b.top(),a)},scrollBarWidth:function(){var a=p.fromHtml('<div style="width: 100px; height: 100px; overflow: scroll; position: absolute; top: -9999px;"></div>');
y.after(fa.body(),a);var b=a.dom().offsetWidth-a.dom().clientWidth;E.remove(a);return b}},dA={withOptions:function(a,b){return m.has(a,"tabindex")?cb(b,{content:{tabindex:m.get(a,"tabindex")}}):b}},eA=ba.detect(),HY=eA.browser.isIE()&&10===eA.browser.version.major,Kq=function(a,b){var c=v.getRaw(a,b).getOrThunk(function(){return v.get(a,b)});return HY&&"0px"===c?"auto":c},cj=function(a,b,c){a=Kq(a,b);return void 0===a?c:g.some(a)},IY=function(a){return{width:cj(a,"width",g.none()),"max-width":cj(a,
"max-width",g.some("none")),"min-width":cj(a,"min-width",g.some("none")),"max-height":cj(a,"max-height",g.some("none")),"min-height":cj(a,"min-height",g.some("1em"))}},Tl=function(a,b,c){var d=v.getRaw(b,"display"),e=Kq(b,"height");v.set(b,"display","none");var f=Kq(b,"height"),h=IY(b);d.fold(function(){v.remove(b,"display")},function(a){v.set(b,"display",a)});Ra(h,function(a,b){a.each(function(a){v.set(c,b,a)})});d="auto"===f?e:f;void 0!==d&&(!0===a?(v.set(c,"min-height",d),v.remove(c,"height")):
v.set(c,"height",d));v.set(c,"display","flex")},JY=t(Tl,!1),KY=t(Tl,!0),LY=function(a){Tl(!1,a,a)},MY=function(a){Tl(!0,a,a)},fA=function(a){return a.replace(/\./g,"-")},Hb={create:function(a){var b=fA(a);return{resolve:function(a){a=a.split(" ");return F(a,function(a){return b+"-"+a}).join(" ")}}},cssNamespace:fA,cssClass:function(a,b){return a+"-"+b}},gA=Hb.create("ephox-elder"),Ul={resolve:gA.resolve,scrollable:t(gA.resolve,"scrollable")},Lq=function(a,b){a=m.get(a,b);return void 0===a||""===a?
[]:a.split(" ")},Ae={read:Lq,add:function(a,b,c){c=Lq(a,b).concat([c]);m.set(a,b,c.join(" "));return!0},remove:function(a,b,c){var d=ka(Lq(a,b),function(a){return a!==c});0<d.length?m.set(a,b,d.join(" ")):m.remove(a,b);return!1}},hA=function(a){return Ae.read(a,"class")},iA=function(a,b){return Ae.add(a,"class",b)},jA=function(a,b){return Ae.remove(a,"class",b)},Xc={get:hA,add:iA,remove:jA,toggle:function(a,b){return V(hA(a),b)?jA(a,b):iA(a,b)},supports:function(a){return void 0!==a.dom().classList}},
kA=function(a,b){return Xc.supports(a)&&a.dom().classList.contains(b)},n={add:function(a,b){Xc.supports(a)?a.dom().classList.add(b):Xc.add(a,b)},remove:function(a,b){Xc.supports(a)?a.dom().classList.remove(b):Xc.remove(a,b);0===(Xc.supports(a)?a.dom().classList:Xc.get(a)).length&&m.remove(a,"class")},toggle:function(a,b){return Xc.supports(a)?a.dom().classList.toggle(b):Xc.toggle(a,b)},toggler:function(a,b){var c=Xc.supports(a),d=a.dom().classList;return Ho(function(){c?d.remove(b):Xc.remove(a,b)},
function(){c?d.add(b):Xc.add(a,b)},kA(a,b))},has:kA},ja={add:function(a,b){A(b,function(b){n.add(a,b)})},remove:function(a,b){A(b,function(b){n.remove(a,b)})},toggle:function(a,b){A(b,function(b){n.toggle(a,b)})},hasAll:function(a,b){return kb(b,function(b){return n.has(a,b)})},hasAny:function(a,b){return Va(b,function(b){return n.has(a,b)})},get:function(a){if(Xc.supports(a)){a=a.dom().classList;for(var b=Array(a.length),c=0;c<a.length;c++)b[c]=a.item(c);a=b}else a=Xc.get(a);return a}},Ue={addClass:function(a){return function(b){n.add(b,
a)}},removeClass:function(a){return function(b){n.remove(b,a)}},removeClasses:function(a){return function(b){ja.remove(b,a)}},hasClass:function(a){return function(b){return n.has(b,a)}}},Vl=g.none(),lA=Ul.resolve("modal-scroll-lock"),mA=function(a,b){A(b,function(b){a(b)})},NY=t(mA,Ue.addClass(lA)),OY=t(mA,Ue.removeClass(lA)),De=function(a,b){var c=null,d=null;return{cancel:function(){null!==c&&(clearTimeout(c),d=c=null)},throttle:function(){for(var e=[],f=0;f<arguments.length;f++)e[f]=arguments[f];
d=e;null===c&&(c=setTimeout(function(){a.apply(null,d);d=c=null},b))}}},pi=function(a,b){var c=null;return{cancel:function(){null!==c&&(clearTimeout(c),c=null)},throttle:function(){for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];null!==c&&clearTimeout(c);c=setTimeout(function(){a.apply(null,d);c=null},b)}}},G={create:function(a){var b=Wb(a,function(a){return{bind:a.bind,unbind:a.unbind}});a=Wb(a,function(a){return a.trigger});return{registry:b,trigger:a}}},Ic={register:function(a){n.add(a,
Ul.scrollable())},deregister:function(a){n.remove(a,Ul.scrollable())},scrollable:Ul.scrollable,preserve:Pa.preserve,capture:Pa.capture,block:function(){if(Vl.isNone()){var a=Pa.get(),b=J.bind(p.fromDom(window),"scroll",function(b){b=Pa.get();b.left()===a.left()&&b.top()===a.top()||window.scrollTo(a.left(),a.top())});Vl=g.some(b)}},unblock:function(){Vl.each(function(a){a.unbind();Vl=g.none()})},lock:NY,unlock:OY,event:function(a){var b=!1,c=G.create({started:q([]),stopped:q([])}),d=pi(function(){!0===
b&&(b=!1,c.trigger.stopped())},250),e=J.bind(a,"scroll",function(){!1===b&&c.trigger.started();b=!0;d.throttle()});return{events:c.registry,destroy:function(){e.unbind()},isScrolling:function(){return b}}}},Te={isEmpty:function(a){return null===a||void 0===a||""===a||Gb(a)&&0===a.length}},Wl=kv(),Mq={preload:function(){Wl.preload()},addStylesheet:function(a,b){return Wl.addStylesheet(a,b)},addScript:function(a,b){return Wl.addScript(a,b)},waitForLoad:function(){return Wl.waitForLoad()}},nA=function(){return{zh_hk:"zh_tw",
iw:"he",no:"nb",nn:"nb",en:"en",ar:"ar",ca:"ca",cs:"cs",da:"da",de:"de",el:"el",es:"es",fa:"fa",fi:"fi",fr:"fr",he:"he",hr:"hr",hu:"hu",it:"it",ja:"ja",kk:"kk",ko:"ko",nl:"nl",nb:"nb",pl:"pl",pt:"pt",pt_pt:"pt_pt",ro:"ro",ru:"ru",sl:"sl",sk:"sk",sv:"sv",th:"th",tr:"tr",uk:"uk",zh:"zh",zh_tw:"zh_tw"}},oA=function(a){a=a.toLowerCase().replace("-","_");var b=a.indexOf(";");a=-1<b?a.substring(0,b):a;a=dh(a);b=a.indexOf("_");b=-1<b?a.substring(0,b):a;return{full:a,languageCode:b}},pA=function(a,b){a=a.split(",");
a=F(a,function(a){a=oA(a);return b[a.full]||b[a.languageCode]||""});return va(a,function(a){return""!==a})},Nq={extract:oA,determine:function(a){var b=nA();return pA(a,b)},determineFrom:pA,localeList:nA},Td=function(a){for(var b=[],c=function(a){b.push(a)},d=0;d<a.length;d++)a[d].each(c);return b},oc=function(a,b){for(var c=0;c<a.length;c++){var d=b(a[c],c);if(d.isSome())return d}return g.none()},qA=function(){var a=lg("navigator")||{};return a.userLanguage||a.language||"en"}(),rA=g.none(),Le={determine:function(a){var b=
void 0!==a?[a,qA]:[qA];return oc(b,Nq.determine).fold(function(){console.warn("WARNING: locales not supported: "+b.join(", "));return"en"},aa)},get:function(){return rA.getOrDie("locale used before it has been set")},set:function(a){rA=g.from(a)}},PY={font:{arial:"Arial",courier:"Courier New",comicsans:"Comic Sans MS",consolas:"Consolas",georgia:"Georgia",impact:"Impact",tahoma:"Tahoma",timesnr:"Times New Roman",trebuchet:"Trebuchet MS",verdana:"Verdana"},error:{duplicate:{code:"That snippet code is already taken.",
uuid:"That snippet uuid is already taken."},unknown:{uuid:"The snippet uuid cannot be found"},code:{duplicate:"That snippet code is already taken."}},cog:{login:"Log in",logout:"Log out","not-logged-in":"Not logged in",user:"User: {0}"},banner:{"logged-in":"Logged in as: {0}"}},sA={},tA="",Oq={},uA=function(a){return lg(a,Oq)||lg(a,sA)||lg(a,PY)},og={loadEnglish:function(a){sA=a},load:function(a,b){tA=a;Oq=b;Le.set(a)},isLoaded:function(a){return tA===a&&0<jb(Oq).length},get:function(a){var b=uA(a);
if(ta(b))return b;throw Error("key "+a+" does not exist");},has:function(a){if(!ta(a))throw a.fold?console.error("object details were",a.fold(aa,aa,aa)):console.error("object key was",a),"key was an object";return ta(uA(a))}},Pq=g.none(),Qq={set:function(a){Pq.fold(function(){Pq=g.some(a)},function(b){b!==a&&console.error('Only one base URL supported per page. Requested value "'+a+'", already using "'+b+'"')})},get:function(){return Pq.getOrDie("Must begin loading with a base URL")}},QY={execute:function(a){if("complete"===
document.readyState||"interactive"===document.readyState)a();else var b=J.bind(p.fromDom(document),"DOMContentLoaded",function(){a();b.unbind()})}},Xl=qv("width",function(a){return a.dom().offsetWidth}),Aa={set:function(a,b){Xl.set(a,b)},get:function(a){return Xl.get(a)},getOuter:function(a){return Xl.getOuter(a)},setMax:function(a,b){b=Xl.max(a,b,"margin-left border-left-width padding-left padding-right border-right-width margin-right".split(" "));v.set(a,"max-width",b+"px")}},vA=function(){var a=
p.fromTag("div");n.add(a,"ephox-textbox-font");var b=p.fromTag("span");n.add(b,"ephox-chameleon-icon");y.append(a,b);y.append(fa.body(),a);var c=Aa.get(b);b=v.get(b,"font-family");E.remove(a);return 0<c&&void 0!==b&&Cb(b,"Textbox Icons")},RY=function(a){var b=0,c=setInterval(function(){b+=250;vA()?(clearInterval(c),a(!0)):2E3<b&&(clearInterval(c),a(!1))},250)},SY={wait:Xb(function(){return Fe.nu(function(a){QY.execute(function(){vA()?a(!0):RY(a)})})})},TY=function(a){SY.wait().get(function(b){a(b?
N.value(!0):N.error("Stylesheet loaded, but did not contain Textbox.io styles"))})},wA=function(a,b){a=a+"/i18n/tbio_"+b+".js?"+pf.resourceParam();return Mq.addScript(a,function(a){return a.bind(function(a){return pf.strictMatch(a.version,"Language strings").fold(function(){return N.value(a.strings())},N.error)})})},xA=function(a){var b="/textboxio.css?"+pf.fullParam();Mq.addStylesheet(a+b,TY)},Ri={load:function(a){Qq.set(a);a=Qq.get();xA(a+"/css");wA(a,"en").get(function(a){a.each(og.loadEnglish)});
return a},devLoad:xA,setLanguage:function(a){var b=Le.determine(a);og.isLoaded(b)||(a=Qq.get(),wA(a,b).get(function(a){a.each(function(a){og.load(b,a)})}))},waitForLoad:function(){return Mq.waitForLoad()},getFailures:function(a){return ia(a,function(a){return a.fold(function(a){return[a]},k([]))})}},S={span:function(a){a=p.fromTag("span",a);m.set(a,"role","presentation");return a},div:function(a){a=p.fromTag("div",a);m.set(a,"role","presentation");return a},tag:function(a,b){a=p.fromTag(a,b);m.set(a,
"role","presentation");return a}},z={resolve:Hb.create("ephox-polish").resolve},tb={any:function(a){return L.first(a).isSome()},ancestor:function(a,b,c){return L.ancestor(a,b,c).isSome()},sibling:function(a,b){return L.sibling(a,b).isSome()},child:function(a,b){return L.child(a,b).isSome()},descendant:function(a,b){return L.descendant(a,b).isSome()},closest:function(a,b,c){return L.closest(a,b,c).isSome()}},Rq=z.resolve("highcontrast-mode"),UY=function(a){var b=p.fromTag("div");n.add(b,z.resolve("highcontrast-detect"));
y.append(a,b);v.reflow(b);(!0===("none"===v.get(b,"background-image")?!0:!1)?n.add:n.remove)(a,Rq);E.remove(b)},VY=function(a){var b=p.fromDom(document.documentElement);(!0===(m.has(b,"hc")&&m.has(b,"hcx"))?n.add:n.remove)(a,Rq)},WY=u,gi={detect:function(a){var b=ba.detect();b.os.isWindows()&&(b.browser.isIE()||b.browser.isEdge()||b.browser.isFirefox()?UY:b.browser.isChrome()?VY:WY)(a)},isHighContrast:function(a){return tb.ancestor(a.uiContainer(),"."+Rq)}},vv=ya(["width","docWidth","height","docHeight"],
[]),yA=sa.generate([{unchanged:["html"]},{changed:["html"]}]),ef={unchanged:yA.unchanged,changed:yA.changed,cata:function(a,b,c){return a.fold(b,c)}},zA=function(){return{validate:function(a,b){return wb(a)||"events"===b&&Zb(a)},label:"Function (or events)"}}(),AA="activateInline communication connect content deactivateInline element events filter focus getContent getMode insertHtmlAtCursor isDirty isPrettyPrinting keyboard macros operations setContent setDirty smartview state ui undo".split(" "),
XY=Il(AA.concat([]),zA),YY=Il(AA.concat("blur destroy fromTransfer fullscreen uploader toTransfer viewport".split(" ")),zA),fi={external:XY,internal:YY},ZY={create:function(){var a=!1;return{isBlocked:function(){return a},block:function(){a=!0},unblock:function(){a=!1}}}},$Y={create:function(a,b){return{control:a,instance:b}}},nd={tap:function(a){var b=ZY.create();return $Y.create(b,function(){b.isBlocked()||a.apply(null,arguments)})}},BA=0,Za=function(a){var b=(new Date).getTime(),c=Math.floor(1E9*
Math.random());BA++;return a+"_"+c+BA+String(b)},CA={isFunctionOrEvents:function(a){var b=function(b){return!0===kb(a,function(a){return void 0!==b[a]&&void 0!==b[a].bind&&wb(b[a].bind)})?!0:!1};return{validate:function(a,d){return wb(a)||"events"===d&&Zb(a)&&b(a)},label:"Function (or events)"}}},Jo=Il("events init ui check scanView situation hasDropdown hasAutocorrect handle assign lock destroy state lookup name".split(" "),CA.isFunctionOrEvents(["analytics"])),Tf={noSituation:function(){return{primary:k([]),
secondary:k([]),submenus:k({})}},basic:function(){return{destroy:u,ui:g.none,state:k({}),events:md(["analytics"])}}},DA=function(a,b){var c={};Ra(a,function(a,b){var d=b.split(".");if(1>=d.length)c[b]={finalvalue:a};else{var e=c;hq(b,c);for(b=0;b<d.length-1;b++)e=e[d[b]];e[d[d.length-1]]={finalvalue:a}}});var d=function(a){var c={},e=jb(a);A(e,function(e){c[e]=void 0!==a[e].finalvalue?b(a[e].finalvalue):k(d(a[e]))});return c};return d(c)},ob={ui:function(a,b){a=DA(a,void 0!==b?b:k);return k(g.some(a))},
actions:function(a){a=DA(a,aa);return k(a)}},Ja={basic:Tf.basic,draganddrop:function(){return{events:md(["insertAssets","insertHtml"]),destroy:u}},communication:function(){return{headers:k({}),destroy:u}},fullscreen:function(){return{ui:g.none,actions:ob.actions({maximize:u,restore:u}),select:u,deselect:u,destroy:u,events:md(["analytics","maximize","restore"])}},dialog:function(){return{destroy:u,ui:g.none,events:md(["analytics"]),actions:ob.actions({show:u})}},spelling:function(){return SO()},editorcontext:function(){return{events:md(["blockChanged",
"enterDown","enterUp"]),destroy:u}},highlighter:function(){return{destroy:u,run:u}},linkvalidator:function(){return{destroy:u,refresh:u,ignore:u,state:k({ignore:[],cache:{}})}},macros:function(){return{events:md(["analytics"]),state:k({}),customMacros:k(Io({})),destroy:u}},table:function(){return{ui:g.none,state:k({}),events:md(["analytics"]),situation:Tf.noSituation,handle:u,assign:u,destroy:u,name:k("table-disabled")}},image:function(){return{events:md(["changed","contextmenu"]),situation:Tf.noSituation,
handle:u,assign:u,destroy:u,name:k("image-disabled")}},imageEdit:function(){var a=function(a,b){return Ba.pure(F(b,Db(N.value,a)))},b=t(a,aa);a=t(a,function(a){return a.asset()});return{situation:Tf.noSituation,handle:u,assign:u,ui:g.none,destroy:u,insertResample:k({assets:b,correlated:a,destroy:u}),name:k("imageEdit-disabled")}},mobile:function(){return{ui:g.none,events:md(["fullscreen"]),destroy:u}},noAnalytics:function(){return{log:u,register:u}},state:function(a){var b=rv(a.laundry),c=sv(a.filters,
u,u),d=Io(a.macros.customs);return{filter:k({customFilters:k(c)}),macros:k({customMacros:k(d)}),laundry:b,getState:function(e){return ra(a,void 0===e?{}:e,{laundry:b.state(),filters:c.state(),macros:{customs:d.state()}})}}},uploader:function(){var a=G.create({reconstitute:q([]),uploadAssets:q(["assets"])});return{destroy:u,events:a.registry,reconstitute:u,uploadAssets:u}},undo:function(){return{reset:u,disable:pb,save:u}}},od={activateInline:u,deactivateInline:u,communication:Ja.communication,events:function(){return G.create({loaded:q([]),
focus:q([]),dirty:q([]),change:q([]),internal:q(["command","data"]),paint:q([])}).registry},keyboard:yb("the keyboard feature is not implemented in this mode"),operations:yb("the operations feature is not implemented in this mode"),smartview:yb("the smartview feature is not implemented in this mode"),ui:yb("the ui feature is not implemented in this mode")},Yl=qv("height",function(a){var b=a.dom();return fa.inBody(a)?b.getBoundingClientRect().height:b.offsetHeight}),pa={set:function(a,b){Yl.set(a,
b)},get:function(a){return Yl.get(a)},getOuter:function(a){return Yl.getOuter(a)},setMax:function(a,b){b=Yl.max(a,b,"margin-top border-top-width padding-top padding-bottom border-bottom-width margin-bottom".split(" "));v.set(a,"max-height",b+"px")}},aZ="undo insert style emphasis align listindent format tools".split(" "),Af=M("x","y","width","height"),bZ={intersect:function(a,b){var c=Math.max(a.x(),b.x()),d=Math.max(a.y(),b.y()),e=Math.min(a.x()+a.width(),b.x()+b.width());e=Math.max(0,e-c);a=Math.min(a.y()+
a.height(),b.y()+b.height());return Af(c,d,e,Math.max(0,a-d))}},fe=sa.generate([{unbundled:[]},{unsupported:["message"]},{item:["info","blueprint"]},{customMenu:["info","groups","blueprint"]},{textboxMenu:["info","blueprint"]},{palette:["info","children","blueprint"]}]),EA={create:function(a){var b=function(a,b){return a.feature.fold(function(){return void 0!==a.unsupported?[fe.unsupported(a.unsupported)]:[fe.unbundled()]},function(c){if(void 0===c[a.command])return console.warn("unknown command: "+
a.command),[];c=c[a.command]();return[b(c)]})},c=function(a,c){return b(c,function(b){return V(["widget","inline-widget","split-widget"],c.type)?fe.item({instance:b.widget},a[c.type]):fe.item(b[c.type](),a[c.type])})},d={dropdown:c,general:c,widget:c,"split-widget":c,"inline-widget":c,palette:function(a,c){return b(c,function(b){b=b.palette();var c=F(b.items,function(b){return V(["widget","inline-widget","split-widget"],b.type)?fe.item({instance:b.build},a[b.type]):V(["dropdown"],b.type)?fe.item(b.build(),
a[b.type]):fe.item(b.spec,a[b.type])});return fe.palette(b,c,a.palette)})},submenu:function(b,c){var d=F(c.commands,a);return[fe.customMenu(c,d,b.menu)]},menu:function(a,c){return b(c,function(b){return fe.textboxMenu(b[c.type](),a[c.type])})}};return{classify:function(a,b){var c=d[b.type];return void 0!==c?c(a,b):[]}}},cata:function(a,b,c,d,e,f,h){return a.fold(b,c,d,e,f,h)}},cZ={fromConfig:function(a,b,c){var d=function(a,b){a=t(e.classify,a);a=ia(b.items,a);return{category:b.category,books:a}};
a=t(d,a);b=t(d,b);var e=EA.create(b);return F(c,a)}},na={resolve:Hb.create("ephox-chameleon").resolve},hi={show:function(a){v.remove(a,"display")},hide:function(a){v.set(a,"display","none")},isShowing:function(a){return v.getRaw(a,"display").isNone()},isHiding:function(a){return v.getRaw(a,"display").is("none")}},wv={group:Ac(eh,["component","isVisible","refreshUi","destroy"])},To={menu:function(a,b){var c=G.create({done:q([]),abort:q(["item"])}),d=function(a){a.done.bind(function(){c.trigger.done()});
a.abort.bind(function(a){c.trigger.abort(a.item())});return ra(a,{done:c.registry.done,abort:c.registry.abort})},e=zb(b,function(a,b){var c=ra(b.structure(),a.structures),e=b.submenus().concat(a.submenus),f=ra(b.handlers(),a.actions),h=[b.refreshMenu].concat(a.refreshMenu);a=[b.destroyer].concat(a.destroyers);b=d(b.events);return{structures:c,submenus:e,refreshMenu:h,actions:f,destroyers:a,events:b}},{structures:{},submenus:[],actions:{},refreshMenu:[],destroyers:[],events:{}});return{structure:k(e.structures),
init:function(a){A(e.refreshMenu,pb)},name:k(a),handlers:k(e.actions),submenus:k(e.submenus),events:e.events,destroy:function(){A(e.destroyers,pb)}}},toolbar:function(a){a=UO(a);var b=G.create({escaped:q([]),executed:q([])});return wv.group({component:a.component,isVisible:a.isVisible,refreshUi:a.refreshUi,destroy:a.destroy,events:b.registry})}},FA=function(a,b){n.add(a,na.resolve("user-icon"));v.setAll(a,{"background-image":"url("+b+")"})},Zl={setUrl:FA,findAndSetUrl:function(a,b){L.descendant(a,
".ephox-pastry-icon-content").each(function(a){FA(a,b)})}},$l=function(a,b){m.set(a,"aria-pressed",b?"true":"false")},ma={expanded:function(a){m.set(a,"aria-expanded","true")},collapsed:function(a){m.set(a,"aria-expanded","false")},checked:function(a,b){m.set(a,"aria-checked",String(b))},setPressed:$l,press:function(a){$l(a,!0)},release:function(a){$l(a,!1)},pressed:function(a){$l(a.element(),a.selected())},enable:function(a){m.set(a,"aria-disabled","false")},disable:function(a){m.set(a,"aria-disabled",
"true")},tabSelected:function(a,b){m.setAll(a,{"aria-selected":"true","aria-pressed":"true"});A(b,function(a){m.setAll(a,{"aria-selected":"false","aria-pressed":"false"})})},showPanel:function(a){m.set(a,"aria-selected","true");m.set(a,"aria-hidden","false")},hidePanel:function(a){m.set(a,"aria-selected","false");m.set(a,"aria-hidden","true")}},dZ=function(a){a.enable();ma.enable(a.element())},eZ=function(a){a.disable();ma.disable(a.element())},Qo={control:function(a){return{enable:t(dZ,a),disable:t(eZ,
a)}},ariaPressed:function(a){return{press:t(ma.press,a.element()),release:t(ma.release,a.element())}}},am=function(a){var b=a.replace(/\./g,"-");return{resolve:function(a){return b+"-"+a}}},dj={resolve:am("ephox-echo").resolve},fZ=dj.resolve("aria-help"),gZ=dj.resolve("aria-help-visible"),bm=function(a){m.set(a,"role","presentation")},GA=function(a,b){m.setAll(a,{role:"application","aria-label":b})},HA=function(a){m.set(a,"role","button")},Sq=function(a,b){m.set(a,"aria-owns",b)},IA=function(a,b){m.set(a,
"aria-controls",b)},JA=function(a,b){var c=Za("ephox-aria");m.set(b,"id",c);IA(a,c)},KA=function(a,b){m.set(a,"aria-describedby",b)},LA=function(a,b){m.set(a,"aria-labelledby",b)},cm=function(a,b){m.set(a,"aria-label",b)},T={document:function(a){m.set(a,"role","document")},presentation:bm,region:function(a){m.set(a,"role","region")},controls:IA,owns:Sq,disown:function(a){m.remove(a,"aria-owns")},editor:function(a,b,c,d,e){GA(a,c);d.each(function(c){var d=p.fromTag("span");bm(d);y.append(d,p.fromText(c));
c=Za("ephox-aria");m.set(d,"id",c);KA(b,c);n.add(d,fZ);!0===e&&n.add(d,gZ);y.append(a,d)});return{destroy:function(){m.remove(b,"aria-describedby")}}},inline:function(a,b,c,d,e){GA(a,c);var f=[];m.has(b,"id")?Sq(a,m.get(b,"id")):(c=Za("ephox-aria-content"),m.set(b,"id",c),Sq(a,c),f.push(function(){m.remove(b,"id")}));d.each(function(a){if(m.has(b,"aria-label")){var c=m.get(b,"aria-label");cm(b,a);f.push(function(){cm(b,c)})}else cm(b,a),f.push(function(){m.remove(b,"aria-label")})});return{destroy:function(){A(f,
pb)}}},group:function(a){m.set(a,"role","group")},toolbar:function(a,b){m.setAll(a,{role:"group","aria-label":b})},toolbarGroup:function(a,b){m.set(a,"role","toolbar");null===b||void 0===b||""===b||Gb(b)&&0===b.length||m.set(a,"aria-label",b)},toolbarButton:function(a,b,c,d){m.setAll(a,{role:"button","aria-label":b,"aria-haspopup":""+c});d&&m.set(a,"aria-pressed","false");c&&m.set(a,"aria-expanded","false")},textButton:function(a,b){HA(a);bm(b)},menu:function(a,b){m.setAll(a,{"aria-label":b,role:"menu"})},
menuItem:function(a,b,c){b=b.map(function(a){return{"aria-label":a}}).getOr({});m.setAll(a,ra(b,{role:"menuitem","aria-haspopup":c.getOr(!1)}))},menuItemCheckbox:function(a){m.setAll(a,{role:"menuitemcheckbox","aria-checked":!1})},checkbox:function(a,b){m.setAll(a,{role:"checkbox","aria-label":b,"aria-checked":!1})},dialog:function(a,b){m.setAll(a,{role:"dialog","aria-label":b})},buttonRole:HA,button:function(a,b){m.setAll(a,{"aria-label":b,role:"button"})},labelledField:function(a,b,c){var d=p.fromTag("div");
bm(d);b+=Za("");var e=Za("label");c=p.fromHtml("<label>"+c+"</label>");m.set(c,"for",b);m.set(c,"id",e);m.set(a,"id",b);LA(a,e);O.append(d,[c,a]);return{element:k(d),field:k(a)}},multiline:function(a){m.set(a,"aria-multiline","true")},textarea:function(a){m.setAll(a,{"aria-multiline":"true",role:"textbox"})},label:cm,widget:function(a){m.set(a,"role","widget")},option:function(a){m.set(a,"role","option")},listBox:function(a){m.set(a,"role","listbox")},live:function(a,b,c){m.setAll(a,{"aria-live":c?
c:"polite",id:b})},tabList:function(a){m.set(a,"role","tablist")},tabButton:function(a,b){m.setAll(a,{"aria-label":b,role:"tab"})},tabPanel:function(a){m.setAll(a,{role:"tabpanel"})},linkElements:JA,linkTabToPanel:function(a,b){JA(a,b)},describedBy:KA,labelledBy:LA,required:function(a){m.set(a,"aria-required","true")},hidden:function(a,b){b?m.set(a,"aria-hidden",b):m.remove(a,"aria-hidden")},invalid:function(a,b){!0===b?m.set(a,"aria-invalid","true"):m.remove(a,"aria-invalid")}},VO={disable:function(a){m.set(a,
"unselectable","on");v.setAll(a,{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"});a.dom().style.setProperty("-moz-user-select","-moz-none");return J.bind(a,"onselectstart",function(){return!1})}},eb={resolve:Hb.create("ephox-pastry").resolve},MA=function(a,b,c,d){T.toolbarButton(a.element(),b,c,d);b=Qo.control(a);c=Qo.ariaPressed(a);return{enable:b.enable,disable:b.disable,press:c.press,release:c.release,destroy:function(){a.destroy()}}},Tq=function(a,b,c,d,e,f,h,l){h=
g.from(h).fold(function(){return l(e)},function(a){return a(e,b)});f=g.from(f).getOr(!1);a=a(b);c=ve([na.resolve("icon"),na.resolve(c)]);f=!0===f?[Rc(l(e)).element()]:[];O.append(c.element(),f);a.content(c);a.events.click.bind(function(){d()});m.set(a.element(),"title",h);a.initAria=MA;return a},NA=function(a,b){L.descendant(a,b).each(function(a){T.hidden(a,"true")})},OA=function(a,b,c,d,e,f,h,l){a=Tq(a,b,c,d,e,f,h,l);n.add(a.element(),na.resolve("split-"+b));NA(a.element(),".ephox-pastry-dropbutton-arrow");
NA(a.element(),".ephox-pastry-dropbutton-button");L.descendant(a.element(),".ephox-pastry-dropbutton-arrow .ephox-pastry-icon-content").each(function(a){n.add(a,na.resolve("icon"));n.add(a,na.resolve("arrow-"+b))});return a},Yf={aria:MA,typical:function(a,b,c,d,e,f,h){return Tq(Dc,a,b,c,d,e,f,h)},toggle:function(a,b,c,d,e,f,h){return Tq(Hd,a,b,c,d,e,f,h)},splitToggle:function(a,b,c,d,e,f,h){return OA(XO,a,b,c,d,e,f,h)},split:function(a,b,c,d,e,f,h){return OA(WO,a,b,c,d,e,f,h)}},Sd={resolve:Hb.create("ephox-gopher").resolve},
Uq=wk("item"),Vq=Sd.resolve("disabled-item"),PA="data-"+Sd.resolve("item-value"),tc={set:function(a,b){Uq.set(a);m.set(a,PA,b)},get:function(a){return m.get(a,PA)},up:Uq.up,all:Uq.all,disable:function(a){n.add(a,Vq)},enable:function(a){n.remove(a,Vq)},isEnabled:function(a){return!n.has(a,Vq)}},ej=wk("menu"),QA="data-"+Sd.resolve("menu-value"),dm=Sd.resolve("active-menu"),pd={set:function(a,b){ej.set(a);m.set(a,QA,b)},active:function(a){return L.descendant(a,"."+dm)},inactive:function(a){a=ej.all(a);
return ka(a,function(a){return!n.has(a,dm)})},activate:function(a,b){a=ej.all(a);A(a,function(a){n.remove(a,dm)});n.add(b,dm)},up:ej.up,all:ej.all,submenu:function(a,b,c){c=tc.get(c);return(b.hasOwnProperty(c)?g.from(b[c]):g.none()).bind(function(b){return L.descendant(a,"["+QA+'="'+b+'"]')})}},hZ=wk("submenu"),iZ=wk("main-menu"),ff={main:k(iZ),submenu:k(hZ)},RA=function(a,b,c){tc.set(c,b);m.set(c,"tabindex",-1);return c},TA=function(a,b,c){return SA(a,b,c,!1)},SA=function(a,b,c,d){var e=p.fromTag("li",
a.dom()),f=S.span();n.add(f,Sd.resolve("item-text"));!0===d&&n.add(f,Sd.resolve("item-ellipsis"));y.append(f,p.fromText(c));y.append(e,f);RA(a,b,e);return e},UA=function(a){a=p.fromTag("li",a.dom());n.add(a,Sd.resolve("separator"));return a},jZ=function(a,b){return"-"!==b.value()?TA(a,b.value(),b.text()):UA(a)},VA=function(a,b,c){var d=p.fromTag("ol",a.dom());pd.set(d,b);a=F(c,t(jZ,a));O.append(d,a);return d},WA=function(a,b){a=p.fromTag("div",a.dom());pd.set(a,b);return a},qb={item:TA,ellipsisItem:function(a,
b,c){return SA(a,b,c,!0)},mainmenu:function(a,b,c){a=VA(a,b,c);ff.main().set(a);return a},submenu:function(a,b,c){a=VA(a,b,c);ff.submenu().set(a);return a},widget:WA,widgetSubmenu:function(a,b){a=WA(a,b);ff.submenu().set(a);return a},separator:UA,custom:RA,enableItem:tc.enable,disableItem:tc.disable},XA=function(a,b){if(void 0===a)throw Error("Cannot intersperse undefined");if(1>=a.length)return a;var c=[];c.push(a[0]);for(var d=1;d<a.length;d++)c.push(b()),c.push(a[d]);return c},kZ={css:function(a){var b=
/^[a-zA-Z]/.test(a)?"":"e";a=a.replace(/[^\w]/gi,"-");return b+a}},lZ={splits:function(a,b){if(0===b.length)return[a];var c=hb(b,function(b,c){if(0===c)return b;var d=a.substring(b.prev,c);return{prev:c,values:b.values.concat([d])}},{prev:0,values:[]});b=b[b.length-1];return b<a.length?c.values.concat(a.substring(b)):c.values}},em={cssSanitise:function(a){return kZ.css(a)},splits:function(a,b){return lZ.splits(a,b)}},mZ=function(a,b){b=Kb(b);return To.menu(a,b)},nZ=function(a){return F(a,function(a){a=
F(a,function(a){return a.items()});return Kb(a)})},YA={create:function(a,b,c){var d=a.name,e=a.textkey,f=a.menuTextkey,h=a.tooltip,l=a.label,r=g.from(a.icon),D=k(void 0!==a.contentFocus?a.contentFocus:!1),x=p.fromDom(document),m=ta(e)?em.cssSanitise(d):d,n=c(e);f=c(f);var q=qb.mainmenu(x,m+"-menu",[]),t=Yf.toggle(d,m,aa,e,l,h,c);r.filter(ta).each(function(a){Zl.findAndSetUrl(t.element(),a)});var v=t.initAria(t,n,!0,a.toggle);a=nZ(b);var w=mZ(m,b);b=XA(a,function(){return[qb.separator(x)]});T.menu(q,
f);O.append(q,Kb(b));return{button:k(t),contentFocus:D,destroy:function(){t.destroy();w.destroy();v.destroy()},element:k(q),events:w.events,handlers:w.handlers,icon:k(r),init:w.init,label:k(n),name:w.name,structure:w.structure,submenus:w.submenus,textkey:k(e),menuTextkey:k(f),updateMenu:u,enable:v.enable,disable:v.disable}}},oZ=function(a,b){return g.some(b(a))},pZ=function(a,b){return g.some(b(a,[]))},ZA=function(a,b){var c=t(ZA,a);return EA.cata(b,g.none,g.none,oZ,function(b,e,f){e=F(e,function(a){return ia(a.books,
c)});b=YA.create(b,e,a);return g.some(f(b,[]))},pZ,function(a,b,f){b=ia(b,c);return g.some(f(a,b))}).toArray()},qZ={build:function(a,b){return{items:ia(a.books,function(a){return ZA(b,a)}),category:a.category}}},rZ={build:function(a,b,c){var d=c.translations();a=cZ.fromConfig(b.toolbar(),b.menu(),a);a=F(a,function(a){return qZ.build(a,d)});return F(a,function(a){var b=To.toolbar(a.items);a=a.category;T.toolbarGroup(b.component(),d(a));return b})}},sZ=M("toolbar","menu"),tZ=M("smartview","translations"),
$A=function(a){return function(){return a.apply(null,arguments)}},aB={blueprints:$A(sZ),env:$A(tZ)},bB=function(){return/(?:(?:[A-Za-z]{3,9}:(?:\/\/))(?:[-.~*+=!&;:'%@?^${}(),\w]+@)?[A-Za-z0-9-]+(?:\.[A-Za-z0-9-]+)*|(?:www\.|[-;:&=+$,.\w]+@)[A-Za-z0-9-]+(?:\.[A-Za-z0-9-]+)*)(?::[0-9]+)?(?:\/[-+~%.()\/\w]*)?(?:\?(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?(?:#(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?/g},fm={tokens:function(a,b){return a.replace(/\{(\d+)\}/g,function(c,d,e,f){d=parseInt(d,10);if(void 0===b[d])throw"No value for token: "+
c+" in translation: "+a;return b[d]})},link:bB,autolink:function(){var a=bB().source;return new RegExp("("+a+")[-.~*+=!&;:'%@?#^${}(),]*","g")}},Wq=sa.generate([{raw:["text"]},{key:["key"]},{pkey:["key","params"]}]),Xq=function(a){var b=og.get(a);if(1<arguments.length||/\{(\d+)\}/.test(b)){for(var c=Array(arguments.length-1),d=1;d<arguments.length;d++)c[d-1]=arguments[d];return fm.tokens(b,c)}return b},w={get:function(a){if(ta(a))throw"string passed to I18n.get:"+a;return a.fold(aa,Xq,Xq)},has:og.has,
translate:Xq,raw:Wq.raw,key:function(a){og.get(a);return Wq.key(a)},pkey:function(a,b){og.get(a);return Wq.pkey(a,b)},cata:function(a,b,c,d){return a.fold(b,c,d)}},ge={dropdown:Ac(Qd,"enable disable select clear selectElement populate tick untick activate deactivate".split(" ")),menu:Ac(Qd,["enable","disable"]),general:Ac(Qd,"enable disable select deselect selected element".split(" ")),widget:Ac(Qd,"enable disable select deselect press release".split(" ")),palette:Ac(Qd,["show","hide"])},Ck={generateItem:function(a,
b,c,d){return c.fold(function(){return qb.item(a,b.value(),d(b.textkey()))},function(c){c=c(b);var d=p.fromTag("li",a.dom());y.append(d,c);return qb.custom(a,b.value(),d)})},generateSeparator:function(a,b,c){var d=qb.separator(a);y.append(d,p.fromText(c(b),a.dom()));return d}},uZ=function(a,b){a=va(a,function(a){return a.value()===b});return g.from(a)},cB=function(a){a=ca.children(a,".ephox-pastry-toggle-list-item-selected");A(a,function(a){n.remove(a,"ephox-pastry-toggle-list-item-selected");ma.checked(a,
!1)})},Mg={updateDropdown:function(a,b,c,d,e){b.fold(a.clear,u,function(b){e.fold(function(){(ta(b)?uZ(d,b):g.some(b)).each(a.select)},function(c){c=c(b);var d=eb.resolve("arrow-righticon");n.add(c,d);a.selectElement(c)})});c.fold(a.disable,u,a.enable)},tick:function(a,b){cB(a);a=ca.descendants(a,".ephox-gopher-item");va(a,function(a){return m.get(a,"data-ephox-gopher-item-value")===b}).each(function(a){n.add(a,"ephox-pastry-toggle-list-item-selected");ma.checked(a,!0)})},untick:cB,activate:function(a){n.add(a,
"ephox-pastry-statebutton-selected")},deactivate:function(a){n.remove(a,"ephox-pastry-statebutton-selected")}},Yq=eb.resolve("toggle-list-item-selected"),vZ=function(a){qb.enableItem(a);ma.enable(a)},wZ=function(a){qb.disableItem(a);ma.disable(a)},xZ=function(a){n.remove(a,Yq);ma.checked(a,!1)},yZ=function(a){n.add(a,Yq);ma.checked(a,!0)},Kg={control:function(a){return{enable:t(vZ,a),disable:t(wZ,a)}},selected:function(a){return{deselect:t(xZ,a),select:t(yZ,a),selected:t(n.has,a,Yq)}}},dB=function(a){var b=
S.span();T.hidden(b,!0);ja.add(b,["ephox-pastry-icon-content","ephox-chameleon-icon"].concat([a]));return[b]},zZ=function(a){var b=S.span();T.hidden(b,!0);ja.add(b,["ephox-pastry-icon-content","ephox-chameleon-"+a.value]);Zl.setUrl(b,a.icon);return[b]},AZ=function(a){return dB(!0===a.icon?"ephox-chameleon-"+a.value:a.icon)},ji={generate:dB,generateFrom:function(a){return void 0===a.icon?[]:(ta(a.icon)?zZ:AZ)(a)}},BZ=ba.detect().browser.isFirefox(),CZ={position:"absolute",left:"-9999px"},eB=function(a,
b){var c=p.fromTag("span",a.dom());T.presentation(c);a=p.fromText(b,a.dom());y.append(c,a);return c},fB=function(a,b){var c=Za("ephox-echo-voice");m.set(b,"id",c);m.set(a,"aria-describedby",c)},gB=function(a,b,c){var d=B.owner(b),e=eB(d,c);BZ&&fB(b,e);m.setAll(e,a(c));v.setAll(e,CZ);y.append(b,e);setTimeout(function(){m.remove(e,"aria-live");E.remove(e)},1E3)},DZ=t(gB,function(a){return{"aria-live":"polite","aria-atomic":"true","aria-label":a}}),EZ=t(gB,k({"aria-live":"assertive","aria-atomic":"true",
role:"alert"})),bb={describe:function(a,b){var c=B.owner(a);b=eB(c,b);v.set(b,"display","none");T.hidden(b,!0);fB(a,b);return b},speak:DZ,shout:EZ,tokenSelector:function(){return'span[id^="ephox-echo-voice"]'}},ZO=p.fromDom(document),yv=na.resolve("label-default"),Zq=p.fromDom(document),FZ="data-"+Sd.resolve("item-value"),GZ=function(a){a=qb.submenu(Zq,a+"-menu",[]);n.remove(a,"ephox-gopher-main-menu");n.add(a,"ephox-gopher-submenu");return a},HZ=function(a,b){b=m.get(b,"data-ephox-gopher-menu-value");
var c={};c[a.name+"-menu-trigger"]=b;return c},IZ=function(a,b){var c=GZ(b.name);T.menu(c,a(b.textkey,!1));var d=HZ(b,c),e=YO(a,b),f=function(d){d=ia(d,function(c){var d=F(c.items(),function(c){c=Ck.generateItem(Zq,c,b.render,a);T.menuItemCheckbox(c);return c});return c.label().fold(k(d),function(b){return[Ck.generateSeparator(Zq,b,a)].concat(d)})});E.empty(c);O.append(c,d)},h=G.create({done:q([]),abort:q(["item"])}),l={};A(b.values,function(a){l[a.value()]=function(a){a=m.get(a,FZ);b.action(a);h.trigger.done()}});
e.events.populate.bind(function(a){f(a.items())});return{items:k([e.element()]),structure:k(d),submenus:k([c]),refreshMenu:function(){b.updateDropdown(ge.dropdown({enable:e.enable,disable:e.disable,select:e.select,clear:e.clear,selectElement:e.selectElement,populate:e.populate,tick:t(Mg.tick,c),untick:t(Mg.untick,c),activate:u,deactivate:u}))},destroyer:function(){e.destroy()},handlers:k(l),events:h.registry}},JZ=p.fromDom(document),KZ=function(a,b){a=a(b.textkey);var c=(!0===b.hasDialog?qb.ellipsisItem:
qb.item)(JZ,b.value,a),d=Kg.control(c),e=!0===b.toggle?Kg.selected(c):{select:u,deselect:u,selected:k(!1)};!0===b.toggle?T.menuItemCheckbox(c):T.menuItem(c,g.some(a),g.some(!1));var f=function(){b.updateGeneral(ge.general({disable:d.disable,enable:d.enable,select:e.select,deselect:e.deselect,selected:e.selected,element:k(c)}))},h=G.create({done:q([]),abort:q(["item"])});a={};a[b.value]=function(){h.trigger.done();b.action();f()};var l=ji.generateFrom(b);O.prepend(c,l);return{items:k([c]),structure:k({}),
submenus:k([]),refreshMenu:f,handlers:k(a),destroyer:aa,events:h.registry}},LZ=p.fromDom(document),MZ=function(a){return{submenu:function(b){var c=b.textkey();b=b.element();T.menu(b,a(c));n.remove(b,"ephox-gopher-main-menu");n.add(b,"ephox-gopher-submenu");return b},item:function(b){var c=b.textkey();c=a(c);b=qb.item(LZ,b.name()+"-menu-trigger",c);n.add(b,na.resolve("menu-more"));T.menuItem(b,g.some(c),g.some(!0));return b}}},NZ=function(a,b,c){c=MZ(a);a=c.submenu(b);var d=m.get(a,"data-ephox-gopher-menu-value");
c=c.item(b);var e={};e[b.name()+"-menu-trigger"]=d;d=ra(e,b.structure());var f=ji.generate("ephox-chameleon-"+b.name());O.prepend(c,f);b.icon().each(function(a){0<f.length&&Zl.setUrl(f[0],a)});var h=Kg.control(c);e=void 0!==b.destroyer?b.destroyer:void 0!==b.destroy?b.destroy:u;return{items:k([c]),structure:k(d),submenus:k([a].concat(b.submenus())),refreshMenu:function(){b.updateMenu({enable:h.enable,disable:h.disable})},destroyer:e,handlers:b.handlers,events:b.events}},$q=p.fromDom(document),hB=
na.resolve("menu-widget"),OZ=function(a,b){b=qb.widgetSubmenu($q,b);y.append(b,a.element());ja.add(a.element(),[hB,"ephox-gopher-item"]);return b},PZ=function(a,b,c){a=a(b.textkey());a=qb.item($q,c,a);n.add(a,na.resolve("menu-more"));c=ji.generate(na.resolve(c));O.prepend(a,c);return a},iB=function(a,b){var c=b.instance();b=c.name();var d=b+"-submenu",e=OZ(c,d),f=PZ(a,c,b);T.menu(e,a(c.menuTextkey()));T.menuItem(f,g.some(a(c.textkey())),g.some(!0));var h=Kg.control(f);a={};a[b]=d;var l=G.create({done:Q([],
c.events.done),abort:q(["item"])});c.events.abort.bind(function(){l.trigger.abort(f)});return{items:k([f]),structure:k(a),submenus:k([e]),refreshMenu:function(){c.updateWidget(ge.widget({enable:h.enable,disable:h.disable,select:u,deselect:u,press:u,release:u}))},destroyer:c.destroy,handlers:k({}),events:l.registry}},Bk={widget:iB,inline:function(a,b){var c=b.instance();b=c.name();n.add(c.element(),na.resolve("menu-inline-widget"));var d=p.fromTag("li");y.append(d,c.element());var e=qb.custom($q,b,
d),f=Kg.control(e);T.menuItem(e,g.some(a(c.textkey())),g.some(!1));a={};a[b]=function(a){var b=Y.active().filter(function(b){return ed.ancestor(b,t(P.eq,a))});c.element().dom().click();b.each(Y.focus)};var h=G.create({done:Q([],c.events.done),abort:q(["item"])});c.events.abort.bind(function(){h.trigger.abort(e)});return{items:k([e]),structure:k({}),submenus:k([]),refreshMenu:function(){c.updateInlineWidget(ge.widget({enable:f.enable,disable:f.disable,select:u,deselect:u,press:u,release:u}))},destroyer:c.destroy,
handlers:k(a),events:h.registry}},split:iB,styles:k(hB)},jB=na.resolve("keyfocus"),kB=function(a,b){var c=S.span();v.set(c,"display","none");n.add(c,jB);y.append(a,c);return J.bind(c,"click",function(a){b();a.kill()})},gf={onButton:function(a){return kB(a.element(),a.click)},custom:kB,trigger:function(a){var b="."+jB;a=za.is(a,b)?g.some(a):L.descendant(a,b);a.each(function(a){a.dom().click()});return a}},mi={menu:ya(["focusActive"],[])},ih=Sd.resolve("item-selected"),ar=function(a,b){n.add(b,ih)},
lB=function(a,b){n.remove(b,ih)},qd={is:function(a){return n.has(a,ih)},none:function(a){var b=tc.all(a);A(b,function(b){lB(a,b)})},selectAll:function(a,b){a=tc.all(a);A(a,function(a){n.remove(a,ih)});A(b,function(a){n.add(a,ih)})},select:ar,deselect:lB,selected:function(a){return L.descendant(a,"."+ih)},first:function(a){var b=tc.all(a);return g.from(b[0]).map(function(b){ar(a,b);return b})},last:function(a){var b=tc.all(a);return g.from(b[b.length-1]).map(function(b){ar(a,b);return b})}},QZ=function(a,
b){var c=tc.all(a);return Ta(c,function(a){return P.eq(b,a)}).map(function(a){return{index:k(a),all:k(c)}})},RZ=function(a,b){return 0===b?a.length-1:b-1},SZ=function(a,b){return b===a.length-1?0:b+1},mB=function(a,b,c){return QZ(a,b).map(function(d){var e=c(d.all(),d.index());d=d.all()[e];qd.deselect(a,b);qd.select(a,d);return d})},Oo={first:function(a){var b=tc.all(a);return g.from(b[0]).map(function(b){qd.select(a,b);return b})},prev:function(a,b){return mB(a,b,RZ)},next:function(a,b){return mB(a,
b,SZ)}},Rb=function(a){return function(){return a}},R={BACKSPACE:Rb([8]),TAB:Rb([9]),ENTER:Rb([13]),SHIFT:Rb([16]),CTRL:Rb([17]),ALT:Rb([18]),CAPSLOCK:Rb([20]),ESCAPE:Rb([27]),SPACE:Rb([32]),PAGEUP:Rb([33]),PAGEDOWN:Rb([34]),END:Rb([35]),HOME:Rb([36]),LEFT:Rb([37]),UP:Rb([38]),RIGHT:Rb([39]),DOWN:Rb([40]),INSERT:Rb([45]),DEL:Rb([46]),META:Rb([91,93,224]),F10:Rb([121])},Av={isCommand:function(a,b){var c=[];A(b,function(a){a="string"===typeof a?[a.toUpperCase().charCodeAt(0)]:a;c=c.concat(a)});b=function(a){return 0<
ka(c,function(b){return V(R[a](),b)}).length};if(!!a.altKey!==b("ALT")||!!a.shiftKey!==b("SHIFT")||!!a.ctrlKey!==b("CTRL")||!!a.metaKey!==b("META"))return!1;b=null!==a.charCode&&void 0!==a.charCode&&0!==a.charCode?String.fromCharCode(a.charCode).toUpperCase().charCodeAt(0):a.which;var d=R.CTRL().concat(R.ALT()).concat(R.SHIFT()).concat(R.META()),e=ka(c,function(a){return!V(d,a)});return 1<e.length?!1:0===e.length&&void 0===a.which||e[0]===b}},zv={stop:function(a){a.preventDefault();a.stopPropagation&&
a.stopPropagation()}},TZ={BACKSPACE:R.BACKSPACE,TAB:R.TAB,ENTER:R.ENTER,CAPSLOCK:R.CAPSLOCK,ESCAPE:R.ESCAPE,SPACE:R.SPACE,PAGEUP:R.PAGEUP,PAGEDOWN:R.PAGEDOWN,END:R.END,HOME:R.HOME,LEFT:R.LEFT,UP:R.UP,DOWN:R.DOWN,RIGHT:R.RIGHT,INSERT:R.INSERT,DEL:R.DEL},Vf={getSpecial:function(a){var b=null;Ra(TZ,function(c,d){V(c(),a)&&(b=d)});return b},noModifiers:function(a){return!(a.metaKey||a.altKey||a.ctrlKey)},isCharCode:function(a){return a.charCode===a.keyCode}},nB=function(a,b){return va(b,function(b){return Av.isCommand(a,
b)})},oB=function(a){return Vf.isCharCode(a)?g.none():g.from(Vf.getSpecial(a.keyCode))},bP={identify:function(a,b){return{fold:function(c,d,e){nB(a,b).fold(function(){oB(a).fold(function(){e(a.which&&String.fromCharCode(a.which))},function(a){d(R[a]())})},c)}}},shortcut:nB,special:oB},pB=function(a){return"rtl"===v.get(a,"direction")?"rtl":"ltr"},we={onDirection:function(a,b){return function(c){return"rtl"===pB(c)?b:a}},getDirection:pB},qB=function(a,b,c,d){var e=v.get(a,b);void 0===e&&(e="");c=e===
c?d:c;e=t(v.set,a,b,e);a=t(v.set,a,b,c);return Ho(e,a,!1)},kc={toggler:function(a){return qB(a,"visibility","hidden","visible")},displayToggler:function(a,b){return qB(a,"display","none",b)},isVisible:function(a){a=a.dom();return!(0>=a.offsetWidth&&0>=a.offsetHeight)}},gm=sa.generate([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]}]),fd={southeast:gm.southeast,southwest:gm.southwest,northeast:gm.northeast,northwest:gm.northwest,cata:function(a,b,c,d,e){return a.fold(b,c,d,e)}},rB=function(a,
b){return a.view(b).fold(k([]),function(b){var c=a.owner(b);c=rB(a,c);return[b].concat(c)})},UZ={pathTo:function(a,b){a=b.owner(a);b=rB(b,a);return g.some(b)}},VZ={view:function(a){return(a.dom()===document?g.none():g.from(a.dom().defaultView.frameElement)).map(p.fromDom)},owner:function(a){return B.owner(a)}},fj={find:function(a){var b=p.fromDom(document),c=Pa.get(b);return UZ.pathTo(a,VZ).fold(t(Wa.absolute,a),function(b){var d=Wa.viewport(a);b=zb(b,function(a,b){b=Wa.viewport(b);return{left:a.left+
b.left(),top:a.top+b.top()}},{left:0,top:0});return Ma(b.left+d.left()+c.left(),b.top+d.top()+c.top())})}},We={absolute:function(a){var b=fj.find(a),c=Aa.getOuter(a);a=pa.getOuter(a);return Af(b.left(),b.top(),c,a)},view:function(){return Af(0,0,window.innerWidth,window.innerHeight)}},sB=function(a,b,c){var d=Ma(b,c);b=function(){var a=Pa.get();return d.translate(-a.left(),-a.top())};return a.fold(k(d),b,b)},br={toBox:function(a,b){var c=fj.find(b);a=sB(a,c.left(),c.top());c=Aa.getOuter(b);b=pa.getOuter(b);
return Af(a.left(),a.top(),c,b)},viewport:function(a,b){return b.fold(function(){return a.fold(We.view,We.view,Af)},function(b){return a.fold(b,b,Af)})},translate:sB},WZ=ya("x y width height maxHeight direction classes label candidateYforTest".split(" "),[]),XZ=M("position","left","top","right","bottom"),pg={decision:WZ,css:XZ},cr=sa.generate([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),tB=function(a,b,c,d,e,f){c=b.x()-c;d=b.y()-d;var h=b.width(),l=b.height();
e-=c+h;f-=d+l;var k=g.some(c),D=g.some(d),x=g.some(e),m=g.some(f),n=g.none();return fd.cata(b.direction(),function(){return pg.css(a,k,D,n,n)},function(){return pg.css(a,n,D,x,n)},function(){return pg.css(a,k,n,n,m)},function(){return pg.css(a,n,n,x,m)})},he={none:cr.none,relative:cr.relative,fixed:cr.fixed,reposition:function(a,b){return a.fold(function(){return pg.css("absolute",g.some(b.x()),g.some(b.y()),g.none(),g.none())},function(a,d,e,f){return tB("absolute",b,a,d,e,f)},function(a,d,e,f){return tB("fixed",
b,a,d,e,f)})},viewport:function(a,b){return br.viewport(a,b)},toBox:function(a,b){return br.toBox(a,b)},translate:function(a,b,c){return br.translate(a,b,c)},cata:function(a,b,c,d){return a.fold(b,c,d)}},uB=M("anchorBox","origin"),Rg={box:function(a,b){return uB(a,b)},element:function(a,b){a=he.toBox(b,a);return uB(a,b)},relativeOrigin:function(a){a=a.dom().getBoundingClientRect();return he.relative(a.left,a.top,a.width,a.height)}},gj={resolve:Hb.create("ephox-repartee").resolve},vB=gj.resolve("caret-top-align"),
wB=gj.resolve("caret-bottom-align"),xB=gj.resolve("caret-right-align"),yB=gj.resolve("caret-left-align"),zB=gj.resolve("caret-middle-align"),Sb={east:k(yB),south:k(vB),west:k(xB),north:k(wB),middle:k(zB),all:k([vB,wB,yB,xB,zB])},ie=M("x","y","bubble","direction","anchors","label"),AB=function(a,b){return a.x()+a.width()-b.width()/2},BB=function(a,b){return a.x()+a.width()-b.width()},dr=function(a,b){return a.y()-b.height()},er=function(a){return a.y()+a.height()},fr=function(a,b,c){return ie(a.x(),
er(a),c.southeast(),fd.southeast(),[Sb.south(),Sb.east()],"layout-se")},gr=function(a,b,c){return ie(BB(a,b),er(a),c.southwest(),fd.southwest(),[Sb.south(),Sb.west()],"layout-sw")},hr=function(a,b,c){return ie(a.x(),dr(a,b),c.northeast(),fd.northeast(),[Sb.north(),Sb.east()],"layout-ne")},ir=function(a,b,c){return ie(BB(a,b),dr(a,b),c.northwest(),fd.northwest(),[Sb.north(),Sb.west()],"layout-nw")},jr=function(a,b,c){return ie(AB(a,b),dr(a,b),c.northeast(),fd.northeast(),[Sb.north(),Sb.middle()],"layout-nm")},
kr=function(a,b,c){return ie(AB(a,b),er(a),c.southeast(),fd.southeast(),[Sb.south(),Sb.middle()],"layout-sm")},Wg={southeast:fr,northeast:hr,southwest:gr,northwest:ir,southmiddle:kr,northmiddle:jr,all:function(){return[fr,gr,hr,ir,kr,jr]},allRtl:function(){return[gr,fr,ir,hr,kr,jr]}},CB=function(a){return a.x()+a.width()},DB=function(a,b){return a.y()-b.height()+a.height()},lr=function(a,b,c){return ie(CB(a),a.y(),c.southeast(),fd.southeast(),[Sb.south(),Sb.east()],"link-layout-se")},mr=function(a,
b,c){b=a.x()-b.width();return ie(b,a.y(),c.southwest(),fd.southwest(),[Sb.south(),Sb.west()],"link-layout-sw")},nr=function(a,b,c){return ie(CB(a),DB(a,b),c.northeast(),fd.northeast(),[Sb.north(),Sb.east()],"link-layout-ne")},or=function(a,b,c){var d=a.x()-b.width();return ie(d,DB(a,b),c.northwest(),fd.northwest(),[Sb.north(),Sb.west()],"link-layout-nw")},YZ={southeast:lr,northeast:nr,southwest:mr,northwest:or,all:function(){return[lr,mr,nr,or]},allRtl:function(){return[mr,lr,or,nr]}},xe={anchored:k(function(a,
b){pa.setMax(a,Math.floor(b));v.setAll(a,{"overflow-x":"hidden","overflow-y":"auto"})}),expandable:k(function(a,b){pa.setMax(a,Math.floor(b))})},qg=sa.generate([{fit:["reposition"]},{nofit:["reposition","deltaW","deltaH"]}]),ZZ=function(a,b,c,d){var e=a.x(),f=a.y(),h=a.bubble().left(),l=a.bubble().top(),g=d.x(),D=d.y(),x=d.width(),m=d.height();h=e+h;e=f+l;var n=h>=g,p=e>=D;f=n&&p;l=h+b<=g+x&&e+c<=D+m;g=n?Math.min(b,g+x-h):Math.abs(g-(h+b));x=p?Math.min(c,D+m-e):Math.abs(D-(e+c));b=d.width()-b;b=Math.min(Math.max(0,
h),b);c=p?e:e+(c-x);d=k(c+x-D);D=k(D+m-c);D=fd.cata(a.direction(),D,D,d,d);a=pg.decision({x:b,y:c,width:g,height:x,maxHeight:D,direction:a.direction(),classes:a.anchors(),label:a.label(),candidateYforTest:e});return f&&l?qg.fit(a):qg.nofit(a,g,x)},$Z={attempts:function(a,b,c,d,e){var f=c.width(),h=c.height(),l=function(a,l,g,k){a=a(b,c,d);return ZZ(a,f,h,e).fold(qg.fit,function(a,b,c){return b>g||c>k?qg.nofit(a,b,c):qg.nofit(l,g,k)})};return hb(a,function(a,b){b=t(l,b);return a.fold(qg.fit,b)},qg.nofit(pg.decision({x:b.x(),
y:b.y(),width:c.width(),height:c.height(),maxHeight:c.height(),direction:fd.southeast(),classes:[],label:"none",candidateYforTest:b.y()}),-1,-1)).fold(aa,aa)}},a_={measure:function(a){var b=p.fromTag("div");v.setAll(b,{position:"fixed",opacity:"0",top:"0",left:"0",bottom:"0",right:"0"});y.prepend(a,b);a=Wa.viewport(b);var c=Aa.get(b),d=pa.get(b);E.remove(b);return{top:a.top,left:a.left,width:k(c),height:k(d)}}},hm={layout:function(a,b,c,d){v.remove(b,"max-height");b={width:k(Aa.getOuter(b)),height:k(pa.getOuter(b))};
return $Z.attempts(d.preference(),a,b,c,d.bounds())},setClasses:function(a,b){ja.remove(a,Sb.all());ja.add(a,b.classes())},setHeight:function(a,b,c){c.maxHeightFunction()(a,b.maxHeight())},position:function(a,b,c){var d=function(a){return a+"px"};c=c.origin();var e=k(c);c=c.fold(e,e,function(){var b=a_.measure(a);return he.fixed(b.left(),b.top(),b.width(),b.height())});b=he.reposition(c,b,a);v.setOptions(a,{position:g.some(b.position()),left:b.left().map(d),top:b.top().map(d),right:b.right().map(d),
bottom:b.bottom().map(d)})}},EB=ya(["bounds","origin","preference","maxHeightFunction"],[]),hj=function(a,b,c){return void 0===a[b]?c:a[b]},FB=function(a,b,c,d){a=hm.layout(a,b,c,d);hm.position(b,a,d);hm.setClasses(b,a);hm.setHeight(b,a,d)},ll={simple:function(a,b,c,d,e){var f=hj(e,"maxHeightFunction",xe.anchored());e=a.anchorBox();a=a.origin();d=EB({bounds:he.viewport(a,g.none()),origin:a,preference:d,maxHeightFunction:f});FB(e,b,c,d)},detailed:function(a,b,c,d){d=void 0!==d?d:{};d=EB({bounds:hj(d,
"bounds",We.view()),origin:hj(d,"origin",he.none()),preference:hj(d,"preference",Wg.all()),maxHeightFunction:hj(d,"maxHeightFunction",xe.anchored())});FB(a,b,c,d)}},b_=function(a,b,c,d,e,f,h){return function(a){var l=he.none();var k=he.viewport(l,g.some(b));var x=he.toBox(l,c());k={bounds:k,origin:l,preference:e.isRtl()?f.allRtl():f.all(),maxHeightFunction:h};a=a.panel();ll.detailed(x,a,d,k)}},c_=function(a,b,c,d,e,f,h){return function(b){var l=e.isRtl()?f.allRtl():f.all(),g={maxHeightFunction:h},
k=Rg.element(c(),Rg.relativeOrigin(a()));b=b.panel();ll.simple(k,b,d,l,g)}},GB=ba.detect().deviceType.isiOS()?b_:c_,Wf={main:function(a,b,c,d,e,f){a=GB(a,b,c,d,e,Wg,f);return{recalculate:a,isAnchored:xb,place:a}},submenu:function(a,b,c,d,e){a=GB(a,b,c,Lg(3,-2),d,YZ,e);return{recalculate:a,isAnchored:xb,place:a}}},HB=function(a){return function(b){return b.key()===a}},d_=M("key","value"),zk={put:function(a,b,c,d,e){var f=void 0!==d?d:d_,h=void 0!==e?e:HB(b);a=hb(a,function(a,d){var e=h(d)?f(b,c):d;
return{updated:h(d)||a.updated,acc:a.acc.concat([e])}},{updated:!1,acc:[]});return a.updated?a.acc:a.acc.concat([f(b,c)])},get:function(a,b,c){b=void 0!==c?c:HB(b);return va(a,b)}},hP={triage:function(a){a=zb(a,function(a,c){var b=fa.inBody(c.menu());return{keep:b?[c].concat(a.keep):a.keep,throwaway:!1===b?[c].concat(a.throwaway):a.throwaway}},{throwaway:[],keep:[]});A(a.throwaway,function(a){a.popup().destroy()});return a.keep}},IB=function(a,b){return ed.ancestor(a,t(P.eq,b))},eP={ancestor:IB,anyAncestor:function(a,
b){return Va(b,function(b){return IB(a,b)})},sibling:function(a,b){return ed.sibling(a,t(P.eq,b))},child:function(a,b){return ed.child(a,t(P.eq,b))},descendant:function(a,b){return ed.descendant(a,t(P.eq,b))}},gP={create:function(a,b){var c=G.create({open:q([]),close:q([]),uistale:q([])});if(void 0===a)throw"uicontainer not specified";var d=fP({layerClass:na.resolve("layer-menus"),container:a()}),e=S.div();n.add(e,na.resolve("popup-container"));d.content(e);var f=!1,h=function(){f&&(g.off(),d.hide(),
f=!1,k.control.block(),c.trigger.close())},l=[e],g=Bv(function(a){!1===!f&&(h(),L.ancestor(a,"."+b).fold(function(){Y.focus(a)},u))},function(){return l}),k=nd.tap(function(){c.trigger.uistale()});k.control.block();return{element:function(){return e},panel:d.element,destroy:function(){d.hide();d.destroy();g.off()},open:function(){f||(k.control.unblock(),v.set(d.element(),"opacity","0"),d.show(),v.reflow(d.element()),g.on(),f=!0,c.trigger.open(),v.set(d.element(),"opacity","1"))},close:h,closed:function(){return!f},
mousedown:function(a){g.mousedown(a.original())},uiStale:function(){k.instance()},setContent:function(a){y.append(e,a)},setComponents:function(a){l=a.concat([e])},events:c.registry}}},Cv=M("menu","popup"),Ak=function(a){return function(b){return P.eq(b.menu(),a)}},kP=ba.detect().deviceType.isiOS,e_=function(a,b,c,d,e){var f=jP(a,b,e.name,e.textkey,e.menuTextkey,e.render,e.layout,c,e.toggle,d);a=function(){e.updateDropdown(ge.dropdown({enable:f.enable,disable:f.disable,select:f.select,clear:f.clear,
selectElement:f.selectElement,populate:f.populate,tick:f.tick,untick:f.untick,activate:f.activate,deactivate:f.deactivate}))};var h=gf.onButton(f);f.events.select.bind(function(a){e.action(a.value());f.close()});var l=G.create({select:Q(["value","item"],f.events.select),itemHover:Q(["item"],f.events.itemHover),escaped:Q([],f.events.escaped),open:Q(["menu","popup","anchor"],f.events.open),close:Q([],f.events.close)});a();m.set(f.element(),"tabindex","-1");return{dropdown:function(){return{events:l.registry,
close:f.close,uiStale:f.uiStale,enable:f.enable,disable:f.disable,list:f.list,menu:f.menu,recalculate:f.recalculate}},component:f.element,refreshUi:a,destroy:function(){h.unbind();f.destroy()}}},f_=function(a,b){b=Yf.typical(a.value,a.value,a.action,a.textkey,a.label,a.tooltip,b);a.setup&&a.setup(b,a);return b},g_=function(a,b){b=Yf.toggle(a.value,a.value,a.action,a.textkey,a.label,a.tooltip,b);a.setup&&a.setup(b,a);a.selected&&b.select();return b},h_=function(a,b){var c=!0===b.hasPopup,d=(!0===b.toggle?
g_:f_)(b,a);ta(b.icon)&&Zl.findAndSetUrl(d.element(),b.icon);var e=d.initAria(d,a(b.textkey),c,b.toggle);m.set(d.element(),"tabindex","-1");var f=function(){!0===b.toggle&&ma.pressed(d)},h=gf.onButton(d);d.events.click.bind(function(){f()});var l=!0===b.toggle?d.select:u,g=!0===b.toggle?d.deselect:u,D=!0===b.toggle?d.selected:k(!1);f();var x=G.create({click:Q([],d.events.click)});return{generals:function(){return{events:x.registry,enableButton:d.enable,disableButton:d.disable}},component:d.element,
refreshUi:function(){b.updateGeneral(ge.general({disable:e.disable,enable:e.enable,select:l,deselect:g,selected:D,element:d.element}));f()},destroy:function(){h.unbind();d.destroy();e.destroy()}}},i_=ba.detect().deviceType.isiOS,j_=function(a,b,c,d,e,f){var h=e.button(),l=gf.onButton(h),g=Po(a.uiContainer,e.name,mi.menu({focusActive:!0}));m.set(h.element(),"tabindex","-1");var k=S.div();n.add(k,na.resolve("menu-system-main"));var x=li(g.sandbox,a.bounds,b,[h.element()],d),H=x.initMenu(k);c=yk();var p=
Wf.main(a.uiContainer,a.bounds,h.element,c,b.uiDirection(),xe.anchored()),t=function(){p.recalculate(H)},u=function(){var a=B.children(g.sandbox());A(a,function(a){v.set(a,"display","none")})},w=function(a){g.update(a.structure());E.empty(k);y.append(k,a.element());a=x.registerMenus(a.submenus());a=F(a,function(a){return a.panel()});E.empty(g.sandbox());O.append(g.sandbox(),[H.panel()].concat(a));u()},z=function(a){e.init(a)},C=G.create({open:q(["menu","popup","anchor"]),close:Q([],g.events.close),
itemAction:Q(["value","item"],g.events.itemAction),itemHover:Q(["item"],g.events.itemHover),reveal:q(["menu","trigger","popup","anchor"]),collapse:Q(["menu","item"],g.events.collapse),escaped:Q([],g.events.escaped)});h.events.click.bind(function(){return(h.selected()?H.open:H.close)()});e.events.done.bind(function(){g.close()});e.events.abort.bind(function(a){g.select(a.item());Y.focus(a.item())});H.events.uistale.bind(function(){g.getActiveMenu().bind(function(a){z(a)})});H.events.close.bind(function(){g.close();
ma.collapsed(h.element())});H.events.open.bind(function(){var a=void 0!==f?f:[];a=[g.sandbox()].concat(a);w(e);z(e);v.set(H.panel(),"display","block");v.set(k,"display","block");g.open(a,k);ma.expanded(h.element())});g.events.open.bind(function(){C.trigger.open(e.element(),H,p);i_()||g.setActiveMenu(e.element())});g.events.close.bind(function(){x.hideAll();h.deselect()});g.events.itemAction.bind(function(a){var b=e.handlers();if(void 0!==b[a.value()])(0,b[a.value()])(a.item())});g.events.reveal.bind(function(a){ma.expanded(a.trigger());
var b=x.expandMenu(a.menu(),a.trigger(),H);C.trigger.reveal(a.menu(),a.trigger(),b.popup,b.anchorage)});g.events.collapse.bind(function(a){x.hideMenu(a.menu());a.item().each(ma.collapsed)});return{menus:function(){return{events:C.registry,enable:e.enable,disable:e.disable,close:H.close,uiStale:H.uiStale,mousedown:H.mousedown,contentFocus:e.contentFocus,menu:H.element,refreshMenus:z,recalculate:t}},component:h.element,refreshUi:function(){e.updateMenu({enable:e.enable,disable:e.disable})},destroy:function(){l.unbind();
g.destroy();e.destroy();H.destroy()}}},k_=function(a,b){var c=S.span();n.add(c,na.resolve("palette-group"));var d=t(bb.speak,fa.body()),e=function(a){var b=hi.isShowing(c);hi.hide(c);b&&a.each(d);return b},f=ge.palette({show:function(a){var b=hi.isHiding(c);hi.show(c);b&&a.each(d);return b},hide:e});e(g.none());O.append(c,F(b,function(a){return a.component()}));return{component:k(c),destroy:function(){A(b,function(a){a.destroy()})},refreshUi:function(){A(b,function(a){a.refreshUi()});a.updatePalette(f)}}},
l_=function(a,b,c,d,e){var f=e.instance();e=p.fromDom(document);var h=(f.toggle?Yf.splitToggle:Yf.split)(f.name(),f.name(),aa,f.textkey(),f.label(),f.tooltip,c),l=gf.custom(h.element(),function(){h.open();f.enter()});m.set(h.element(),"tabindex","-1");var g=h.initAria(h,c(f.textkey()),!0,f.toggle);d=li(a.uiContainer,a.bounds,b,[h.element()],d);var k=yk(),x=qb.widget(e,f.name());e=Za("menu-control");m.set(x,"id",e);T.controls(h.element(),e);T.owns(h.element(),e);T.menu(x,c(f.menuTextkey()));y.append(x,
f.element());var H=d.initMenu(x),n=Wf.main(a.uiContainer,a.bounds,h.element,k,b.uiDirection(),xe.expandable()),t=function(){n.recalculate(H)};H.events.open.bind(function(){ma.expanded(h.element());f.open();u.trigger.open(x,H,n)});H.events.close.bind(function(){ma.collapsed(h.element());f.close();h.close()});f.events.done.bind(function(){H.close();h.close()});f.events.abort.bind(function(){H.close();h.close();u.trigger.abort()});h.events.open.bind(function(){H.open();n.recalculate(H)});h.events.close.bind(function(){f.close();
H.close()});h.events.click.bind(function(){f.action()});var u=G.create({abort:q([]),close:Q([],f.events.close),open:q(["menu","popup","anchor"])});return{widgets:function(){return{events:u.registry,open:h.open,isOpen:h.isOpen,close:h.close,recalculate:t}},component:h.element,refreshUi:function(){f.updateWidget(ge.widget({select:h.select,deselect:h.deselect,enable:h.enable,disable:h.disable,press:g.press,release:g.release}))},destroy:function(){l.unbind();g.destroy();H.destroy();f.destroy();h.destroy()}}},
m_=function(a,b,c,d,e){var f=e.instance(),h=Yf.toggle(f.name(),f.name(),aa,f.textkey(),f.label(),f.tooltip,c),l=gf.onButton(h),g=h.initAria(h,c(f.textkey()),!0,!0);c=li(a.uiContainer,a.bounds,b,[h.element()],d);d=yk();var k=c.initMenu(f.element()),x=Wf.main(a.uiContainer,a.bounds,h.element,d,b.uiDirection(),xe.expandable());m.set(h.element(),"tabindex","-1");n.add(k.element(),na.resolve("toolbar-widget"));var H=function(){x.recalculate(k)};k.events.open.bind(function(){ma.expanded(h.element());f.open();
p.trigger.open(f.element(),k,x)});k.events.close.bind(function(){ma.collapsed(h.element());f.close()});f.events.done.bind(function(){k.close();h.deselect()});f.events.abort.bind(function(){k.close();h.deselect();p.trigger.abort()});h.events.click.bind(function(){h.selected()?(k.open(),x.recalculate(k)):k.close();ma.pressed(h)});var p=G.create({abort:q([]),open:q(["menu","popup","anchor"])}),t=function(){h.deselect();k.close()};return{widgets:function(){return{events:p.registry,close:t,recalculate:H}},
component:h.element,refreshUi:function(){f.updateWidget(ge.widget({select:u,deselect:u,enable:g.enable,disable:g.disable,press:u,release:u}))},destroy:function(){l.unbind();g.destroy();k.destroy();f.destroy();h.destroy()}}},n_=function(a,b){var c=b.instance(),d=gf.custom(c.element(),function(){c.element().dom().click()});m.remove(c.element(),"tabindex");n.add(c.element(),na.resolve("toolbar-inline-widget"));T.toolbarButton(c.element(),a(c.textkey()),!1);var e=G.create({abort:q([]),open:q(["menu",
"popup","anchor"])});return{widgets:function(){return{events:e.registry,recalculate:u,close:u}},component:c.element,refreshUi:function(){c.updateInlineWidget(ge.widget({select:u,deselect:u,enable:t(ma.enable,c.element()),disable:t(ma.disable,c.element()),press:u,release:u}))},destroy:function(){d.unbind();c.destroy()}}},Fv={menu:function(a){return{general:t(KZ,a),menu:t(NZ,a),dropdown:t(IZ,a),widget:t(Bk.widget,a),"split-widget":t(Bk.split,a),"inline-widget":t(Bk.inline,a),palette:yb("No palettes for menus yet")}},
toolbar:function(a,b,c,d){var e=function(e){return t(e,a,b,c,d)};return{menu:e(j_),dropdown:e(e_),widget:e(m_),"split-widget":e(l_),"inline-widget":t(n_,c),general:t(h_,c),palette:k_}}},JB=sa.generate([{toolbar:[]},{menu:[]}]),Ro={toolbar:JB.toolbar,menu:JB.menu,cata:function(a,b,c){return a.fold(b,c)}},o_=function(a,b,c,d){a.events.escaped.bind(function(a){c.focused()&&Y.focus(d.component())});a.events.close.bind(function(a){b.focus()})},p_=function(a,b,c,d){a.events.open.bind(function(a){Ic.register(a.popup().panel())})},
oP={init:function(a,b,c,d,e,f,h,l,g){var k=a.dropdown(g),r=k.dropdown();a=c.toolbar;(ba.detect().deviceType.isTouch()?p_:o_)(r,e,a,k);var m=!1;r.events.open.bind(function(a){e.toReading();h.show(a.popup(),a.anchor());m=!0});r.events.close.bind(function(){m=!1});r.events.escaped.bind(function(){Y.focus(k.component())});e.events.mousedown.bind(function(){m&&r.close()});e.events.uiStale.bind(r.uiStale);c.toolbar.events.transitionend.bind(function(a){V(["top","height"],a.property())&&r.recalculate()});
return{component:k.component,refreshUi:k.refreshUi,destroy:k.destroy}}},nP={init:function(a,b,c,d,e,f,h,l,g){a=a.general(g);b=a.generals();a.refreshUi();return{generals:b,component:a.component,refreshUi:a.refreshUi,destroy:a.destroy}}},KB=function(a){var b=g.none(),c=function(){b=g.none()};return{begin:function(){b=g.from(Pa.capture(a))},end:function(){b.each(function(a){a.restore()});c()},destroy:c}},pl={fromSafe:function(a){return KB(a.doc())},fromUnsafe:function(a){a=a.doc().getOrDie();return KB(a)}},
pP={init:function(a,b,c,d,e,f,h,l,k){var r=a.menu(k,[]),x=r.menus(),m=pl.fromUnsafe(e);x.events.open.bind(function(a){e.toReading();x.refreshMenus(a.menu());h.show(a.popup(),a.anchor())});x.events.close.bind(function(){e.focus();m.end()});x.events.escaped.bind(function(){Y.focus(r.component())});x.events.reveal.bind(function(a){k.init(a.menu());h.show(a.popup(),a.anchor())});x.events.itemAction.bind(function(a){m.end()});x.events.itemHover.bind(function(a){m.begin();if(null!==document.activeElement&&
void 0!==document.activeElement){var b=p.fromDom(document.activeElement),c=B.owner(a.item());"input"!==C.name(b)&&Ic.preserve(c,t(Y.focusInside,a.item()))}else e.backupSelection(),Y.focus(a.item())});e.events.mousedown.bind(x.mousedown);e.events.uiStale.bind(x.uiStale);e.events.focus.bind(x.enable);var n=!e.isInline()&&k.contentFocus();n&&x.disable();return{component:r.component,refreshUi:function(){r.refreshUi();var a=n?g.none():g.some(!0);e.getSelection().or(a).fold(x.disable,x.enable)},destroy:function(){m.destroy();
e.events.mousedown.unbind(x.mousedown);e.events.uiStale.unbind(x.update);r.destroy()}}}},pr=function(a,b,c,d,e,f,h,l,g,k,x){var r=c[b]({instance:a(x.instance)});a=r.widgets();e=e.toolbar;a.events.open.bind(function(a){h.toReading();g.show(a.popup(),a.anchor())});a.events.abort.bind(function(){Y.focus(r.component())});h.events.mousedown.bind(a.close);return(ba.detect().deviceType.isTouch()&&"split-widget"===b?q_:r_)(a,h,e,r)},r_=function(a,b,c,d){return d},q_=function(a,b,c,d){var e=J.capture(d.component(),
"click",function(b){b.kill();n.add(d.component(),eb.resolve("statebutton-selected"));a.isOpen()?a.close():a.open()});a.events.close.bind(function(){n.remove(d.component(),eb.resolve("statebutton-selected"))});return{widgets:d.widgets,component:d.component,refreshUi:d.refreshUi,destroy:function(){e.unbind();d.destroy()}}},So={widget:t(pr,aa,"widget"),inlineWidget:t(pr,function(a){return function(){return a(Ro.toolbar())}},"inline-widget"),splitWidget:t(pr,aa,"split-widget")},s_=z.resolve("editor-container"),
Xf={editorContainer:k(s_)},im=M("key","link"),LB=M("url","text"),MB=function(a,b,c){return function(d){var e=LB(b,w.translate(c));return im(w.pkey(a,d),g.some(e))}},ec=function(a){return function(b){return im(w.pkey(a,b),g.none())}},qr=function(a){return function(b){var c=a(b);b=LB(b[0].websiteUrl,w.translate("cloud.dashboard"));return im(c.key(),g.some(b))}},t_={"no.api.key":qr(ec("cloud.error.apikey")),"domain.not.supported":qr(function(a){return im(w.pkey("cloud.error.domain",[a[0].details.domain]),
g.none())}),"plan.exceeded":qr(ec("cloud.error.plan")),"error.code.invalid.toolbar":ec("errors.toolbar.invalid"),"error.code.spelling.not.found":ec("errors.spelling.missing.service"),"error.code.images.not.found":ec("errors.images.missing.service"),"safari.imagepaste":MB("errors.safari.image","https://support.ephox.com/entries/88543243-Safari-Direct-paste-of-images-does-not-work","errors.safari.url"),"webview.imagepaste":ec("errors.webview.image"),"flash.clipboard.no.rtf":function(a){return(ba.detect().browser.isSafari()?
MB("errors.safari.browser-settings","https://support.ephox.com/entries/59328357-Safari-6-1-and-7-Flash-Sandboxing","errors.safari.rtf"):ec("errors.images.missing.flash"))(a)},"fileupload.invalidimages":ec("errors.images.upload.invalid"),"error.imageupload":ec("errors.images.upload.failed"),"error.imageupload.generic":ec("errors.images.upload.unknown"),"error.imageupload.cors":ec("errors.images.upload.cors"),"errors.paste.word.notready":ec("errors.paste.notready"),"errors.paste.process.failure":ec("errors.paste.generic"),
"flash.crashed":ec("errors.flash.crashed"),"errors.imageimport.failed":ec("errors.images.import.failed"),"errors.imageimport.unsupported":ec("errors.images.import.unsupported"),"errors.imageimport.invalid":ec("errors.images.import.invalid"),"imageedit.needsproxy":ec("errors.images.edit.needsproxy"),"imageedit.proxyerror":ec("errors.images.edit.proxyerror"),"imageedit.generic":ec("errors.images.edit.generic")},u_={"errors.local.images.disallowed":"Removing pasted images from content. Local image insert has been disabled.",
"errors.dragdrop.images.disallowed":"Blocking image drop operation. Local image insert has been disabled."},NB=function(a,b){a=(0,t_[a])(b);return{description:k(w.get(a.key())),link:k(a.link().getOr(null))}},Ge={get:NB,getOrLog:function(a,b){return g.from(u_[a]).fold(function(){var c=NB(a,b);return g.some(c)},function(a){console.warn(a);return g.none()})}},v_=function(a,b){var c=function(b){var c=Ge.get("error.code.invalid.toolbar",[b.small()]);c=ii(c);a.displayBanner(c);A(b.big(),function(a){console.error(a)})};
return b.fold(function(a){c(a);return[]},aa)},OB={setup:function(a,b,c,d,e,f){f=v_(a,f);var h=function(a){a=ta(a)?w.has(a)?w.key(a):w.raw(a):a;return w.get(a)};n.add(a.toolbar.element(),z.resolve("layer-above-editor"));b=aB.blueprints(mP(e.uiContainer,a,b,c,d,e,h),lP(h));e=aB.env(e.uiContainer,h);e=rZ.build(f,b,e);A(e,a.toolbar.add);a.position();A(e,function(a){c.events.uiStale.bind(function(){a.refreshUi()})})}},Ng={preserve:function(a,b){var c=B.owner(b),d=Y.active(c).bind(function(a){var c=function(b){return P.eq(a,
b)};return c(b)?g.some(b):Da.descendant(b,c)});a=a(b);d.each(function(a){Y.active(c).filter(function(b){return P.eq(b,a)}).isNone()&&Y.focus(a)});return a}},Hv=M("component","index"),vP={item:k('.ephox-chameleon-toolbar-group [tabindex="-1"]'),group:k(".ephox-chameleon-toolbar-group"),sector:k(".ephox-chameleon-toolstrip > *")},PB=na.resolve("toolbar-more-closed"),QB=na.resolve("toolbar-more-open"),Lv=na.resolve("toolbar-more-hide"),Kv=na.resolve("toolbar-more-show"),Vo=function(a,b){v.set(a,"height",
b+"px");v.reflow(a)},Uo=function(a){n.remove(a,QB);n.add(a,PB);Vo(a,0)},Mv=function(a){n.remove(a,PB);n.add(a,QB);v.remove(a,"height")},rr=M("within","extra","withinWidth"),RB=function(a,b,c){var d=zd.generate(a,function(a,b){var d=c(a);return g.some({element:k(a),start:k(b),finish:k(b+d),width:k(d)})});a=ka(d,function(a){return a.finish()<b});var e=zb(a,function(a,b){return a+b.width()},0);d=d.slice(a.length);return{within:k(a),extra:k(d),withinWidth:k(e)}},jm=function(a){return F(a,function(a){return a.element()})},
w_=function(a,b,c){a=jm(a.concat(b));return rr(a,[],c)},x_=function(a,b,c,d){a=jm(a).concat([c]);return rr(a,jm(b),d)},y_=function(a,b,c){return rr(jm(a),[],c)},z_=function(a,b,c){a=RB(b,a,c);return 0===a.extra().length?g.some(a):g.none()},tP={partition:function(a,b,c,d){var e=z_(a,b,c).getOrThunk(function(){return RB(b,a-c(d),c)}),f=e.within(),h=e.extra();e=e.withinWidth();return 1===h.length&&h[0].width()<=c(d)?w_(f,h,e):1<=h.length?x_(f,h,d,e):y_(f,h,e)}},xa={grid:ya(["trigger"],["isValid","first"]),
flow:ya(["trigger"],["first","executeOnArrow"]),sectors:ya(["trigger","first"],[]),radio:ya(["one"],[]),input:ya([],["execute"]),button:ya(["execute"],["process"]),dialog:ya(["execute","ok","cancel"],["index"]),inlineDialog:ya(["ok","cancel"],["index"]),page:ya(["trigger"],["first"]),tabular:ya(["trigger"],["first","isValid"]),dynamic:ya([],["execute"])},Tc=Ac(eh,["enter","exit","destroy"]),SB=function(a){return function(b){return b.raw().which===a}},Z={inSet:function(a){return function(b){return V(a,
b.raw().which)}},and:function(a){return function(b){return kb(a,function(a){return a(b)})}},is:SB,isShift:function(a){return!0===a.raw().shiftKey},basic:function(a,b){return{matches:SB(a),run:b}},rule:function(a,b){return{matches:a,run:b}}},sr=function(a){m.has(a,"tabIndex")||m.set(a,"tabIndex","-1")},$a={set:function(a){sr(a);Y.focus(a)},find:function(a){return Y.search(a)},isFocused:Y.hasFocus,mark:sr,markSelectors:function(a,b){A(b,function(b){b=ca.descendants(a,b);A(b,sr)})}},je={adjust:function(a,
b,c,d){a+=b;return a>d?c:a<c?d:a},findPrev:function(a,b,c){var d=Ld(a.slice(0,b));a=Ld(a.slice(b+1));return va(d.concat(a),c)},findNext:function(a,b,c){var d=a.slice(0,b);a=a.slice(b+1);return va(a.concat(d),c)}},TB=function(a){return va(a,km)},km=function(a){return kc.isVisible(a.element())&&a.isEnabled()&&"hidden"!==v.get(a.element(),"visibility")},qa={exit:function(a){A(a,function(a){a.clear();a.exit()})},clear:function(a){A(a,function(a){a.clear()})},refresh:function(a){A(a,function(a){a.refresh()})},
first:TB,enterFirst:function(a,b){b.index().bind(function(b){return g.from(a[b]).filter(km)}).orThunk(function(){return TB(a)}).each(function(a){a.enter()})},isEnabled:function(a){return Va(a,function(a){return a.isEnabled()})},locate:function(a,b){return va(a,function(a){var c=b.target();a=a.element();return ed.closest(c,t(P.eq,a))}).getOr(void 0)},next:function(a,b){var c=zc(a,b).getOr(-1);return je.findNext(a,c,km).getOr(b)},prev:function(a,b){var c=zc(a,b).getOr(-1);return je.findPrev(a,c,km).getOr(b)},
prevNoCycle:function(a,b){b=zc(a,b).getOr(-1);return 0<b?g.some(a[b-1]):g.none()},nextNoCycle:function(a,b){b=zc(a,b).getOr(-1);return b+1<a.length?g.some(a[b+1]):g.none()},progress:function(a,b){a.exit();b.enter()},destroy:function(a){A(a,function(a){a.destroy()})}},A_=ya(["index","focused","group","items"],[]),B_=ya(["index","sectors","sector"],[]),C_=ya(["index","candidates"],[]),rg={ofFocus:function(a,b,c){return $a.find(a).bind(function(a){return L.closest(a,b).bind(function(b){var d=ca.descendants(b,
c),e=ka(d,kc.isVisible);return Ta(e,t(P.eq,a)).map(function(c){return A_({index:c,focused:a,group:b,items:e})})})})},ofSector:function(a,b,c){var d=ca.descendants(a,b);return L.closest(c,b).bind(function(a){return Ta(d,t(P.eq,a)).map(function(b){return B_({index:b,sectors:d,sector:a})})})},within:function(a,b,c){var d=ca.descendants(a,c);return Ta(d,t(P.eq,b)).map(function(a){return C_({index:a,candidates:d})})}},UB={horizontal:function(a,b,c,d){return rg.within(a,c,b).bind(function(a){var b=a.index();
a=a.candidates();b=je.adjust(b,d,0,a.length-1);return g.from(a[b])})}},lm={delegate:function(a,b,c){return hf(a,[Z.basic(R.LEFT()[0],b.west),Z.basic(R.RIGHT()[0],b.east),Z.basic(R.UP()[0],b.north),Z.basic(R.DOWN()[0],b.south),Z.rule(Z.inSet(R.SPACE().concat(R.ENTER())),function(){return $a.find(a).bind(c.trigger()).map(xb)})],g.none())},findRecent:function(a,b,c,d){return d.isValid().fold(k(c),function(a){return c.filter(a)}).orThunk(function(){return d.first().bind(function(a){return a()}).orThunk(function(){return L.descendant(a,
b)})})}},D_=M("row","column"),da={set:function(a,b){if(void 0===b)throw Error("Value.set was undefined");a.dom().value=b},get:function(a){return a.dom().value}},E_={move:function(a,b,c){var d=M("row","col"),e=a.length-1,f=a[b.row()]-1;e=je.adjust(b.row(),c.dr(),0,e);a=a[e]-1;f=Math.max(f,a);b=Math.min(a,je.adjust(b.col(),c.dc(),0,f));return d(e,b)}},VB={single:hf,multiple:Nv,multipleAll:function(a,b){var c=J.bind(a,"keydown",function(a){var c=qa.locate(b,a);if(Z.is(R.ESCAPE()[0])(a))d(),a.kill();
else if(void 0!==c&&null!==c)if(Z.is(R.UP()[0])(a))qa.progress(c,qa.prev(b,c)),a.kill();else if(Z.is(R.DOWN()[0])(a))qa.progress(c,qa.next(b,c)),a.kill();else if(Z.is(R.TAB()[0])(a)){var e=(Z.isShift(a)?qa.prev:qa.next)(b,c);qa.progress(c,e);a.kill()}}),d=function(){qa.exit(b);e.trigger.exit()},e=G.create({enter:q([]),exit:q([])});return Tc({enter:function(){qa.first(b).each(function(a){a.enter()})},exit:d,clear:t(qa.clear,b),refresh:t(qa.refresh,b),isEnabled:t(qa.isEnabled,b),isFocused:t($a.isFocused,
a),events:e.registry,destroy:function(){qa.destroy(b);c.unbind()}})},flow:function(a,b,c){var d=g.none();$a.markSelectors(a,[b.item()]);var e=function(c){return $a.find(a).bind(function(d){return UB.horizontal(a,b.item(),d,c)})},f=ni(a,function(a){return e(a).bind(function(a){r(a);return c.executeOnArrow().fold(function(){return g.some(!0)},h)})}),h=function(){return $a.find(a).bind(c.trigger()).map(xb)},l=hf(a,[Z.rule(Z.inSet(R.LEFT().concat(R.UP())),f.west),Z.rule(Z.inSet(R.RIGHT().concat(R.DOWN())),
f.east),Z.rule(Z.inSet(R.SPACE().concat(R.ENTER())),h)],g.none()),r=function(a){d=g.some(a);$a.set(a)};return Tc({element:l.element,destroy:l.destroy,clickFocus:function(a){za.is(a,b.item())&&r(a)},clear:function(){d=g.none()},isFocused:l.isFocused,isEnabled:k(!0),refresh:u,enter:function(){l.enter();d.orThunk(function(){return c.first().fold(function(){return L.descendant(a,b.item())},pb)}).each(r)},exit:l.exit})},grid:function(a,b,c,d,e){var f=c,h=d;$a.markSelectors(a,[b.cell()]);var l=Ga(g.none()),
k=function(a){return B.findIndex(a).map(function(a){return D_(Math.floor(a/h),a%h)})},D=function(c,d){return $a.find(a).bind(function(e){return k(e).bind(function(e){var l=je.adjust(e.row(),d,0,f-1),k=je.adjust(e.column(),c,0,h-1);e=ca.descendants(a,b.cell());var r=e.length-1;l*=h;l=l+k>r?0<c?l:r:l+k;return 0<=l&&l<e.length?g.some(e[l]):g.none()})})};c=ni(a,function(a,b){return D(a,b).bind(function(a){$a.set(a);l.set(g.some(a));return g.some(!0)})});var x=lm.delegate(a,c,e);return Tc({element:x.element,
destroy:x.destroy,clear:function(){l.set(g.none())},isFocused:x.isFocused,isEnabled:xb,refresh:u,enter:function(){x.enter();l.set(lm.findRecent(a,b.cell(),l.get(),e));l.get().each(Y.focus)},exit:x.exit,resize:function(a,b){f=a;h=b}})},sectors:function(a,b,c){$a.markSelectors(a,[b.sector(),b.group(),b.item()]);var d=function(a){return Da.descendant(a,function(a){return za.is(a,b.item())&&k(a)})},e=function(a){return Da.child(a,m)},f=function(a){a=Cc.children(a,m);return 0<a.length?g.some(a[a.length-
1]):g.none()},h=ni(a,function(c){return rg.ofFocus(a,b.group(),b.item()).bind(function(a){var b=a.items();a=je.adjust(a.index(),c,0,b.length-1);return g.from(b[a])})}),l=function(c){return rg.ofFocus(a,b.group(),b.item()).bind(function(a){return c(a.group()).bind(d)})},k=function(a){return 0<pa.get(a)},D=function(c){return rg.ofSector(a,b.sector(),c).map(function(a){return je.findPrev(a.sectors(),a.index(),k).getOr(a.sector())})},x=function(c){return rg.ofSector(a,b.sector(),c).map(function(a){return je.findNext(a.sectors(),
a.index(),k).getOr(a.sector())})},m=function(a){var c;if(c=za.is(a,b.group()))a=ca.descendants(a,b.item()),c=Va(a,kc.isVisible);return c},n=function(a){return function(){return a().map(function(a){$a.set(a);p.trigger.active(a);return a})}},p=G.create({enter:q([]),exit:q([]),active:q(["element"])}),v=hf(a,[Z.rule(Z.inSet(R.ESCAPE()),function(){v.exit();p.trigger.exit();return g.some(!0)}),Z.rule(Z.inSet(R.RIGHT().concat(R.DOWN())),n(h.east)),Z.rule(Z.inSet(R.LEFT().concat(R.UP())),n(h.west)),Z.rule(Z.and([Z.isShift,
Z.inSet(R.TAB())]),n(t(l,function(a){return B.prevSibling(a).filter(m).orThunk(function(){return D(a).bind(f)})}))),Z.rule(Z.inSet(R.TAB()),n(t(l,function(a){return B.nextSibling(a).filter(m).orThunk(function(){return x(a).bind(e)})}))),Z.rule(Z.inSet(R.SPACE().concat(R.ENTER())),function(){return $a.find(a).bind(c.trigger()).map(xb)})],g.none());return Tc({element:v.element,clear:u,isFocused:v.isFocused,enter:function(){v.enter();p.trigger.enter();c.first()().orThunk(function(){return d(a)}).each(function(a){$a.set(a);
p.trigger.active(a)})},refresh:u,isEnabled:xb,exit:v.exit,destroy:v.destroy,events:p.registry})},radio:function(a,b,c){var d=function(c){return $a.find(a).bind(function(d){return UB.horizontal(a,b.item(),d,c)})},e=ni(a,function(b){return d(b).bind(function(b){$a.set(b);c.one()(a,b);return g.some(!0)})}),f=hf(a,[Z.rule(Z.inSet(R.LEFT().concat(R.UP())),e.west),Z.rule(Z.inSet(R.RIGHT().concat(R.DOWN())),e.east),Z.rule(Z.inSet(R.SPACE()),t(g.some,!0))],g.none());return Tc({element:f.element,destroy:f.destroy,
clear:u,refresh:function(){f.isFocused()&&L.descendant(a,b.selected()).each($a.set)},isFocused:f.isFocused,isEnabled:xb,enter:function(){f.enter();L.descendant(a,b.selected()).orThunk(function(){return L.descendant(a,b.item())}).each(function(d){za.is(d,b.selected())||c.one()(a,d);$a.set(d)})},exit:f.exit})},input:function(a,b){var c=hf(a,[Z.basic(R.ENTER()[0],function(c){return b.execute().map(function(b){var d={isShift:k(Z.isShift(c))},e=da.get(a);b(e,d);return!0})})],g.none());return Tc({element:c.element,
destroy:c.destroy,clear:c.clear,isFocused:c.isFocused,isEnabled:function(){return!m.has(a,"disabled")},refresh:u,enter:function(){c.enter();a.dom().setSelectionRange(0,da.get(a).length)},exit:c.exit})},dialog:function(a,b,c){var d=c.execute(),e=xa.button({execute:d}),f=b.slice(0).concat([Wo(c.cancel(),e),Wo(c.ok(),e)]),h=J.bind(a,"keydown",function(a){var b=qa.locate(f,a);if(void 0!==b&&null!==b){var e=Z.isShift(a);Z.is(R.TAB()[0])(a)?(e=(e?qa.prev:qa.next)(f,b),qa.progress(b,e),a.kill()):Z.is(R.ESCAPE()[0])(a)?
(l(),a.kill(),d(c.cancel())):"button"===C.name(b.element())||e||!Z.is(R.ENTER()[0])(a)?(b=[R.UP()[0],R.DOWN()[0]],e=["textarea","select","input"],Z.inSet(b)(a)&&!1===V(e,C.name(a.target()))&&a.kill()):(d(c.ok()),a.kill())}}),l=function(){qa.exit(f);g.trigger.exit()},g=G.create({enter:q([]),exit:q([])});return Tc({enter:function(){qa.enterFirst(f,c)},exit:l,clear:t(qa.clear,f),refresh:t(qa.refresh,f),isEnabled:t(qa.isEnabled,f),isFocused:t($a.isFocused,a),events:g.registry,destroy:function(){qa.destroy(f);
h.unbind()}})},button:Wo,inlineDialog:function(a,b,c){var d=c.ok(),e=c.cancel(),f=J.bind(a,"keydown",function(a){var c=qa.locate(b,a);if(void 0!==c&&null!==c){var f=Z.isShift(a);Z.is(R.TAB()[0])(a)?(f=(f?qa.prev:qa.next)(b,c),qa.progress(c,f),a.kill()):Z.is(R.ESCAPE()[0])(a)?(h(),a.kill(),e(a.target())):!f&&Z.is(R.ENTER()[0])(a)?(d(a.target()),a.kill()):(c=[R.UP()[0],R.DOWN()[0]],f=["textarea","select","input"],Z.inSet(c)(a)&&!1===V(f,C.name(a.target()))&&a.kill())}}),h=function(){qa.exit(b);l.trigger.exit()},
l=G.create({enter:q([]),exit:q([])});return Tc({enter:function(){qa.enterFirst(b,c)},exit:h,clear:t(qa.clear,b),refresh:t(qa.refresh,b),isEnabled:t(qa.isEnabled,b),isFocused:t($a.isFocused,a),events:l.registry,destroy:function(){qa.destroy(b);f.unbind()}})},tabular:function(a,b,c){var d=b.row(),e=b.cell();$a.markSelectors(a,[d,e]);var f=Ga(g.none()),h=ni(a,function(a,b){return p(a,b).bind(function(a){$a.set(a);f.set(g.some(a));return g.some(!0)})}),l=M("row","col"),k=M("dc","dr"),m=function(a){a=
ca.descendants(a,d);return F(a,function(a){return ca.descendants(a,e).length})},x=function(b){return L.closest(b,d).bind(function(c){return rg.within(a,c,d).bind(function(a){return rg.within(c,b,e).map(function(b){return l(a.index(),b.index())})})})},n=function(b){var c=ca.descendants(a,d);return g.from(c[b.row()]).bind(function(a){a=ca.descendants(a,e);return g.from(a[b.col()])})},p=function(b,c){return $a.find(a).bind(function(d){return x(d).bind(function(d){var e=m(a);d=E_.move(e,d,k(b,c));return n(d)})})},
q=lm.delegate(a,h,c);return Tc({element:q.element,destroy:q.destroy,clear:function(){f.set(g.none())},isFocused:q.isFocused,isEnabled:xb,refresh:u,enter:function(){q.enter();f.set(lm.findRecent(a,b.cell(),f.get(),c));f.get().each($a.set)},exit:q.exit})},page:function(a,b,c){var d=b.stops().join(","),e=function(){return c.first().bind(function(b){return L.descendant(a,b)}).getOr(a)},f=function(a){var b=e();return(Y.hasFocus(b)?g.some:$a.find)(b).bind(function(b){var c=e();if(P.eq(c,b)&&0>a)c=g.none();
else{var f=ca.descendants(c,d);b=Ta(f,t(P.eq,b)).getOr(-1)+a;c=b>=f.length?g.none():0>b?g.some(c):0<=b&&b<f.length?g.some(f[b]):g.none()}return c})};b=function(a){return f(a).bind(function(a){$a.set(a);return g.some(!0)})};var h=hf(a,[Z.rule(Z.and([Z.isShift,Z.inSet(R.TAB())]),t(b,-1)),Z.rule(Z.inSet(R.TAB()),t(b,1)),Z.rule(Z.inSet(R.SPACE().concat(R.ENTER())),function(){return $a.find(a).bind(c.trigger()).map(xb)})],g.none());return Tc({element:h.element,destroy:h.destroy,clear:u,isFocused:h.isFocused,
isEnabled:xb,refresh:u,enter:function(){h.enter();$a.set(e())},exit:h.exit})},dynamic:function(a){var b=Ga([]),c=function(a,c){Z.is(R.TAB()[0])(c)&&(Z.isShift(c)?qa.prevNoCycle:qa.nextNoCycle)(b.get(),a).each(function(b){qa.progress(a,b);c.kill()})},d=J.bind(a,"keydown",function(a){var d=qa.locate(b.get(),a);void 0!==d&&null!==d&&c(d,a)}),e=G.create({enter:q([]),exit:q([])}),f=function(a){return function(){return a(b.get())}};return Tc({element:k(a),enter:function(){qa.first(b.get()).each(function(a){a.enter()})},
exit:function(){qa.exit(b.get());e.trigger.exit()},set:function(a){qa.destroy(b.get());b.set(a)},clear:f(qa.clear),refresh:f(qa.refresh),isEnabled:f(qa.isEnabled),isFocused:t($a.isFocused,a),destroy:function(){qa.destroy(b.get());d.unbind()},events:e.registry})}},F_={grid:function(a,b,c,d,e){$a.markSelectors(a,[b.cell()])}},G_=function(a,b){var c=g.from(F_[b]).getOr(u);return function(){c.apply(null,arguments);return{element:u,clear:u,isFocused:u,isEnabled:u,refresh:u,enter:u,exit:u,events:G.create({enter:q([]),
exit:q([]),active:q([])}).registry,destroy:u,set:u,clickFocus:u,resize:u}}},ea=ba.detect().deviceType.isTouch()?Wb(VB,G_):VB,ye={toolbar:function(a,b){return uP(a,b)},menu:function(a,b,c){return YA.create(a,b,c)},popup:function(a,b,c,d,e){return li(a,b,c,d,e)},menuSystem:function(a,b,c){return Po(a,b,c)}},Id={styleSpan:k("ephox-hare-style-span"),base:k("ephox-candy-mountain"),active:k("ephox-candy-mountain-active"),autoresize:k("ephox-candy-mountain-autoresize")},WB=ba.detect(),mm=WB.deviceType.isTouch,
H_=WB.deviceType.isAndroid,nm=function(a,b){return window.screen.width>=a&&window.screen.height>=b},XB=function(){return!nm(620,700)&&mm()},nc={isTouch:mm,choice:function(a,b){return hb(a,function(a,b){return a.orThunk(function(){return b.predicate()?g.some(b.value()):g.none()})},g.none()).getOr(b)},isLarge:function(){return nm(620,700)},isLargeTouch:function(){return nm(620,700)&&mm()},isSmallTouch:XB,isLargeDesktop:function(){return nm(620,700)&&!mm()},isSmallAndroid:function(){return XB()&&H_()}},
sg=ba.detect(),I_={"ephox-platform-desktop":!sg.deviceType.isTouch(),"ephox-platform-touch":sg.deviceType.isTouch(),"ephox-platform-small-touch":nc.isSmallTouch(),"ephox-platform-android":sg.deviceType.isAndroid(),"ephox-platform-ios":sg.deviceType.isiOS(),"ephox-platform-ie":sg.browser.isIE()||sg.browser.isEdge(),"ephox-platform-firefox":sg.browser.isFirefox()},YB=[];Ra(I_,function(a,b){!0===a&&YB.push(b)});var aq={addClasses:function(a){ja.add(a,YB)}},ZB=function(a,b){var c=p.fromTag("div");n.add(c,
z.resolve(b));y.append(c,a);return c},Yv={build:function(a,b,c){g.from(b).filter(Ti.isPrototypeOf).map(p.fromDom).each(function(b){var c=p.fromTag("div");n.add(c,z.resolve("flex-row"));var d=p.fromTag("div");n.add(d,z.resolve("flex-column"));O.append(d,B.children(a));y.append(a,c);y.append(c,d);y.append(c,ZB(b,"side-bar"))});g.from(c).filter(Ti.isPrototypeOf).map(p.fromDom).each(function(b){y.append(a,ZB(b,"bottom-bar"))})}},J_=Ac(Qd,["compare","extract","mutate","sink"]),K_=Ac(Qd,["element","start",
"stop","destroy"]),L_=Ac(Qd,["forceDrop","drop","move","delayDrop"]),Wk={mode:J_,sink:K_,api:L_},Qv={resolve:am("ephox-dragster").resolve},M_=Wk.mode({compare:function(a,b){return Ma(b.left()-a.left(),b.top()-a.top())},extract:function(a){return g.some(Ma(a.x(),a.y()))},sink:function(a,b){var c=xP(b),d=J.bind(c.element(),"mousedown",a.forceDrop),e=J.bind(c.element(),"mouseup",a.drop),f=J.bind(c.element(),"mousemove",a.move),h=J.bind(c.element(),"mouseout",a.delayDrop);return Wk.sink({element:c.element,
start:function(a){y.append(a,c.element())},stop:function(){E.remove(c.element())},destroy:function(){c.destroy();e.unbind();f.unbind();h.unbind();d.unbind()}})},mutate:function(a,b){a.mutate(b.left(),b.top())}}),N_={setup:function(a,b,c){var d=!1,e=G.create({start:q([]),stop:q([])}),f=AP(),h=function(){k.stop();f.isOn()&&(f.off(),e.trigger.stop())},l=pi(h,200);f.events.move.bind(function(c){b.mutate(a,c.info())});var g=function(a){return function(){var b=Array.prototype.slice.call(arguments,0);if(d)return a.apply(null,
b)}},k=b.sink(Wk.api({forceDrop:h,drop:g(h),move:g(function(a,c){l.cancel();f.onEvent(a,b)}),delayDrop:g(l.throttle)}),c);return{element:k.element,go:function(a){k.start(a);f.on();e.trigger.start()},on:function(){d=!0},off:function(){d=!1},destroy:function(){k.destroy()},events:e.registry}}},oi={transform:function(a,b){var c=void 0!==b?b:{};return N_.setup(a,void 0!==c.mode?c.mode:M_,b)}},CP={both:function(a){var b=G.create({relocate:q(["x","y","deltaX","deltaY"])});return{mutate:function(c,d){var e=
Wa.absolute(a),f=e.left()+c;e=e.top()+d;b.trigger.relocate(f,e,c,d)},events:b.registry}}},$B=M("hx","hy","position","x","y"),O_=function(a,b,c,d,e,f){f=b.x();b=b.y()-c;return(b>=a.y()&&b<=a.y()+a.h()?[$B(f,b,"absolute",f,b)]:[]).concat([$B(e,a.y(),"fixed",e-d.left(),a.fy())])},P_={detect:function(a,b,c,d,e,f){a=O_(a,b,e,f,c,d);return va(a,function(a){return 10>Math.abs(d-a.hy())&&38>Math.abs(c-a.hx())})}},aC={box:function(a){var b=Wa.absolute(a),c=Aa.getOuter(a);a=pa.getOuter(a);var d=b.left();b=
b.top();return{x:k(d),y:k(b),width:k(c),height:k(a),right:k(d+c),bottom:k(b+a)}}},tr={resolve:Hb.create("ephox-ego").resolve},om=function(a){var b="data-"+tr.resolve(a+"-left"),c="data-"+tr.resolve(a+"-top"),d="data-"+tr.resolve(a+"-position");return{get:function(a){var e=parseInt(m.get(a,b),10),h=parseInt(m.get(a,c),10);a=m.get(a,d);return isNaN(e)||isNaN(h)?g.none():g.some({left:k(e),top:k(h),position:k(a)})},set:function(a,f,h,l){m.set(a,d,f);m.set(a,b,h+"px");m.set(a,c,l+"px")},clear:function(a){m.remove(a,
d);m.remove(a,b);m.remove(a,c)}}}("pre-snap"),Q_=function(a,b,c,d,e,f){return om.get(b).fold(function(){return a.fromLocation(b,c,d)},function(c){return a.fromFixed(b,c.left()+e,c.top()+f)})},R_=function(a,b,c,d){var e=B.owner(b);e=Pa.get(e);b=aC.box(b);c=c.loc();return P_.detect(a,b,c.left(),c.top(),d,e)},ur=function(a,b,c,d){return{attrs:{"data-ephox-snap":"absolute"===b?"true":"false"},styles:{position:b,left:a.left+c+"px",top:a.top+d+"px"}}},ij={move:function(a,b,c,d,e,f){var h=a.graph(),l=a.lazyTheatre(),
g=a.lazyHeight();c=Q_(h,b,c,d,e,f);var k=c.loc(),x=c.fixed(),m={top:0,left:0};return R_(l,a.container(),c,g).fold(function(){var a=h.boundToFixed(l,b,k.left(),k.top(),x.left(),x.top(),g);om.set(b,"fixed",a.left(),a.top());return ur(m,"fixed",a.left(),a.top())},function(c){var d=h.boundToFixed(l,b,k.left(),k.top(),x.left(),x.top(),g);om.set(b,"fixed",d.left(),d.top());d="absolute"===c.position()?h.locationToAbsolute(b,c.x(),c.y()):Ma(c.x(),c.y());a.resetOffset();return ur(m,c.position(),d.left(),d.top())})},
getSnapAttrs:ur,forget:function(a){om.clear(a)}},Vv={none:function(a,b){var c=G.create({dragend:q([]),moved:q([])});return{blocker:yb("no blocker"),setState:u,getState:k({}),init:function(d,e){d=ij.getSnapAttrs(a.getOffset(),"absolute",d,e);v.setAll(b,d.styles);m.setAll(b,d.attrs);c.trigger.moved()},update:u,destroy:u,events:c.registry}},except:function(a){return function(b,c){var d=BP(c,a.join(",")),e=G.create({dragend:Q([],d.events.dragend),moved:q([])});d.events.relocate.bind(function(a){var d=
a.x(),e=a.y(),f=a.deltaX();a=a.deltaY();d=ij.move(b,c,d,e,f,a);v.setAll(c,d.styles);m.setAll(c,d.attrs)});d.events.dragend.bind(function(){e.trigger.moved()});return{blocker:d.blocker,setState:function(a){v.setAll(c,a.styles);m.setAll(c,a.attrs)},getState:function(){var a=Wa.viewport(c);return ij.getSnapAttrs(b.getOffset(),"absolute",a.left(),a.top())},init:function(a,d){a=ij.getSnapAttrs(b.getOffset(),"absolute",a,d);v.setAll(c,a.styles);m.setAll(c,a.attrs);e.trigger.moved()},update:function(){ij.forget(c)},
destroy:function(){d.destroy()},events:e.registry}}}},Rv={isInside:function(a,b,c,d){return!(b>a.y()+a.h()||c-d<a.y())},isAllInside:function(a,b,c){return b>a.y()&&b<a.y()+a.h()&&c>a.y()&&c<a.y()+a.h()}},Wv={register:function(a,b,c,d){var e=a.container(),f=c(a,b),h=d(a,b),l=DP();c=G.create({dragend:Q([],f.events.dragend),appear:Q(["element"],h.events.appear),disappear:Q(["element"],h.events.disappear),dock:Q([],l.events.dock),undock:Q([],l.events.undock)});f.events.moved.bind(function(){m();k=!0});
h.events.scrolled.bind(function(){m()});h.events.appear.bind(function(){var c=a.lazyTheatre(),d=a.graph();l.update(d,c,b,a.lazyHeight,e,a.getOffset())});var k=!1,m=function(){if(kc.isVisible(b)){f.update();h.update();var c=a.lazyTheatre(),d=Wa.absolute(b);c=Math.max(0,c.x()+c.w()-d.left());v.set(b,"max-width",c+"px")}};return{blocker:f.blocker,setState:function(a){f.setState(a);m();k=!0},state:function(){return k?g.some(f.getState()):g.none()},init:function(b,c,d){a.setOffset(d);f.init(b,c);m()},
update:m,destroy:function(){h.destroy();f.destroy()},events:c.registry}}},Uv={transitions:function(a,b){var c=a.container(),d=B.defaultView(b),e=G.create({appear:q(["element"]),disappear:q(["element"]),scrolled:q([])}),f=J.bind(d,"scroll",function(){e.trigger.scrolled()});return{update:function(){var d=a.lazyTheatre(),f=a.lazyHeight(),g=aC.box(c);Rv.isInside(d,g.y(),g.bottom(),f)?e.trigger.appear(b):e.trigger.disappear(b)},destroy:function(){f.unbind()},events:e.registry}}},Sv=M("fixed","loc"),FP=
function(a,b,c,d){b=EP(b);var e={top:0,left:0},f=function(a){e.top=a.top;e.left=a.left};return{lazyTheatre:a,graph:k(b),lazyHeight:c,container:k(d),setOffset:f,resetOffset:function(){f({top:-1*c(),left:0})},getOffset:function(){return e}}},vr=z.resolve("drag-show"),bC=z.resolve("fade-container"),$c={width:function(a,b){return v.getRaw(a,"max-width").fold(function(){return B.owner(b).dom().defaultView.innerWidth-Wa.absolute(b).left()},function(a){return parseInt(a,10)})},updateWidth:function(a,b,c){b=
0===c.extra().length?c.withinWidth():c.withinWidth()+Aa.getOuter(b.group());0<b&&v.set(a,"width",b+"px")},clearWidth:function(a){v.remove(a,"width")},offsetFrom:function(a,b,c,d){b=void 0!==d.toolbar.offset?d.toolbar.offset:d.toolbar.sticky?{left:0,top:0}:{left:0,top:-1*c};c=Wa.absolute(a.element());a=a.isInline()?{left:c.left(),top:c.top()}:{left:0,top:0};return{left:a.left+b.left,top:a.top+b.top}},initFade:function(a){n.add(a,vr)},fadeIn:function(a,b){A(a,function(a){n.remove(a,bC)});n.add(b,vr)},
fadeOut:function(a,b){A(a,function(a){n.add(a,bC)});n.remove(b,vr)}},JP={setup:function(a,b,c,d){return(!0===c.toolbar.draggable?GP:!0===c.toolbar.sticky||void 0!==c.toolbar.offset||a.isInline()?HP:Pv)(a,b,c)}};ba.detect();var Xv=function(a,b){a.updateUi(b);a=[Xf.editorContainer(),"ephox-textbox-font",z.resolve("layer-editor")];ja.add(b,a);m.set(b,"lang",Le.get());aq.addClasses(b)},S_=function(a){a=We.absolute(a);var b=We.view();a=bZ.intersect(a,b);return Af(a.x(),a.y(),a.width(),a.height())},bq=
{build:function(a,b,c,d,e,f,h,l){var g=IP(a,b,c,f,h,l),k=d.tabbed(g);k.init();return{element:g.element,socket:g.socket,viewport:g.viewport,uiContainerParent:g.uiContainerParent,init:function(b,d,h){d=k.config(a.isInline(),d,e,h);OB.setup(g,f,a,b,c,d);k.loaded()},connect:g.connect,destroy:function(){g.destroy();k.destroy()},displayBanner:g.displayBanner,hideBanner:g.hideBanner,position:g.position,refresh:g.refresh,tabstrip:g.toolbar,state:g.state,dialogContainer:g.dialogContainer}},bounds:function(){var a=
function(a){var b=function(){return g.from(a.bounds()).filter(Ti.isPrototypeOf).map(p.fromDom).map(S_).getOrThunk(We.view)};return wb(a.bounds)?b:We.view};return ba.detect().deviceType.isTouch()?k(We.view):a}()},Qy={settings:function(a){return{onprem:!0,blocktag:{styles:[{rule:"p"},{rule:"h1"},{rule:"h2"},{rule:"h3"},{rule:"h4"},{rule:"div"},{rule:"pre"}],showDocumentStyles:!1,bundled:!0},image:{bundled:!0},imageEdit:{bundled:!0},imageupload:{immediate:!1,bundled:!1},content:{imageExcludes:[],css:a+
"/css",tabindex:null,stylesheets:[],documentStyles:"",prettyprint:!0,showDocumentStyles:!1,autoresize:!1},ui:{layout:bq,isFullScreen:!1,toolbar:{draggable:!1,sticky:!1},locale:{},editorName:N.value("debug"),bounds:null,showHelpHint:!1,autoresize:!1},shortcuts:{features:!0},spelling:{bundled:!0,autocorrect:!0,scanView:!0,multilingual:!0,menu:!0},specialchar:{bundled:!0},fileupload:{bundled:!0,allowLocalImages:!0},horizontalrule:{bundled:!0},media:{bundled:!0},mentions:{bundled:!1},registration:{bundled:!1},
help:{baseUrl:a+"/html",integration:{},bundled:!0},draganddrop:{bundled:!0},wordcount:{bundled:!0},formatting:{bundled:!0},alignindent:{bundled:!0},directionality:{bundled:!0},parlance:{bundled:!0,languages:"en_us en_gb es fr de pt zh".split(" ")},font:{faces:[],colors:{buttons:[]},bundled:!0},lists:{bundled:!0},link:{bundled:!0},linkvalidator:{bundled:!1},bookmark:{bundled:!0},removeformat:{bundled:!0},fullscreen:{bundled:!0},editorcontext:{bundled:!0},macros:{allowed:g.none(),bundled:!0},highlighter:{external:[],
bundled:!0},table:{colors:{buttons:[]},bundled:!0},contextmenu:{bundled:!0},project:{apiKey:null},smartclipboard:{bundled:!0,copy:{},paste:{forceText:!1,baseUrl:a+"/js",swf:a+"/flash/textboxpaste.swf",officeStyles:"prompt",htmlStyles:"merge",allowLocalImages:!0,enableFlashImport:!0}},resize:{bundled:!0},platform:{toolbar:{items:aZ,contextual:["table-tools","image-tools"]},allowLocalImages:!0,fillscreen:!1},codeview:{bundled:!0,showButton:!0,mode:"pencil",css:a+"/css",js:a+"/js"},findreplace:{bundled:!0},
accessibility:{bundled:!0},plaincodeview:{bundled:!0},embed:{inlineStyles:!0,bundled:!1}}},state:function(){return{spelling:{words:{},language:g.none()},undo:{initial:{raw:"",marked:""},undo:[],redo:[]},profile:{spelling:!1,nativeSpelling:!0,autocorrect:!0,capitalisation:!1,linkpreviews:!1},content:{raw:"",marked:""},ui:{toolbar:{drag:g.none()}},macros:{customs:{}},filters:{customs:[]},laundry:{dirty:!1},linkvalidator:{ignore:[],cache:{}},embed:{cache:{}}}}},wr=M("item","mode"),xr=function(a,b,c,
d){var e=void 0!==d?d:jj;return a.property().parent(b).map(function(a){return wr(a,e)})},jj=function(a,b,c,d){var e=void 0!==d?d:jh;return c.sibling(a,b).map(function(a){return wr(a,e)})},jh=function(a,b,c,d){var e=void 0!==d?d:jh;a=a.property().children(b);return c.first(a).map(function(a){return wr(a,e)})},T_=[{current:xr,next:jj,fallback:g.none()},{current:jj,next:jh,fallback:g.some(xr)},{current:jh,next:jh,fallback:g.some(jj)}],cC=function(a,b,c,d,e){e=void 0!==e?e:T_;return va(e,function(a){return a.current===
c}).bind(function(c){return c.current(a,b,d,c.next).orThunk(function(){return c.fallback.bind(function(c){return cC(a,b,c,d)})})})},tg={backtrack:xr,sidestep:jj,advance:jh,go:cC},pm={left:function(){return{sibling:function(a,b){return a.query().prevSibling(b)},first:function(a){return 0<a.length?g.some(a[a.length-1]):g.none()}}},right:function(){return{sibling:function(a,b){return a.query().nextSibling(b)},first:function(a){return 0<a.length?g.some(a[0]):g.none()}}}},yr=function(a,b,c,d,e,f){return tg.go(a,
b,d,e).bind(function(b){return f(b.item())?g.none():c(b.item())?g.some(b.item()):yr(a,b.item(),c,b.mode(),e,f)})},qm={left:function(a,b,c,d){return yr(a,b,c,tg.sidestep,pm.left(),d)},right:function(a,b,c,d){return yr(a,b,c,tg.sidestep,pm.right(),d)}},dC=function(a,b){return 0===a.property().children(b).length},eC=function(a,b,c,d){return qm.left(a,b,c,d)},fC=function(a,b,c,d){return qm.right(a,b,c,d)},ua={before:function(a,b,c){return eC(a,b,t(dC,a),c)},after:function(a,b,c){return fC(a,b,t(dC,a),
c)},seekLeft:eC,seekRight:fC,walkers:function(){return{left:pm.left,right:pm.right}},walk:function(a,b,c,d,e){return tg.go(a,b,c,d,e)},backtrack:tg.backtrack,sidestep:tg.sidestep,advance:tg.advance},kh=gb(),mc={gather:function(a,b,c){return ua.gather(kh,a,b,c)},before:function(a,b){return ua.before(kh,a,b)},after:function(a,b){return ua.after(kh,a,b)},seekLeft:function(a,b,c){return ua.seekLeft(kh,a,b,c)},seekRight:function(a,b,c){return ua.seekRight(kh,a,b,c)},walkers:function(){return ua.walkers()},
walk:function(a,b,c,d){return ua.walk(kh,a,b,c,d)}},gC=function(a){return p.fromDom(a.dom().cloneNode(!0))},zr=function(a,b){b=p.fromTag(b);a=m.clone(a);m.setAll(b,a);return b},Gc={shallow:function(a){return p.fromDom(a.dom().cloneNode(!1))},shallowAs:zr,deep:gC,copy:function(a,b){b=zr(a,b);a=B.children(gC(a));O.append(b,a);return b},mutate:function(a,b){b=zr(a,b);y.before(a,b);var c=B.children(a);O.append(b,c);E.remove(a);return b}},aw={convertToHeading:function(a,b){var c=B.owner(a);b=p.fromTag(b,
c.dom());c=B.children(a);c=F(c,Gc.deep);O.append(b,c);c=ca.descendants(b,"b,strong");A(c,E.unwrap);y.before(a,b);E.remove(a);return N.value(b)},joinLinks:function(a,b){return mc.seekLeft(b,function(a){return"a"===C.name(a)},a).fold(function(){return N.value(b)},function(a){var c=B.children(b);O.append(a,c);E.remove(b);return N.value(a)})}},hC=M("row","y"),iC=M("col","x"),jC=function(a){return Wa.absolute(a).left()+Aa.getOuter(a)},kC=function(a){return Wa.absolute(a).left()},lC=function(a,b){return iC(a,
kC(b))},mC=function(a,b){return iC(a,jC(b))},Ar=function(a){return Wa.absolute(a).top()},Br=function(a,b,c){if(0===c.length)return[];var d=F(c.slice(1),function(b,c){return b.map(function(b){return a(c,b)})}),e=c[c.length-1].map(function(a){return b(c.length-1,a)});return d.concat([e])},U_={delta:aa,positions:t(Br,function(a,b){return hC(a,Ar(b))},function(a,b){return hC(a,Ar(b)+pa.getOuter(b))}),edge:Ar},V_={delta:aa,edge:kC,positions:t(Br,lC,mC)},W_={delta:function(a,b){return-a},edge:jC,positions:t(Br,
mC,lC)},Ni={height:U_,rtl:W_,ltr:V_},Dk={ltr:Ni.ltr,rtl:Ni.rtl},nC=function(a){return"img"===C.name(a)?1:Oa.getOption(a).fold(function(){return B.children(a).length},function(a){return a.length})},X_=function(a){return Oa.getOption(a).filter(function(a){return 0!==a.trim().length||-1<a.indexOf("\u00a0")}).isSome()},Y_=["img","br"],oa={getEnd:nC,isEnd:function(a,b){return nC(a)===b},isStart:function(a,b){return 0===b},isCursorPosition:function(a){return X_(a)||V(Y_,C.name(a))}},Z_=function(a,b){var c=
function(a){a=B.children(a);for(var d=a.length-1;0<=d;d--){var f=a[d];if(b(f))return g.some(f);f=c(f);if(f.isSome())return f}return g.none()};return c(a)},ac={first:function(a){return Da.descendant(a,oa.isCursorPosition)},last:function(a){return Z_(a,oa.isCursorPosition)}},Cr=function(){var a=p.fromTag("td");y.append(a,p.fromTag("br"));return a},$_=function(a,b,c){var d=Gc.copy(a,b);Ra(c,function(a,b){null===a?m.remove(d,b):m.set(d,b,a)});return d},a0=function(a){return a},oC=function(a){return function(){return p.fromTag("tr",
a.dom())}},b0=function(a,b,c){return ac.first(a).map(function(d){var e=c.join(",");d=ca.ancestors(d,e,function(b){return P.eq(b,a)});return zb(d,function(a,b){b=Gc.shallow(b);m.remove(b,"contenteditable");y.append(a,b);return b},b)}).getOr(b)},pC={cellOperations:function(a,b,c){return{row:oC(b),cell:function(b){var d=B.owner(b.element());d=p.fromTag(C.name(b.element()),d.dom());var f=c.getOr("strong em b i span font h1 h2 h3 h4 h5 h6 p div".split(" "));f=0<f.length?b0(b.element(),d,f):d;y.append(f,
p.fromTag("br"));v.copy(b.element(),d);v.remove(d,"height");1!==b.colspan()&&v.remove(b.element(),"width");a(b.element(),d);return d},replace:$_,gap:Cr}},paste:function(a){return{row:oC(a),cell:Cr,replace:a0,gap:Cr}}},pc={erase:function(a,b,c,d){a=p.fromText("");y.after(b,a);E.remove(b);return g.some(Ec(a,0,a,0))},execute:function(a,b,c,d){return function(e,f,h){var l=d(),k=e.doc().getOrDie();e=$v(a.directionAt);var m=g.some([]);k=pC.cellOperations(c,k,m);return b(l,f,h,k,e,u,u).bind(function(a){return a.cursor().map(function(a){return Ec(a,
0,a,0)})})}}},Zp={only:function(a){var b=g.from(a.dom().documentElement).map(p.fromDom).getOr(a);return{parent:k(b),view:k(a),origin:k(Ma(0,0))}},detached:function(a,b){var c=t(Wa.absolute,b);return{parent:k(b),view:k(a),origin:c}},body:function(a,b){return{parent:k(b),view:k(a),origin:k(Ma(0,0))}}},qC=function(a,b,c){return a.isInline()?Zp.detached(a.element(),b.uiContainer()):Zp.only(c)},Tp={get:qC,fromEngine:function(a){var b=a.content(),c=a.smartview();return b.doc().map(function(a){return qC(b,
c,a)})}},c0=M("width","height"),d0=M("rows","columns"),e0=M("row","column"),f0=M("x","y"),g0=M("element","rowspan","colspan"),h0=M("element","rowspan","colspan","isNew"),i0=M("element","rowspan","colspan","row","column"),j0=M("element","cells","section"),k0=M("element","isNew"),l0=M("element","cells","section","isNew"),m0=M("cells","section"),n0=M("details","section"),o0=M("startRow","startCol","finishRow","finishCol"),Ha={dimensions:c0,grid:d0,address:e0,coords:f0,extended:i0,detail:g0,detailnew:h0,
rowdata:j0,elementnew:k0,rowdatanew:l0,rowcells:m0,rowdetails:n0,bounds:o0},Dr=function(a,b,c){return ia(B.children(a),function(a){return za.is(a,b)?c(a)?[a]:[]:Dr(a,b,c)})},kj={firstLayer:function(a,b){return Dr(a,b,k(!0))},filterFirstLayer:Dr},Er=function(a,b,c){var d=void 0!==c?c:k(!1);return d(b)?g.none():V(a,C.name(b))?g.some(b):L.ancestor(b,a.join(","),function(a){return za.is(a,"table")||d(a)})},rC=function(a,b){return B.parent(b).map(function(b){return ca.children(b,a)})},p0=t(rC,"th,td"),
q0=t(rC,"tr"),Fr=function(a,b){return parseInt(m.get(a,b),10)},mb={cell:function(a,b){return Er(["td","th"],a,b)},firstCell:function(a){return L.descendant(a,"th,td")},cells:function(a){return kj.firstLayer(a,"th,td")},neighbourCells:p0,table:function(a,b){return L.closest(a,"table",b)},row:function(a,b){return Er(["tr"],a,b)},rows:function(a){return kj.firstLayer(a,"tr")},notCell:function(a,b){return Er(["caption","tr","tbody","tfoot","thead"],a,b)},neighbourRows:q0,attr:Fr,grid:function(a,b,c){b=
Fr(a,b);a=Fr(a,c);return Ha.grid(b,a)}},Bf={fromTable:function(a){a=mb.rows(a);return F(a,function(a){var b=B.parent(a).map(function(a){a=C.name(a);return"tfoot"===a||"thead"===a||"tbody"===a?a:"tbody"}).getOr("tbody"),d=F(mb.cells(a),function(a){var b=m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1,c=m.has(a,"colspan")?parseInt(m.get(a,"colspan"),10):1;return Ha.detail(a,b,c)});return Ha.rowdata(a,d,b)})},fromPastedRows:function(a,b){return F(a,function(a){var c=F(mb.cells(a),function(a){var b=
m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1,c=m.has(a,"colspan")?parseInt(m.get(a,"colspan"),10):1;return Ha.detail(a,b,c)});return Ha.rowdata(a,c,b.section())})}},sC=function(a,b){a=ia(a.all(),function(a){return a.cells()});return ka(a,b)},vb={generate:function(a){var b={},c=[],d=a.length,e=0;A(a,function(a,d){var f=[];A(a.cells(),function(a,c){for(c=0;void 0!==b[d+","+c];)c++;for(var h=Ha.extended(a.element(),a.rowspan(),a.colspan(),d,c),l=0;l<a.colspan();l++)for(var g=0;g<a.rowspan();g++){var k=
c+l;b[d+g+","+k]=h;e=Math.max(e,k+1)}f.push(h)});c.push(Ha.rowdata(a.element(),f,a.section()))});a=Ha.grid(d,e);return{grid:k(a),access:k(b),all:k(c)}},getAt:function(a,b,c){a=a.access()[b+","+c];return void 0!==a?g.some(a):g.none()},findItem:function(a,b,c){a=sC(a,function(a){return c(b,a.element())});return 0<a.length?g.some(a[0]):g.none()},filterItems:sC,justCells:function(a){a=F(a.all(),function(a){return a.cells()});return Kb(a)}},Pd={repeat:function(a,b){for(var c=[],d=0;d<a;d++)c.push(b(d));
return c},range:function(a,b){for(var c=[];a<b;a++)c.push(a);return c},unique:function(a,b){var c=[];A(a,function(d,e){e<a.length-1&&!b(d,a[e+1])?c.push(d):e===a.length-1&&c.push(d)});return c},deduce:function(a,b){if(0>b||b>=a.length-1)return g.none();var c=a[b].fold(function(){var c=Ld(a.slice(0,b));return oc(c,function(a,b){return a.map(function(a){return{value:a,delta:b+1}})})},function(a){return g.some({value:a,delta:0})}),d=a[b+1].fold(function(){var c=a.slice(b+1);return oc(c,function(a,b){return a.map(function(a){return{value:a,
delta:b+1}})})},function(a){return g.some({value:a,delta:1})});return c.bind(function(a){return d.map(function(b){return Math.abs(b.value-a.value)/(b.delta+a.delta)})})}},tC=function(a,b,c){var d=a();return va(d,b).orThunk(function(){return g.from(d[0]).orThunk(c)}).map(function(a){return a.element()})},rm={columns:function(a){var b=a.grid(),c=Pd.range(0,b.columns()),d=Pd.range(0,b.rows());return F(c,function(b){return tC(function(){return ia(d,function(c){return vb.getAt(a,c,b).filter(function(a){return a.column()===
b}).fold(k([]),function(a){return[a]})})},function(a){return 1===a.colspan()},function(){return vb.getAt(a,0,b)})})},rows:function(a){var b=a.grid(),c=Pd.range(0,b.rows()),d=Pd.range(0,b.columns());return F(c,function(b){return tC(function(){return ia(d,function(c){return vb.getAt(a,b,c).filter(function(a){return a.row()===b}).fold(k([]),function(a){return[a]})})},function(a){return 1===a.rowspan()},function(){return vb.getAt(a,b,0)})})}},uC=ba.detect(),lh=function(a,b,c){a=v.get(a,b);a=parseFloat(a);
return isNaN(a)?c:a},r0={getWidth:function(a){return lh(a,"width",Aa.get(a))},getHeight:function(a){if(uC.browser.isIE()||uC.browser.isEdge()){var b=lh(a,"padding-top",0),c=lh(a,"padding-bottom",0),d=lh(a,"border-top-width",0),e=lh(a,"border-bottom-width",0),f=a.dom().getBoundingClientRect().height;a="border-box"===v.get(a,"box-sizing")?f:f-b-c-(d+e)}else a=lh(a,"height",pa.get(a));return a}},vC=/(\d+(\.\d+)?)(\w|%)*/,lj=/(\d+(\.\d+)?)%/,Gr=/(\d+(\.\d+)?)px|em/,wC=function(a,b){v.set(a,"height",b+
"px")},s0=function(a){return v.getRaw(a,"height").getOrThunk(function(){return r0.getHeight(a)+"px"})},t0=function(a,b,c,d){var e=mb.table(a).map(function(a){a=c(a);return Math.floor(b/100*a)}).getOr(b);d(a,e);return e},sm=function(a){return v.getRaw(a,"width").fold(function(){return g.from(m.get(a,"width"))},function(a){return g.some(a)})},fc={percentageBasedSizeRegex:k(lj),pixelBasedSizeRegex:k(Gr),setPixelWidth:function(a,b){v.set(a,"width",b+"px")},setPercentageWidth:function(a,b){v.set(a,"width",
b+"%")},setHeight:wC,getPixelWidth:function(a,b){return sm(a).fold(function(){return Aa.get(a)},function(c){Gr.test(c)?(c=Gr.exec(c),c=parseInt(c[1],10)):lj.test(c)?(c=lj.exec(c),c=parseFloat(c[1])/100*b.pixelWidth()):c=Aa.get(a);return c})},getPercentageWidth:function(a,b){return sm(a).fold(function(){return Aa.get(a)/b.pixelWidth()*100},function(c){lj.test(c)?(c=lj.exec(c),c=parseFloat(c[1])):c=Aa.get(a)/b.pixelWidth()*100;return c})},getGenericWidth:function(a){return sm(a).bind(function(a){return vC.test(a)?
(a=vC.exec(a),g.some({width:k(a[1]),unit:k(a[3])})):g.none()})},setGenericWidth:function(a,b,c){v.set(a,"width",b+c)},getHeight:function(a){var b;if(b=s0(a)){var c=pa.get,d=parseInt(b,10);b=ce(b,"%")&&"table"!==C.name(a)?t0(a,d,c,wC):d}else b=pa.get(a);a=m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1;return b/a},getRawWidth:sm},xC=function(a,b){return m.has(a,b)&&1<parseInt(m.get(a,b),10)},xd={hasColspan:function(a){return xC(a,"colspan")},hasRowspan:function(a){return xC(a,"rowspan")},minWidth:k(10),
minHeight:k(10),getInt:function(a,b){return parseInt(v.get(a,b),10)}},yC=function(a,b,c){return v.getRaw(a,b).fold(function(){return c(a)+"px"},function(a){return a})},u0=function(a){return yC(a,"width",fc.getPixelWidth)},v0=function(a){return yC(a,"height",fc.getHeight)},Hr=function(a,b,c,d,e){a=rm.columns(a);var f=F(a,function(a){return a.map(b.edge)});return F(a,function(a,b){return a.filter(xf(xd.hasColspan)).fold(function(){var a=Pd.deduce(f,b);return d(a)},function(a){return c(a,e)})})},zC=
function(a){return a.map(function(a){return a+"px"}).getOr("")},AC=function(a,b,c,d){a=rm.rows(a);var e=F(a,function(a){return a.map(b.edge)});return F(a,function(a,b){return a.filter(xf(xd.hasRowspan)).fold(function(){var a=Pd.deduce(e,b);return d(a)},function(a){return c(a)})})},mj={getRawWidths:function(a,b){return Hr(a,b,u0,zC)},getPixelWidths:function(a,b,c){return Hr(a,b,fc.getPixelWidth,function(a){return a.getOrThunk(c.minCellWidth)},c)},getPercentageWidths:function(a,b,c){return Hr(a,b,fc.getPercentageWidth,
function(a){return a.fold(function(){return c.minCellWidth()},function(a){return a/c.pixelWidth()*100})},c)},getPixelHeights:function(a,b){return AC(a,b,fc.getHeight,function(a){return a.getOrThunk(xd.minHeight)})},getRawHeights:function(a,b){return AC(a,b,v0,zC)}},tm=sa.generate([{invalid:["raw"]},{pixels:["value"]},{percent:["value"]}]),BC=function(a,b,c){a=c.substring(0,c.length-a.length);var d=parseFloat(a);return a===d.toString()?b(d):tm.invalid(c)},ug=function(a){return ce(a,"%")?BC("%",tm.percent,
a):ce(a,"px")?BC("px",tm.pixels,a):tm.invalid(a)},w0=function(a,b){return F(a,function(a){return ug(a).fold(function(){return a},function(a){return a/b*100+"%"},function(a){return a+"%"})})},x0=function(a,b,c){var d=c/b;return F(a,function(a){return ug(a).fold(function(){return a},function(a){return a*d+"px"},function(a){return a/100*c+"px"})})},y0=function(a,b){a=a.fold(function(){return k("")},function(a){return k(a/b+"px")},function(a){return k(a/b+"px")});return Pd.repeat(b,a)},z0=function(a,
b,c){return a.fold(function(){return b},function(a){return x0(b,c,a)},function(a){return w0(b,c)})},CC=function(a,b){var c=Math.floor(a);return{value:c+b,remainder:a-c}},A0=function(a,b){return ug(a).fold(k(a),function(a){return a+b+"px"},function(a){return a+b+"%"})},DC=function(a){if(0===a.length)return a;a=zb(a,function(a,b){var c=ug(b).fold(function(){return{value:b,remainder:0}},function(a){return CC(a,"px")},function(a){return CC(a,"%")});return{output:[c.value].concat(a.output),remainder:a.remainder+
c.remainder}},{output:[],remainder:0});var b=a.output;return b.slice(0,b.length-1).concat([A0(b[b.length-1],Math.round(a.remainder))])},nj={validate:ug,redistribute:function(a,b,c){c=ug(c);a=kb(a,function(a){return"0px"===a})?y0(c,a.length):z0(c,a,b);return DC(a)},sum:function(a,b){return 0===a.length?b:zb(a,function(a,b){return ug(b).fold(k(0),aa,aa)+a},0)},toIntegers:DC},B0=function(a,b,c){A(b,function(b){var d=a.slice(b.column(),b.colspan()+b.column());d=nj.sum(d,xd.minWidth());v.set(b.element(),
"width",d+c)})},C0=function(a,b,c,d){A(c,function(b){var c=a.slice(b.row(),b.rowspan()+b.row());c=nj.sum(c,xd.minHeight());v.set(b.element(),"height",c+d)});A(b,function(b,c){v.set(b.element(),"height",a[c])})},EC=function(a){return nj.validate(a).fold(k("px"),k("px"),k("%"))},D0={redistribute:function(a,b,c,d){var e=Bf.fromTable(a),f=vb.generate(e),h=f.all(),l=vb.justCells(f);b.each(function(b){var c=EC(b),e=Aa.get(a),h=mj.getRawWidths(f,d);e=nj.redistribute(h,e,b);B0(e,l,c);v.set(a,"width",b)});
c.each(function(b){var c=EC(b),d=pa.get(a),e=mj.getRawHeights(f,Ni.height);d=nj.redistribute(e,d,b);C0(d,h,l,c);v.set(a,"height",b)})}},E0=function(a){var b=m.has(a,"colspan")?parseInt(m.get(a,"colspan"),10):1,c=m.has(a,"rowspan")?parseInt(m.get(a,"rowspan"),10):1;return{element:k(a),colspan:k(b),rowspan:k(c)}},Ir=Ac(Qd,["cell","row","replace","gap"]),Tb={modification:function(a,b){Ir(a);var c=Ga(g.none()),d=void 0!==b?b:E0,e=function(b){var e=d(b);e=a.cell(e);c.get().isNone()&&c.set(g.some(e));f=
g.some({item:b,replacement:e});return e},f=g.none();return{getOrInit:function(a,b){return f.fold(function(){return e(a)},function(c){return b(a,c.item)?c.replacement:e(a)})},cursor:c.get}},transform:function(a,b){return function(c){var d=Ga(g.none());Ir(c);var e=[],f=function(a,b){return va(e,function(c){return b(c.item,a)})},h=function(f){var h=c.replace(f,b,{scope:a});e.push({item:f,sub:h});d.get().isNone()&&d.set(g.some(h));return h};return{replaceOrInit:function(a,b){return f(a,b).fold(function(){return h(a)},
function(c){return b(a,c.item)?c.sub:h(a)})},cursor:d.get}}},merging:function(a){Ir(a);var b=Ga(g.none());return{combine:function(c){b.get().isNone()&&b.set(g.some(c));return function(){var b=a.cell({element:k(c),colspan:k(1),rowspan:k(1)});v.remove(b,"width");v.remove(c,"width");return b}},cursor:b.get}}},F0="body p div article aside figcaption figure footer header nav section ol ul table thead tfoot tbody caption tr td th h1 h2 h3 h4 h5 h6 blockquote pre address".split(" "),FC=function(a,b){a=a.property().name(b);
return V(F0,a)},GC=function(a,b){return V(["br","img","hr","input"],a.property().name(b))},yc={isBlock:FC,isList:function(a,b){a=a.property().name(b);return V(["ol","ul"],a)},isFormatting:function(a,b){a=a.property().name(b);return V("address pre p h1 h2 h3 h4 h5 h6".split(" "),a)},isHeading:function(a,b){a=a.property().name(b);return V("h1 h2 h3 h4 h5 h6".split(" "),a)},isContainer:function(a,b){return V("div li td th blockquote body caption".split(" "),a.property().name(b))},isEmptyTag:GC,isFrame:function(a,
b){return"iframe"===a.property().name(b)},isInline:function(a,b){return!(FC(a,b)||GC(a,b))&&"li"!==a.property().name(b)}},Cf=gb(),la={isBlock:function(a){return yc.isBlock(Cf,a)},isList:function(a){return yc.isList(Cf,a)},isFormatting:function(a){return yc.isFormatting(Cf,a)},isHeading:function(a){return yc.isHeading(Cf,a)},isContainer:function(a){return yc.isContainer(Cf,a)},isEmptyTag:function(a){return yc.isEmptyTag(Cf,a)},isFrame:function(a){return yc.isFrame(Cf,a)},isInline:function(a){return yc.isInline(Cf,
a)}},G0={merge:function(a){var b=function(a){return kb(a,function(a){return"br"===C.name(a)||C.isText(a)&&0===Oa.get(a).trim().length})},c=function(a){return B.nextSibling(a).map(function(a){if(la.isBlock(a))return!0;if(la.isEmptyTag(a))return"img"===C.name(a)?!1:!0}).getOr(!1)},d=function(a){return ac.last(a).bind(function(b){var d=c(b);return B.parent(b).map(function(c){var e;(e=!0===d)||(e="li"===C.name(c)||Da.ancestor(c,la.isList).isSome());return e||"br"===C.name(b)||la.isBlock(c)&&!P.eq(a,c)?
[]:[p.fromTag("br")]})}).getOr([])},e=function(){var c=ia(a,function(a){var c=B.children(a);return b(c)?[]:c.concat(d(a))});return 0===c.length?[p.fromTag("br")]:c}();E.empty(a[0]);O.append(a[0],e)}},HC=function(a,b){return Ha.rowcells(b,a.section())},IC=function(a,b){return a.cells()[b]},Ea={addCell:function(a,b,c){var d=a.cells(),e=d.slice(0,b);b=d.slice(b);c=e.concat([c]).concat(b);return HC(a,c)},setCells:HC,mutateCell:function(a,b,c){a.cells()[b]=c},getCell:IC,getCellElement:function(a,b){return IC(a,
b).element()},mapCells:function(a,b){var c=a.cells();b=F(c,b);return Ha.rowcells(b,a.section())},cellLength:function(a){return a.cells().length}},H0=function(a,b){return F(a,function(a){return Ea.getCell(a,b)})},JC=function(a,b){if(0===a.length)return 0;var c=a[0];return Ta(a,function(a){return!b(c.element(),a.element())}).fold(function(){return a.length},function(a){return a})},I0={subgrid:function(a,b,c,d){var e=a[b].cells().slice(c);e=JC(e,d);a=H0(a,c).slice(b);d=JC(a,d);return{colspan:k(e),rowspan:k(d)}}},
um={toDetails:function(a,b){var c=F(a,function(a,b){return F(a.cells(),function(a,b){return!1})});return F(a,function(d,e){var f=ia(d.cells(),function(d,f){if(!1===c[e][f]){for(var h=I0.subgrid(a,e,f,b),l=h.rowspan(),g=h.colspan(),k=e;k<e+l;k++)for(var m=f;m<f+g;m++)c[k][m]=!0;return[Ha.detailnew(d.element(),h.rowspan(),h.colspan(),d.isNew())]}return[]});return Ha.rowdetails(f,d.section())})},toGrid:function(a,b,c){for(var d=[],e=0;e<a.grid().rows();e++){for(var f=[],h=0;h<a.grid().columns();h++){var l=
vb.getAt(a,e,h).map(function(a){return Ha.elementnew(a.element(),c)}).getOrThunk(function(){return Ha.elementnew(b.gap(),!0)});f.push(l)}f=Ha.rowcells(f,a.all()[e].section());d.push(f)}return d}},vm=function(a,b,c,d){c===d?m.remove(a,b):m.set(a,b,c)},J0={render:function(a,b){var c=[],d=[],e=function(b,e){var f=L.child(a,e).getOrThunk(function(){var b=p.fromTag(e,B.owner(a).dom());y.append(a,b);return b});E.empty(f);b=F(b,function(a){a.isNew()&&c.push(a.element());var b=a.element();E.empty(b);A(a.cells(),
function(a){a.isNew()&&d.push(a.element());vm(a.element(),"colspan",a.colspan(),1);vm(a.element(),"rowspan",a.rowspan(),1);y.append(b,a.element())});return b});O.append(f,b)},f=function(b,c){0<b.length?e(b,c):L.child(a,c).each(E.remove)},h=[],l=[],g=[];A(b,function(a){switch(a.section()){case "thead":h.push(a);break;case "tbody":l.push(a);break;case "tfoot":g.push(a)}});f(h,"thead");f(l,"tbody");f(g,"tfoot");return{newRows:k(c),newCells:k(d)}},copy:function(a){return F(a,function(a){var b=Gc.shallow(a.element());
A(a.cells(),function(a){var c=Gc.deep(a.element());vm(c,"colspan",a.colspan(),1);vm(c,"rowspan",a.rowspan(),1);y.append(b,c)});return b})}},KC={col:function(a,b,c,d,e){var f=p.fromTag("div");v.setAll(f,{position:"absolute",left:b-d/2+"px",top:c+"px",height:e+"px",width:d+"px"});m.setAll(f,{"data-column":a,role:"presentation"});return f},row:function(a,b,c,d,e){var f=p.fromTag("div");v.setAll(f,{position:"absolute",left:b+"px",top:c-e/2+"px",height:e+"px",width:d+"px"});m.setAll(f,{"data-row":a,role:"presentation"});
return f}},dd={resolve:am("ephox-snooker").resolve},Jr=dd.resolve("resizer-bar"),LC=dd.resolve("resizer-rows"),MC=dd.resolve("resizer-cols"),NC=function(a){a=ca.descendants(a.parent(),"."+Jr);A(a,E.remove)},OC=function(a,b,c){var d=a.origin();A(b,function(b,f){b.each(function(b){b=c(d,b);n.add(b,Jr);y.append(a.parent(),b)})})},K0=function(a,b,c,d){OC(a,b,function(a,b){a=KC.col(b.col(),b.x()-a.left(),c.top()-a.top(),7,d);n.add(a,MC);return a})},L0=function(a,b,c,d){OC(a,b,function(a,b){a=KC.row(b.row(),
c.left()-a.left(),b.y()-a.top(),d,7);n.add(a,LC);return a})},PC=function(a,b){a=ca.descendants(a.parent(),"."+Jr);A(a,b)},ee={refresh:function(a,b,c,d){NC(a);var e=Bf.fromTable(b);e=vb.generate(e);var f=rm.rows(e),h=rm.columns(e);e=Wa.absolute(b);c=0<f.length?c.positions(f,b):[];L0(a,c,e,Aa.getOuter(b));d=0<h.length?d.positions(h,b):[];K0(a,d,e,pa.getOuter(b))},hide:function(a){PC(a,function(a){v.set(a,"display","none")})},show:function(a){PC(a,function(a){v.set(a,"display","block")})},destroy:NC,
isRowBar:function(a){return n.has(a,LC)},isColBar:function(a){return n.has(a,MC)}},M0=function(a,b){var c=function(a){return oc(a,function(a){return B.parent(a.element()).map(function(a){var b=B.parent(a).isNone();return Ha.elementnew(a,b)})}).getOrThunk(function(){return Ha.elementnew(b.row(),!0)})};return F(a,function(a){var b=c(a.details());return Ha.rowdatanew(b.element(),a.details(),a.section(),b.isNew())})},QC=function(a,b){a=um.toDetails(a,P.eq);return M0(a,b)},wm=function(a,b){a=Kb(F(a.all(),
function(a){return a.cells()}));return va(a,function(a){return P.eq(b,a.element())})},Ia={run:function(a,b,c,d,e){return function(f,h,l,r,m){var x=Bf.fromTable(h),D=vb.generate(x);return b(D,l).map(function(b){var c=um.toGrid(D,r,!1);b=a(c,b,P.eq,e(r));c=QC(b.grid(),r);return{grid:k(c),cursor:b.cursor}}).fold(function(){return g.none()},function(a){var b=J0.render(h,a.grid());c(h,a.grid(),m);d(h);ee.refresh(f,h,Ni.height,m);return g.some({cursor:a.cursor,newRows:b.newRows,newCells:b.newCells})})}},
toDetailList:QC,onCell:function(a,b){return mb.cell(b.element()).bind(function(b){return wm(a,b)})},onCells:function(a,b){b=F(b.selection(),function(b){return mb.cell(b).bind(function(b){return wm(a,b)})});b=Td(b);return 0<b.length?g.some(b):g.none()},onPaste:function(a,b){return mb.cell(b.element()).bind(function(c){return wm(a,c).map(function(a){return ra(a,{generators:b.generators,clipboard:b.clipboard})})})},onPasteRows:function(a,b){var c=F(b.selection(),function(b){return mb.cell(b).bind(function(b){return wm(a,
b)})});c=Td(c);return 0<c.length?g.some(ra({cells:c},{generators:b.generators,clipboard:b.clipboard})):g.none()},onMergable:function(a,b){return b.mergable()},onUnmergable:function(a,b){return b.unmergable()}},RC=function(a,b){return F(a,function(){return Ha.elementnew(b.cell(),!0)})},N0=function(a,b,c){return a.concat(Pd.repeat(b,function(b){return Ea.setCells(a[a.length-1],RC(a[a.length-1].cells(),c))}))},O0=function(a,b,c){return F(a,function(a){return Ea.setCells(a,a.cells().concat(RC(Pd.range(0,
b),c)))})},mh={measure:function(a,b,c){if(a.row()>=b.length||a.column()>Ea.cellLength(b[0]))return N.error("invalid start address out of table bounds, row: "+a.row()+", column: "+a.column());b=b.slice(a.row());a=b[0].cells().slice(a.column());var d=Ea.cellLength(c[0]);return N.value({rowDelta:k(b.length-c.length),colDelta:k(a.length-d)})},measureWidth:function(a,b){a=Ea.cellLength(a[0]);b=Ea.cellLength(b[0]);return{rowDelta:k(0),colDelta:k(a-b)}},tailor:function(a,b,c){var d=0>b.colDelta()?O0:aa,
e=0>b.rowDelta()?N0:aa;a=d(a,Math.abs(b.colDelta()),c);return e(a,Math.abs(b.rowDelta()),c)}},P0=function(a,b){return hb(a,function(a,d){return Va(a,function(a){return b(a.element(),d.element())})?a:a.concat([d])},[])},xm={merge:function(a,b,c,d){if(0===a.length)return a;for(c=b.startRow();c<=b.finishRow();c++)for(var e=b.startCol();e<=b.finishCol();e++)Ea.mutateCell(a[c],e,Ha.elementnew(d(),!1));return a},unmerge:function(a,b,c,d){for(var e=!0,f=0;f<a.length;f++)for(var h=0;h<Ea.cellLength(a[0]);h++){var l=
Ea.getCellElement(a[f],h);l=c(l,b);!0===l&&!1===e?Ea.mutateCell(a[f],h,Ha.elementnew(d(),!0)):!0===l&&(e=!1)}return a},splitRows:function(a,b,c,d){if(0<b&&b<a.length){var e=a[b-1].cells();e=P0(e,c);A(e,function(e){for(var f=g.none(),l=b;l<a.length;l++)for(var k=0;k<Ea.cellLength(a[0]);k++){var m=a[l].cells()[k];c(m.element(),e.element())&&(f.isNone()&&(f=g.some(d())),f.each(function(b){Ea.mutateCell(a[l],k,Ha.elementnew(b,!0))}))}})}return a}},Kr={merge:function(a,b,c,d,e){return mh.measure(a,b,c).map(function(f){f=
mh.tailor(b,f,d);var h=a.row(),l=a.column(),g=c.length,k=Ea.cellLength(c[0]);g=h+g;k=l+k;for(var m=h;m<g;m++)for(var n=l;n<k;n++){var p=f,q=m,u=n,v=e,w=Ea.getCell(p[q],u);v=t(v,w.element());w=p[q];1<p.length&&1<Ea.cellLength(w)&&(0<u&&v(Ea.getCellElement(w,u-1))||u<w.length-1&&v(Ea.getCellElement(w,u+1))||0<q&&v(Ea.getCellElement(p[q-1],u))||q<p.length-1&&v(Ea.getCellElement(p[q+1],u)))&&xm.unmerge(f,Ea.getCellElement(f[m],n),e,d.cell);p=Ea.getCellElement(c[m-h],n-l);p=d.replace(p);Ea.mutateCell(f[m],
n,Ha.elementnew(p,!0))}return f})},insert:function(a,b,c,d,e){xm.splitRows(b,a,e,d.cell);e=mh.measureWidth(c,b);c=mh.tailor(c,e,d);e=mh.measureWidth(b,c);b=mh.tailor(b,e,d);return b.slice(0,a).concat(c).concat(b.slice(a,b.length))}},Ad={insertRowAt:function(a,b,c,d,e){var f=a.slice(0,b),h=a.slice(b);c=Ea.mapCells(a[c],function(c,f){return 0<b&&b<a.length&&d(Ea.getCellElement(a[b-1],f),Ea.getCellElement(a[b],f))?Ea.getCell(a[b],f):Ha.elementnew(e(c.element(),d),!0)});return f.concat([c]).concat(h)},
insertColumnAt:function(a,b,c,d,e){return F(a,function(a){var f=0<b&&b<Ea.cellLength(a)&&d(Ea.getCellElement(a,b-1),Ea.getCellElement(a,b))?Ea.getCell(a,b):Ha.elementnew(e(Ea.getCellElement(a,c),d),!0);return Ea.addCell(a,b,f)})},splitCellIntoColumns:function(a,b,c,d,e){var f=c+1;return F(a,function(a,l){l=l===b?Ha.elementnew(e(Ea.getCellElement(a,c),d),!0):Ea.getCell(a,c);return Ea.addCell(a,f,l)})},splitCellIntoRows:function(a,b,c,d,e){var f=b+1,h=a.slice(0,f);f=a.slice(f);a=Ea.mapCells(a[b],function(a,
b){return b===c?Ha.elementnew(e(a.element(),d),!0):a});return h.concat([a]).concat(f)},deleteRowsAt:function(a,b,c){return a.slice(0,b).concat(a.slice(c+1))},deleteColumnsAt:function(a,b,c){a=F(a,function(a){var d=a.cells().slice(0,b).concat(a.cells().slice(c+1));return Ha.rowcells(d,a.section())});return ka(a,function(a){return 0<a.cells().length})}},SC=function(a,b,c,d){var e=function(a){return Va(b,function(b){return c(a.element(),b.element())})};return F(a,function(a){return Ea.mapCells(a,function(a){return e(a)?
Ha.elementnew(d(a.element(),c),!0):a})})},TC=function(a,b,c,d){return void 0!==Ea.getCellElement(a[b],c)&&0<b&&d(Ea.getCellElement(a[b-1],c),Ea.getCellElement(a[b],c))},UC=function(a,b,c){return 0<b&&c(Ea.getCellElement(a,b-1),Ea.getCellElement(a,b))},ym={replaceColumn:function(a,b,c,d){var e=ia(a,function(d,e){return TC(a,e,b,c)||UC(d,b,c)?[]:[Ea.getCell(d,b)]});return SC(a,e,c,d)},replaceRow:function(a,b,c,d){var e=a[b],f=ia(e.cells(),function(d,f){return TC(a,b,f,c)||UC(e,f,c)?[]:[d]});return SC(a,
f,c,d)}},nh={none:function(){return{fold:function(a,b,c,d,e){return a()}}},only:function(a){return{fold:function(b,c,d,e,f){return c(a)}}},left:function(a,b){return{fold:function(c,d,e,f,h){return e(a,b)}}},middle:function(a,b,c){return{fold:function(d,e,f,h,l){return h(a,b,c)}}},right:function(a,b){return{fold:function(c,d,e,f,h){return h(a,b)}}}},Q0=function(a,b){return 0===a.length?nh.none():1===a.length?nh.only(0):0===b?nh.left(0,1):b===a.length-1?nh.right(b-1,b):0<b&&b<a.length-1?nh.middle(b-
1,b,b+1):nh.none()},R0={determine:function(a,b,c,d){var e=a.slice(0);a=Q0(a,b);var f=function(a){return F(a,k(0))};b=k(f(e));var h=function(a,b){if(0<=c){var h=Math.max(d.minCellWidth(),e[b]-c);return f(e.slice(0,a)).concat([c,h-e[b]]).concat(f(e.slice(b+1)))}h=Math.max(d.minCellWidth(),e[a]+c);var l=e[a]-h;return f(e.slice(0,a)).concat([h-e[a],l]).concat(f(e.slice(b+1)))};return a.fold(b,function(a){return d.singleColumnWidth(e[a],c)},h,function(a,b,c){return h(b,c)},function(a,b){if(0<=c)return f(e.slice(0,
b)).concat([c]);a=Math.max(d.minCellWidth(),e[b]+c);return f(e.slice(0,b)).concat([a-e[b]])})}},VC=function(a,b,c){for(var d=0;a<b;a++)d+=void 0!==c[a]?c[a]:0;return d},zm={recalculateWidth:function(a,b){a=vb.justCells(a);return F(a,function(a){var c=VC(a.column(),a.column()+a.colspan(),b);return{element:a.element,width:k(c),colspan:a.colspan}})},recalculateHeight:function(a,b){a=vb.justCells(a);return F(a,function(a){var c=VC(a.row(),a.row()+a.rowspan(),b);return{element:a.element,height:k(c),rowspan:a.rowspan}})},
matchRowHeight:function(a,b){return F(a.all(),function(a,d){return{element:a.element,height:k(b[d])}})}},S0=function(a,b){var c=parseFloat(a),d=Aa.get(b);return{width:k(c),pixelWidth:k(d),getWidths:mj.getPercentageWidths,getCellDelta:function(a){return a/d*100},singleColumnWidth:function(a,b){return[100-a]},minCellWidth:function(){return xd.minWidth()/d*100},setElementWidth:fc.setPercentageWidth,setTableWidth:function(a,b,d){fc.setPercentageWidth(a,c+d)}}},Lr=function(a){a=parseInt(a,10);var b=aa;
return{width:k(a),pixelWidth:k(a),getWidths:mj.getPixelWidths,getCellDelta:b,singleColumnWidth:function(a,b){return[Math.max(xd.minWidth(),a+b)-a]},minCellWidth:xd.minWidth,setElementWidth:fc.setPixelWidth,setTableWidth:function(a,b,e){b=zb(b,function(a,b){return a+b},0);fc.setPixelWidth(a,b)}}},WC={getTableSize:function(a){return fc.getRawWidth(a).fold(function(){var b=Aa.get(a);return Lr(b)},function(b){fc.percentageBasedSizeRegex().test(b)?(b=fc.percentageBasedSizeRegex().exec(b),b=S0(b[1],a)):
fc.pixelBasedSizeRegex().test(b)?(b=fc.pixelBasedSizeRegex().exec(b),b=Lr(b[1])):(b=Aa.get(a),b=Lr(b));return b})}},T0=function(a){return zb(a,function(a,c){return a+c},0)},XC=function(a){a=Bf.fromTable(a);return vb.generate(a)},Yp={adjustWidth:function(a,b,c,d){var e=WC.getTableSize(a);b=e.getCellDelta(b);var f=XC(a),h=e.getWidths(f,d,e);d=R0.determine(h,c,b,e);d=F(d,function(a,b){return a+h[b]});var l=zm.recalculateWidth(f,d);A(l,function(a){e.setElementWidth(a.element(),a.width())});c===f.grid().columns()-
1&&e.setTableWidth(a,d,b)},adjustHeight:function(a,b,c,d){var e=XC(a);d=mj.getPixelHeights(e,d);d=F(d,function(a,d){return c===d?Math.max(b+a,xd.minHeight()):a});var f=zm.recalculateHeight(e,d);e=zm.matchRowHeight(e,d);A(e,function(a){fc.setHeight(a.element(),a.height())});A(f,function(a){fc.setHeight(a.element(),a.height())});e=T0(d);fc.setHeight(a,e)},adjustWidthTo:function(a,b,c){var d=WC.getTableSize(a);b=vb.generate(b);c=d.getWidths(b,c,d);b=zm.recalculateWidth(b,c);A(b,function(a){d.setElementWidth(a.element(),
a.width())});c=zb(c,function(a,b){return b+a},0);0<b.length&&d.setElementWidth(a,c)}},YC=function(a){0===mb.cells(a).length&&E.remove(a)},Xe=M("grid","cursor"),oj=function(a,b,c){return Mr(a,b,c).orThunk(function(){return Mr(a,0,0)})},Mr=function(a,b,c){return g.from(a[b]).bind(function(a){return g.from(a.cells()[c]).bind(function(a){return g.from(a.element())})})},Yc=function(a,b,c){return Xe(a,Mr(a,b,c))},Nr=function(a){return hb(a,function(a,c){return Va(a,function(a){return a.row()===c.row()})?
a:a.concat([c])},[]).sort(function(a,c){return a.row()-c.row()})},Or=function(a){return hb(a,function(a,c){return Va(a,function(a){return a.column()===c.column()})?a:a.concat([c])},[]).sort(function(a,c){return a.column()-c.column()})},ZC=function(a,b,c){a=Bf.fromPastedRows(a,c);a=vb.generate(a);return um.toGrid(a,b,!0)},Df=Yp.adjustWidthTo,dc={insertRowBefore:Ia.run(function(a,b,c,d){var e=b.row(),f=b.row();a=Ad.insertRowAt(a,f,e,c,d.getOrInit);return Yc(a,f,b.column())},Ia.onCell,u,u,Tb.modification),
insertRowsBefore:Ia.run(function(a,b,c,d){var e=b[0].row(),f=b[0].row(),h=Nr(b);a=hb(h,function(a,b){return Ad.insertRowAt(a,f,e,c,d.getOrInit)},a);return Yc(a,f,b[0].column())},Ia.onCells,u,u,Tb.modification),insertRowAfter:Ia.run(function(a,b,c,d){var e=b.row(),f=b.row()+b.rowspan();a=Ad.insertRowAt(a,f,e,c,d.getOrInit);return Yc(a,f,b.column())},Ia.onCell,u,u,Tb.modification),insertRowsAfter:Ia.run(function(a,b,c,d){var e=Nr(b),f=e[e.length-1].row(),h=e[e.length-1].row()+e[e.length-1].rowspan();
a=hb(e,function(a,b){return Ad.insertRowAt(a,h,f,c,d.getOrInit)},a);return Yc(a,h,b[0].column())},Ia.onCells,u,u,Tb.modification),insertColumnBefore:Ia.run(function(a,b,c,d){var e=b.column(),f=b.column();a=Ad.insertColumnAt(a,f,e,c,d.getOrInit);return Yc(a,b.row(),f)},Ia.onCell,Df,u,Tb.modification),insertColumnsBefore:Ia.run(function(a,b,c,d){var e=Or(b),f=e[0].column(),h=e[0].column();a=hb(e,function(a,b){return Ad.insertColumnAt(a,h,f,c,d.getOrInit)},a);return Yc(a,b[0].row(),h)},Ia.onCells,Df,
u,Tb.modification),insertColumnAfter:Ia.run(function(a,b,c,d){var e=b.column(),f=b.column()+b.colspan();a=Ad.insertColumnAt(a,f,e,c,d.getOrInit);return Yc(a,b.row(),f)},Ia.onCell,Df,u,Tb.modification),insertColumnsAfter:Ia.run(function(a,b,c,d){var e=b[b.length-1].column(),f=b[b.length-1].column()+b[b.length-1].colspan(),h=Or(b);a=hb(h,function(a,b){return Ad.insertColumnAt(a,f,e,c,d.getOrInit)},a);return Yc(a,b[0].row(),f)},Ia.onCells,Df,u,Tb.modification),splitCellIntoColumns:Ia.run(function(a,
b,c,d){a=Ad.splitCellIntoColumns(a,b.row(),b.column(),c,d.getOrInit);return Yc(a,b.row(),b.column())},Ia.onCell,Df,u,Tb.modification),splitCellIntoRows:Ia.run(function(a,b,c,d){a=Ad.splitCellIntoRows(a,b.row(),b.column(),c,d.getOrInit);return Yc(a,b.row(),b.column())},Ia.onCell,u,u,Tb.modification),eraseColumns:Ia.run(function(a,b,c,d){c=Or(b);a=Ad.deleteColumnsAt(a,c[0].column(),c[c.length-1].column());b=oj(a,b[0].row(),b[0].column());return Xe(a,b)},Ia.onCells,Df,YC,Tb.modification),eraseRows:Ia.run(function(a,
b,c,d){c=Nr(b);a=Ad.deleteRowsAt(a,c[0].row(),c[c.length-1].row());b=oj(a,b[0].row(),b[0].column());return Xe(a,b)},Ia.onCells,u,YC,Tb.modification),makeColumnHeader:Ia.run(function(a,b,c,d){a=ym.replaceColumn(a,b.column(),c,d.replaceOrInit);return Yc(a,b.row(),b.column())},Ia.onCell,u,u,Tb.transform("row","th")),unmakeColumnHeader:Ia.run(function(a,b,c,d){a=ym.replaceColumn(a,b.column(),c,d.replaceOrInit);return Yc(a,b.row(),b.column())},Ia.onCell,u,u,Tb.transform(null,"td")),makeRowHeader:Ia.run(function(a,
b,c,d){a=ym.replaceRow(a,b.row(),c,d.replaceOrInit);return Yc(a,b.row(),b.column())},Ia.onCell,u,u,Tb.transform("col","th")),unmakeRowHeader:Ia.run(function(a,b,c,d){a=ym.replaceRow(a,b.row(),c,d.replaceOrInit);return Yc(a,b.row(),b.column())},Ia.onCell,u,u,Tb.transform(null,"td")),mergeCells:Ia.run(function(a,b,c,d){d=b.cells();G0.merge(d);a=xm.merge(a,b.bounds(),c,k(d[0]));return Xe(a,g.from(d[0]))},Ia.onMergable,u,u,Tb.merging),unmergeCells:Ia.run(function(a,b,c,d){a=zb(b,function(a,b){return xm.unmerge(a,
b,c,d.combine(b))},a);return Xe(a,g.from(b[0]))},Ia.onUnmergable,Df,u,Tb.merging),pasteCells:Ia.run(function(a,b,c,d){d=function(a,b){a=Bf.fromTable(a);a=vb.generate(a);return um.toGrid(a,b,!0)}(b.clipboard(),b.generators());var e=Ha.address(b.row(),b.column());return Kr.merge(e,a,d,b.generators(),c).fold(function(){return Xe(a,g.some(b.element()))},function(a){var c=oj(a,b.row(),b.column());return Xe(a,c)})},Ia.onPaste,Df,u,Tb.modification),pasteRowsBefore:Ia.run(function(a,b,c,d){var e=a[b.cells[0].row()];
d=b.cells[0].row();e=ZC(b.clipboard(),b.generators(),e);a=Kr.insert(d,a,e,b.generators(),c);b=oj(a,b.cells[0].row(),b.cells[0].column());return Xe(a,b)},Ia.onPasteRows,u,u,Tb.modification),pasteRowsAfter:Ia.run(function(a,b,c,d){var e=a[b.cells[0].row()];d=b.cells[b.cells.length-1].row()+b.cells[b.cells.length-1].rowspan();e=ZC(b.clipboard(),b.generators(),e);a=Kr.insert(d,a,e,b.generators(),c);b=oj(a,b.cells[0].row(),b.cells[0].column());return Xe(a,b)},Ia.onPasteRows,u,u,Tb.modification)},Pr=function(a){return function(b,
c){return hb(a,function(a,e){return a.bind(function(a){return U0(c,function(a){return V0(e,b,c,a)})})},N.value(c))}},W0=Pr([dc.makeRowHeader,dc.makeColumnHeader]),X0=Pr([dc.makeRowHeader]),Y0=Pr([dc.makeColumnHeader]),V0=function(a,b,c,d){return Tp.fromEngine(b).bind(function(e){e=k(e);var f=u;return pc.execute(b.region(),a,f,e)(b.content(),c,{element:k(d)})})},U0=function(a,b){return L.descendant(a,"td,th").bind(function(a){return b(a)}).fold(function(){return N.error("Could not run the operation on table")},
function(b){return N.value(a)})},jf={setCaption:function(a,b){var c=L.child(a,"caption").fold(function(){return p.fromTag("caption")},function(a){E.empty(a);return a});Ca.set(c,b);y.prepend(a,c)},setSummary:function(a,b){m.set(a,"summary",b)},setDimensions:function(a,b){D0.redistribute(a,b.width(),b.height(),"rtl"===m.get(a,"dir")?Dk.rtl:Dk.ltr)},addBothHeaders:W0,addRowHeader:X0,addColumnHeader:Y0},Qr=sa.generate([{field:["name","textkey","f"]},{select:["name","textkey","values"]},{toggles:["name",
"textkey","options"]}]),Z0=M("value","text"),$0=M("value","icon","textkey"),$b={field:Qr.field,select:Qr.select,toggles:Qr.toggles,pair:Z0,toggle:$0,cata:function(a,b,c,d){return a.fold(b,c,d)}},a1=function(a,b){A(a,function(a){b.get(a.severity()).fold(function(){console.warn("unknown severity for accessibility rule: ",a.id(),a.severity())},function(c){ja.add(a.element(),[b.violation(),c.style()]);Ae.add(a.element(),c.attribute(),a.id())})});g.from(a[0]).each(function(a){var c=a.element(),e=b.currentAttr();
a=a.severity();m.set(c,e,a)})},b1=function(a,b,c,d){a=ca.descendants(a,"["+b+"]");A(a,function(a){m.remove(a,b)});m.set(c,b,d)},c1=function(a,b){a=ca.descendants(a,"."+b.violation());A(a,function(a){n.remove(a,b.violation());m.remove(a,b.currentAttr());A(b.all(),function(b){n.remove(a,b.style());m.remove(a,b.attribute())})})},$C=function(a,b,c){var d=function(b){return 0===Ae.read(a,b.attribute()).length};b.get(c).each(function(b){d(b)&&n.remove(a,b.style())});kb(b.all(),d)&&n.remove(a,b.violation())},
d1=function(a,b,c,d){b.get(d).each(function(d){Ae.remove(a,d.attribute(),c);Ae.add(a,b.ignoreAttr(),c);d=b.currentAttr();m.remove(a,d)})},e1=function(a,b,c,d){b.get(d).each(function(d){Ae.remove(a,d.attribute(),c);d=b.currentAttr();m.remove(a,d)})},f1={manager:function(a){var b=a.content();return{start:function(b){a1(b,a)},moveTo:function(c,d){b.body().each(function(b){b1(b,a.currentAttr(),c,d)})},stop:function(){b.body().each(function(b){c1(b,a)})},ignore:function(b,d,e){d1(b,a,d,e);$C(b,a,e)},solve:function(b,
d,e){e1(b,a,d,e);$C(b,a,e)}}}},oh=function(a){return function(b){A(b,a)}},g1=oh(E.remove),h1=oh(function(a){m.set(a,"class","")}),i1=oh(function(a){var b=B.children(a);O.before(a,b);E.remove(a)}),j1=fb(),k1=function(a){return C.isText(a)?(a=Mb.get(a),""===a||a===j1):!1},l1=oh(function(a){if(C.isElement(a)){var b=B.childNodesCount(a);b=0===b||1===b&&B.child(a,0).exists(k1)}else b=!1;b&&m.hasNone(a)&&E.remove(a)}),Ka={remove:g1,clearClasses:h1,removeClass:function(a){return oh(function(b){n.remove(b,
a)})},removeAttr:function(a){return oh(function(b){m.remove(b,a)})},unwrap:i1,removeIfEmpty:l1},pj=function(a){return"data-"+z.resolve(a)},aD=pj("a11y-current-violation"),bD=z.resolve("a11y-violation"),cD=z.resolve("a11y-severity-info"),dD=z.resolve("a11y-severity-warn"),eD=z.resolve("a11y-severity-error"),Am=pj("a11y-ignore"),fD=pj("a11y-error"),gD=pj("a11y-warning"),hD=pj("a11y-info"),Rr=ya(["style","attribute"],[]),iD=Rr({style:eD,attribute:fD}),jD=Rr({style:dD,attribute:gD}),kD=Rr({style:cD,attribute:hD}),
m1=function(a){return"error"===a?g.some(iD):"warning"===a?g.some(jD):"info"===a?g.some(kD):g.none()},Xo={configure:function(a){a.addSelector(a.output(),"["+Am+"]",Ka.removeAttr(Am));A([a.output(),a.input(),a.history(),a.internal()],function(b){A([bD,cD,dD,eD],function(c){a.add(b,c,Ka.removeClass(c))});A([aD,fD,gD,hD],function(c){a.addSelector(b,"["+c+"]",Ka.removeAttr(c))})})},ignoreAttr:k(Am),manager:function(a){return f1.manager({content:k(a),violation:k(bD),currentAttr:k(aD),ignoreAttr:k(Am),get:m1,
all:k([iD,jD,kD])})}},lD=z.resolve("highlight-common"),Sr=z.resolve("highlight-placeholder"),Me={configure:function(a){a.add(a.output(),lD,Ka.unwrap);a.add(a.history(),Sr,Ka.unwrap);a.add(a.output(),Sr,Ka.unwrap);a.add(a.output(),"ephox-custom-highlight",Ka.unwrap);a.add(a.history(),"ephox-custom-highlight",Ka.unwrap)},highlightClass:k(lD),customHighlightClass:k("ephox-custom-highlight"),placeholderClass:k(Sr)},mD=function(){return Tr(function(a,b,c){return a()},"off")},nD=function(){return Tr(function(a,
b,c){return b()},"unchanged")},oD=function(a){return Tr(function(b,c,d){return d(a)},"on")},Tr=function(a,b){return{fold:a,map:function(b){return a(mD,nD,function(a){return oD(b(a))})},label:k(b)}},wa={off:mD,unchanged:nD,on:oD},pD=M("content"),Ud={hasSelection:function(a){return a.getSelection().fold(function(){return pD(wa.off())},function(){return pD(wa.on(!0))})},isAnnotation:function(a){return n.has(a,"ephox-cram-annotation-wrap")||n.has(a,Me.customHighlightClass())},isEmptyText:function(a){return C.isText(a)&&
0===Oa.get(a).length},isTextArea:function(a){return"textarea"===C.name(a)}},ay={descend:function(a,b){var c=B.children(a);if(0===c.length||Ud.isTextArea(a))return W.point(a,b);if(b<c.length&&!Ud.isTextArea(c[b]))return W.point(c[b],0);c=c[c.length-1];if(Ud.isTextArea(c))return W.point(a,b);a=C.isText(c)?Oa.get(c).length:"img"===C.name(c)?1:B.children(c).length;return W.point(c,a)}},Ur=sa.generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),ha={before:Ur.before,on:Ur.on,after:Ur.after,
cata:function(a,b,c,d){return a.fold(b,c,d)},getStart:function(a){return a.fold(aa,aa,aa)}},Bm=sa.generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),n1=M("start","soffset","finish","foffset"),o1=function(a){return a.match({domRange:function(a){return p.fromDom(a.startContainer)},relative:function(a,c){return ha.getStart(a)},exact:function(a,c,d,e){return a}})},wc={domRange:Bm.domRange,relative:Bm.relative,exact:Bm.exact,exactFromRange:function(a){return Bm.exact(a.start(),
a.soffset(),a.finish(),a.foffset())},range:n1,getWin:function(a){a=o1(a);return B.defaultView(a)}},qD=function(a,b,c,d){var e=B.owner(a).dom().createRange();e.setStart(a.dom(),b);e.setEnd(c.dom(),d);return e},Vc={after:function(a,b,c,d){var e=qD(a,b,c,d);a=P.eq(a,c)&&b===d;return e.collapsed&&!a},commonAncestorContainer:function(a,b,c,d){a=qD(a,b,c,d);return p.fromDom(a.commonAncestorContainer)}},p1={fromElements:function(a,b){var c=(b||document).createDocumentFragment();A(a,function(a){c.appendChild(a.dom())});
return p.fromDom(c)}},rD=function(a,b){a.selectNodeContents(b.dom())},q1=function(a,b){b.fold(function(b){a.setStartBefore(b.dom())},function(b,d){a.setStart(b.dom(),d)},function(b){a.setStartAfter(b.dom())})},r1=function(a,b){b.fold(function(b){a.setEndBefore(b.dom())},function(b,d){a.setEnd(b.dom(),d)},function(b){a.setEndAfter(b.dom())})},sD=function(a){a.deleteContents()},tD=function(a){return{left:k(a.left),top:k(a.top),right:k(a.right),bottom:k(a.bottom),width:k(a.width),height:k(a.height)}},
hc={create:function(a){return a.document.createRange()},replaceWith:function(a,b){sD(a);a.insertNode(b.dom())},selectNodeContents:function(a,b){a=a.document.createRange();rD(a,b);return a},selectNodeContentsUsing:rD,relativeToNative:function(a,b,c){a=a.document.createRange();q1(a,b);r1(a,c);return a},exactToNative:function(a,b,c,d,e){a=a.document.createRange();a.setStart(b.dom(),c);a.setEnd(d.dom(),e);return a},deleteContents:sD,cloneFragment:function(a){a=a.cloneContents();return p.fromDom(a)},getFirstRect:function(a){var b=
a.getClientRects();a=0<b.length?b[0]:a.getBoundingClientRect();return 0<a.width||0<a.height?g.some(a).map(tD):g.none()},getBounds:function(a){a=a.getBoundingClientRect();return 0<a.width||0<a.height?g.some(a).map(tD):g.none()},isWithin:function(a,b){return 1>b.compareBoundaryPoints(a.END_TO_START,a)&&-1<b.compareBoundaryPoints(a.START_TO_END,a)},toString:function(a){return a.toString()}},qj=sa.generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),uD=
function(a,b,c){return b(p.fromDom(c.startContainer),c.startOffset,p.fromDom(c.endContainer),c.endOffset)},s1=function(a,b){return b.match({domRange:function(a){return{ltr:k(a),rtl:g.none}},relative:function(b,d){return{ltr:Xb(function(){return hc.relativeToNative(a,b,d)}),rtl:Xb(function(){return g.some(hc.relativeToNative(a,d,b))})}},exact:function(b,d,e,f){return{ltr:Xb(function(){return hc.exactToNative(a,b,d,e,f)}),rtl:Xb(function(){return g.some(hc.exactToNative(a,e,f,b,d))})}}})},t1=function(a,
b){var c=b.ltr();return c.collapsed?b.rtl().filter(function(a){return!1===a.collapsed}).map(function(a){return qj.rtl(p.fromDom(a.endContainer),a.endOffset,p.fromDom(a.startContainer),a.startOffset)}).getOrThunk(function(){return uD(a,qj.ltr,c)}):uD(a,qj.ltr,c)},vD=function(a,b){b=s1(a,b);return t1(a,b)},ke={ltr:qj.ltr,rtl:qj.rtl,diagnose:vD,asLtrRange:function(a,b){return vD(a,b).match({ltr:function(b,d,e,f){var c=a.document.createRange();c.setStart(b.dom(),d);c.setEnd(e.dom(),f);return c},rtl:function(b,
d,e,f){var c=a.document.createRange();c.setStart(e.dom(),f);c.setEnd(b.dom(),d);return c}})}},Vr={inRect:function(a,b,c){return b>=a.left&&b<=a.right&&c>=a.top&&c<=a.bottom},searchForPoint:function(a,b,c,d,e){if(0===e)return 0;if(b===d)return e-1;for(var f=1;f<e;f++){var h=a(f),l=Math.abs(b-h.left);if(c<=h.bottom){if(c<h.top||l>d)return f-1;d=l}}return 0}},u1=function(a,b,c,d,e){var f=function(c){var d=a.dom().createRange();d.setStart(b.dom(),c);d.collapse(!0);return d},h=Oa.get(b).length;c=Vr.searchForPoint(function(a){return f(a).getBoundingClientRect()},
c,d,e.right,h);return f(c)},wD=function(a,b,c,d){var e=a.dom().createRange();e.selectNode(b.dom());e=e.getClientRects();return oc(e,function(a){return Vr.inRect(a,c,d)?g.some(a):g.none()}).map(function(e){return u1(a,b,c,d,e)})},xD=function(a,b,c,d){var e=a.dom().createRange();b=B.children(b);return oc(b,function(b){e.selectNode(b.dom());return Vr.inRect(e.getBoundingClientRect(),c,d)?(C.isText(b)?wD:xD)(a,b,c,d):g.none()})},v1={locate:function(a,b,c,d){var e=a.dom().createRange();e.selectNode(b.dom());
e=e.getBoundingClientRect();c=Math.max(e.left,Math.min(e.right,c));d=Math.max(e.top,Math.min(e.bottom,d));return(C.isText(b)?wD:xD)(a,b,c,d)}},yD=function(a,b,c){a=a.dom().createRange();a.selectNode(b.dom());a.collapse(c);return a},w1=function(a,b,c){var d=a.dom().createRange();d.selectNode(b.dom());d=d.getBoundingClientRect();var e=c-d.left<d.right-c?!0:!1;return(!0===e?ac.first:ac.last)(b).map(function(b){return yD(a,b,e)})},x1=function(a,b,c){var d=b.dom().getBoundingClientRect();return g.some(yD(a,
b,c-d.left<d.right-c?!0:!1))},y1={search:function(a,b,c){return(0===B.children(b).length?x1:w1)(a,b,c)}},z1=function(a,b,c){return g.from(a.dom().caretPositionFromPoint(b,c)).bind(function(b){if(null===b.offsetNode)return g.none();var c=a.dom().createRange();c.setStart(b.offsetNode,b.offset);c.collapse();return g.some(c)})},A1=function(a,b,c){return g.from(a.dom().caretRangeFromPoint(b,c))},B1=function(a,b,c,d){var e=a.dom().createRange();e.selectNode(b.dom());e=e.getBoundingClientRect();return v1.locate(a,
b,Math.max(e.left,Math.min(e.right,c)),Math.max(e.top,Math.min(e.bottom,d)))},C1=function(a,b,c){return p.fromPoint(a,b,c).bind(function(d){var e=function(){return y1.search(a,d,b)};return 0===B.children(d).length?e():B1(a,d,b,c).orThunk(e)})},D1=document.caretPositionFromPoint?z1:document.caretRangeFromPoint?A1:C1,E1={fromPoint:function(a,b,c){a=p.fromDom(a.document);return D1(a,b,c).map(function(a){return wc.range(p.fromDom(a.startContainer),a.startOffset,p.fromDom(a.endContainer),a.endOffset)})}},
F1=function(a,b,c,d){var e=hc.create(a);a=(za.is(b,d)?[b]:[]).concat(ca.descendants(b,d));return ka(a,function(a){hc.selectNodeContentsUsing(e,a);return hc.isWithin(c,e)})},G1={find:function(a,b,c){b=ke.asLtrRange(a,b);var d=p.fromDom(b.commonAncestorContainer);return C.isElement(d)?F1(a,d,b,c):[]}},rj=function(a,b){var c=C.name(a);return"input"===c?ha.after(a):V(["br","img"],c)?0===b?ha.before(a):ha.after(a):ha.on(a,b)},zD=function(a,b){a=a.fold(ha.before,rj,ha.after);b=b.fold(ha.before,rj,ha.after);
return wc.relative(a,b)},Wr=function(a,b,c,d){a=rj(a,b);c=rj(c,d);return wc.relative(a,c)},Xr={beforeSpecial:rj,preprocess:function(a){return a.match({domRange:function(a){var b=p.fromDom(a.startContainer),d=p.fromDom(a.endContainer);return Wr(b,a.startOffset,d,a.endOffset)},relative:zD,exact:Wr})},preprocessRelative:zD,preprocessExact:Wr},Cm=function(a,b){g.from(a.getSelection()).each(function(a){a.removeAllRanges();a.addRange(b)})},AD=function(a,b){return ke.diagnose(a,b).match({ltr:function(b,
d,e,f){b=hc.exactToNative(a,b,d,e,f);Cm(a,b)},rtl:function(b,d,e,f){var c=a.getSelection();if(c.setBaseAndExtent)c.setBaseAndExtent(b.dom(),d,e.dom(),f);else if(c.extend)try{c.collapse(b.dom(),d),c.extend(e.dom(),f)}catch(l){b=hc.exactToNative(a,e,f,b,d),Cm(a,b)}else b=hc.exactToNative(a,e,f,b,d),Cm(a,b)}})},H1=function(a){var b=p.fromDom(a.anchorNode),c=p.fromDom(a.focusNode);Vc.after(b,a.anchorOffset,c,a.focusOffset)?a=g.some(wc.range(p.fromDom(a.anchorNode),a.anchorOffset,p.fromDom(a.focusNode),
a.focusOffset)):0<a.rangeCount?(b=a.getRangeAt(0),a=a.getRangeAt(a.rangeCount-1),a=g.some(wc.range(p.fromDom(b.startContainer),b.startOffset,p.fromDom(a.endContainer),a.endOffset))):a=g.none();return a},BD=function(a){return g.from(a.getSelection()).filter(function(a){return 0<a.rangeCount}).bind(H1)},Na={setExact:function(a,b,c,d,e){b=Xr.preprocessExact(b,c,d,e);AD(a,b)},getExact:BD,get:function(a){return BD(a).map(function(a){return wc.exact(a.start(),a.soffset(),a.finish(),a.foffset())})},setRelative:function(a,
b,c){b=Xr.preprocessRelative(b,c);AD(a,b)},toNative:function(a){var b=wc.getWin(a).dom(),c=function(a,c,f,h){return hc.exactToNative(b,a,c,f,h)};a=Xr.preprocess(a);return ke.diagnose(b,a).match({ltr:c,rtl:c})},setToElement:function(a,b){b=hc.selectNodeContents(a,b);Cm(a,b)},clear:function(a){a.getSelection().removeAllRanges()},clone:function(a,b){a=ke.asLtrRange(a,b);return hc.cloneFragment(a)},replace:function(a,b,c){b=ke.asLtrRange(a,b);a=p1.fromElements(c,a.document);hc.replaceWith(b,a)},deleteAt:function(a,
b){a=ke.asLtrRange(a,b);hc.deleteContents(a)},forElement:function(a,b){a=hc.selectNodeContents(a,b);return wc.range(p.fromDom(a.startContainer),a.startOffset,p.fromDom(a.endContainer),a.endOffset)},getFirstRect:function(a,b){a=ke.asLtrRange(a,b);return hc.getFirstRect(a)},getBounds:function(a,b){a=ke.asLtrRange(a,b);return hc.getBounds(a)},getAtPoint:function(a,b,c){return E1.fromPoint(a,b,c)},findWithin:function(a,b,c){return G1.find(a,b,c)},getAsString:function(a,b){a=ke.asLtrRange(a,b);return hc.toString(a)},
isCollapsed:function(a,b,c,d){return P.eq(a,c)&&b===d}},CD=function(a,b){return fa.inBody(a)?g.some(Math.max(0,Math.min(b,oa.getEnd(a)))):g.none()},Yr={findDescendants:function(a,b,c,d,e){var f=B.defaultView(a);return CD(a,b).bind(function(b){return CD(c,d).map(function(d){d=wc.exact(a,b,c,d);return Na.findWithin(f.dom(),d,e)})}).getOr([])},findAncestors:function(a,b,c){return L.ancestor(a,c).fold(function(){return L.ancestor(b,c).toArray()},function(a){return L.ancestor(b,c).fold(k([a]),function(b){return P.eq(a,
b)?[a]:[a,b]})})}},I1=ba.detect().browser.isFirefox(),sj=function(a){return a.filter(function(a){return"img"===C.name(a)})},J1=function(a){var b=sj(B.child(a.startContainer(),a.startOffset()));return sj(B.nextSibling(a.startContainer())).orThunk(function(){return b}).bind(function(c){return sj(B.prevSibling(a.endContainer())).bind(function(d){d=P.eq(c,d);var e=a.startContainer().dom().length===a.startOffset(),f=0===a.endOffset();return d&&(e||b.isSome())&&f?g.some(c):g.none()})})},K1=function(a){if(!P.eq(a.startContainer(),
a.endContainer()))return g.none();var b=Math.min(a.startOffset(),a.endOffset()),c=Math.max(a.startOffset(),a.endOffset()),d=sj(B.child(a.startContainer(),b));return c===b+1?d.orThunk(function(){return sj(g.some(a.startContainer()))}):I1&&c===b+2?d.filter(function(a){return B.nextSibling(a).filter(Ud.isEmptyText).isSome()}):g.none()},DD=M("image"),ED=function(a){return a.filter(function(a){return!a.collapsed()}).bind(function(a){return K1(a).orThunk(function(){return J1(a)})})},FD=function(a,b){return!Va(b,
function(b){return za.is(a,b)})},lc={allowedForEditing:FD,detect:function(a){return ED(a).map(DD)},detectForEditing:function(a,b){return ED(a).filter(function(a){return FD(a,b)}).map(DD)}},GD=ba.detect().browser.isFirefox(),L1=function(a,b){return lc.detect(g.some(a)).filter(function(a){return P.eq(a.image(),b)}).isSome()},HD=function(a,b){var c=function(){a.setRelativeSelection(ha.before(b),ha.after(b))},d=GD?function(){a.getSelection().fold(c,function(c){M1(a,c,b)})}:c;a.focus();d()},M1=function(a,
b,c){2===Math.abs(b.startOffset()-b.endOffset())&&L1(b,c)||(b=B.nextSibling(c).filter(Ud.isEmptyText).getOrThunk(function(){var a=p.fromText("");y.after(c,a);return a}),a.setRelativeSelection(ha.before(c),ha.after(b)))},Ne={selectionContains:function(a){a=Yr.findDescendants(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset(),"img");return 1===a.length?g.some(a[0]):g.none()},remove:function(a,b){a.setRelativeSelection(ha.before(b),ha.before(b));E.remove(b)},select:HD,reselect:GD?HD:u},
Zr=function(a,b){var c=Wa.absolute(a),d=pa.get(a);return{element:k(a),bottom:k(c.top()+d),pos:k(c),cleanup:b}},N1=function(a,b){a=ay.descend(a,b);b=p.fromText(fb());var c=p.fromTag("span");y.append(c,b);y.before(a.element(),c);return Zr(c,function(){E.remove(c)})},JD=function(a,b){a.getSelection().each(function(c){ID(a,function(d,e){O1(a,b,c)},c)})},O1=function(a,b,c){a.body().each(function(d){a.doc().each(function(a){v.reflow(d);var e=Pa.get(a).top(),h=N1(c.startContainer(),c.startOffset());b(a,
e,h);h.cleanup()})})},KD=function(a,b,c){a.doc().each(function(a){var d=Pa.get(a).top();c(a,d,b)})},LD=function(a,b,c){var d=a.dom().defaultView.innerHeight,e=c.pos();c.bottom()>d+b?(b=e.top()-d+1.5*pa.get(c.element()),Pa.to(e.left(),b,a)):e.top()<b&&Pa.to(e.left(),e.top(),a)},MD=function(a,b,c,d){a.body().each(function(e){var f=pa.get(a.element()),h=e.dom();var l=Math.max(h.offsetHeight,h.scrollHeight);h=d.pos();d.bottom()>l?v.set(e,"min-height",d.bottom()+"px"):v.remove(e,"min-height");h.top()<
c?Pa.to(h.left(),h.top(),b):h.top()>f+c&&(e=h.top()-f+(d.bottom()-h.top()),Pa.to(h.left(),e,b));e=fj.find(d.element());f=Pa.get().top();h=window.innerHeight+f;e.top()<f?Pa.intoView(d.element(),!0):e.top()>h&&Pa.intoView(d.element(),!1)})},P1=function(a){JD(a,LD)},Q1=function(a,b){KD(a,Zr(b,u),LD)},R1=function(a){JD(a,t(MD,a))},S1=function(a,b){KD(a,Zr(b,u),t(MD,a))},ID=function(a,b,c){var d=c.startContainer(),e=c.startOffset(),f=c.endContainer();c=c.endOffset();b(d,f);a.setSelection(d,e,f,c);lc.detect(a.getSelection()).each(function(b){Ne.select(a,
b.image())})},Zf={cursorIntoView:function(a){(a.isInline()?P1:R1)(a)},elementIntoView:function(a,b){(a.isInline()?Q1:S1)(a,b)},preserve:function(a,b){a.getSelection().each(function(c){ID(a,b,c)})}},T1=ba.detect(),$r=function(a,b,c){a=p.fromTag(a);c=w.translate(c);return ND(a,b,c)},ND=function(a,b,c){c=T.labelledField(a,b,c);n.add(c.element(),z.resolve("form-group"));n.add(c.element(),z.resolve(b));"select"===C.name(a)&&(a=S.div(),n.add(a,z.resolve("select-wrap")),y.append(a,c.field()),y.append(c.element(),
a));return c},Jc={input:function(a,b){a=$r("input",a,b);T1.browser.isSafari()&&m.setAll(a.field(),{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"});m.setAll(a.field(),{type:"text"});return{element:a.element,input:a.field}},textarea:function(a,b){a=$r("textarea",a,b);T.multiline(a.field());return{element:a.element,textarea:a.field}},common:$r,commonWith:ND,comboBox:function(a,b,c){var d=p.fromTag("input"),e=w.translate(b);b=S.div();var f=a+Za("");e=p.fromHtml("<label>"+
e+"</label>");m.set(e,"for",f);m.set(d,"id",f);n.add(b,z.resolve("form-group"));n.add(b,z.resolve(a));a=S.span();T.hidden(a,!0);f=S.span();T.hidden(f,!0);ja.add(f,["ephox-textbox-font",z.resolve("icon"),z.resolve("combo-drop-arrow-icon")]);n.add(a,z.resolve("combo-drop-arrow"));y.append(a,f);var h=S.div();n.add(h,z.resolve("label-wrap"));c.each(function(a){y.append(h,a)});y.append(h,e);c=S.div();n.add(c,z.resolve("combo-wrap"));O.append(c,[d,a]);m.set(d,"type","text");O.append(b,[h,c]);return{element:k(b),
input:k(d),dropArrow:k(a)}}},OD=function(a){n.add(a,z.resolve("dialog-button-default"))},PD=function(a){n.add(a,z.resolve("dialog-button"))},as=function(a,b,c){var d=Dc(a+b);n.add(d.element(),z.resolve("dialog-"+b));a=Rc(w.translate(c));d.content(a);m.set(d.element(),"tabindex","-1");T.textButton(d.element(),a.element());return{enable:function(){d.enable();ma.enable(d.element())},disable:function(){d.disable();ma.disable(d.element())},element:d.element,name:d.name,destroy:d.destroy,content:d.content,
disabled:d.disabled,click:d.click,events:d.events}},U1=function(a){a=as(a,"ok","button.ok");OD(a.element());return a},V1=function(a){a=as(a,"cancel","button.cancel");PD(a.element());return a},ud={button:as,okCancel:function(a){var b=void 0!==a?a+"-":"";a=S.div();n.add(a,z.resolve(b+"dialog-controls"));var c=V1(b),d=U1(b);O.append(a,[c.element(),d.element()]);b=G.create({ok:Q([],d.events.click),cancel:Q([],c.events.click)});return{element:k(a),ok:k(d),cancel:k(c),destroy:function(){d.destroy();c.destroy()},
events:b.registry}},makeNormal:PD,makeDefault:OD},bs=function(a,b){a=a();var c=a.element();T.button(c,b);m.set(c,"tabindex","-1");a.events.click.bind(function(){Y.focus(c)});return a},QD=function(a,b){var c=bs(Dc,b);c.content(ve([a,z.resolve("icon")]));m.set(c.element(),"title",b);return c},ZP={setDefaultAction:function(a){ud.makeDefault(a)},setNormalButton:function(a){ud.makeNormal(a)},makeTextButton:function(a,b,c){b=bs(Dc,b);ja.add(b.element(),a);b.content(Rc(c));return b},makeIconToggle:function(a,
b,c){var d=bs(Hd,c);d.content(ve([b,z.resolve("icon")]));n.add(d.element(),z.resolve("choice-button"));m.set(d.element(),"data-value",a);m.set(d.element(),"title",c);return d},makeField:function(a,b,c){return Jc.commonWith(a,b,c)},makeIconButton:QD,makeIconStepperButton:function(a,b){a=QD(a,b);n.add(a.element(),z.resolve("stepper-button"));return a}},cs={"a11y.widget.ok.label":"button.ok","a11y.widget.ok.text":"button.ok","a11y.widget.ignore.label":"a11y.widget.ignore","a11y.widget.ignore.text":"a11y.widget.ignore",
"a11y.widget.repair.label":"a11y.widget.repair","a11y.widget.repair.text":"a11y.widget.repair","a11y.widget.repair.available":"a11y.widget.available","a11y.i1.description":"a11y.image.alttext.empty","a11y.i1.repair.info":"a11y.image.alttext.set","a11y.i1.repair.errors.empty":"a11y.image.alttext.validation.empty","a11y.i1.repair.errors.duplicate":"a11y.image.alttext.validation.filenameduplicate","a11y.i2.description":"a11y.image.alttext.filenameduplicate","a11y.i2.repair.info":"a11y.image.alttext.set",
"a11y.i2.repair.errors.empty":"a11y.image.alttext.validation.empty","a11y.i2.repair.errors.duplicate":"a11y.image.alttext.validation.filenameduplicate","a11y.t1.description":"a11y.table.caption.empty","a11y.t1.repair.info":"a11y.table.caption.set","a11y.t1.repair.errors.empty":"a11y.table.caption.validation.empty","a11y.t1.repair.errors.duplicate":"a11y.table.caption.validation.summaryduplicate","a11y.t2.description":"a11y.table.summary.empty","a11y.t2.repair.info":"a11y.table.summary.set","a11y.t2.repair.errors.empty":"a11y.table.summary.validation.empty",
"a11y.t2.repair.errors.duplicate":"a11y.table.summary.validation.captionduplicate","a11y.t3.description":"a11y.table.caption.summaryduplicate","a11y.t3.repair.info":"a11y.table.caption.set","a11y.t3.repair.errors.empty":"a11y.table.caption.validation.empty","a11y.t3.repair.errors.duplicate":"a11y.table.caption.validation.summaryduplicate","a11y.t4a.description":"a11y.table.rowscells.none","a11y.t4b.description":"a11y.table.headers.none","a11y.t4b.repair.info":"a11y.table.headers.set","a11y.t4b.repair.row":"table.row-header",
"a11y.t4b.repair.column":"table.column-header","a11y.t4b.repair.errors.none":"a11y.table.headers.validation.none","a11y.t4c.description":"a11y.table.headerscope.none","a11y.t4c.repair.info":"a11y.table.headerscope.set","a11y.t4c.repair.scope.row":"a11y.table.headerscope.scope.row","a11y.t4c.repair.scope.col":"a11y.table.headerscope.scope.col","a11y.t4c.repair.scope.rowgroup":"a11y.table.headerscope.scope.rowgroup","a11y.t4c.repair.scope.colgroup":"a11y.table.headerscope.scope.colgroup","a11y.d1.description":"a11y.heading.paragraphmisuse",
"a11y.d1.repair.info":"a11y.heading.set","a11y.d1.repair.block.h1":"block.h1","a11y.d1.repair.block.h2":"block.h2","a11y.d1.repair.block.h3":"block.h3","a11y.d1.repair.block.h4":"block.h4","a11y.d1.repair.block.h5":"block.h5","a11y.d1.repair.block.h6":"block.h6","a11y.d2.description":"a11y.heading.nonsequential","a11y.d3.description":"a11y.link.adjacent","a11y.d4.description":"a11y.list.paragraphmisuse","a11y.d5a.description":"a11y.contrast.largetext","a11y.d5b.description":"a11y.contrast.smalltext"},
bw={get:function(a){return g.from(cs[a])},translate:function(a){var b=Array.prototype.slice.call(arguments,1);return w.translate.apply(void 0,[void 0!==cs[a]?cs[a]:a].concat(b))}},aQ=ya(["rules"],[]),RD=ya(["rule","element"],[]),W1=function(a,b){return ia(b,function(b){return b.check()(a)?[RD({rule:b,element:a})]:[]})},X1=function(a,b){return ia(b,function(b){return F(b.check()(a),function(a){return RD({rule:b,element:a})})})},PP={audit:function(a,b){var c=[],d=tX(b,function(a){return a.walkable()});
b=d.pass;d=d.fail;for(var e=document.createTreeWalker(a,vc.getOrDie("NodeFilter").SHOW_ELEMENT,null,!1);e.nextNode();)c=c.concat(W1(e.currentNode,b));a=X1(a,d);c=c.concat(a);c.sort(function(a,b){a=a.element();b=b.element();return a===b?0:Sk.documentPositionPreceding(a,b)?1:-1});return c}},Mc=ya("id wcag severity desckey url walkable check".split(" "),[]),Nc={error:k("error"),warning:k("warning"),info:k("info")},vg={match:function(a,b){return a.matches?a.matches(b):a.webkitMatchesSelector?a.webkitMatchesSelector(b):
a.mozMatchesSelector?a.mozMatchesSelector(b):a.msMatchesSelector?a.msMatchesSelector(b):!1}},Y1=function(a){return kb(a.childNodes,function(a){return/^(b|strong)$/i.test(a.nodeName)})},Z1=Mc({id:"D1",wcag:"1.3.1",severity:Nc.warning(),desckey:"a11y.d1.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return vg.match(a,"p")?Y1(a):!1}}),$1=Mc({id:"D2",wcag:"1.3.1",severity:Nc.error(),desckey:"a11y.d2.description",
url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!1,check:function(a){a=a.querySelectorAll("h1, h2, h3, h4, h5, h6");var b,c=[];A(a,function(a){var d=parseInt(a.tagName.slice(1),10);b&&1<d-b&&c.push(a);b=d});return c}}),a2=Mc({id:"D3",wcag:"2.4.4",severity:Nc.error(),desckey:"a11y.d3.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/navigation-mechanisms-refs.html",walkable:!1,check:function(a){return ka(a.querySelectorAll("a + a"),
function(a){return a.href===a.previousSibling.href})}}),SD=function(a){var b=a.nodeName;for(a=a.nextSibling;null!==a&&("#text"===a.nodeName||"BR"===a.nodeName);)a=a.nextSibling;return null!==a&&a.nodeName===b?a:!1},TD={check:function(a,b){a=a.querySelectorAll("p,h1,h2,h3,h4,h5,h6");for(var c=[],d=0;d<a.length;){var e=a[d];var f=b;var h=SD(e);for(e=f(e)?[e]:[];!1!==h&&f(h);)e.push(h),h=SD(h);f=e;if(1<f.length){c.push(f[0]);f=f[f.length-1];h=-1;for(e=0;e<a.length;e++)if(a[e]===f){h=e;break}f=h;d=-1===
f?d+1:f}else d++}return c}},b2=function(a){return a.textContent.match(/^\s{0,}([a-z1-9]|i+)\s{0,}[.)-]/gmi)},c2=Mc({id:"D4o",wcag:"1.3.1",severity:Nc.error(),desckey:"a11y.d4.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!1,check:function(a){return TD.check(a,b2)}}),d2=function(a){return a.textContent.match(/^\s{0,}(\*|-)\s{0,}/gmi)},e2=Mc({id:"D4u",wcag:"1.3.1",severity:Nc.error(),desckey:"a11y.d4.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
walkable:!1,check:function(a){return TD.check(a,d2)}}),UD=M("red","green","blue","alpha"),tj={rgbaColour:UD,white:function(){return UD(255,255,255,1)}},ph={calculateContrastRatio:function(a,b){return(Math.max(a,b)+.05)/(Math.min(a,b)+.05)},calculateLuminance:function(a){var b=function(a){return.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)},c=a.red()/255,d=a.green()/255;a=a.blue()/255;c=b(c);d=b(d);b=b(a);return.2126*c+.7152*d+.0722*b},composeColour:function(a,b){var c=a.alpha()+b.alpha()*(1-a.alpha()),
d=(a.red()*a.alpha()+b.red()*b.alpha()*(1-a.alpha()))/c,e=(a.green()*a.alpha()+b.green()*b.alpha()*(1-a.alpha()))/c;a=(a.blue()*a.alpha()+b.blue()*b.alpha()*(1-a.alpha()))/c;return tj.rgbaColour(Math.ceil(d),Math.ceil(e),Math.ceil(a),c)}},VD={parseColour:function(a){var b=function(a,b,c,h){a=parseInt(a,10);b=parseInt(b,10);c=parseInt(c,10);h=parseFloat(h);return g.some(tj.rgbaColour(a,b,c,h))};if("transparent"===a)return b(0,0,0,0);var c=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(null!==c)return b(c[1],
c[2],c[3],1);a=a.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d?(?:\.\d+)?)\)/);return null!==a?b(a[1],a[2],a[3],a[4]):g.none()}},WD=function(a,b){a=parseFloat(v.get(a,"opacity"));return 1>a?tj.rgbaColour(b.red(),b.green(),b.blue(),b.alpha()*a):b},XD={getBackgroundColor:function(a){var b=B.owner(a),c=fa.getBody(b);a=[a].concat(B.parents(a,function(a){return P.eq(a,c)}));a=hb(a,function(a,b){if(1===a.alpha())return a;var c=v.get(b,"background-color");return VD.parseColour(c).bind(function(c){c=WD(b,
c);return 0<c.alpha()?g.some(ph.composeColour(a,c)):g.none()}).getOr(a)},tj.rgbaColour(0,0,0,0));return 1>a.alpha()?ph.composeColour(a,tj.white()):a},getForegroundColor:function(a,b){var c=v.get(a,"color");return VD.parseColour(c).bind(function(c){c=WD(a,c);c=1>c.alpha()?ph.composeColour(c,b):c;return g.some(c)})}},YD=function(a){var b=XD.getBackgroundColor(a);return XD.getForegroundColor(a,b).map(function(a){var c=ph.calculateLuminance(b);a=ph.calculateLuminance(a);return ph.calculateContrastRatio(a,
c)})},ZD={check:function(a,b){return YD(a).filter(function(a){return a<b}).isSome()},getRatio:YD},f2=function(a){a=v.get(a,"font-weight");return"bold"===a||"bolder"===a?!0:/^[0-9]*$/.test(a)?700<=parseInt(a,10):!1},$D=function(a){var b=v.get(a,"font-size");a=/.*px/.test(b);b=b.match(/(\d*\.?\d*)(.*)/);return a&&null!==b?g.some(Number(b[1])):g.none()},aE={isLargeFont:function(a){var b=f2(a),c=B.owner(a);c=fa.getBody(c);var d=$D(c);return $D(a).fold(Sc,function(a){return d.fold(function(){return 24<=
a||b&&19<=a},function(c){return a>=1.5*c||b&&a>=1.2*c})})}},bE={hasNonEmptyTextChild:function(a){a=B.children(a);return 0<ka(a,function(a){return C.isText(a)&&0<C.value(a).trim().length}).length}},g2=Mc({id:"D5a",wcag:"1.4.3",severity:Nc.error(),desckey:"a11y.d5a.description",url:"https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html",walkable:!0,check:function(a){a=p.fromDom(a);return bE.hasNonEmptyTextChild(a)&&aE.isLargeFont(a)&&ZD.check(a,3)}}),h2=Mc({id:"D5b",wcag:"1.4.3",
severity:Nc.error(),desckey:"a11y.d5b.description",url:"https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html",walkable:!0,check:function(a){a=p.fromDom(a);return bE.hasNonEmptyTextChild(a)&&!aE.isLargeFont(a)&&ZD.check(a,4.5)}}),i2=Mc({id:"I1",wcag:"1.1.1",severity:Nc.error(),desckey:"a11y.i1.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/text-equiv-all.html",walkable:!0,check:function(a){return vg.match(a,"img")&&(!1===a.hasAttribute("alt")||""===a.getAttribute("alt").trim())}}),
j2=Mc({id:"I2",wcag:"1.1.1",severity:Nc.error(),desckey:"a11y.i2.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/text-equiv-all.html",walkable:!0,check:function(a){return vg.match(a,"img[alt][src]")&&a.src.split("/").pop()===a.alt.split("/").pop()}}),k2=Mc({id:"T1",wcag:"1.3.1",severity:Nc.error(),desckey:"a11y.t1.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return vg.match(a,"table")?(a=a.querySelector("caption"))?
vg.match(a,":empty"):!0:!1}}),l2=Mc({id:"T2",wcag:"1.3.1",severity:Nc.warning(),desckey:"a11y.t2.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return vg.match(a,"table")&&(a.querySelector("[rowspan]")||a.querySelector("[colspan]"))&&!a.hasAttribute("summary")}}),m2=Mc({id:"T3",wcag:"1.3.1",severity:Nc.error(),desckey:"a11y.t3.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
walkable:!0,check:function(a){return vg.match(a,"table")&&a.hasAttribute("summary")&&0<a.querySelectorAll("caption").length&&a.getAttribute("summary")===a.querySelector("caption").innerHTML}}),n2=Mc({id:"T4b",wcag:"1.3.1",severity:Nc.error(),desckey:"a11y.t4b.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){return"table"===a.nodeName.toLowerCase()&&0===a.querySelectorAll("th").length}}),o2=Mc({id:"T4c",wcag:"1.3.1",
severity:Nc.error(),desckey:"a11y.t4c.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",walkable:!0,check:function(a){if("th"===a.nodeName.toLowerCase()){var b=!1===a.hasAttribute("scope");a=!1===/row|col|rowgroup|colgroup/i.test(a.getAttribute("scope"));b=b||a}else b=!1;return b}}),p2=Mc({id:"T4a",wcag:"1.3.1",severity:Nc.error(),desckey:"a11y.t4a.description",url:"http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
walkable:!0,check:function(a){return"table"===a.nodeName.toLowerCase()?0===a.querySelectorAll("tr").length||0===a.querySelectorAll("td").length:!1}}),cE=[Z1,$1,a2,c2,e2,g2,h2,i2,j2,k2,l2,m2,o2,p2,n2],dE={get:function(a){return va(cE,function(b){return b.name()===a})},all:k(cE)},$P={get:function(a){return dE.get(a)},all:function(){return dE.all().slice()}},q2={resolve:Hb.create("ephox-wheel").resolve},Sa={resolve:function(a,b){return q2.resolve(a.prefix()+"-"+b)},translate:function(a,b){var c=[(Ab(b,
a.tnames())?"":a.tnames()+".")+b].concat(Array.prototype.slice.call(arguments,2));return a.translate.apply(null,c)}},ds=function(a,b,c,d,e){c=Sa.translate(e,c);d=Sa.translate(e,d);return a.makeTextButton(b,c,d)},ze={defaultActionButton:function(a,b,c,d,e){b=ds(a,b,c,d,e);a.setDefaultAction(b.element());return b},normalButton:function(a,b,c,d,e){b=ds(a,b,c,d,e);a.setNormalButton(b.element());return b},button:ds,toggleButton:function(a,b,c,d,e){d=Sa.translate(e,d);return a.makeIconToggle(b,c,d)},field:function(a,
b,c,d,e){d=Sa.translate(e,d);return a.makeField(b,c,d)},icon:function(a,b,c,d){c=Sa.translate(d,c);return a.makeIconStepperButton(b,c)}},r2=function(a,b,c,d,e,f){var h=p.fromTag("input");a=ze.field(a,h,c,d,f);n.add(h,Sa.resolve(f,"input"));b=[ea.input(h,xa.input({execute:b}))];return{element:a.element,get:function(){var a={};a[c]=da.get(h);return a},update:function(a){a=e(a);da.set(h,a)},keylayouts:k(b),destroy:u}},s2=function(a,b,c,d,e){var f=p.fromTag("select");a=ze.field(a,f,b,c,e);d=F(d,function(a){var b=
p.fromTag("option");da.set(b,a.value());Ca.set(b,Sa.translate(e,a.text()));return b});O.append(f,d);d=[ea.single(f,[],g.none())];return{element:a.element,get:function(){var a={};a[b]=da.get(f);return a},update:u,keylayouts:k(d),destroy:u}},t2=function(a,b,c,d,e){var f=S.div();n.add(f,Sa.resolve(e,"flow"));var h=F(d,function(b){return ze.toggleButton(a,b.value(),b.icon(),b.textkey(),e)});d=F(h,function(a){return a.element()});O.append(f,d);d=[ea.flow(f,{item:k(".ephox-pastry-statebutton")},xa.flow({trigger:function(a){return L.descendant(a,
".ephox-pastry-button").map(function(a){a.dom().click();return a})}}))];return{element:ze.field(a,f,b,c,e).element,get:function(){return zb(h,function(a,b){var c={};c[m.get(b.element(),"data-value")]=b.selected();return cb(a,c)},{})},update:u,keylayouts:k(d),destroy:function(){A(h,function(a){a.destroy()})}}},SP={generate:function(a,b,c,d){b=b.getOr([]);var e=ia(b,function(a){return a.fold(function(a,b,c){return[a]},function(a,b,c){return[a]},function(a,b,c){return F(c,function(a){return a.value()})})}),
f=0<e.length?ya(e,[]):k({}),h=G.create({execute:q([])}),l=function(){h.trigger.execute()},g=F(b,function(b){return b.fold(function(b,c,e){return r2(a,l,b,c,e,d)},function(b,c,e){return s2(a,b,c,e,d)},function(b,c,e){return t2(a,b,c,e,d)})});A(g,function(a){a.update(c)});b=F(g,function(a){return a.element()});var m=ia(g,function(a){return a.keylayouts()});return{elements:k(b),get:function(){var a=zb(g,function(a,b){return cb(a,b.get())},{});return f(a)},keylayouts:k(m),destroy:function(){A(g,function(a){a.destroy()});
A(m,function(a){a.destroy()})},events:h.registry}}},Fc={title:k("widget.title"),running:k("widget.running"),previous:k("widget.previous"),next:k("widget.next"),issueCounter:k("widget.issue.counter"),issueHelp:k("widget.issue.help"),noIssue:k("widget.issue.none"),severity:function(a){return"severity."+a},repairLabel:k("widget.repair.label"),repairText:k("widget.repair.text"),repairAvailable:k("widget.repair.available"),ignoreLabel:k("widget.ignore.label"),ignoreText:k("widget.ignore.text"),okLabel:k("widget.ok.label"),
okText:k("widget.ok.text")},Ek=function(a,b,c){var d=S.div();n.add(d,Sa.resolve(c,a));b.each(function(a){y.append(d,p.fromText(Sa.translate(c,a)))});return d},eE=function(a){var b=Ga(g.none());return{clear:function(){b.get().each(a);b.set(g.none())},isSet:function(){return b.get().isSome()},set:function(c){b.get().each(a);b.set(g.some(c))}}},Uc={destroyable:function(){return eE(function(a){a.destroy()})},unbindable:function(){return eE(function(a){a.unbind()})},api:function(){var a=Ga(g.none()),b=
function(){a.get().each(function(a){a.destroy()})};return{clear:function(){b();a.set(g.none())},isSet:function(){return a.get().isSome()},set:function(c){b();a.set(g.some(c))},run:function(b){a.get().each(b)}}},value:function(){var a=Ga(g.none());return{clear:function(){a.set(g.none())},set:function(b){a.set(g.some(b))},isSet:function(){return a.get().isSome()},on:function(b){a.get().each(b)}}}},fE=ba.detect(),Dm=fE.os.isOSX(),Oc=Dm?"\u2318":"Ctrl",Em=Dm?"\u21e7":"Shift",gE={blockquote:[Oc,Em,"9"],
bold:[Oc,"B"],italic:[Oc,"I"],underline:[Oc,"U"],link:[Oc,"K"],help:[Oc,"?"],fullscreen:[Oc,Em,"F"],indent:[Oc,"]"],outdent:[Oc,"["],undo:[Oc,"Z"],redo:Dm?[Oc,Em,"Z"]:[Oc,"Y"],search:[Oc,"F"]},u2="fr nl sv ru de es it".split(" "),v2=ra(gE,{indent:[Oc,"M"],outdent:[Oc,Em,"M"]}),hE=function(a){var b=Le.get();return V(u2,b)?v2[a]:gE[a]},w2=function(a){a=hE(a);return void 0===a?"":" "+a.join("")},x2=function(a){a=hE(a);return void 0===a?"":" ("+a.join(" ")+")"},y2=Dm?w2:x2,ib={get:function(a,b){return fE.os.isiOS()?
w.get(a):w.get(a)+y2(b)}},dQ=z.resolve("inverted-dialog-widget"),iE=function(a,b,c){var d=v.get(b,a);c=parseInt(d,10)+40*c;(0<c?v.set:v.remove)(b,a,c+"px")},z2={change:t(iE,"margin-right")},dw={ltr:{change:t(iE,"margin-left")},rtl:z2},wd={runTransaction:function(a,b,c,d){d=void 0!==d?d:u;b.save();a.focus();c=c();setTimeout(function(){a.domChanged();a.uiChanged()},0);d();b.save();return c}},es=M("startContainer","startOffset","endContainer","endOffset"),fs=function(a,b){if(a.property().isText(b))return W.point(b,
a.property().getText(b).length);var c=a.property().children(b);return 0<c.length?fs(a,c[c.length-1]):W.point(b,c.length)},jE=function(a,b,c){var d=a.property().children(b);return 0<d.length&&c<d.length?jE(a,d[c],0):0<d.length&&a.property().isElement(b)&&d.length===c?fs(a,d[d.length-1]):W.point(b,c)},gs=function(a,b,c){return a.property().isText(b)&&0===a.property().getText(b).trim().length||a.property().isComment(b)?c(b).bind(function(b){return gs(a,b,c).orThunk(function(){return g.some(b)})}):g.none()},
kE=function(a,b){b=gs(a,b,a.query().nextSibling).getOr(b);if(a.property().isText(b))return W.point(b,0);var c=a.property().children(b);return 0<c.length?kE(a,c[0]):W.point(b,0)},lE=function(a,b){return a.property().isText(b)?a.property().getText(b).length:a.property().children(b).length},mE=function(a,b){b=gs(a,b,a.query().prevSibling).getOr(b);if(a.property().isText(b))return W.point(b,lE(a,b));var c=a.property().children(b);return 0<c.length?mE(a,c[c.length-1]):W.point(b,lE(a,b))},Ef={toLast:fs,
toLeaf:jE,toLower:function(a,b){a=a.property().isText(b)?a.property().getText(b).length:a.property().children(b).length;return W.point(b,a)},freefallLtr:kE,freefallRtl:mE},Pc={toLeaf:function(a,b,c){return Ef.toLeaf(a,b,c)},freefallLtr:function(a,b){return Ef.freefallLtr(a,b)},freefallRtl:function(a,b){return Ef.freefallRtl(a,b)}},hs=gb(),Xa={toLeaf:function(a,b){return Pc.toLeaf(hs,a,b)},freefallLtr:function(a){return Pc.freefallLtr(hs,a)},freefallRtl:function(a){return Pc.freefallRtl(hs,a)}},nE=
function(a,b){return fa.inBody(a)&&0<=b&&b<B.children(a).length},Fm={multiple:function(a,b,c){return function(d,e){d=a.getSelection();var f=d.map(function(a){return{left:B.parent(a.startContainer()).getOrDie(),right:B.parent(a.endContainer()).getOrDie()}}),h=wd.runTransaction(a,b,function(){return ia(e,function(a){return a.getSelection().bind(function(a){return c(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()).map(function(a){return a.all()})}).getOr([])})},a.toEditing);d=d.filter(function(a){return nE(a.startContainer(),
a.startOffset())&&nE(a.endContainer(),a.endOffset())}).getOrThunk(function(){var a=Xa.freefallLtr(0<h.length?h[0]:f.getOrDie().left),b=Xa.freefallRtl(0<h.length?h[h.length-1]:f.getOrDie().right);return es(a.element(),a.offset(),b.element(),b.offset())});a.setSelection(d.startContainer(),d.startOffset(),d.endContainer(),d.endOffset());return h}},single:function(a,b,c,d,e){return function(f,h){var g=d(a,f.startContainer(),f.startOffset()),k=d(a,f.endContainer(),f.endOffset());h=wd.runTransaction(a,
b,function(){return c(g.element(),g.offset(),k.element(),k.offset())},a.toEditing);return e(a,h,g,k,f)}}},Gm={multiple:function(a,b,c){return function(d,e){return wd.runTransaction(a,b,function(){return ia(e,function(a){return a.getSelection().bind(function(a){return c(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()).map(function(a){return a.all()})}).getOr([])})},a.toEditing)}},single:function(a,b,c,d,e){return function(f,h){var g=d(a,f.startContainer(),f.startOffset()),k=d(a,f.endContainer(),
f.endOffset());h=wd.runTransaction(a,b,function(){return c(g.element(),g.offset(),k.element(),k.offset())},a.toEditing);return e(a,h,g,k,f)}}},uj=function(a,b,c,d,e){return b.map(function(b){a.setSelection(b.start(),b.soffset(),b.finish(),b.foffset());return b.all()}).getOr([])},vj=function(a,b,c){return W.point(b,c)},is=sa.generate([{none:[]},{multiple:["elements","environments"]},{single:["selection","environment"]}]),Pb={cata:function(a,b,c,d){return a.fold(b,c,d)},none:is.none,multiple:is.multiple,
single:is.single,toSelection:function(a){return a.fold(g.none,function(a,c){return g.from(c[0]).bind(function(a){return a.getSelection()})},g.some)}},oE=M("left","right"),pE=function(a,b,c){var d=a.property().children(b);return Ta(d,t(a.eq,c)).map(function(a){return{before:k(d.slice(0,a)),after:k(d.slice(a+1))}})},wj={breakToLeft:function(a,b,c){return pE(a,b,c).map(function(d){var e=a.create().clone(b);a.insert().appendAll(e,d.before().concat([c]));a.insert().appendAll(b,d.after());a.insert().before(b,
e);return oE(e,b)})},breakToRight:function(a,b,c){return pE(a,b,c).map(function(c){var d=a.create().clone(b);a.insert().appendAll(d,c.after());a.insert().after(b,d);return oE(b,d)})},breakPath:function(a,b,c,d){var e=M("first","second","splits"),f=function(b,l,k){var h=e(b,g.none(),k);return c(b)?e(b,l,k):a.property().parent(b).bind(function(e){return d(a,e,b).map(function(a){var b=[{first:a.left,second:a.right}],d=c(e)?e:a.left();return f(d,g.some(a.right()),k.concat(b))}).getOr(h)})};return f(b,
g.none(),[])}},B2=function(a,b,c,d){c=b(a,c);return zb(d,function(c,d){d=b(a,d);return A2(a,c,d)},c)},A2=function(a,b,c){return b.bind(function(b){return c.filter(t(a.eq,b))})},C2={oneAll:function(a,b,c){if(0<c.length){var d=c[0];c=c.slice(1);a=B2(a,b,d,c)}else a=g.none();return a}},D2=function(a,b,c,d){var e=a.property().children(b);if(a.eq(b,c[0]))return g.some([c[0]]);if(a.eq(b,d[0]))return g.some([d[0]]);var f=function(c){c=Ld(c);var d=Ta(c,t(a.eq,b)).getOr(-1);return Ta(e,t(a.eq,d<c.length-1?
c[d+1]:c[d]))};c=f(c);var h=f(d);return c.bind(function(a){return h.map(function(b){return e.slice(Math.min(a,b),Math.max(a,b)+1)})})},qE=function(a,b,c,d){var e=void 0!==d?d:k(!1);b=[b].concat(a.up().all(b));c=[c].concat(a.up().all(c));d=function(a){return Ta(a,e).fold(function(){return a},function(b){return a.slice(0,b+1)})};b=d(b);var f=d(c);c=va(b,function(b){return Va(f,t(a.eq,b))});return{firstpath:k(b),secondpath:k(f),shared:k(c)}},js={subset:function(a,b,c){var d=qE(a,b,c);return d.shared().bind(function(b){return D2(a,
b,d.firstpath(),d.secondpath())})},ancestors:qE},gd={sharedOne:function(a,b,c){return C2.oneAll(a,b,c)},subset:function(a,b,c){return js.subset(a,b,c)},ancestors:function(a,b,c,d){return js.ancestors(a,b,c,d)},breakToLeft:function(a,b,c){return wj.breakToLeft(a,b,c)},breakToRight:function(a,b,c){return wj.breakToRight(a,b,c)},breakPath:function(a,b,c,d){return wj.breakPath(a,b,c,d)}},qh=gb(),He={sharedOne:function(a,b){return gd.sharedOne(qh,function(b,d){return a(d)},b)},subset:function(a,b){return gd.subset(qh,
a,b)},ancestors:function(a,b,c){return gd.ancestors(qh,a,b,c)},breakToLeft:function(a,b){return gd.breakToLeft(qh,a,b)},breakToRight:function(a,b){return gd.breakToRight(qh,a,b)},breakPath:function(a,b,c){return gd.breakPath(qh,a,b,function(a,b,f){return c(b,f)})}},Hm=function(a,b,c,d,e){return d(a).fold(function(){return!0},function(a){return P.eq(b,a)&&e(b,c)})},ag={isLeft:function(a,b){return Hm(a,b.startContainer(),b.startOffset(),ac.first,oa.isStart)},isAtLeftEdge:function(a,b,c){return Hm(a,
b,c,ac.first,oa.isStart)},isRight:function(a,b){return Hm(a,b.startContainer(),b.startOffset(),ac.last,oa.isEnd)},isAtRightEdge:function(a,b,c){return Hm(a,b,c,ac.last,oa.isEnd)}},E2=function(a){a=C.name(a);return"td"===a||"th"===a},ks=function(a){return"li"===C.name(a)||la.isBlock(a)},rE=function(a){return"a"===C.name(a)},sE=function(a,b,c){return Da.closest(a,b,c).filter(xf(c)).filter(xf(E2))},Ub={stopAt:function(a){return t(P.eq,a)},isList:function(a){a=C.name(a);return"ol"===a||"ul"===a},isAnchor:rE,
isHeading:function(a,b){b=Gb(b)?b:[];b="h1 h2 h3 h4 h5 h6".split(" ").concat(b);a=C.name(a);return V(b,a)},isCollapsed:function(a){return P.eq(a.startContainer(),a.endContainer())&&a.startOffset()===a.endOffset()},isRightEdge:function(a,b,c){var d=M("startContainer","startOffset");return ag.isRight(a,d(b,c))},isBlockOrList:ks,exitList:function(a){return 0===Cc.descendants(a,function(a){return C.isText(a)&&0<Oa.get(a).length&&0<dh(Oa.get(a)).length||C.isElement(a)&&V("hr img input video iframe picture audio embed map object".split(" "),
C.name(a))}).length},findBlock:function(a,b){return Da.closest(a,ks,b)},findValidHardBreak:function(a,b){return sE(a,ks,b)},findAnchorBreak:function(a,b){return sE(a,rE,b)}},ls={forceAddBr:function(a,b){if("br"!==C.name(a)){var c=p.fromTag("br");C.isText(a)?(y.after(a,c),P.eq(b,a)||E.remove(a)):Ub.isBlockOrList(a)?y.append(a,c):(b=p.fromText(fb()),y.prepend(a,b),y.after(a,c))}},rootBr:function(a,b){y.before(a,p.fromTag("br"))}},tE=function(a,b,c){var d=[];A(B.children(a),function(a){b(a)&&(d=d.concat([a]));
d=c(a)?d:d.concat(tE(a,b,c))});return d},uE=function(a,b){var c=B.children(a);return 0<c.length?(c=c[0],b(c)||"textarea"===C.name(c)?a:uE(c,b)):a},Im={descendants:tE,plunge:uE},Jm=function(a){if(!C.isText(a))return!1;a=Oa.get(a).trim();return 0===a.length||0===a.replace(fb(),"").length},Km=function(a){if(C.isText(a))return Jm(a);var b=Ca.get(a);a=B.children(a);return""===dh(b)||kb(a,Jm)},rh={vacant:function(a){a=ca.descendants(a,"span,a");return ka(a,function(a){if("span"===C.name(a)){var b=m.has(a,
"class")&&0<m.get(a,"class").length,d=m.has(a,"id");a=!b&&!d&&!m.has(a,"style")&&Km(a)}else a=Km(a);return a})},isEmpty:Km,hasCursor:function(a,b){b=void 0!==b?b:"hr br img input textarea iframe".split(" ");return C.isText(a)?!1===Jm(a):V(b,C.name(a))},isVacantText:Jm,hasNoContent:Km},vE=function(a){var b="li"===C.name(a)?Ub.isList:k(!1);return 0<Im.descendants(a,rh.hasCursor,b).length?g.none():g.some(Im.plunge(a,b))},wE=function(a){a=rh.vacant(a);A(a,E.remove)},xE=function(a,b){a=ca.descendants(b,
a);a=ka(a,rh.isEmpty);A(a,E.remove);rh.isEmpty(b)&&E.remove(b)},Ye={vacate:wE,emptyStyles:function(a){!0===m.has(a,"style")&&0===m.get(a,"style").length&&m.remove(a,"style")},needsCursor:vE,postprocess:function(a,b,c){wE(a);vE(a).each(function(a){ls.forceAddBr(a,b)})},lists:t(xE,"ul,ol"),blockquotes:t(xE,"blockquote")},F2=function(a,b){a=He.breakToRight(a,b);a.each(function(a){a=a.right();A(["id"],t(m.remove,a));Ye.emptyStyles(a)});return a},Lm={breakPath:function(a,b){return He.breakPath(a,b,F2)}},
G2={breakQuote:function(a,b){var c=Lm.breakPath(b,Ub.stopAt(a));return c.second().map(function(a){var d=c.first();y.before(a,b);A([d,a],Ye.blockquotes);return{start:k(ha.on(b,0)),finish:k(ha.on(b,0))}})}},yE=function(a){return C.isElement(a)?a:B.parent(a).getOr(a)},zE={bothMatch:function(a,b,c){a=yE(a);b=yE(b);return c(a)&&c(b)}},Mm={isRootOrCell:function(a){return function(b){return a(b)||za.is(b,"td,th")}},isRootOrContainer:function(a){return function(b){return a(b)||la.isContainer(b)}}},AE=function(a,
b){return 0===a.length?!0:0===b.length?!1:a[0]<b[0]?!0:b[0]<a[0]?!1:AE(a.slice(1),b.slice(1))},Ff={head:function(a){return 0<a.length?g.some(a[0]):g.none()},tail:function(a){return 0<a.length?g.some(a.slice(1)):g.none()},toLast:function(a){return 0<a.length?g.some(a[a.length-1]):g.none()},box:function(a){return[a]},isBefore:AE},Nm=sa.generate([{quasi:["elements"]},{block:["element"]},{container:["element","children"]},{fixture:["element"]}]),BE=function(a){return a.fold(function(a){return"@q["+F(a,
function(a){return a.dom().outerHTML||'"'+a.dom().nodeValue+'"'}).join(",")+"]"},function(a){return"@"+a.dom().nodeName.toLowerCase()+"("+a.dom().innerHTML+")"},function(a,c){return"#"+a.dom().nodeName.toLowerCase()+"("+F(c,BE).join(",")+")"},function(a){return a.dom().nodeName.toLowerCase()})},CE=function(a){var b=function(a){return[a]};return a.fold(aa,b,b,b)},Om=k(!0),Gf=k(!1),qc={cata:function(a,b,c,d,e){return a.fold(b,c,d,e)},quasi:Nm.quasi,block:Nm.block,container:Nm.container,fixture:Nm.fixture,
isQuasi:function(a){return a.fold(Om,Gf,Gf,Gf)},isFixture:function(a){return a.fold(Gf,Gf,Gf,Om)},isQuasiOrFixture:function(a){return a.fold(Om,Gf,Gf,Om)},toTarget:CE,toString:BE,toLastTarget:function(a){return Ff.toLast(CE(a))}},xj=function(a,b){return{fold:a,label:k(b)}},Hf={before:function(a){return xj(function(b,c,d,e,f){return b(a)},"before")},after:function(a){return xj(function(b,c,d,e,f){return c(a)},"after")},rest:function(a){return xj(function(b,c,d,e,f){return d(a)},"rest")},last:function(a){return xj(function(b,
c,d,e,f){return e(a)},"last")},invalid:function(a,b){return xj(function(c,d,e,f,h){return h(a,b)},"invalid")}},DE={subdivide:function(a,b,c){var d=a.property().getText(b);c=ka(em.splits(d,c),function(a){return 0<a.length});if(1>=c.length)return[W.range(b,0,d.length)];a.property().setText(b,c[0]);d=zd.generate(c.slice(1),function(b,c){var d=a.create().text(b);b=W.range(d,c,c+b.length);return g.some(b)},c[0].length);var e=F(d,function(a){return a.element()});a.insert().afterAll(b,e);return[W.range(b,
0,c[0].length)].concat(d)}},Pm=function(a,b){return{fold:a,label:k(b)}},Qm={none:function(){return Pm(function(a,b,c,d){return a()},"none")},start:function(a){return Pm(function(b,c,d,e){return c(a)},"start")},middle:function(a,b){return Pm(function(c,d,e,f){return e(a,b)},"middle")},end:function(a){return Pm(function(b,c,d,e){return e(a)},"end")}},H2={determine:function(a){return a.before().fold(function(){return a.after().fold(function(){return Qm.none()},function(a){return Qm.start(a)})},function(b){return a.after().fold(function(){return Qm.end(b)},
function(a){return Qm.middle(b,a)})})}},I2={group:function(a,b,c){b=ia(b,function(b){return zf.from(a,b,c)});b=Mz.splitbyAdv(b,function(a){return Kl.cata(a,function(){return fh.excludeWithout(a)},function(){return fh.excludeWith(a)},function(){return fh.include(a)})});return ka(b,function(a){return 0<a.length})}},J2={common:function(a,b,c){b=[b].concat(a.up().all(b));var d=[c].concat(a.up().all(c));return va(b,function(b){return Va(d,function(c){return a.eq(c,b)})})}},fQ="table tbody thead tfoot tr ul ol".split(" "),
K2={range:function(a,b,c,d,e){return a.eq(b,d)?[b]:J2.common(a,b,d).fold(function(){return[]},function(f){var h=[f].concat(zf.all(a,f,k(!1)));f=Ta(h,t(a.eq,b));var g=Ta(h,t(a.eq,d));f=f.bind(function(a){return g.map(function(b){return a<b?h.slice(a+c,b+e):h.slice(b+e,a+c)})}).getOr([]);var r=eQ(a);return ka(f,r.validateText)})}},EE={range:function(a,b,c,d,e){return K2.range(a,b,c,d,e)},group:function(a,b,c){return I2.group(a,b,c)}},ms=M("before","after"),FE=function(a,b,c){a=a.property().getText(b);
return em.splits(a,c)},GE=function(a,b,c,d){if(!a.property().isText(b)||c===d)return b;if(c>d)return GE(a,b,d,c);var e=a.property().getText(b).length;if(0===c&&d===e)return b;d=FE(a,b,[c,d]);a.property().setText(b,d[0]);d=F(d.slice(1),function(b){return a.create().text(b)});e=d[0];a.insert().afterAll(b,d);return 0===c?b:e},yj={split:function(a,b,c){if(!a.property().isText(b)||0>=c)return ms(g.none(),g.some(b));if(c>=a.property().getText(b).length)return ms(g.some(b),g.none());c=FE(a,b,[c]);a.property().setText(b,
c[0]);c=a.create().text(c[1]);a.insert().after(b,c);return ms(g.some(b),g.some(c))},splitByPair:GE},L2=function(a,b,c,d,e){c=yj.split(a,b,c).after().fold(function(){return W.delta(b,1)},function(a){return W.delta(a,0)});e=yj.split(a,d,e).before().fold(function(){return W.delta(d,0)},function(a){return W.delta(a,1)});return EE.range(a,c.element(),c.deltaOffset(),e.element(),e.deltaOffset())},M2=function(a,b,c,d,e){return[yj.splitByPair(a,b,c,e)]},N2={nodes:function(a,b,c,d,e){return(a.eq(b,d)?M2:L2)(a,
b,c,d,e)}},Bd={split:function(a,b,c){return yj.split(a,b,c)},splitByPair:function(a,b,c,d){return yj.splitByPair(a,b,c,d)},range:function(a,b,c,d,e){return N2.nodes(a,b,c,d,e)},subdivide:function(a,b,c){return DE.subdivide(a,b,c)},position:function(a,b){return H2.determine(b)}},O2=function(a,b,c){var d=Bd.split(a,b,c);return Bd.position(a,d).fold(function(){return Hf.invalid(b,c)},Hf.before,Hf.after,Hf.after)},P2=function(a,b,c){var d=a.property().children(b);return a.property().isEmptyTag(b)?Hf.before(b):
c===d.length?Hf.last(b):c<d.length?Hf.rest(d[c]):Hf.invalid(b,c)},Q2={atStartOf:function(a,b,c,d){var e=function(b){a.insert().before(b,d)};(a.property().isText(b)?O2:P2)(a,b,c).fold(e,function(b){a.insert().after(b,d)},e,function(b){a.insert().append(b,d)},u)}},ns={atStartOf:function(a,b,c,d){Q2.atStartOf(a,b,c,d)}},R2=sa.generate([{none:[]},{root:["target","block"]},{created:["target","block"]},{actual:["target","block"]}]),If=ra(R2,{toString:function(a){return a.fold(function(){return["block.none"]},
function(a,c){return["block.root",a,c]},function(a,c){return["block.created",a,c]},function(a,c){return["block.actual",a,c]})},cata:function(a,b,c,d,e){return a.fold(b,c,d,e)},extract:function(a){var b=k([]),c=function(a,b){return[b]};return a.fold(b,b,c,c)},extractEvenRoot:function(a){var b=k([]),c=function(a,b){return[b]};return a.fold(b,c,c,c)}}),HE=function(a,b){return function(c){return a.eq(c,b)||a.property().parent(c).map(function(c){return a.eq(c,b)}).getOr(!1)}},S2=function(a,b,c){return a.eq(b,
c)?g.none():a.property().isBoundary(c)?a.query().nextSibling(c):a.property().isEmptyTag(c)?(b=HE(a,b),b(c)?a.query().nextSibling(c):gd.breakPath(a,c,b,gd.breakToRight).second()):g.none()},T2=function(a,b,c){if(a.eq(b,c))return g.none();if(a.property().isBoundary(c))return a.query().prevSibling(c);if(a.property().isEmptyTag(c)){var d=HE(a,b);return d(c)?a.query().prevSibling(c):a.query().prevSibling(c).map(function(b){return gd.breakPath(a,b,d,gd.breakToRight).first()})}return g.none()},IE=function(a,
b,c,d){return c(a,b,d).bind(function(c){var d=a.property().children(b);return Ta(d,function(b){return a.eq(b,c)})})},os=function(a,b){return a.property().isEmptyTag(b)||a.property().isBoundary(b)},ps={create:function(a,b,c){if(os(a,c)||os(a,Pc.toLeaf(a,c,0).element()))return[c];var d=t(os,a),e=t(a.eq,b),f=ua.seekLeft(a,c,d,e).bind(function(c){return IE(a,b,S2,c)}).getOr(0),h=a.property().children(b);c=ua.seekRight(a,c,d,e).bind(function(c){return IE(a,b,T2,c)}).getOr(h.length-1);return a.property().children(b).slice(f,
c+1)}},U2=function(a,b,c,d){return c(b)||d(b)?g.some(b):a.up().predicate(b,c,d)},JE=function(a,b,c){c=c();a.insert().wrap(b,c);return If.created(b,c)},V2=function(a,b,c,d){var e=d();a.insert().before(c[0],e);A(c,function(b){a.insert().append(e,b)});return If.created(b,e)},W2=function(a,b,c,d,e,f,h){if(f(c)){var g=a.property().children(b);if(d<g.length&&h(g[d]))return If.actual(c,g[d])}return e(b).fold(function(){return If.root(c,b)},function(e){if(f(c)){var h=e(),g=a.property().children(b),l=g[d];
void 0!==l&&(e=ps.create(a,b,l,e),a.insert().appendAll(h,0<e.length?e:[l]));ns.atStartOf(a,b,Math.min(g.count,d),h);return If.created(b,h)}a.property().isEmptyTag(c)?e=JE(a,c,e):(h=ps.create(a,b,c),e=0<h.length?V2(a,c,h,e):JE(a,c,e));return e})},X2={single:function(a,b,c,d,e,f){return U2(a,c,b,f).fold(If.none,function(h){return f(h)?W2(a,h,c,d,e,f,b):If.actual(c,h)})}},KE={resolve:Hb.create("ephox-soldier").resolve},sh=KE.resolve("quasi-block"),LE=function(a){a=B.children(a);return 1===a.length&&
"br"===C.name(a[0])},ME=function(a){return n.has(a,sh)&&!LE(a)},Rm={condense:function(a){a=ka(a,function(a,c){if(!C.isElement(a))return!0;n.has(a,sh)&&LE(a)&&(B.prevSibling(a).exists(ME)||B.nextSibling(a).exists(ME))?(E.remove(a),a=!1):a=!0;return a});return F(a,function(a){var b=C.isElement(a)?[a].concat(ca.descendants(a,"."+sh)):[];A(b,function(a){n.remove(a,sh)});return a})},register:function(a){return function(b){return a(b).map(function(a){return function(){var b=a();n.add(b,sh);return b}})}},
style:k(sh)},Y2=gb(),xi={single:function(a,b,c,d,e){return X2.single(Y2,a,b,c,Rm.register(d),e)},isBlock:function(a){return V("ol p div ul table caption td th h1 h2 h3 h4 h5 h6 body blockquote pre".split(" "),C.name(a))}},zj={tag:function(){return"p"},nu:function(a){return t(a.create().nu,"p")}},qs=function(a){return 0<a.length?g.some(a[0]):g.none()},Aj=sa.generate([{descend:["index"]},{leftOf:["rindex"]},{bounded:["lindex","rindex"]},{rightOf:["lindex"]},{all:[]}]),NE={derive:function(a,b){return a.bind(qs).fold(function(){return b.bind(qs).fold(function(){return Aj.all()},
function(a){return Aj.leftOf(a)})},function(a){return b.bind(qs).fold(function(){return Aj.rightOf(a)},function(b){return a===b?Aj.descend(a):Aj.bounded(a,b)})})},cata:function(a,b,c,d,e,f){return a.fold(b,c,d,e,f)}},OE=function(a,b,c){return g.from(a.property().children(b)[c])},Z2=function(a,b,c){var d=a.property().children(c),e=OE(a,c,0).bind(function(e){return OE(a,c,d.length-1).map(function(d){return rs(a,b,c,e,d)})}).getOr([]);return qc.container(c,e)},rs=function(a,b,c,d,e){var f=PE(a,c,b,d);
return qc.toLastTarget(f).filter(function(b){return!a.eq(e,b)}).bind(function(d){return ua.walk(a,d,ua.sidestep,ua.walkers().right()).bind(function(d){if(a.eq(c,d.item()))return g.none();d=rs(a,b,c,d.item(),e);return g.some([f].concat(d))})}).getOrThunk(function(){return[f]})},PE=function(a,b,c,d){if(yc.isFormatting(a,d))return qc.block(d);if(yc.isEmptyTag(a,d))return qc.fixture(d);if(yc.isBlock(a,d)||yc.isContainer(a,d))return Z2(a,c,d);a=ps.create(a,b,d);return qc.quasi(0<a.length?a:[d])},QE=function(a,
b,c){return PE(a,c,b,c)},ss=function(a,b,c,d,e,f,h,l){c=c.map(function(c){return Bj(a,b,c,h.bind(Ff.tail),g.none())}).getOr([]);e=e.map(function(c){return Bj(a,b,c,g.none(),l.bind(Ff.tail))}).getOr([]);d=0===d.length?[]:rs(a,b,f,d[0],d[d.length-1]);return[qc.container(f,c.concat(d).concat(e))]},Bj=function(a,b,c,d,e){var f=a.property().children(c);d.bind(Ff.head).getOr(0);e.bind(Ff.head).getOr(f.length-1);var h=NE.derive(d,e);return NE.cata(h,function(c){return Bj(a,b,f[c],d.bind(Ff.tail),e.bind(Ff.tail))},
function(h){return ss(a,b,g.none(),f.slice(0,h),g.from(f[h]),c,d,e)},function(h,k){return ss(a,b,g.from(f[h]),f.slice(h+1,k),g.from(f[k]),c,d,e)},function(h){return ss(a,b,g.from(f[h]),f.slice(h+1),g.none(),c,d,e)},function(){return[QE(a,b,c)]})},RE={categorise:QE,within:function(a,b,c,d,e){return!0===Ff.isBefore(d,e)?Bj(a,b,c,g.some(d),g.some(e)):Bj(a,b,c,g.some(e),g.some(d))}},ts=function(a,b){if("li"!==C.name(a))return!1;a=hb(b,function(a,b){return 1<a.quasi||0<a.nonlist?a:qc.cata(b,function(){return{quasi:1+
a.quasi,nonlist:a.nonlist}},function(){return{quasi:a.quasi,nonlist:1+a.nonlist}},function(b){return{quasi:a.quasi,nonlist:(V(["ul","ol"],C.name(b))?0:1)+a.nonlist}},function(){return{quasi:1+a.quasi,nonlist:a.nonlist}})},{quasi:0,nonlist:0});return 1>=a.quasi&&0===a.nonlist},us=function(a,b,c){return 0>=c.length?!0:V(a,C.name(b))?2<c.length?!1:1===c.length?qc.isQuasiOrFixture(c[0]):qc.isQuasiOrFixture(c[0])&&qc.isQuasiOrFixture(c[1])&&!kb(c,qc.isFixture):!1},Cd={wrap:function(a){if(0===a.length||
1===a.length&&C.isText(a[0])&&0===Oa.get(a[0]).trim().length)return[];var b=p.fromTag(zj.tag());n.add(b,Rm.style());y.before(a[0],b);O.append(b,a);return[b]},handleContainer:function(a,b,c,d){if(us(a,b,c))return[b];var e=ts(b,c)?[b]:[];return e.concat(ia(c,function(a){return d(a,0<e.length)}))},hasSimpleContent:us,isNestedList:ts,handleRoot:function(a,b){b=RE.categorise(gb(),t(P.eq,b),b,b,b);var c=function(){return g.some(zj.nu(gb()))},d=g.none;return qc.cata(b,c,d,function(b,f){return us(a,b,f)||
ts(b,f)?d():c()},c)}},Sm=["li","td","th","caption"],SE=function(a,b){return qc.cata(a,function(a){return!0===b?[]:Cd.wrap(a)},function(a){return[a]},function(a,b){return Cd.handleContainer(Sm,a,b,SE)},function(a){return!0===b?[]:Cd.wrap([a])})},$2={isRootContainer:Mm.isRootOrContainer,extract:function(a){return SE(a,!1)},isCapable:function(a){return xi.isBlock(a)||V(Sm,C.name(a))},canUse:function(a){return la.isFormatting(a)||V(Sm,C.name(a))},quasi:t(Cd.handleRoot,Sm),ascend:aa},TE=ya(["start","soffset",
"finish","foffset","all"],[]),UE=ya(["start","soffset","finish","foffset"],[]),th={block:TE,inline:UE,blockFrom:function(a){return 0<a.length?g.some(TE({start:a[0],soffset:0,finish:a[a.length-1],foffset:oa.getEnd(a[a.length-1]),all:a})):g.none()},inlineFrom:function(a){return a.map(function(a){return UE({start:a.start(),soffset:a.soffset(),finish:a.finish(),foffset:a.foffset()})})}},Tm=function(a){return za.is(a,"td,th")},VE=function(a){return P.eq(a.startContainer(),a.endContainer())&&a.startOffset()===
a.endOffset()},WE=function(a,b){return a(b.startContainer())?g.some(Xa.freefallLtr(b.startContainer())):g.none()},XE=function(a,b){return(a(b.endContainer())?g.some(Xa.freefallRtl(b.endContainer())):g.none()).map(function(a){return za.is(a.element(),"br")&&!1===VE(b)?W.point(a.element(),1):a})},Dd={is:Tm,isCollapsed:VE,isWholeCell:function(a){return Tm(a.startContainer())&&P.eq(a.startContainer(),a.endContainer())&&0===a.startOffset()&&a.endOffset()===oa.getEnd(a.endContainer())},left:t(WE,Tm),leftWith:WE,
right:t(XE,Tm),rightWith:XE},vs=M("startContainer","startOffset","endContainer","endOffset"),ws=M("start","soffset","finish","foffset"),Lb={hare:vs,fussy:ws,fromHare:function(a){return ws(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())},fromFussy:function(a){return vs(a.start(),a.soffset(),a.finish(),a.foffset())},fussyFromElements:function(a){if(0===a.length)return g.none();var b=a[0];a=a[a.length-1];b=B.firstChild(b).getOr(b);a=B.lastChild(a).getOr(a);return g.some(ws(b,0,a,oa.getEnd(a)))},
hareFromElement:function(a){return vs(a,0,a,oa.getEnd(a))}},YE=function(a,b){return b(a)?g.some([]):B.parent(a).bind(function(c){return B.findIndex(a).bind(function(a){return YE(c,b).map(function(b){return b.concat([a])})})})},ZE=function(a,b){return 0===b.length?g.some(a):B.child(a,b[0]).bind(function(a){return ZE(a,b.slice(1))})},uh={path:function(a,b){var c=t(P.eq,a);return P.eq(a,b)?g.some([]):YE(b,c)},follow:ZE},$E=M("ancestor","startPath","finishPath"),a3=function(a,b,c){return He.ancestors(b,
c,a).shared().bind(function(a){return uh.path(a,b).bind(function(b){return uh.path(a,c).map(function(c){return $E(a,b,c)})})})},aF=function(a,b,c,d){var e=b.isRootContainer(a);c=xi.single(b.isCapable,c,d,b.quasi,e);c=If.extractEvenRoot(c);return 1===c.length?g.some(c[0]).map(function(c){return b.ascend(c,a)}):g.none()},bF=function(a,b,c,d){if(!1===b(c))return W.point(c,d);d<oa.getEnd(c)||a.isCapable(c)&&a.canUse(c)?c=Xa.toLeaf(c,d):(a=p.fromTag("br"),y.append(c,a),c=W.point(a,0));return c},b3={branch:function(a,
b,c,d,e,f){var h=b.isRootContainer(a),l=Lb.hare(c,d,e,f),r=k(!0===Dd.isWholeCell(l)),m=Dd.left(l).filter(r).getOrThunk(function(){return bF(b,h,c,d)}),x=Dd.right(l).filter(r).getOrThunk(function(){return bF(b,h,e,f)});return aF(a,b,m.element(),m.offset()).bind(function(c){return(P.eq(m.element(),x.element())&&m.offset()===x.offset()?g.some(c):aF(a,b,x.element(),x.offset())).bind(function(b){return P.eq(c,b)?g.some($E(c,[],[])):a3(a,c,b)})})}},cF=function(a,b,c,d,e,f,h){a=b.isRootContainer(a)(c);b=
!a&&fa.inBody(c)?W.point(c,d):a||!b.isCapable(c)||fa.inBody(c)?fa.inBody(e.element())&&V(["td","th"],C.name(c))?e:!fa.inBody(c)&&fa.inBody(f.element())&&"br"==C.name(f.element())?f:Xa.toLeaf(h,0):W.point(h,d);oa.getEnd(b.element());return b.offset()<=oa.getEnd(b.element())?g.some(b):g.none()},vh={applyOn:function(a,b,c,d,e,f,h){var l=Vc.after(c,d,e,f),k=b.isRootContainer(a)(c)?Xa.toLeaf(c,d):W.point(c,d),m=b.isRootContainer(a)(e)?Xa.toLeaf(e,f):W.point(e,f),x=Xa.toLeaf(c,d),n=Xa.toLeaf(e,f),q=b3.branch(a,
b,c,d,e,f).map(function(b){return RE.within(gb(),a,b.ancestor(),b.startPath(),b.finishPath())}).getOr([]);q=ia(q,b.extract);A(q,function(a){0===B.children(a).length&&la.isFormatting(a)&&y.append(a,p.fromTag("br"))});q=Rm.condense(q);var t=h(q);return 0===t.length?g.none():cF(a,b,c,d,k,x,t[l?t.length-1:0]).bind(function(c){return cF(a,b,e,f,m,n,t[l?0:t.length-1]).map(function(a){return th.block({start:c.element(),soffset:c.offset(),finish:a.element(),foffset:a.offset(),all:t})})})}},xs=function(a){return function(b){return a}},
dF={start:we.onDirection("left","right"),end:we.onDirection("right","left"),justify:xs("justify"),center:xs("center"),"match-parent":xs("match-parent")},c3={hasAlignment:function(a,b,c){C.isText(a)?a=!1:(b=v.get(a,b),a=(void 0!==dF[b]?dF[b](a):b)===c);return a}},d3=function(a,b,c){return c3.hasAlignment(c,a,b)},Um=function(a,b,c){var d=gQ(b,c);return{run:function(a,b,c,g,k){return vh.applyOn(a,$2,b,c,g,k,function(a){var b=kb(a,d.is)?d.remove:d.set;A(a,b);return a})},query:function(a,d){var e=t(d3,
b,c);return zE.bothMatch(a,d,e)},name:k(a)}},e3=Um("JustifyLeft","text-align","left"),f3=Um("JustifyCenter","text-align","center"),g3=Um("JustifyRight","text-align","right"),h3=Um("JustifyFull","text-align","justify"),Rd={justifyleft:k(e3),justifycentre:k(f3),justifyright:k(g3),justifyfull:k(h3)},eF=function(a){a=a.dom();if(ue.isSupported(a)){var b=a.style.marginLeft;return"auto"===a.style.marginRight&&"auto"===b}return!1},ys={isCentered:eF,divine:function(a){if(eF(a))return g.some("center");var b=
v.getRaw(a,"float").getOrThunk(function(){return v.get(a,"float")});return void 0!==b&&null!==b&&0<b.length?g.some(b):g.none()},getRaw:function(a){return v.getRaw(a,"float").getOr(null)},setCentered:function(a){v.setAll(a,{"margin-left":"auto","margin-right":"auto"})}},i3={left:{"float":"left",margin:""},right:{"float":"right",margin:""},none:{"float":"none",margin:""},center:{"float":"",margin:"0 auto"}},fF={none:{display:""},left:{display:""},right:{display:""},center:{display:"block"}},gF=function(a,
b){return ys.divine(a).is(b)},hF=function(a,b){var c="img"===C.name(a)&&void 0!==fF[b]?fF[b]:{};g.from(i3[b]).each(function(b){v.setAll(a,b);v.setAll(a,c)})},Vm=function(a,b){return{run:function(a){hF(a,b);return g.none()},query:function(a){return gF(a,b)},name:k(a)}},j3=Vm("JustifyLeft","left"),k3=Vm("JustifyCenter","center"),l3=Vm("JustifyRight","right"),m3=Vm("FloatNone","none"),wg={floatnone:k(m3),floatleft:k(j3),floatcentre:k(k3),floatright:k(l3),queryIsFloat:gF,runFloat:hF},iF=function(a){return qc.cata(a,
function(a){return Cd.wrap(a)},function(a){return[a]},function(a,c){return ia(c,iF)},function(a){return Cd.wrap([a])})},jF={isRootContainer:Mm.isRootOrContainer,extract:iF,isCapable:function(a){return xi.isBlock(a)||"li"===C.name(a)},canUse:function(a){return la.isFormatting(a)},quasi:function(a){return g.some(zj.nu(gb()))},ascend:aa},zs=M("level","content","cruft","list","item"),Wm={level:function(a,b){return zs(a.level()+b,a.content(),a.cruft(),a.list(),a.item())},list:function(a,b){return zs(a.level(),
a.content(),a.cruft(),b,a.item())}},kF=M("elements","elementsTransformed"),n3=M("original","replaced"),xg=M("result","items"),Xm={answer:kF,write:function(a,b){var c=[],d=function(b){var c=a.create().nu("p");a.insert().appendAll(c,b);return c},e=function(a){if(0===a.length)throw"Cannot get tail of an empty array";return a.slice(1)},f=function(b,c){for(var d=a.create().clone(c[0].list()),g=[],l=c[0];0<c.length&&c[0].level()>=b&&a.property().name(l.list())===a.property().name(c[0].list());){if(c[0].level()===
b){var k=b;var r=c[0];var m=r;var n=m.item(),p=n;p=a.property().children(p);A(p,a.remove().remove);a.insert().appendAll(n,m.content());m=n;r=r.cruft();for(c=e(c);0<c.length&&c[0].level()>k;)c=f(k+1,c),n=[c.result()].filter(t(h,["li"])),c=c.items(),a.insert().appendAll(m,n);a.insert().appendAll(m,r);k=xg(m,c);c=[k.result()].filter(t(h,["li"]));k=xg(c,k.items())}else k=f(b+1,c),c=[k.result()].filter(t(h,["ul","ol"])),r=a.create().nu("li"),a.styles().set(r,"list-style-type","none"),a.attrs().remove(d,
"id"),a.insert().appendAll(r,c),k=xg([r],k.items());c=k.items();g=g.concat(k.result())}a.insert().appendAll(d,g);return xg(d,c)},h=function(b,c){return!(V(b,a.property().name(c))&&0===a.property().children(c).length)};b=function(b){for(var g=[];0<b.length;){var l=b[0];if(0===l.level()){var k=b[0],m=k.content();m=1===m.length&&yc.isBlock(a,m[0])?m[0]:d(m);c.push(n3(k.item(),m));b=xg(m,e(b));k=[b.result()].filter(t(h,["p"]));0===k.length&&c.pop();b=b.items();g=g.concat(k);m=b;for(b=[];0<m.length&&0<
m[0].level();)m=f(1,m),k=[m.result()].filter(t(h,["ul","ol"])),m=m.items(),b=b.concat(k);k=xg(b,m);b=k.items();g=g.concat(k.result());0<l.cruft().length&&(g=g.concat([d(l.cruft())]))}else b=f(1,b),l=[b.result()].filter(t(h,["ul","ol"])),b=b.items(),g=g.concat(l)}return xg(g,b)}(b);if(0!==b.items().length)throw"Error - there should not be any remaining items to parse";return kF(b.result(),c)}},lF=function(a){return hb(a,function(a,c){var b=a.elements().concat(c.elements());a=a.elementsTransformed().concat(c.elementsTransformed());
return Xm.answer(b,a)},Xm.answer([],[]))},o3={combine:lF,write:function(a,b){b=Lk(b,function(b){return a.property().name(b.list())+"-"+a.styles().getRaw(b.list(),"list-style-type").getOr("default")});b=F(b,function(b){return Xm.write(a,b)});return lF(b)}},mF=gb(),nF=function(a){return o3.write(mF,a)},p3=function(a){return Xm.write(mF,a)},oF=function(a,b,c){return L.closest(a,"li",c).bind(function(a){return b(a,c).map(function(b){return{item:k(a),outerlist:k(b)}})})},pF=function(a,b){return Ta(a,function(a){return P.eq(a,
b)})},q3=function(a,b,c){return pF(a,b).bind(function(b){return pF(a,c).map(function(c){return a.slice(Math.min(b,c),Math.max(b,c)+1)})})},wh={context:function(a,b,c,d,e){return oF(a,c,e).bind(function(f){return oF(b,c,e).bind(function(c){if(P.eq(f.outerlist(),c.outerlist())){if(P.eq(a,b))var e=[f.item()];else{var h=f.outerlist();e=f.item();var m=c.item();h=ca.descendants(h,"li");e=q3(h,e,m).getOr([])}c=g.some({outerlist:f.outerlist,startItem:f.item,finishItem:c.item,writer:k(d),selected:k(e)})}else c=
g.none();return c})})},immediate:function(a,b){return L.closest(a,"ul,ol",b)},topmost:function(a,b){var c=Cc.ancestors(a,function(a){return la.isList(a)||la.isContainer(a)},b);return Ta(c,function(a){return!V(["li","ol","ul"],C.name(a))}).map(function(a){return 0<a&&a-1<c.length?g.some(c[a-1]):0<c.length?g.some(c[c.length-1]):g.none()}).getOrThunk(function(){return 0<c.length?g.some(c[c.length-1]):g.none()})}},As={context:function(a,b,c){return wh.context(a,b,wh.topmost,p3,c)},indent:function(a){return Wm.level(a,
1)},outdent:function(a){return Wm.level(a,-1)}},r3=function(a,b){return Va(a,function(a){return P.eq(b,a)})},s3={operate:function(a,b,c){return F(b,function(b){return r3(c,b.item())?a(b):b})}},qF=M("before","on","after"),t3=function(a,b){var c=g.from(F(b,function(b){return a[b]})),d=a.slice(0,b[0]);b=a.slice(b[b.length-1]+1);return qF(d,c,b)},u3={refine:function(a,b){var c=F(a,function(a,c){return b(a)?g.some(c):g.none()});c=Td(c);var d=qF(a,g.none(),[]);return 0===c.length?d:t3(a,c)}},Bs=function(a,
b){var c=ca.children(a,"li,ol,ul");return ia(c,function(c){return"li"===C.name(c)?v3(a,c,b):Bs(c,b+1)})},v3=function(a,b,c){var d=w3(b),e=[zs(c,d.before(),d.after(),a,b)];return d.on().fold(function(){return e},function(a){a=ia(a,function(a){return Bs(a,c+1)});return e.concat(a)})},x3=function(a){return za.is(a,"ol,ul")},w3=function(a){a=B.children(a);return u3.refine(a,x3)},y3={read:function(a){return Bs(a,1)}},z3=function(a){a=a.elementsTransformed();A(a,function(a){v.transfer(a.original(),a.replaced(),
["text-align"]);m.transfer(a.original(),a.replaced(),["dir"])})},rF=function(a,b){return va(b,function(b){return P.eq(b.original(),a)}).map(function(a){return a.replaced()}).getOr(a)},sF=function(a,b,c,d,e,f){if(0===a.selected().length)return g.none();var h=a.writer(),l=a.outerlist();a=a.selected();var k=y3.read(l);f=f(a);f=s3.operate(f,k,a);h=h(f);z3(h);O.before(l,h.elements());E.remove(l);l=h.elementsTransformed();b=rF(b,l);d=rF(d,l);return g.some(th.block({start:b,soffset:c,finish:d,foffset:e,
all:h.elements()}))},tF={execute:function(a,b,c,d,e,f){return sF(a,b,c,d,e,k(f))},executeUsing:sF},A3=function(a,b,c,d,e,f,h){return vh.applyOn(a,jF,b,c,d,e,function(a){A(a,function(a){h.change(a,f)});return a})},uF=function(a,b){return function(c,d,e,f,h,g){var l=Mm.isRootOrCell(c);return As.context(d,f,c).fold(function(){return A3(l,d,e,f,h,a,g)},function(a){return tF.execute(a,d,e,f,h,b)})}},cp={indent:function(a,b,c,d,e,f){return uF(1,As.indent)(a,b,c,d,e,f)},outdent:function(a,b,c,d,e,f){return uF(-1,
As.outdent)(a,b,c,d,e,f)}},B3={isRootContainer:function(a){return function(b){return a(b)||V(["td","th","caption"],C.name(b))}},extract:function(a){return qc.cata(a,function(a){return[a]},function(a){return[a]},function(a,c){return V(["ol","ul"],C.name(a))?[a]:ia(c,qc.toTarget)},function(a){return[a]})},isCapable:function(a){return la.isBlock(a)},canUse:k(!1),quasi:function(a){return g.some(zj.nu(gb()))},ascend:aa},Cs=function(a){return Dd.is(a)?L.descendant(a,"blockquote"):L.closest(a,"blockquote")},
vF=function(a){return He.sharedOne(Cs,a)},C3=function(a,b,c,d,e){return vh.applyOn(a,B3,b,c,d,e,function(a){var b=p.fromTag("blockquote");0<a.length&&(y.before(a[0],b),O.append(b,a),b=ca.descendants(b,"blockquote"),F(b,E.unwrap));return a})},Ds={toggle:function(a,b,c,d,e){return(P.eq(b,d)?Cs(b):vF([b,d])).fold(function(){return C3(a,b,c,d,e)},function(a){E.unwrap(a);return g.some(th.block({start:b,soffset:c,finish:d,foffset:e,all:[]}))})},queryPoint:Cs,queryAll:vF},wF=function(a,b,c,d){var e=a.content(),
f=a.undo();Pb.cata(a.selections().get(),u,Fm.multiple(e,a.undo(),d),Fm.single(e,f,d,b,c))},xF=function(a){return function(b){var c=0<a?cp.indent:cp.outdent,d=Yo(b.region()),e=b.content();wF(b,vj,uj,function(a,b,g,k){return c(e.isRoot,a,b,g,k,d)})}},Ym=function(a){return function(b){var c=b.content(),d=function(b,d,h,g){return a.run(c.isRoot,b,d,h,g)};Pb.cata(b.selections().get(),u,Gm.multiple(c,b.undo(),d),Gm.single(c,b.undo(),d,vj,uj))}},Zm=function(a){return function(b){lc.detect(b.content().getSelection()).each(function(c){wd.runTransaction(b.content(),
b.undo(),function(){(a.query(c.image())?wg.floatnone():a).run(c.image())},b.content().toEditing)})}},Jd={indent:xF(1),outdent:xF(-1),blockquote:function(a){var b=a.content();wF(a,vj,uj,function(a,d,e,f){return Ds.toggle(b.isRoot,a,d,e,f)})},justifyLeft:Ym(Rd.justifyleft()),justifyCentre:Ym(Rd.justifycentre()),justifyRight:Ym(Rd.justifyright()),justifyFull:Ym(Rd.justifyfull()),imageNone:Zm(wg.floatnone()),imageLeft:Zm(wg.floatleft()),imageCentre:Zm(wg.floatcentre()),imageRight:Zm(wg.floatright()),
breakQuote:function(a,b,c){G2.breakQuote(b,c).each(function(b){a.content().setRelativeSelection(b.start(),b.finish());a.content().uiChanged()})}},D3=function(a,b){return va(a,function(a){return a.value()===b})},Gk={updateMenu:function(a,b,c,d,e){b.fold(a.clear,u,function(b){(ta(b)?D3(d,b):g.some(b)).each(a.select);e.each(function(c){c=c(b);a.selectElement(c)})});c.fold(a.disable,u,a.enable);b.fold(a.untick,u,function(b){b=ta(b)?b:b.value();a.tick(b)})}},Es=sa.generate([{table:["selection"]},{list:["selection"]}]),
E3=function(a,b){return a.isRoot(b)||V(["table","ul","ol"],C.name(b))},Fk={context:function(a){return a.getSelection().bind(function(b){if(b.collapsed())return L.closest(b.startContainer(),"td,th,li",t(E3,a)).map(function(a){return"li"===C.name(a)?Es.list(b):Es.table(b)});var c=Vc.commonAncestorContainer(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset());return L.closest(c,"ol,ul",a.isRoot).map(function(a){return Es.list(b)})})},cata:function(a,b,c){return a.fold(b,c)}},xh={attr:function(a,
b,c){var d=t(m.set,a,b,c);a=t(m.remove,a,b);0<c.length?d():a()},css:function(a,b,c){var d=t(v.set,a,b,c);a=t(v.remove,a,b);0<c.length?d():a()}},Fs={resolve:Hb.create("ephox-salmon").resolve},F3=Fs.resolve("upload-image-in-progress"),G3="data-"+Fs.resolve("image-blob"),H3="data-"+Fs.resolve("image-upload"),ic={uploadInProgress:k(F3),blobId:k(G3),trackedImage:k(H3)},yF=ya("url alt width height isLocal align".split(" "),["computedWidth","computedHeight"]),zF=function(a,b){a=m.get(a,b);return void 0!==
a?a:""},gl={divine:function(a){var b=v.getRaw(a,"width").getOr(""),c=v.getRaw(a,"height").getOr(""),d=v.getRaw(a,"width").getOrThunk(function(){return Aa.get(a)+"px"}),e=v.getRaw(a,"height").getOrThunk(function(){return pa.get(a)+"px"}),f=ys.divine(a);return yF({url:zF(a,"src"),alt:zF(a,"alt"),width:b,height:c,computedWidth:d,computedHeight:e,isLocal:m.has(a,ic.blobId()),align:f})},properties:yF,apply:function(a,b){m.get(a,"src")===b.url()||b.isLocal()||m.set(a,"src",b.url());xh.attr(a,"alt",b.alt());
xh.css(a,"width",b.width());xh.css(a,"height",b.height());b.align().each(function(b){wg.runFloat(a,b)})}},I3={hasNoContent:function(a){var b=B.children(a);return C.isElement(a)&&(0===b.length||1===b.length&&"br"===C.name(b[0]))}},J3=M("alignment","quoted"),AF=function(a){return a.getSelection().fold(function(){return!1},function(a){var b=a.startContainer();a=a.endContainer();return P.eq(b,a)?Ds.queryPoint(b).isSome():Ds.queryAll([b,a]).isSome()})},K3=[Rd.justifyleft(),Rd.justifycentre(),Rd.justifyright(),
Rd.justifyfull()],BF=function(a){return lc.detect(a.getSelection()).fold(function(){return a.getSelection().bind(function(a){return va(K3,function(b){return b.query(a.startContainer(),a.endContainer())}).map(function(a){return a.name()})}).fold(wa.off,wa.on)},function(a){return gl.divine(a.image()).align().fold(wa.off,function(a){return"center"===a?wa.on(Rd.justifycentre().name()):"right"===a?wa.on(Rd.justifyright().name()):wa.on(Rd.justifyleft().name())})})},Zo={read:function(a){var b=BF(a);a=AF(a)?
wa.on({}):wa.off();return J3(b,a)},alignment:BF,inQuote:AF,atQuoteBreak:function(a){return a.getSelection().bind(function(a){var b=a.startContainer();return a.collapsed()?L.closest(b,"blockquote").bind(function(a){return I3.hasNoContent(b)?g.some({quote:k(a),element:k(b)}):g.none()}):g.none()})}},Jk={multiple:function(a,b,c){return function(d,e){wd.runTransaction(a,b,function(){A(e,c)},a.toEditing)}},single:function(a,b,c){return function(d,e){wd.runTransaction(a,b,function(){c(e).each(function(b){a.setSelection(b.start(),
b.soffset(),b.finish(),b.foffset())});a.backupSelection()},a.toEditing)}}},L3=gb(),Hk={atStartOf:function(a,b,c){ns.atStartOf(L3,a,b,c)}},M3=KE.resolve("style-marker"),Eb={styleSpan:k(M3),overrideSpan:k("data-ephox-override"),quasiBlock:Rm.style},Cj=sa.generate([{none:[]},{tempIn:["selection"]},{tempOut:["selection"]},{rangedIn:["selection"]},{rangedOut:["selection"]}]),ap={detect:function(a,b){return a.getSelection().fold(function(){return Cj.none()},function(a){var c=b(a);return Na.isCollapsed(a.startContainer(),
a.startOffset(),a.endContainer(),a.endOffset())?c?Cj.tempIn(a):Cj.tempOut(a):c?Cj.rangedIn(a):Cj.rangedOut(a)})}},CF=function(a,b){return p.fromTag(a,b.dom())},DF=function(a,b,c){c=p.fromTag("span",c.dom());v.set(c,a,b);return c},$o={nu:function(a,b,c,d){return"span"===c?DF(a,b,d):CF(c,d)},nuTag:CF,nuAttr:function(a,b,c){c=p.fromTag("span",c.dom());m.set(c,a,b);return c},nuStyle:DF},EF={"font-weight":{700:"bold",400:"normal"}},FF=function(a,b){if(a===b&&""!==b&&void 0!==b)return!0;a=a.toLowerCase();
b=b.toLowerCase().split(" ");return V(b,a)},GF=function(a,b){return void 0!==EF[a]?(a=EF[a][b],void 0!==a?a:b):b},HF=function(a,b){a=N3(a,b);return GF(b,a)},N3=function(a,b){return(C.isText(a)?B.parent(a):g.some(a)).map(function(a){return v.get(a,b)}).getOr(void 0)},qi={state:function(a,b,c){a=HF(a,b);return"text-decoration"===b?FF(c,a):c===a&&""!==a&&void 0!==a},rawState:function(a,b,c){a=GF(b,v.getRaw(a,b).getOr(void 0));return"text-decoration"===b?FF(c,a):c===a&&""!==a&&void 0!==a},value:HF},IF=
{"text-decoration":function(a,b,c,d){var e=function(d){return Da.closest(d,function(d){return C.isElement(d)&&(V(c,C.name(d))||v.getRaw(d,a).exists(function(a){return-1!==a.indexOf(b)}))}).toArray()};d=e(d.startContainer()).concat(e(d.endContainer()));return Va(d,function(d){return V(c,C.name(d))?!0:v.getRaw(d,a).exists(function(a){return b===a})})}},O3={handle:function(a,b,c){return void 0!==IF[a]?g.some(IF[a]):g.none()}},JF=function(a,b){return b.getSelection().map(function(b){return a(b)}).getOr(!1)},
Gs=function(a,b,c,d){var e=Dd.leftWith(la.isBlock,d).getOrThunk(function(){return W.point(d.startContainer(),d.startOffset())}),f=Dd.rightWith(la.isBlock,d).getOrThunk(function(){return W.point(d.endContainer(),d.endOffset())});return O3.handle(a,b).fold(function(){var c=qi.state(e.element(),a,b),d=qi.state(f.element(),a,b);return c||d},function(d){return d(a,b,c,Lb.hare(e.element(),e.offset(),f.element(),f.offset()))})},P3=function(a,b,c,d){return JF(t(Gs,a,b,c),d)},KF=function(a,b){return Q3(a,
b)},R3=function(a,b){return JF(t(KF,a),b)},Q3=function(a,b){var c=Dd.leftWith(la.isBlock,b).fold(b.startContainer,function(a){return a.element()});b=Dd.rightWith(la.isBlock,b).fold(b.endContainer,function(a){return a.element()});c=tb.closest(c,a);a=tb.closest(b,a);return c||a},LF=function(a,b){return V(a,C.name(b))},S3=function(a,b){var c="["+a+"]";return L.closest(b.startContainer(),c).bind(function(d){return L.closest(b.endContainer(),c).bind(function(b){var c=m.get(d,a);b=m.get(b,a);c=c.toLowerCase();
b=b.toLowerCase();return c===b?g.some(c):g.none()})})},$f={queriesStyle:function(a,b,c){return{queryOn:t(Gs,a,b,c),query:t(P3,a,b,c)}},queryStyleOn:Gs,queriesTag:function(a){return{queryOn:t(KF,a),query:t(R3,a)}},relatedStyle:function(a,b,c,d){(c=LF(c,d))||(c="span"===C.name(d)&&qi.state(d,a,b));return c},relatedTags:LF,queryAttrSame:function(a,b){return b.getSelection().bind(function(b){return S3(a,b)})},queryAttrIs:function(a,b,c){var d=b.toLowerCase(),e=function(b){return m.get(b,a).toLowerCase()===
d};return L.closest(c.startContainer(),"["+a+"]").filter(e).orThunk(function(){return L.closest(c.endContainer(),"["+a+"]").filter(e)}).isSome()}},$m=sa.generate([{none:["last","mode"]},{running:["next","mode"]},{split:["boundary","last","mode"]},{finished:["element","mode"]}]),Hs=M("start","soffset","finish","foffset"),MF=function(a,b,c){c=Pc.toLeaf(a,c,0);return Is(a,c.element())?Js(a,b,c.element()).map(function(a){return W.point(a,0)}).getOr(c):c},Dj=function(a,b){return yc.isFrame(a,b)||yc.isBlock(a,
b)||V(["li"],a.property().name(b))},Js=function(a,b,c){return ua.seekRight(a,c,function(b){return!Is(a,b)&&!Dj(a,b)},b)},Is=function(a,b){return a.property().isText(b)?a.property().parent(b).exists(function(b){return V("table tbody thead tfoot tr ul ol".split(" "),a.property().name(b))}):!1},T3=function(a,b,c,d,e){return ua.walk(a,d,c,ua.walkers().right()).fold(function(){return $m.none(d,ua.sidestep)},function(b){return a.eq(b.item(),e)?$m.finished(e,b.mode()):Dj(a,b.item())?$m.split(b.item(),d,
b.mode()):$m.running(b.item(),b.mode())})},OF=function(a,b,c,d){return Js(a,b,c).fold(function(){return g.none()},function(e){return a.eq(e,d)?g.some(d):NF(a,c,e)?OF(a,b,e,d):Dj(a,e)?(e=MF(a,b,e),g.some(e.element())):g.some(e)})},NF=function(a,b,c){return a.property().parent(b).exists(function(b){return a.eq(b,c)})},Ks=function(a,b,c,d,e,f){return T3(a,b,c,e,f).fold(function(a,b){return[{start:d,finish:a}]},function(c,e){return Ks(a,b,e,d,c,f)},function(c,l,k){var h={start:d,finish:l};return(NF(a,
e,c)?OF(a,b,c,f):function(){var d=MF(a,b,c);return a.eq(d.element(),c)?ua.walk(a,c,ua.advance,ua.walkers().right()).map(function(a){return a.item()}):g.some(d.element())}()).fold(function(){return[h]},function(c){return a.eq(c,f)?[h].concat({start:f,finish:f}):[h].concat(Ks(a,b,ua.advance,c,c,f))})},function(a,b){return[{start:d,finish:a}]})},Ls=function(a,b,c){if(Dj(a,b)){var d=a.property().children(b);return 0<=c&&c<d.length?Ls(a,d[c],0):c===d.length?Ls(a,d[d.length-1],0):b}return b},PF=function(a,
b,c,d){c=Ls(a,c,d);return Is(a,c)?Js(a,b,c).getOr(c):c},U3=function(a,b,c,d,e,f){var h=PF(a,b,c,d),g=PF(a,b,e,f);b=Ks(a,b,ua.sidestep,h,h,g);return F(b,function(b,h){h=a.eq(b.start,c)?d:0;if(a.eq(b.finish,e))var g=f;else g=b.finish,g=a.property().isText(g)?a.property().getText(g).length:a.property().children(g).length;return Hs(b.start,h,b.finish,g)})},QF=function(a,b,c,d,e,f){a.eq(c,e)?Dj(a,c)?(d=Pc.toLeaf(a,c,d),f=Pc.toLeaf(a,c,f),a=a.eq(d.element(),c)&&a.eq(f.element(),c)?[Hs(d.element(),d.offset(),
f.element(),f.offset())]:QF(a,b,d.element(),d.offset(),f.element(),f.offset())):a=[Hs(c,d,c,f)]:a=U3(a,b,c,d,e,f);return a},V3={collect:QF},Ze=sa.generate([{leftEdge:["element"]},{between:["before","after"]},{rightEdge:["element"]}]),W3=function(a,b,c){c=Bd.split(a,b,c);var d=function(){return Ze.rightEdge(b)};return Bd.position(a,c).fold(d,function(){return Ze.leftEdge(b)},Ze.between,d)},RF=function(a,b,c,d){if(a.property().isText(b))return W3(a,b,c);if(a.property().isEmptyTag(b))return d(b);a=a.property().children(b);
b=0===c?Ze.leftEdge(b):c===a.length?Ze.rightEdge(b):0<c&&c<a.length?Ze.between(a[c-1],a[c]):Ze.rightEdge(b);return b},SF={toLeft:function(a,b,c,d){return RF(a,c,d,Ze.leftEdge).fold(function(a){return a},function(a,b){return b},function(c){return ua.after(a,c,b).getOr(c)})},toRight:function(a,b,c,d){return RF(a,c,d,Ze.rightEdge).fold(function(c){return ua.before(a,c,b).getOr(c)},function(a,b){return a},function(a){return a})}},X3=function(a,b,c,d){var e=a.property().children(b);b=function(b){return Ta(e,
t(a.eq,b))};c=c.bind(b).getOr(0);d=d.bind(b).getOr(e.length-1);return-1<c&&-1<d?g.some(e.slice(c,d+1)):g.none()},TF=function(a,b,c,d){return gd.breakPath(a,b,function(b){return a.property().parent(b).fold(k(!0),t(a.eq,c))},d)},UF=function(a,b,c,d){a.eq(b,d)?d=g.none():(d=TF(a,d,b,wj.breakToRight),d=g.some(d.first()));if(a.eq(b,c))c=g.none();else{var e=TF(a,c,b,wj.breakToLeft);0<e.splits().length&&a.insert().prepend(e.splits()[0].second(),c);c=g.some(e.second().getOr(c))}return X3(a,b,c,d)},Y3=function(a,
b,c,d,e){return js.ancestors(a,c,d,b).shared().orThunk(function(){return gd.sharedOne(a,function(c,d){return b(d)?g.some(d):a.up().predicate(d,b)},[c,d])}).map(e)},Z3=function(a,b,c,d,e){return Y3(a,b,c,d,e).bind(function(b){return UF(a,b,c,d)})},VF={fracture:function(a,b,c,d,e){e=void 0!==e?e:aa;a.eq(c,d)?(b=e(c),a=a.eq(b,c)?g.some([c]):UF(a,b,c,c)):a=Z3(a,b,c,d,e);return a}},WF=function(a,b,c,d,e,f,h){a.property().isText(c)&&a.eq(c,e)?(c=Bd.splitByPair(a,c,d,f),a=VF.fracture(a,b,c,c,h)):(e=SF.toRight(a,
b,e,f),c=SF.toLeft(a,b,c,d),a=VF.fracture(a,b,c,e,h));return a},XF={fractures:function(a,b,c,d,e,f,h){c=V3.collect(a,b,c,d,e,f);return ia(c,function(c,d){return WF(a,b,c.start(),c.soffset(),c.finish(),c.foffset(),h).toArray()})},fracture:WF},YF=gb(),$3={fractures:function(a,b,c,d,e,f){return XF.fractures(YF,a,b,c,d,e,f)},fracture:function(a,b,c,d,e,f){return XF.fracture(YF,a,b,c,d,e,f)}},yg={makeTo:function(a,b,c){var d=B.owner(a).dom().createRange();d.setStart(a.dom(),b);d.setEndBefore(c.dom());
return d},makeFrom:function(a,b,c){var d=B.owner(b).dom().createRange();d.setStartAfter(a.dom());d.setEnd(b.dom(),c);return d},leftEdge:function(a,b,c,d){return Vc.after(a,b,c,d)?W.point(c,d):W.point(a,b)},rightEdge:function(a,b,c,d){return Vc.after(a,b,c,d)?W.point(a,b):W.point(c,d)}},a4=function(a,b){b=jb(b).join(",");return(za.is(a,b)?[a]:[]).concat(ca.descendants(a,b))},ZF={cleanse:function(a,b){a=a4(a,b);A(a,function(a){var c=C.name(a);(void 0!==b[c]?b[c]:u)(a)})}},b4={onlyEphox:function(a){var b=
ja.get(a);b=ka(b,function(a,b,e){return!Ab(a,"ephox-")});A(b,function(b){n.remove(a,b)})}},Ej=function(a){E.unwrap(a)},$F=function(a,b){v.remove(a,b);m.hasNone(a)&&Ej(a)},aG=function(a){var b={};A(a,function(a){b[a]=zg(Ej)});return b},zg=function(a){return function(b){m.has(b,"data-ignore")||a.apply(null,arguments)}},uc={cssAndTag:function(a,b,c){a=aG(a);c=function(a){$F(a,b)};return ra(a,{span:zg(c),font:zg(c)})},tagList:aG,removeStyle:zg($F),removeAttribute:zg(function(a,b){m.remove(a,b);m.hasNone(a)&&
Ej(a)}),unwrap:zg(Ej),unstyle:zg(function(a){b4.onlyEphox(a);m.remove(a,"style");m.hasNone(a)&&Ej(a)}),normal:function(a){m.remove(a,"data-ignore")},ignore:function(a){m.set(a,"data-ignore","true")}},an=function(a,b){var c=B.children(a);A(c,function(a){an(a,b)});b(a)},bG=function(a){return C.isElement(a)&&!la.isEmptyTag(a)&&!la.isFrame(a)&&0===Ca.get(a).replace(fb(),"").length},yh={wipeout:an,onEmpty:function(a){an(a,function(a){!C.isElement(a)||la.isFrame(a)||la.isEmptyTag(a)||0!==Ca.get(a).length?
bG(a)&&E.unwrap(a):E.remove(a)})},onQuasiEmpty:function(a){an(a,function(a){bG(a)&&E.remove(a)})}},cG=function(a){return B.parent(a).fold(k([]),function(a){return la.isBlock(a)?[a]:[a].concat(cG(a))})},c4=function(a,b){var c=[b].concat(cG(b)),d=Ld(c);return Ta(d,a).map(function(a){return 0===a?d[0]:d[a-1]}).getOr(b)},d4=function(a,b){A(b,function(b){ZF.cleanse(b,a);yh.onQuasiEmpty(b)})},bp={run:function(a,b,c,d){var e=Dd.left(c).getOrThunk(function(){return yg.leftEdge(c.startContainer(),c.startOffset(),
c.endContainer(),c.endOffset())}),f=Dd.right(c).getOrThunk(function(){return yg.rightEdge(c.startContainer(),c.startOffset(),c.endContainer(),c.endOffset())}),h=t(c4,d.matches);b=$3.fractures(b,e.element(),e.offset(),f.element(),f.offset(),h);b=ia(b,function(b){if(0<b.length){var c=d.purifiers();var e=(0,d.nu)(a);uc.ignore(e);g.from(b[0]).bind(B.prevSibling).each(yh.onQuasiEmpty);g.from(b[b.length-1]).bind(B.nextSibling).each(yh.onQuasiEmpty);A(b,yh.onQuasiEmpty);b=ka(b,fa.inBody);0<b.length?(y.before(b[0],
e),O.append(e,b),d4(c,b),c=[e]):c=[]}else c=[];return c});A(b,uc.normal);return Lb.fussyFromElements(b)}},Ms=function(a,b){return P.eq(a,b)?[]:B.parent(a).fold(function(){return[]},function(c){c=Ms(c,b);var d=B.findIndex(a).toArray();return c.concat(d)})},e4=function(a,b){return a.slice(b+1)},f4=function(a,b){return a.slice(0,b)},Ns=function(a,b,c,d){if(0===d.length)b(c);else{var e=d[0],f=d.slice(1);B.child(c,e).each(function(c){Ns(a,b,c,f)});c=B.children(c);e=a(c,e);A(e,b)}},dG={one:function(a,b){a(b)},
across:function(a,b,c,d){c=Ms(c,b);d=Ms(d,b);b=B.children(b);var e=b.slice(0<c.length?c[0]+1:0,0<d.length?d[0]:b.length-1);A(e,a);0<c.length&&Ns(e4,a,b[c[0]],c.slice(1));0<d.length&&Ns(f4,a,b[d[0]],d.slice(1))}},Fj=gb(),zh={split:function(a,b){return Bd.split(Fj,a,b)},splitByPair:function(a,b,c){return Bd.splitByPair(Fj,a,b,c)},range:function(a,b,c,d){return Bd.range(Fj,a,b,c,d)},subdivide:function(a,b){return Bd.subdivide(Fj,a,b)},position:function(a){return Bd.position(Fj,a)}},eG=function(a,b,c){var d=
B.children(b),e=0===c,f=c===d.length,h=0<d.length;return void 0!==a.empty&&V(["br","hr","img"],C.name(b))?a.empty:void 0!==a.hasPrevious&&h&&0<c&&c<d.length?a.hasPrevious:void 0!==a.hasNext&&h&&c<d.length-1?a.hasNext:void 0!==a.rightEdge&&h&&f?a.rightEdge:void 0!==a.first&&e?a.first:a.otherwise},g4=function(a,b,c){return eG(a.before.element,b,c)(b,c)},h4=function(a,b,c){return eG(a.after.element,b,c)(b,c)},fG=function(a,b,c){c=zh.split(b,c);var d=function(a){return function(){var c=Array.prototype.slice.call(arguments,
0);c=[b].concat(c);return a.apply(null,c)}};return zh.position(c).fold(d(a.none),d(a.start),d(a.middle),d(a.end))},i4=function(a,b,c){return fG(a.before.text,b,c)},j4=function(a,b,c){return fG(a.after.text,b,c)},bn={prefix:function(a,b,c){return(C.isText(b)?i4:g4)(a,b,c)},postfix:function(a,b,c,d,e){b=yg.rightEdge(b,c,d,e);return(C.isText(b.element())?j4:h4)(a,b.element(),b.offset())}},Os=function(a,b){return a.bind(function(a){return b.map(function(b){return{left:k(a),right:k(b)}})})},k4=function(a,
b,c,d){b=zh.splitByPair(b,c,d);return Os(a.general.insertBefore(b),a.general.insertAfter(b))},l4=function(a,b,c,d){c=B.child(b,c);var e=d<B.children(b).length?B.child(b,d):B.lastChild(b);return c.bind(function(b){return e.bind(function(c){return Os(a.general.insertBefore(b),a.general.insertAfter(c))})})},hy={both:function(a,b,c,d,e){if(P.eq(b,d)){var f=C.isText(b)?k4:l4;return c>e?f(a,b,e,c):f(a,b,c,e)}f=yg.leftEdge(b,c,d,e);b=bn.postfix(a,b,c,d,e);a=bn.prefix(a,f.element(),f.offset());return Os(a,
b)}},cn=M("inside","outside"),gG=function(a,b){return B.parent(b).fold(k(!0),function(b){return a(b)})},hG=function(a,b){var c=gb();a=[a].concat(c.up().all(a));var d=[b].concat(c.up().all(b));return va(a,function(a){return Va(d,t(P.eq,a))})},iG=function(a){return cn(a.second(),g.some(a.first()))},jG=function(a){return cn(g.some(a.first()),a.second())},kG=function(a){return cn(g.some(a),g.none())},Ps=function(a,b,c){c=t(gG,c);c=c(a)?a:Da.ancestor(a,c).getOr(a);return P.eq(a,c)?kG(a):lG(a,b,c)},lG=
function(a,b,c){a=Lm.breakPath(a,t(P.eq,c));return b(a)},m4={bridge:function(a,b,c){var d=Ps(a,iG,c),e=Ps(b,jG,c);return d.inside().bind(function(a){return e.inside().bind(function(b){return hG(a,b).map(function(c){return{common:k(c),left:k(a),right:k(b),wipeout:function(){d.outside().each(yh.onEmpty);e.outside().each(yh.onEmpty)}}})})})},edge:cn,isSplit:gG,getCommon:hG,onLeft:iG,onRight:jG,onInside:kG,splitFrom:Ps,breaker:lG},n4=M("start","soffset","finish","foffset"),dn=k(!1),Qs=function(a,b){return la.isBlock(b)||
la.isContainer(b)||a(b)},mG=function(a,b){return B.parents(b,t(Qs,a))},nG=function(a,b,c){return C.isElement(c)&&!b(c)?(a=mG(a,c),!Va(a,b)):!1},oG=function(a,b){return function(c){return Qs(a,c)||nG(a,b,c)}},o4=function(a,b,c,d,e,f){var h=Na.isCollapsed(b,c,d,e);b=Xa.toLeaf(b,c);d=Xa.toLeaf(d,e);var g=ah.extractTo(b.element(),b.offset(),f,dn),k=ah.extractTo(d.element(),d.offset(),f,dn),m=function(b){return h||b.offset()!==oa.getEnd(b.element())?b:mc.after(b.element(),a).map(function(a){return W.point(a,
0)}).getOr(b)},x=function(b){return h||0!==b.offset()?b:mc.before(b.element(),a).map(function(a){return W.point(a,oa.getEnd(a))}).getOr(b)};return function(){return ah.find(g.element(),g.offset(),dn).map(m).bind(function(a){return ah.find(k.element(),k.offset(),dn).map(x).map(function(b){return n4(a.element(),a.offset(),b.element(),b.offset())})})}},p4={applyTo:function(a,b,c,d,e,f,h){var g=oG(a,h),k=o4(a,c,d,e,f,g);a=iQ(fb(),fb());return hy.both(a,c,d,e,f).bind(function(a){return m4.bridge(a.left().element(),
a.right().element(),g).bind(function(c){b(c.common(),c.left(),c.right());a.left().cleanup();a.right().cleanup();c.wipeout();return k()})})},blockRoot:Qs,pathToTop:mG,isEnclosingInline:nG,isStopper:oG},pG=function(a,b,c,d){var e=function(a){ZF.cleanse(a,b)};return p4.applyTo(a,function(a,b,c,d){if(P.eq(b,c))dG.one(e,b);else dG.across(e,a,b,c)},c.startContainer(),c.startOffset(),c.endContainer(),c.endOffset(),d)},Kd={doRemoveAll:function(a,b,c){return pG(a,b,c,xb)},doRemoveUpto:pG,allRules:{b:uc.unwrap,
strong:uc.unwrap,i:uc.unwrap,em:uc.unwrap,u:uc.unwrap,strike:uc.unwrap,del:uc.unwrap,s:uc.unwrap,sup:uc.unwrap,sub:uc.unwrap,small:u,span:uc.unstyle,font:uc.unstyle}},q4=function(a,b,c){return{groups:0<a.current.length?a.groups.concat({parent:a.parent,children:a.current}):a.groups,current:[c],parent:b}},r4=function(a,b,c){return{groups:a.groups,current:a.current.concat([c]),parent:b}},s4=function(a,b,c){return g.from(b.current[b.current.length-1]).bind(a.query().nextSibling).bind(function(b){return a.eq(b,
c)?g.some(r4):g.none()}).getOr(q4)},t4={textnodes:function(a,b){b=hb(b,function(b,d){return a.property().parent(d).fold(function(){return b},function(c){return s4(a,b,d)(b,c,d)})},{groups:[],current:[],parent:null});return 0<b.current.length?b.groups.concat({parent:b.parent,children:b.current}):b.groups}},rG=function(a,b,c,d,e,f){b=Bd.range(a,b,c,d,e);return qG(a,b,f)},qG=function(a,b,c){if(0===b.length)return b;b=ka(b,function(b){return a.property().isText(b)&&0<a.property().getText(b).length});
return F(b,function(b){var d=c();a.insert().before(b,d.element());d.wrap(b);return d.element()})},u4=function(a,b){return g.from(b[0]).map(function(c){var d=Ef.toLower(a,b[b.length-1]);return W.points(W.point(c,0),W.point(d.element(),d.offset()))})},Gj={wrapWith:rG,wrapper:qG,leaves:function(a,b,c,d,e,f){b=Ef.toLeaf(a,b,c);d=Ef.toLeaf(a,d,e);f=rG(a,b.element(),b.offset(),d.element(),d.offset(),f);return u4(a,f)},reuse:function(a,b,c,d,e,f,h){b=Ef.toLeaf(a,b,c);d=Ef.toLeaf(a,d,e);d=Bd.range(a,b.element(),
b.offset(),d.element(),d.offset());d=t4.textnodes(a,d);var g=function(a){return a.parent},k=function(b){var c=h();a.insert().before(b.children[0],c.element());A(b.children,c.wrap);return c.element()};return F(d,function(b){return(a.property().children(b.parent).length===b.children.length&&f(b.parent)?g:k)(b)})}},w4=function(a,b,c,d,e,f){a=v4(a,b,c,d,e,f);b=a.cursor();b=W.points(W.point(b.element(),b.offset()),W.point(b.element(),b.offset()));return g.some({range:k(b),temporary:a.temporary,wrappers:a.wrappers})},
x4=function(a,b,c,d,e){d=b.dom().ownerDocument;var f=a.create().nu("span",d);d=a.create().text(fb(),d);a.insert().append(f,d);(a.property().isEmptyTag(b)?a.property().parent(b):g.some(b)).each(function(b){ns.atStartOf(a,b,c,f)});return{cursor:k(W.point(d,1)),wrappers:k([f]),temporary:k(!0)}},v4=function(a,b,c,d,e,f){return a.property().parent(b).bind(function(d){var e=W.point(b,c),h;if(h=sG(a,f,d)&&1===a.property().children(d).length)h=a.property().isText(b)&&a.property().getText(b)===fb();return h?
g.some({cursor:k(e),temporary:k(!1),wrappers:k([d])}):g.none()}).getOrThunk(function(){return x4(a,b,c,d,e)})},sG=function(a,b,c){return"span"===a.property().name(c)&&!1===b(c)},y4=function(a,b,c,d,e,f){var h=b.dom().ownerDocument,l=Gj.reuse(a,b,c,d,e,t(sG,a,f),function(){return fw(a,a.create().nu("span",h))});return g.from(l[l.length-1]).map(function(b){var c=a.property().children(b).length;b=W.points(W.point(l[0],0),W.point(b,c));return{wrappers:k(l),temporary:k(!1),range:k(b)}})},z4={spans:function(a,
b,c,d,e,f){f=void 0!==f?f:k(!1);return(a.eq(b,d)&&c===e?w4:y4)(a,b,c,d,e,f)}},Ah={nu:function(a,b){return fw(a,b)},wrapWith:function(a,b,c,d,e,f){return Gj.wrapWith(a,b,c,d,e,f)},wrapper:function(a,b,c){return Gj.wrapper(a,b,c)},leaves:function(a,b,c,d,e,f){return Gj.leaves(a,b,c,d,e,f)},reuse:function(a,b,c,d,e,f,h){return Gj.reuse(a,b,c,d,e,f,h)},spans:function(a,b,c,d,e,f){return z4.spans(a,b,c,d,e,f)}},Bh=gb(),Ch={nu:function(a){return Ah.nu(Bh,a)},wrapWith:function(a,b,c,d,e){return Ah.wrapWith(Bh,
a,b,c,d,e)},wrapper:function(a,b){return Ah.wrapper(Bh,a,b)},leaves:function(a,b,c,d,e){return Ah.leaves(Bh,a,b,c,d,e)},reuse:function(a,b,c,d,e,f){return Ah.reuse(Bh,a,b,c,d,e,f)},spans:function(a,b,c,d,e){return Ah.spans(Bh,a,b,c,d,e)}},A4=function(a,b,c){a.getSelection().each(function(d){var e=Dd.left(d).getOrThunk(function(){return W.point(d.startContainer(),d.startOffset())}),f=Dd.right(d).getOrThunk(function(){return W.point(d.endContainer(),d.endOffset())});Ch.spans(e.element(),e.offset(),
f.element(),f.offset(),c).each(function(c){var d=c.temporary()?[Eb.styleSpan()]:[],e=c.range();A(c.wrappers(),function(a){ja.add(a,d);b(a)});c=e.begin();e=e.end();a.setSelection(c.element(),c.offset(),e.element(),e.offset())})})},tG=function(a,b,c,d){b(a);A4(a,d,c)},Be={style:function(a,b,c,d){return tG(a,c,d,function(a){v.setAll(a,b)})},generic:tG},uG=Ik("bold","strong",["strong","b"],"font-weight","bold","normal"),vG=Ik("italic","em",["em","i"],"font-style","italic","normal"),wG=Ik("underline",
"span",["u"],"text-decoration","underline","none"),xG=Ik("strikethrough","span",["s","strike","del"],"text-decoration","line-through","none"),yG=function(a,b){var c=function(a,c){return $o.nuAttr(b,a,c)},d=function(a){return"span"===C.name(a)&&m.has(a,b)},e={span:function(a){uc.removeAttribute(a,b)}},f=function(a,c){return $f.queryAttrIs(b,a,c)},h=function(a,c){Be.generic(c,u,void 0,function(c){n.add(c,Eb.styleSpan());m.set(c,b,a)});return g.none()};return{run:function(a,r,m){return ap.detect(r,t(f,
m)).fold(function(){return g.none()},function(a){var c=["[",b,'="',m,'"]'].join("");L.closest(a.startContainer(),c).each(E.unwrap);return g.none()},function(a){return h(m,r)},function(b){return Kd.doRemoveAll(a,e,b)},function(b){return bp.run(r.doc(),a,b,{nu:t(c,m),matches:d,purifiers:k(e)})})},queryValue:function(a){return $f.queryAttrSame(b,a)},name:k(a)}}("language","lang"),zG=ew("superscript","sup",["sup","sub"],{"font-size":"smaller","vertical-align":"super"}),AG=ew("subscript","sub",["sub",
"sup"],{"font-size":"smaller","vertical-align":"sub"}),BG={bold:uG,italic:vG,underline:wG,strikethrough:xG,language:yG,superscript:zG,subscript:AG},Qc={bold:k(uG),italic:k(vG),underline:k(wG),strikethrough:k(xG),language:k(yG),superscript:k(zG),subscript:k(AG),search:function(a){return void 0!==BG[a]?g.some(BG[a]):g.none()}},Dh=function(a,b){return a.query(b)},hg={bold:t(Dh,Qc.bold()),italic:t(Dh,Qc.italic()),underline:t(Dh,Qc.underline()),strikethrough:t(Dh,Qc.strikethrough()),superscript:t(Dh,Qc.superscript()),
subscript:t(Dh,Qc.subscript()),language:t(function(a,b){return a.queryValue(b)},Qc.language())},B4=M("bold","italic","underline","strikethrough","superscript","subscript"),Eh=function(a,b){return a.on(function(a){return b(a)?wa.on(!0):wa.off()}).getOrThunk(wa.off)},kQ={read:function(a){return B4(Eh(a,hg.bold),Eh(a,hg.italic),Eh(a,hg.underline),Eh(a,hg.strikethrough),Eh(a,hg.superscript),Eh(a,hg.subscript))}},en=M("startContainer","startOffset","endContainer","endOffset"),fn=M("item","start","finish",
"text"),gn=M("items","abort"),CG=function(a,b){a=a.property().getText(b);return fn(b,0,a.length,a)},Rs=function(a,b,c){return gn([],!0)},C4=function(a,b,c){return gn([],!1)},D4=function(a,b,c){var d=a.property().getText(b);return c(d).fold(function(){return gn([fn(b,0,d.length,d)],!1)},function(a){a=a[0]===a[1]?[]:[fn(b,a[0],a[1],d.substring(a[0],a[1]))];return gn(a,!0)})},$e={detail:CG,fromItem:function(a,b){return a.property().isText(b)?CG(a,b):fn(b,0,0,"")},decide:function(a,b,c,d){return(a.property().isBoundary(b)?
Rs:a.property().isEmptyTag(b)?Rs:d(a,b)?Rs:a.property().isText(b)?D4:C4)(a,b,c)}},DG={all:function(a,b){for(var c=b.term(),d=[],e=c.exec(a);e;){var f=e.index+b.prefix(e);e=e[0].length-b.prefix(e)-b.suffix(e);d.push({start:k(f),finish:k(f+e)});c.lastIndex=f+e;e=c.exec(a)}return d}},E4=function(a){a=Array.prototype.slice.call(a,0);a.sort(function(a,c){return a.start()<c.start()?-1:c.start()<a.start()?1:0});return a},F4={search:function(a,b){b=ia(b,function(b){var c=DG.all(a,b.pattern());return F(c,
function(a){return ra(b,{start:a.start,finish:a.finish})})});return E4(b)}},hn={findall:function(a,b){return DG.all(a,b)},findmany:function(a,b){return F4.search(a,b)}},G4=new RegExp(sb.wordbreak()+"+","g"),EG=k(0),FG=function(a){a=hn.findall(a,sb.custom(sb.wordbreak(),EG,EG,g.none()));return g.from(a[a.length-1]).map(function(a){return a.start()})},Ss=function(a){a=a.search(G4);return-1<a?g.some(a):g.none()},Hj={firstWord:function(a){return Ss(a).map(function(b){return a.substring(0,b+1)})},lastWord:function(a){return FG(a).map(function(b){return a.substring(b)})},
leftBreak:FG,rightBreak:Ss,hasBreak:function(a){return Ss(a).isSome()}},GG=ua.walkers(),HG=GG.left(),IG=GG.right(),H4={sibling:HG.sibling,first:HG.first,slicer:function(a){return Hj.leftBreak(a).map(function(b){return[b+1,a.length]})}},I4={sibling:IG.sibling,first:IG.first,slicer:function(a){return Hj.rightBreak(a).map(function(a){return[0,a]})}},Ts=function(a,b,c,d,e){b=ua.walk(a,b,c,d).map(function(b){var c=$e.decide(a,b.item(),d.slicer,e);b=c.abort()?[]:Ts(a,b.item(),b.mode(),d,e);return c.items().concat(b)}).getOr([]);
return ka(b,function(a){return 0<a.text().trim().length})},Ij={creepLeft:function(a,b,c){return Ts(a,b,ua.sidestep,H4,c)},creepRight:function(a,b,c){return Ts(a,b,ua.sidestep,I4,c)},flatten:function(a,b){return a.property().isText(b)?[$e.detail(a,b)]:F(a.down().predicate(b,a.property().isText),function(b){return $e.detail(a,b)})},isEmpty:function(a,b){return a.property().isText(b)?!1:0===a.down().predicate(b,a.property().isText).length}},Us=function(a,b){return a.up().closest(b,"[lang]",k(!1)).map(function(b){return a.attrs().get(b,
"lang")})},Fh={nu:function(a){var b=[],c=[],d=[],e=a,f=function(a){a.each(function(a){b.push(a)})},h=function(a){a.each(function(a){b=b.slice(0,b.length-1)})},l=function(){0<d.length&&c.push({lang:k(e),details:k(d)})},r=function(a){l();d=[];e=a},m=function(c){return c.or(g.from(b[b.length-1])).getOr(a)};return{openInline:function(a,b){b=m(a);b!==e&&r(b);f(a)},closeInline:function(a,b){h(a)},addDetail:function(a){var b=m(g.none());b!==e&&r(b);d.push(a)},addEmpty:function(a){a=m(g.none());r(a)},openBoundary:function(a,
b){f(a);a=m(a);r(a)},closeBoundary:function(a,b){h(a);a=m(a);r(a)},done:function(){l();return c.slice(0)}}},calculate:Us,softBounder:function(a){return function(b,c){b=Us(b,c);return!a.equals(b)}},strictBounder:function(a,b){return function(c,d){c=Us(c,d).getOr(a);return b!==c}}},JG=function(a,b,c,d){var e=Ij.creepLeft(a,b,d);d=Ij.creepRight(a,c,d);b=0<e.length?e[e.length-1]:$e.fromItem(a,b);a=0<d.length?d[d.length-1]:$e.fromItem(a,c);e=0===e.length&&0===d.length;return{left:k(b),right:k(a),isEmpty:k(e)}},
Jj={byBoundary:function(a,b){var c=k(!1);c=JG(a,b,b,c);a=c.isEmpty()&&Ij.isEmpty(a,b);return{left:c.left,right:c.right,isEmpty:k(a)}},getEdges:JG,byLanguage:function(a,b){var c=Fh.calculate(a,b),d=Fh.softBounder(c),e=Ij.creepLeft(a,b,d);d=Ij.creepRight(a,b,d);a=a.property().isText(b)?[$e.detail(a,b)]:[];b=Ld(e).concat(a).concat(d);return{all:k(b),left:k(e),middle:k(a),right:k(d),lang:k(c)}}},Vs=function(a,b,c,d){d=a.property().getText(b);var e=ka(d.substring(0,c),function(a){return a!==fb()}).length,
f=ka(d.substring(c,d.length),function(a){return a===fb()}).length;a=Jj.byLanguage(a,b);b=0===e&&0===a.left().length;c=c+f===d.length&&0===a.right().length;return{all:a.all,leftEdge:k(b),rightEdge:k(c),text:k(d)}},jn={before:function(a,b,c,d,e){a=Vs(a,b,c,e);a.rightEdge()?b=g.none():(a=a.all(),0===a.length?b=g.none():(a=a[a.length-1],b=g.some(en(b,d,a.item(),a.finish()))));return b},after:function(a,b,c,d,e){a=Vs(a,b,c,e);a.leftEdge()?b=g.none():(a=a.all(),0===a.length?b=g.none():(a=a[0],b=g.some(en(a.item(),
a.start(),b,d))));return b},both:function(a,b,c,d,e,f){return d===e?g.none():g.some(en(b,d,b,e))},neither:function(a,b,c,d){a=Vs(a,b,c,d);a.leftEdge()||a.rightEdge()?a=g.none():(b=a.all(),0===b.length?a=g.none():(a=b[0],b=b[b.length-1],a=g.some(en(a.item(),a.start(),b.item(),b.finish()))));return a}},KG=M("before","after"),J4={around:function(a,b){var c=a.substring(0,b),d=Hj.leftBreak(c).map(function(a){return a+1});a=a.substring(b);a=Hj.rightBreak(a).map(function(a){return b+a});var e=KG(d,a),f=
KG(g.some(b),g.some(b));return a.bind(function(a){return b===a?g.some(f):g.none()}).getOrThunk(function(){return d.bind(function(a){return b===a?g.some(f):g.none()}).getOr(e)})}},K4={word:function(a,b,c,d){if(!a.property().isText(b))return g.none();var e=a.property().getText(b),f=J4.around(e,c);return f.before().fold(function(){return f.after().fold(function(){return jn.neither(a,b,c,d)},function(e){return jn.after(a,b,c,e,d)})},function(e){return f.after().fold(function(){return jn.before(a,b,c,
e,d)},function(f){return jn.both(a,b,c,e,f,d)})})}},L4={word:function(a,b,c,d){return K4.word(a,b,c,d)}},M4=gb(),N4={word:function(a,b,c){return L4.word(M4,a,b,c)}},LG=function(a,b,c){N4.word(b,c,k(!1)).each(function(b){a.setSelection(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())})},hd={expand:function(a){a.getSelection().each(function(b){Na.isCollapsed(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())&&LG(a,b.startContainer(),b.startOffset())})},expandWord:LG},
NG=function(a,b){var c=Lb.fussy(b,0,b,B.children(b).length-1);MG(a,b,c)},Ws=function(a){a=B.children(a);return 1===a.length&&C.isText(a[0])&&Oa.get(a[0])===fb()},OG=function(a,b){return L.closest(a,"."+Eb.styleSpan()).bind(function(a){return L.closest(b,"."+Eb.styleSpan()).filter(function(b){return P.eq(a,b)})})},MG=function(a,b,c){n.remove(b,Eb.styleSpan());return m.has(b,Eb.overrideSpan())?PG(a,b,c):g.some(c)},PG=function(a,b,c){return O4(b).bind(function(d){if(d.isStyled(b)){d=d.nu;var e=B.owner(b);
e=d(e);y.before(b,e);O.append(e,B.children(b));E.remove(b);d=P.eq(b,c.start())?e:c.start();e=P.eq(b,c.finish())?e:c.finish();d=g.some(Lb.fussy(d,c.soffset(),e,c.foffset()))}else d=P4(a,b,d.purifiers(),c,d.matches);return d})},O4=function(a){a=m.get(a,Eb.overrideSpan());return Qc.search(a).map(function(a){return a.deferred()})},P4=function(a,b,c,d,e){b=B.owner(b);var f=Lb.fromFussy(d);Kd.doRemoveUpto(a,c,f,e);a="["+Eb.overrideSpan()+"]";return za.one(a,b).bind(function(a){E.unwrap(a);return fa.inBody(d.start())&&
fa.inBody(d.finish())?g.some(d):g.none()})},Jf={clean:function(a,b){Ws(b)?E.unwrap(b):NG(a,b)},cleanNonEmpty:NG,isTransient:Ws,withinTransient:OG,handleOverride:PG,apply:function(a,b,c,d,e){var f=Lb.fussy(b,c,d,e);return OG(b,d).bind(function(b){if(Ws(b)){var c=B.children(b);c=P.eq(b,f.start())?Lb.fussy(c[0],0,c[0],oa.getEnd(c[0])):f;E.unwrap(b);b=g.some(c)}else b=MG(a,b,f);return b})}},kn=function(a,b){return a.action().run(a.isRoot(),a.environment())},Kf=function(a,b){var c=a.temp();Jf.handleOverride(a.isRoot(),
c,Lb.fussy(c,0,c,oa.getEnd(c)));return g.some(b)},Q4=function(a,b){y.after(a.temp(),a.cursor());return g.some(b)},QG=function(a,b){y.before(a.temp(),a.cursor());return g.some(b)},Xs=function(a,b){var c=a.original();Hk.atStartOf(c.startContainer(),c.startOffset(),a.cursor());return g.some(b)},RG=function(a,b){var c=a.action().deferred().isStyled(a.temp()),d=a.cursor(),e=g.some(Lb.fussy(d,1,d,1));c?a=e:(a.environment().setSelection(d,0,d,0),a=kn(a,b));return a},R4=function(a,b){b=a.cursor();var c=a.action().deferred();
Kd.doRemoveUpto(a.isRoot(),c.purifiers(),Lb.hare(b,0,b,1),c.matches);return g.some(Lb.fussy(b,1,b,1))},Ys=function(a,b){var c=a.cursor();a.environment().setSelection(c,0,c,1);kn(a,b);return g.some(Lb.fussy(c,1,c,1))},SG=function(a,b){b=a.environment();a=a.original();b.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset());hd.expand(b);return b.getSelection().map(Lb.fromHare)},S4=function(a,b){var c=a.action().deferred();return Kd.doRemoveUpto(a.isRoot(),c.purifiers(),Lb.fromFussy(b),
c.matches)},T4=function(a,b){a.action().deferred().isStyled(a.temp())?a=g.some(b):(a.environment().setSelection(b.start(),b.soffset(),b.finish(),b.foffset()),a=kn(a,b));return a},U4=function(a,b){a=a.temp();b=B.children(a);E.unwrap(a);return 0===b.length?g.none():g.some(Lb.fussy(b[0],0,b[b.length-1],oa.getEnd(b[b.length-1])))},V4=M("environment","isRoot","cursor","temp","action","original"),W4=function(a,b){return ac.last(a).fold(k(!0),function(a){return P.eq(a,b.startContainer())&&oa.getEnd(a)===
b.startOffset()})},X4=function(a,b){return ac.first(a).fold(k(!0),function(a){return P.eq(a,b.startContainer())&&0===b.startOffset()})},Y4=function(a,b,c,d,e){var f=m.get(d,Eb.overrideSpan()),h=e.collapsed(),l=p.fromText(fb()),k=W4(d,e),D=X4(d,e);f=a.name()===f;var x=V4(c,b,l,d,a,e);a=f&&Jf.isTransient(d)?[U4]:h&&f&&k?[Q4,Kf,RG]:h&&f&&D?[QG,Kf,RG]:h&&f?[Xs,Kf,R4]:h&&k?[Xs,Kf,Ys]:h&&D?[QG,Kf,Ys]:h?[Xs,Kf,Ys]:f?[Kf,SG,S4,T4]:[Kf,SG,kn];return hb(a,function(a,b){return a.bind(function(a){return b(x,
a)})},g.some(Lb.fromHare(e)))},Gh=function(a,b,c){hd.expand(c);var d=c.getSelection().bind(function(d){return Jf.withinTransient(d.startContainer(),d.endContainer()).filter(function(a){return m.has(a,Eb.overrideSpan())}).fold(function(){return a.run(b,c)},function(e){return Y4(a,b,c,e,d)})});return th.inlineFrom(d)},ad={bold:t(Gh,Qc.bold()),italic:t(Gh,Qc.italic()),underline:t(Gh,Qc.underline()),strikethrough:t(Gh,Qc.strikethrough()),superscript:t(Gh,Qc.superscript()),subscript:t(Gh,Qc.subscript()),
removeformat:function(a,b){hd.expand(b);b=b.getSelection().bind(function(b){return Kd.doRemoveAll(a,Kd.allRules,b)});return th.inlineFrom(b)},language:t(function(a,b,c,d){c.getSelection().each(function(a){Jf.apply(b,a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()).each(function(a){c.setSelection(a.start(),a.soffset(),a.finish(),a.foffset())})});hd.expand(c);a=a.run(b,c,d);return th.inlineFrom(a)},Qc.language()),cleanup:Jf.clean,cleanupNonEmpty:Jf.cleanNonEmpty,isTransient:Jf.isTransient,
withinTransient:Jf.withinTransient},ln={multiple:function(a,b,c,d){return function(e,f){wd.runTransaction(a,b,function(){A(f,c)},d)}},single:function(a,b,c,d){return function(e,f){wd.runTransaction(a,b,function(){c(f)},d)}}},TG=function(a,b,c){c=a.create().nu(c);var d=a.property().children(b);a.insert().append(b,c);a.insert().appendAll(c,d);return c},UG=function(a,b,c){c=a.create().nu(c);var d=a.property().children(b);a.attrs().copyTo(b,c);a.insert().before(b,c);a.insert().appendAll(c,d);a.remove().remove(b);
return c},jw={blockTransform:function(a,b,c){return(yc.isFormatting(a,b)?UG:TG)(a,b,c)},nest:TG,replace:UG},lQ={tags:k("address article aside audio blockquote canvas dd div dl fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hgroup hr li noscript ol output p pre section table tbody td tfoot th thead tr ul video".split(" "))},Z4=gb(),$4=gw(Z4),a5={div:!0},VG={query:function(a,b,c){return $4.query(a,b,c)},apply:function(a,b,c,d,e,f){return vh.applyOn(a,jF,b,c,d,e,function(b){return F(b,
function(b){if(!a5[f]){var c=Lb.hareFromElement(b);Kd.doRemoveAll(a,Kd.allRules,c)}return jw.blockTransform(gb(),b,f)})})}},Hh={background:function(a,b,c){Be.style(a,{"background-color":b},hd.expand,c)},addClass:function(a,b,c){Be.generic(a,hd.expand,c,function(a){n.add(a,b)})},setClass:function(a,b,c){Be.generic(a,hd.expand,c,function(a){m.set(a,"class",b)})},foreground:function(a,b,c){Be.style(a,{color:b},hd.expand,c)},addAttribute:function(a){return function(b,c,d){Be.generic(b,hd.expand,d,function(b){m.set(b,
a,c)})}},face:function(a,b,c){Be.style(a,{"font-family":b},hd.expand,c)},size:function(a,b,c){Be.style(a,{"font-size":b},hd.expand,c)}},WG=function(a,b,c,d,e){b=function(b,d,e,f){return a(c.isRoot,b,d,e,f)};var f=Fm.multiple(c,d,b),h=Fm.single(c,d,b,vj,uj);return Pb.cata(e.get(),g.none,function(a,b){return g.some(f(a,b))},function(a,b){return g.some(h(a,b))})},Og={transform:function(a,b,c,d,e){return WG(function(a,b,c,d,g){return VG.apply(a,b,c,d,g,e)},a,b,c,d)},setClass:function(a,b,c,d,e,f){var h=
function(a){L.closest(a,e).each(function(a){wd.runTransaction(b,c,function(){m.set(a,"class",f)},b.toEditing)})};Pb.cata(d.get(),u,function(a,b){A(a,h)},function(a,b){h(a.startContainer())})},inline:function(a,b,c,d,e){a=function(a){Hh.setClass(a,e,Ud.isAnnotation)};Pb.cata(d.get(),u,ln.multiple(b,c,a,b.toEditing),ln.single(b,c,a,b.toEditing))},list:function(a,b,c,d,e){return WG(a,b,c,d,e)}},XG=M("label","items"),Ih=function(a,b){return 0<b.length?[XG(g.some(w.key(a)),b)]:[]},lw={groups:function(a,
b,c){var d=a.divisions(),e=F(d.blocks().concat(d.classblocks()),a.toCandidate),f=F(d.inlines(),a.toCandidate);a=F(d.objects(),a.toCandidate);a=zb(a,function(a,d){if(tb.closest(b,d.base(),c)){var e=d.base();a=V(["a"],e)?ra(a,{link:a.link.concat([d])}):V(["embed","img","object"],e)?ra(a,{media:a.media.concat([d])}):V(["hr"],e)?ra(a,{line:a.line.concat([d])}):V(["li","ol","ul"],e)?ra(a,{list:a.list.concat([d])}):V(["table","tr","td","th"],e)?ra(a,{table:a.table.concat([d])}):a}return a},{link:[],media:[],
line:[],list:[],table:[]});return Kb([[XG(g.none(),e)],Ih("block.label.inline",f),Ih("block.label.link",a.link),Ih("block.label.media",a.media),Ih("block.label.line",a.line),Ih("block.label.list",a.list),Ih("block.label.table",a.table)])}},mn=function(a,b){return{fold:b}},kf={inline:function(a,b,c){return mn("inline",function(d,e,f,h){return d(a,b,c)})},object:function(a,b,c,d){return mn("object",function(e,f,h,g){return f(a,b,c,d)})},block:function(a,b,c){return mn("block",function(d,e,f,h){return f(a,
b,c)})},classblock:function(a,b,c,d){return mn("classed block",function(e,f,h,g){return g(a,b,c,d)})},cata:function(a,b,c,d,e){return a.fold(b,c,d,e)}},YG="h1 h2 h3 h4 h5 h6 div p pre".split(" "),b5="a embed hr img li object ol table td tr ul th".split(" "),c5=function(a){var b=a.match(/[\[\]* !#%=+>:~,\^\$]/),c=a.indexOf(".");-1<c&&null===b?(b=a.substring(0,c),a=a.substring(c+1),a=-1===a.indexOf(".")?g.some({tag:k(b),clazz:k(a)}):g.none()):a=g.none();return a},e5=function(a,b){var c=a.tag(),d=a.clazz(),
e=V(YG,c),f=V(b5,c);return(e?N.value(kf.classblock):f?N.value(kf.object):N.error("Rule must have object tag or block tag.")).map(function(e){var f=d5(b,a);return e(c,d,f,b.style)})},f5=function(a){return a.text.getOrThunk(function(){return w.key("block."+a.name)})},g5=function(a,b){return a.text.getOrThunk(function(){return w.pkey("tag.inline.class",[b])})},d5=function(a,b){return a.text.getOrThunk(function(){var a="block."+b.tag(),d="tag."+b.tag();a=(w.has(a)?w.translate(a):w.has(d)?w.translate(d):
b.tag())+" ("+b.clazz()+")";return w.raw(a)})},nQ={decipher:function(a){return c5(a.name).fold(function(){return V(YG,a.name)?N.value(kf.block(a.name,f5(a),a.style)):N.error("Invalid style name: "+a.name)},function(b){return 0<b.tag().length?e5(b,a):N.value(kf.inline(b.clazz(),g5(a,b.clazz()),a.style))})}},mQ=function(a,b){return ia(b,function(b){if(Va(gq(b.cssRules),function(a){return/ephox-candy-mountain/i.test(a.selectorText)}))return[];var c={};A(gq(b.cssRules),function(b){if(b.type===CSSRule.STYLE_RULE){var d=
b.selectorText,e=d.match(/(.*)\[ephox-data\](.*)/i);null===e?(c.hasOwnProperty(d)||(c[d]={}),c[d].rule=d,c[d].visibility=a):(d=e[1]+e[2],c.hasOwnProperty(d)||(c[d]={}),e=b.style.visibility,"hidden"===e?c[d].visibility=!1:"visible"===e&&(c[d].visibility=!0),b=b.style.content,Te.isEmpty(b)||(c[d].text=b.replace(/["']/g,"")))}});return ka(se(c),function(a){return a.hasOwnProperty("rule")&&!1!==a.visibility})})},h5={text:function(a){var b=w.get(a.textkey()),c=w.cata(a.textkey(),k(!0),k(!1),k(!1));a=c&&
void 0===b?a.value():b;return{text:k(a),unknown:k(c)}}},kw={format:function(a){var b=p.fromText(w.get(a.textkey())),c=S.div();n.add(c,z.resolve("format-element-"+a.tag()));v.setAll(c,a.styles());a=S.div();n.add(a,z.resolve("format-element-container"));y.append(c,b);y.append(a,c);return a},face:function(a){var b=h5.text(a),c=b.text();c=Rc(c).element();v.setAll(c,{"font-family":a.value()});a=b.unknown()?[z.resolve("font-face-unknown")]:[];ja.add(c,a);return c}},qQ=function(a,b){a=p.fromTag(a);T.hidden(a,
!0);v.set(a,"list-style-type",b);b=z.resolve("list-style-content");for(var c=0;3>c;c++){var d=p.fromTag("li"),e=S.span();n.add(e,b);y.append(d,e);y.append(a,d)}return a},pQ=function(a,b){b=w.translate(b);var c=p.fromText(b),d=S.span();n.add(d,z.resolve("list-style-default"));m.set(a,"data-"+z.resolve("list-style"),"default");m.set(a,"title",b);y.append(d,c);return d},Kk="data-"+z.resolve("list-style"),i5=sa.generate([{mine:["element"]},{other:["element"]},{paragraphs:["elements"]}]),ri=ra(i5,{cata:function(a,
b,c,d){return a.fold(b,c,d)}}),j5=function(a,b,c){var d=C.name(a);return v.getRaw(a,"list-style-type").fold(function(){return d===b&&c.isNone()},function(a){return c.exists(function(c){return d===b&&a===c})})},tQ={categorise:function(a,b,c){a=Lk(a,function(a){return la.isList(a)?!0:B.parent(a).map(function(a){return a.dom()}).getOr(!1)});return ia(a,function(a){return kb(a,la.isList)?F(a,function(a){return j5(a,b,c)?ri.mine(a):ri.other(a)}):[ri.paragraphs(a)]})}},ZG=function(a){return qc.cata(a,function(a){return Cd.wrap(a)},
function(a){return[a]},function(a,c){return la.isList(a)?[a]:ia(c,ZG)},function(a){return Cd.wrap([a])})},k5={isRootContainer:function(a){return function(b){return a(b)||la.isContainer(b)&&"li"!==C.name(b)}},extract:ZG,isCapable:la.isBlock,canUse:k(!1),quasi:function(){return g.some(zj.nu(gb()))},ascend:function(a,b){return L.closest(a,"ol,ul",b).getOr(a)}},l5=function(a,b,c){var d=p.fromTag(b);c.each(function(a){v.set(d,"list-style-type",a)});return Wm.list(a,d)},Ag={hasSameType:function(a,b){return C.name(a)===
b},hasSameStyle:function(a,b){var c=v.getRaw(a,"list-style-type");return b.fold(function(){return c.isNone()},function(a){return c.is(a)})},convertOr:function(a,b,c,d,e){return function(f){return d(f.list(),a)&&e(f.list(),b)?c(f):l5(f,a,b)}},topContext:function(a,b,c){return wh.context(a,b,wh.topmost,nF,c)},context:function(a,b,c){return wh.context(a,b,wh.immediate,nF,c)},unapply:function(a){return Wm.level(a,-1*a.level())}},Kj=gb(),m5=gw(Kj),n5=function(a){a=F(a,function(a){return L.ancestor(a,"ul,ol")});
var b=F(a,function(a){return a.fold(function(){return"-"},function(a){return C.name(a)+"-"+v.get(a,"list-style-type")})}),c=b[0];return kb(b.slice(1),function(a){return a===c})?a[0]:g.none()},$G=function(a,b,c){var d=sQ(Kj,a,c),e=function(a,b,c,e,f,g){return vh.applyOn(a,k5,b,c,e,f,function(b){return d.apply(a,g,b)})},f=function(b,d,e){b=b.selected();return 0<b.length&&n5(b).map(function(b){return d(b,a)&&e(b,c)}).getOr(!1)};return{query:function(c){return m5.queryAll(c.startContainer(),c.endContainer(),
["ul","ol"],b).exists(function(b){return b===a})},queryStyle:function(a){var d=c.fold(function(){return":not([style])"},function(a){return'[style*="list-style-type: '+a+';"]'});return Kj.up().closest(a.startContainer(),"ol, ul",b).exists(function(c){return Kj.up().closest(a.endContainer(),"ol, ul",b).exists(function(a){return c.dom()===a.dom()?Kj.is(c,d):!1})})},apply:function(b,d,g,m,x,n,p){var h=p?k(!0):Ag.hasSameStyle,l=function(){return e(b,d,g,m,x,n)},r=function(b,e){return tF.executeUsing(b,
d,g,m,x,function(){return Ag.convertOr(a,c,e,Ag.hasSameType,h)})},D=function(){return Ag.topContext(d,m,b).fold(l,function(a){return r(a,Ag.unapply)})};return Ag.context(d,m,b).fold(l,function(a){return f(a,Ag.hasSameType,h)?D():r(a,aa)})}}},Mk={unordered:t($G,"ul"),ordered:t($G,"ol")},aH=function(a,b,c,d){return function(c){var e=d(c.content().isRoot,g.none());return{toggle:!0,value:a,textkey:w.key(b),icon:!0,tooltip:ib.get,updateGeneral:function(a){c.content().getSelection().each(function(b){(e.query(b)?
wa.on(!0):wa.off()).fold(a.deselect,u,a.select)})},action:function(){Og.list(function(a,b,d,f,g){return e.apply(a,b,d,f,g,Yo(c.region()))},c.region(),c.content(),c.undo(),c.selections());c.content().focus()}}}},o5=aH("bullist","action.bullist","ul",Mk.unordered),mw={ol:aH("numlist","action.numlist","ol",Mk.ordered),ul:o5},p5=M("tag"),bH=function(a,b){return V(["label","li","td","th","normal"],b)?wa.on(a.backup(b)):wa.off()},q5=function(a,b,c){return VG.query(a,b.selectors(),c).fold(function(){return a.collapsed()?
bH(b,"normal"):wa.off()},function(a){return b.candidateByName(a).map(wa.on).getOrThunk(function(){return bH(b,a)})})},wQ={read:function(a,b){var c=a.getSelection().fold(function(){return wa.off()},function(c){return q5(c,b,a.isRoot)});return p5(c)}},vQ=ba.detect(),cH={resolve:Hb.create("ephox-arcade").resolve},Zs="data-"+cH.resolve("no-merge"),$s="data-"+cH.resolve("atomic"),Lf={doNotMerge:function(a){C.isElement(a)&&m.set(a,Zs,"true")},shouldMerge:function(a){return C.isElement(a)&&!1===m.has(a,
Zs)},setAtomic:function(a){C.isElement(a)&&m.set(a,$s,"true")},isAtomic:function(a){return C.isElement(a)&&"true"===m.get(a,$s)},clear:function(a){C.isElement(a)&&A([Zs,$s],function(b){m.remove(a,b)})}},r5=function(a){var b=B.owner(a);a=ca.descendants(a,"td,th");A(a,function(a){Ye.needsCursor(a).each(function(c){y.append(a,p.fromTag("br",b.dom()))})})},s5=function(a){Ye.vacate(a);Ye.needsCursor(a).each(function(b){E.remove(a)})},t5=function(a){("table"===C.name(a)?r5:s5)(a)},dH=function(a,b){a=u5(a);
b=ka(a,b);A(b,t5)},u5=function(a){var b=function(a){return[a]},c=B.prevSibling(a).map(b).getOr([]);b=B.nextSibling(a).map(b).getOr([]);return c.concat([a]).concat(b)},Jh={purge:function(a){dH(a,la.isBlock)},purgeBy:dH},eH=function(a){Jh.purgeBy(a,function(a){var b=la.isBlock(a)||"li"===C.name(a)||"ol"===C.name(a)||"ul"===C.name(a);if("li"===C.name(a)){var d;if(!(d=0===ca.descendants(a,"ul,ol").length)){d=ca.descendants(a,"ul,ol,li");var e=ca.descendants(a,"*");a=Cc.descendants(a,C.isText);d=d.length===
e.length&&0===a.length}a=d}else a=!0;return b&&a})},at=function(a){var b=ca.descendants(a,"ol,ul,li");A([a].concat(b),eH)},fH=function(a){a=("li"===C.name(a)?[a]:[]).concat(ca.descendants(a,"li"));A(a,function(a){var b=B.children(a);Va(b,function(a){return C.isText(a)?0<Oa.get(a).length:!V(["ol","ul"],C.name(a))})||v.set(a,"list-style-type","none")})},nn=function(a,b){var c=p.fromText(fb());a(b,c);return g.some({element:k(c),cleanup:function(){E.remove(c)},splits:k([])})},Kh=function(a,b){return a.map(function(a){return{element:k(a),
cleanup:u,splits:k(b)}})},gH=function(a,b){return nn(y.before,a)},hH=function(a,b){return nn(y.after,a)},bt=function(a,b){return nn(y.append,a)},ct=function(a,b){return nn(y.prepend,a)},iH=function(a,b){return function(c,d){return a(c,d).fold(function(){return b(c,d)},g.some)}},dt=function(a,b,c){return Kh(g.some(b),void 0!==b&&void 0!==c?[{first:b.dom(),second:c.dom()}]:[])},jH={before:{text:{none:g.none,start:iH(function(a,b){return Kh(B.prevSibling(a),[])},gH),middle:dt,end:dt},element:{hasPrevious:function(a,
b){return Kh(B.child(a,b-1),[])},rightEdge:bt,first:ct,empty:gH,otherwise:ct}},after:{text:{none:g.none,start:dt,middle:function(a,b,c){return Kh(g.some(c),void 0!==b&&void 0!==c?[{first:b.dom(),second:c.dom()}]:[])},end:iH(function(a,b){return Kh(B.nextSibling(a),[])},hH)},element:{hasNext:function(a,b){return Kh(B.child(a,b+1),[])},rightEdge:bt,first:ct,empty:hH,otherwise:bt}}},on={prefix:t(bn.prefix,jH),postfix:t(bn.postfix,jH)},v5=function(a){return!ed.descendant(a,function(a){return rh.hasCursor(a,
["hr","img"])})},w5=function(a){var b=a.second();if(Ub.isHeading(b)&&v5(b)){var c=Gc.shallowAs(b,"p");y.before(b,c);E.remove(b);b=g.some(c)}else b=g.none();b=b.getOr(a.second());return{first:a.first,second:k(b),mark:a.mark,splits:a.splits}},x5=function(a){return C.isElement(a)&&la.isInline(a)&&0===B.children(a).length},y5=function(a){var b=p.fromText(fb());y.append(a,b);return b},kH=function(a,b,c){return on.prefix(b,c).bind(function(b){var c=Lm.breakPath(b.element(),Ub.stopAt(a));return c.second().map(function(d){return{first:k(a),
second:k(d),mark:k(b),splits:k(c.splits().concat(b.splits()))}})})},le={soft:function(a,b,c){var d=function(c){if(C.isText(c)){var e=Oa.get(c);e=-1===e.indexOf("\u00a0")&&0===e.trim().length}else e=!1;return e?B.nextSibling(c).forall(d):!oa.isStart(a,b)&&la.isBlock(c)},e=p.fromTag("br");Hk.atStartOf(a,b,e);B.nextSibling(e).fold(function(){return oa.getEnd(a)===b&&Ub.findBlock(a,c).bind(ac.last).fold(k(!1),function(b){var c="br"===C.name(b)?e:a;return P.eq(c,b)})},d)&&y.after(e,p.fromTag("br"));return g.some({start:k(ha.after(e)),
finish:k(ha.after(e))})},hard:function(a,b,c,d,e){return kH(a,b,c).map(w5).map(function(a){A([d.getOr(a.first()),a.second()],function(b){Ye.postprocess(b,a.mark().element(),e)});Ub.findValidHardBreak(a.second(),e).isNone()&&ls.rootBr(a.second(),a.mark().element());var b=Im.plunge(a.second(),k(!1));b=x5(b)?y5(b):b;a.mark().cleanup();return{start:k(ha.on(b,0)),finish:k(ha.on(b,0))}})},rupture:kH},lH=function(a){return g.some({start:k(a),finish:k(a)})},z5={doubleBr:function(a){y.after(a,p.fromTag("br"));
var b=p.fromTag("br");y.after(a,b);return lH(ha.after(b))},emptyParagraph:function(a){var b=p.fromTag("p"),c=p.fromTag("br");y.append(b,c);y.after(a,b);return lH(ha.on(c,0))}},mH=function(a){return[a]},A5={processes:function(a){return{stopper:Ub.stopAt(a),wrapper:mH,post:u}}},C5=function(a,b,c){g.from(c[c.length-1]).each(function(a){O.append(a,B5(B.children(b)));E.empty(b)})},B5=function(a){return ka(a,function(a){return!(C.isElement(a)&&Ub.isList(a)&&0===B.children(a).length)})},D5={processes:function(a){return{stopper:Ub.stopAt(a),
wrapper:mH,post:C5}}},E5=function(a,b){E.remove(a);return b},F5=function(a,b){var c=p.fromTag("p");O.append(c,b);y.before(a,c);E.remove(a);Ye.needsCursor(c).each(function(a){ls.forceAddBr(a,p.fromTag("span"))});return[c]},G5=function(a){var b=B.children(a);b=(ed.descendant(a,la.isFormatting)?E5:F5)(a,b);A(b,function(b){C.isElement(b)&&(m.transfer(a,b,["dir"]),v.transfer(a,b,["text-align"]))});return b},H5={processes:function(a){return{stopper:Ub.stopAt(a),wrapper:G5,post:u}}},I5={exit:function(a,
b){return L.ancestor(a,"ol,ul",b).bind(function(c){var d=L.ancestor(c,"li,ol,ul",b).fold(function(){return H5.processes(c)},function(a){return"li"===C.name(a)?D5.processes(a):A5.processes(c)}),e=Lm.breakPath(a,d.stopper);return e.second().map(function(b){var c=e.first(),f=d.wrapper(a);O.before(b,f);d.post(c,b,f);A([c,b],Ye.lists);b=Im.plunge(f[0],k(!1));b=k(ha.on(b,0));return{start:b,finish:b}})})}},J5=function(a,b,c,d){return L.closest(b,"li",d).fold(function(){return le.hard(a,b,c,g.none(),d)},
function(a){a=Ub.exitList(a)?I5.exit(a,d):le.hard(a,b,c,g.some(a),d);return a})},et={hard:function(a,b,c){return Ub.findValidHardBreak(a,c).fold(function(){return Ub.findAnchorBreak(a,c).fold(function(){return le.soft(a,b,c)},function(d){return!0===Ub.isRightEdge(d,a,b)?z5.doubleBr(d):le.hard(d,a,b,g.none(),c)})},function(d){return J5(d,a,b,c)})},soft:le.soft,rupture:le.rupture},ft=M("cursor","blocks"),pn=function(a,b,c,d){return on.postfix(a,b,c,d).map(function(e){var f=yg.leftEdge(a,b,c,d);yg.makeTo(f.element(),
f.offset(),e.element()).deleteContents();return{start:k(ha.before(e.element())),finish:k(ha.before(e.element())),mark:e.element}})},gt=function(a,b,c,d,e){return pn(a,b,c,d).bind(function(a){return le.soft(a.mark(),0,e)})},K5=function(a,b,c,d,e){return pn(a,b,c,d).bind(function(a){return Ub.findValidHardBreak(a.mark(),e).bind(function(b){return le.hard(b,a.mark(),0,g.none(),e)})})},L5=function(a,b){A(a,function(a){Ye.postprocess(a,b)})},ht={soft:gt,hard:function(a,b,c,d,e){var f=Ub.findValidHardBreak(a,
e),h=Ub.findValidHardBreak(c,e),g=f.fold(function(){var f=gt(a,b,c,d,e);return ft(f,[])},function(f){return h.fold(function(){var h=gt(a,b,c,d,e);return ft(h,[f])},function(h){var g=P.eq(f,h)?K5(a,b,c,d,e):pn(a,b,c,d);return ft(g,[f,h])})});return g.cursor().map(function(a){L5(g.blocks(),a.start().fold(aa,aa,aa));return a})},rupture:function(a,b,c,d,e){return pn(a,b,c,d).bind(function(a){return Ub.findValidHardBreak(a.mark(),e).bind(function(b){return le.rupture(b,a.mark(),0)})})}},it={point:function(a,
b,c){return et.rupture(a,b,c)},range:function(a,b,c,d,e){return ht.rupture(a,b,c,d,e)},ruptureUntil:function(a,b,c,d,e,f){var h=on.postfix(a,b,c,d);return function(a,b){return Ub.findValidHardBreak(a,e).map(f).bind(function(c){return le.rupture(c,a,b)})}(a,b).bind(function(a){return h.map(function(b){var c=document.createRange();c.setStartAfter(a.first().dom());c.setEndBefore(b.element().dom());c.deleteContents();b.cleanup();a.mark().cleanup();return a.first()})})}},Lj=function(a,b,c){if(0<a.length){var d=
a[0],e=a.slice(1);Hk.atStartOf(b,c,d);O.after(d,e);return g.some(a[a.length-1])}return g.none()},id={split:function(a,b,c){var d=void 0===c?Jh.purge:c;return it.point(a.block(),a.element(),a.offset()).bind(function(a){var c=b.all();O.before(a.second(),c);a.mark().cleanup();d(a.first());d(a.second());A([a.first(),a.second()],fH);a=Ld(c);return va(a,function(a){return B.parent(a).isSome()})})},merge:function(a,b){b=B.children(b.single());return Lj(b,a.element(),a.offset())},nest:function(a,b){return Lj(b.all(),
a.element(),a.offset())},insertMany:Lj,insertChildren:function(a,b){a=B.children(a);return Lj(a,b.element(),b.offset())},fallback:function(a,b,c){return Lj(c,b.startContainer(),b.startOffset())}},nH={lists:function(a){return zb(a,function(a,c){return a.bind(function(a){return L.closest(c,"ol,ul").map(function(b){return[b].concat(a)})})},g.some([])).map(function(a){return{all:k(a)}})},from:function(a){return{all:k(a)}}},oH=M("left","right"),M5=function(a){return la.isFormatting(a)||la.isContainer(a)},
pH=function(a,b,c,d){return Da.closest(c,a,b)},qH=function(a){return function(b,c,d){return a(b,c.element(),c.offset()).bind(function(c){return a(b,d.element(),d.offset()).map(function(a){return oH(c,a)})})}},rH=function(a){var b=qH(a);return function(a,d,e){return b(a,d,e).filter(function(a){return P.eq(a.left(),a.right())})}},Ua={inline:function(a,b,c){return Da.closest(b,M5,a).fold(function(){return g.some(b)},function(c){return a(c)?g.some(b):g.none()})},formatter:t(pH,la.isFormatting),container:function(a,
b,c){return Da.closest(b,la.isContainer,a).filter(xf(a))},inListItem:function(a,b,c){return L.closest(b,"li",a)},inList:function(a,b,c){return L.closest(b,"ol,ul",a)},inTableCell:function(a,b,c){return L.closest(b,"td,th",a)},setBlock:function(a,b){return cb(a,{block:k(b)})},both:qH,shared:rH,sharedPredicate:function(a){a=t(pH,a);return rH(a)},entireRoot:function(a,b,c){return Da.closest(b.element(),a).filter(function(c){var d=function(a){return P.eq(a,b.element())};return a(b.element())&&0===b.offset()||
C.isText(b.element())&&0===b.offset()&&ac.first(c).map(d).getOr(!1)}).filter(function(b){var d=function(a){return P.eq(a,c.element())};return a(c.element())&&c.offset()>=B.children(b).length-1||C.isText(c.element())&&c.offset()>=Oa.get(c.element()).length&&ac.last(b).map(d).getOr(!1)}).map(function(a){return oH(a,a)})}},sH=function(a){return function(b){return(1===b.length?g.some(b[0]):g.none()).filter(a).map(function(a){return{single:k(a)}})}},tH=function(a){return function(b){return(Va(b,a)?g.some(b):
g.none()).map(function(a){return{all:k(a)}})}},Vb={oneOf:sH,anyOf:tH,noneOf:function(a){return function(b){return(Va(b,a)?g.none():g.some(b)).map(function(a){return{all:k(a)}})}},allOf:function(a){return function(b){return kb(b,a)?g.some({all:k(b)}):g.none()}},any:g.some,oneOfTag:function(a){return sH(function(b){return C.name(b)===a})},anyOfTag:function(a){return tH(function(b){return C.name(b)===a})},single:function(a){return g.some({single:k(a)})},all:function(a){return g.some({all:k(a)})}},qn=
function(a){return 1===a.length?L.closest(a[0],"ol,ul").map(function(a){return{single:k(a)}}):g.none()},uH=function(a){return qn(a).bind(function(a){a=ca.descendants(a.single(),"li");return 1===a.length?g.some({single:k(a[0])}):g.none()})},vH=function(a){if(2!==a.length)return g.none();var b=a[0],c=a[1];return la.isFormatting(b)||la.isContainer(b)||V(["ol","ul","li"],C.name(b))||!V(["ol","ul"],C.name(c))?g.none():g.some({all:k(a),list:k(c),inline:k(b)})},Lh=Ua.formatter,wH=Ua.inline,N5=Ua.container,
xH=function(a){return la.isFormatting(a)&&!1===Lf.shouldMerge(a)},O5=[db(Ua.inListItem,qn,function(a,b){b=ca.children(b.single(),"li");return 1!==b.length||tb.descendant(b[0],"ol,ul")?id.split(a,nH.from(b),eH):id.insertChildren(b[0],a)},"List"),db(Ua.inListItem,nH.lists,function(a,b){return L.ancestor(a.block(),"ol,ul",a.isRoot).bind(function(c){c=Ua.setBlock(a,c);return id.split(c,b,at)})},"Many lists"),db(wH,Vb.anyOf(xH),id.nest,"Copying formatting (NO MERGE) into root"),db(wH,Vb.oneOf(la.isFormatting),
id.merge,"Copying formatting into root"),db(Lh,Vb.anyOfTag("hr"),id.split,"insert hr into formatter"),db(Lh,Vb.anyOf(xH),id.split,"Copying one formatting block (NO MERGE) into formatting"),db(Lh,Vb.oneOf(la.isFormatting),id.merge,"Copying one formatting block into formatting"),db(Lh,Vb.anyOf(la.isFormatting),id.split,"Copying many formatting blocks into formatting"),db(Lh,Vb.anyOfTag("table"),function(a){return function(b,c){var d=c.all();b=a(b,c);g.from(d[d.length-1]).each(function(a){B.nextSibling(a).fold(function(){var b=
p.fromTag("p");y.append(b,p.fromTag("br"));y.after(a,b)},u)});return b}}(id.split),"Copying tables into formatting"),db(Lh,Vb.anyOf(la.isContainer),id.split,"Copying container blocks into formatting"),db(N5,Vb.all,id.nest,"Fallback pasting into container.")],P5={context:function(a,b,c){return b.context(a.isRoot,c.startContainer(),c.startOffset()).map(function(b){return{block:k(b),element:c.startContainer,offset:c.startOffset,isRoot:a.isRoot}})},rules:k(O5),fallback:id.fallback},Q5={force:function(a){var b=
Vc.after(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset()),c=b?W.point(a.endContainer(),a.endOffset()):W.point(a.startContainer(),a.startOffset());a=b?W.point(a.startContainer(),a.startOffset()):W.point(a.endContainer(),a.endOffset());return{left:k(c),right:k(a)}}},R5=function(a,b){var c=a.original(),d=on.postfix(c.left().element(),c.left().offset(),c.right().element(),c.right().offset()),e=b.all();return d.bind(function(b){yg.makeTo(c.left().element(),c.left().offset(),b.element()).deleteContents();
b.cleanup();O.append(a.left(),e);b=B.children(a.right());O.append(a.left(),b);E.remove(a.right());return g.from(e[e.length-1])})},yH=function(a,b){if(!P.eq(a.left(),a.right()))throw"replaceContents used in the wrong context";a=a.left();E.empty(a);b=b.all();O.append(a,b);return ac.last(a).or(g.from(b[b.length-1]))},jd={replace:function(a,b){return P.eq(a.left(),a.right())?(b=b.all(),a.replaceSelection(b),g.from(b[b.length-1])):R5(a,b)},replaceContents:yH,replaceContentsWrapP:function(a,b){var c=p.fromTag("p");
O.append(c,b.all());return yH(a,{all:k([c])})},replaceWhole:function(a,b){b=b.all();O.after(a.left(),b);E.remove(a.left());return g.from(b[b.length-1])},merge:function(a,b){b=B.children(b.single());a.replaceSelection(b);return g.from(b[b.length-1])},split:function(a,b,c){var d=void 0===c?Jh.purge:c;c=a.original().left();var e=a.original().right();return it.range(c.element(),c.offset(),e.element(),e.offset(),a.isRoot).bind(function(a){var c=b.all();O.before(a.second(),c);a.mark().cleanup();A([a.first(),
a.second()],d);return g.from(c[c.length-1])})},fallback:function(a,b,c){a.replaceSelection(c);g.from(c[0]).each(Jh.purge);g.from(c[c.length-1]).each(Jh.purge);return g.from(c[c.length-1])}},zH=function(a,b,c,d){d=void 0!==d?d:aa;var e=b.original(),f=e.left();e=e.right();return it.ruptureUntil(f.element(),f.offset(),e.element(),e.offset(),b.isRoot,d).bind(function(b){var d=a(b,c);S5(b);return d},void 0!==d?d:aa)},S5=function(a){var b=ca.ancestors(a,"ol,ul");0<b.length&&A([at,fH],function(a){a(b[b.length-
1])})},rn=function(a,b,c){return zH(a,b,c,aa)},Mj=Ua.formatter,T5=t(rn,function(a,b){y.after(a,b.single());return g.some(b.single())}),AH=t(function(a,b,c){return zH(a,b,c,function(a){return B.parent(a).getOr(a)})},function(a,b){b=b.all();O.after(a,b);return g.from(b[b.length-1])}),U5=t(rn,function(a,b){b=B.children(b.single());O.after(a,b);return g.some(b[b.length-1])}),V5=t(rn,function(a,b){var c=p.fromTag("li");O.append(c,[b.inline(),b.list()]);y.after(a,c);return g.some(b.list())}),W5=t(rn,function(a,
b){var c=p.fromTag("li");O.append(c,[b.inline(),b.list()]);var d=L.ancestor(a,"ol,ul").fold(function(){var a=p.fromTag(C.name(b.list()));y.append(a,c);return a},function(){return c});y.after(a,d);return g.some(b.list())}),X5=[db(Ua.sharedPredicate(Lf.isAtomic),Vb.all,jd.replaceWhole,"selection: inside something atomic, so just replace the whole thing"),db(Ua.shared(Ua.inListItem),uH,function(a,b){return jd.merge(a,b)},"selection: same item, paste: singleton"),db(Ua.shared(Ua.inListItem),qn,function(a,
b){return jd.split(a,{all:k(B.children(b.single()))},at)},"selection: same item, paste: single list"),db(Ua.shared(Ua.inListItem),vH,W5,"selection: same item, paste: partial"),db(Ua.shared(Ua.inListItem),Vb.noneOf(la.isBlock),jd.replace,"selection: same item, paste: no blocks"),db(Ua.shared(Ua.inListItem),Vb.anyOf(la.isHeading),function(a,b){a=jd.replace(a,b);A(b.all(),function(a){Jh.purgeBy(a,rh.isVacantText)});return a},"selection: same item, paste: heading"),db(Ua.shared(Ua.inListItem),Vb.all,
AH,"selection: same item, paste: any"),db(Ua.both(Ua.inListItem),uH,T5,"selection: diff items, paste: singleton"),db(Ua.both(Ua.inListItem),qn,U5,"selection: diff items, paste: single list"),db(Ua.both(Ua.inListItem),vH,V5,"selection: diff items, paste: partial"),db(Ua.both(Ua.inListItem),Vb.all,AH,"selection: diff items, paste: any"),db(Ua.both(Mj),Vb.anyOfTag("hr"),jd.split,"selection: inside formatter, paste: split"),db(Ua.both(Mj),Vb.noneOf(la.isBlock),jd.replace,"range no blocks"),db(Ua.both(Mj),
Vb.anyOf(function(a){return la.isFormatting(a)&&!1===Lf.shouldMerge(a)}),jd.split,"range 1 formatting block"),db(Ua.both(Mj),Vb.oneOf(la.isFormatting),jd.merge,"range 1 formatting block"),db(Ua.both(Mj),Vb.all,jd.split,"range anything > formatters"),db(Ua.entireRoot,Vb.noneOf(la.isBlock),jd.replaceContentsWrapP,"complete body, not inserting a block: wrap in P and replace the contents"),db(Ua.entireRoot,Vb.all,jd.replaceContents,"complete body: replace the contents")],Y5={context:function(a,b,c){var d=
Q5.force(c);return b.context(a.isRoot,d.left(),d.right()).map(function(b){return{left:b.left,right:b.right,original:k(d),isRoot:a.isRoot,replaceSelection:a.replaceSelection}})},rules:k(X5),fallback:jd.fallback},Z5=function(a,b,c,d,e){return hb(a,function(a,h){return a.orThunk(function(){return d(b,h,c).bind(function(a){return h.profile(e).map(function(b){return{action:h.action,target:k(b),ctx:k(a)}})})})},g.none())},$5=function(a){var b=oa.getEnd(a);return W.point(a,b)},BH=function(a,b,c,d,e,f){var h=
{getSelection:a,replaceSelection:b,isRoot:c};return h.getSelection().bind(function(a){var b=a.collapsed()?P5:Y5,c=a.collapsed()?e.concat(b.rules()):f.concat(b.rules());c=Z5(c,h,a,b.context,d).fold(function(){return b.fallback(h,a,d)},function(a){return a.action(a.ctx(),a.target())});return c.isNone()&&0===d.length?g.some(W.point(a.startContainer(),a.startOffset())):c.map($5)})},a6={insertAtCursor:function(a,b,c,d){return BH(a,b,c,d,[],[])},insertAtCursorWith:BH},b6=function(a){return C.isElement(a)&&
"false"===m.get(a,"contenteditable")},c6=function(a){return a().map(function(a){a=F([a.startContainer(),a.endContainer()],function(a){return Da.closest(a,b6)});return Td(a)}).getOr([])},CH=function(a,b,c){A(a,b);b=c();A(a,Lf.clear);return b},d6=function(a,b){return CH(a,Lf.setAtomic,b)},DH=function(a,b,c,d,e,f){var h=c6(a);return d6(h,function(){return a6.insertAtCursorWith(a,b,c,d,e,f)})},EH=function(a,b,c,d){b=DH(a.getSelection,a.replaceSelection,a.isRoot,b,c,d);a.domChanged();a.undoChanged();return b},
FH=function(a,b){return EH(a,b,[],[])},bd={insertAtCursorWith:EH,insertAtCursor:FH,insertAtCursorWithInstructions:function(a,b,c){return CH(c,a,function(){return FH(b,c)})},insertAt:function(a,b,c){c=DH(function(){return g.some(b)},function(c){a.win().each(function(a){var d=wc.relative(ha.on(b.startContainer(),b.startOffset()),ha.on(b.endContainer(),b.endOffset()));Na.replace(a,d,c)})},a.isRoot,c,[],[]);a.domChanged();a.undoChanged();return c}},Nk={generate:function(a){return a+"-"+Math.floor(99999*
Math.random()).toString()}},e6=M("ch","offset"),GH=function(a,b){return e6(a.charAt(b),b)},sn={previous:function(a,b){for(b=b.getOr(a.length)-1;0<=b;b--)if(a.charAt(b)!==fb())return g.some(GH(a,b));return g.none()},next:function(a,b){for(b=b.getOr(0)+1;b<a.length;b++)if(a.charAt(b)!==fb())return g.some(GH(a,b));return g.none()},rfind:function(a,b){b.lastIndex=-1;a=Ld(a).join("");b=a.match(b);return void 0!==b&&null!==b&&0<=b.index?g.some(a.length-1-b.index):g.none()},lfind:function(a,b){b.lastIndex=
-1;a=a.match(b);return void 0!==a&&null!==a&&0<=a.index?g.some(a.index):g.none()}},f6=ua.walkers().left(),g6=ua.walkers().right(),h6=sa.generate([{abort:[]},{kontinue:[]},{finish:["info"]}]),jt=sa.generate([{aborted:[]},{edge:["element"]},{success:["info"]}]),HH=function(a,b){return yc.isEmptyTag(a,b)||a.property().isBoundary(b)},kt=function(a,b,c,d,e,f,h){var k=function(){return h.fold(jt.aborted,jt.edge)},r=function(d){return ua.walk(a,b,c,f).fold(k,function(b){return kt(a,b.item(),b.mode(),g.none(),
e,f,d)})};if(HH(a,b))return k();if(a.property().isText(b)){var m=a.property().getText(b);return e(a,h6,b,m,d).fold(k,function(){return r(g.some(b))},jt.success)}return r(h)},i6=function(a,b,c,d){c=Pc.toLeaf(a,b,c);return a.property().isText(b)?g.none():qm.left(a,c.element(),a.property().isText,d).map(function(b){return W.point(b,a.property().getText(b).length)})},j6=function(a,b,c,d){c=Pc.toLeaf(a,b,c);return a.property().isText(b)?g.none():qm.right(a,c.element(),a.property().isText,d).map(function(a){return W.point(a,
0)})},IH=function(a,b,c){var d=t(HH,a);return i6(a,b,c,d).orThunk(function(){return j6(a,b,c,d)}).getOr(W.point(b,c))},JH={repeatLeft:function(a,b,c,d){b=IH(a,b,c);return kt(a,b.element(),ua.sidestep,g.some(b.offset()),d,f6,g.none())},repeatRight:function(a,b,c,d){b=IH(a,b,c);return kt(a,b.element(),ua.sidestep,g.some(b.offset()),d,g6,g.none())}},KH=Ac(Qd,["regex","attempt"]),LH=function(a,b,c,d){return JH.repeatLeft(a,b,c,d)},MH=function(a,b,c,d){return JH.repeatRight(a,b,c,d)},NH=function(a,b,c){var d=
k(!1);if(!a.property().isText(b))return g.none();var e=a.property().getText(b);return c<=e.length?g.some(W.point(b,c)):ua.seekRight(a,b,a.property().isText,d).bind(function(b){return NH(a,b,c-e.length)})},Bg={previousChar:function(a,b){return sn.previous(a,b)},nextChar:function(a,b){return sn.next(a,b)},repeatLeft:LH,repeatRight:MH,expandLeft:function(a,b,c,d){var e=KH(d);return LH(a,b,c,function(a,b,c,d,g){a=g.getOr(d.length);return sn.rfind(d.substring(0,a),e.regex()).fold(function(){return b.kontinue()},
function(a){return e.attempt(b,c,d,a)})})},expandRight:function(a,b,c,d){var e=KH(d);return MH(a,b,c,function(a,b,c,d,g){var f=g.getOr(0);return sn.lfind(d.substring(f),e.regex()).fold(function(){return b.kontinue()},function(a){return e.attempt(b,c,d,f+a)})})},scanRight:NH},Nj=gb(),Cg={previousChar:function(a,b){return Bg.previousChar(a,b)},nextChar:function(a,b){return Bg.nextChar(a,b)},repeatLeft:function(a,b,c){return Bg.repeatLeft(Nj,a,b,c)},repeatRight:function(a,b,c){return Bg.repeatRight(Nj,
a,b,c)},expandLeft:function(a,b,c){return Bg.expandLeft(Nj,a,b,c)},expandRight:function(a,b,c){return Bg.expandRight(Nj,a,b,c)},scanRight:function(a,b){return Bg.scanRight(Nj,a,b)}},Mh=M("before","after"),nt=function(a,b,c,d,e){return tn(c).fold(function(){var c=OH(a,b,d);return Mh(c,e)},function(f){var h=Nh(c,f);return h.length>a?Mh(d,e):lt(b).fold(function(){var b=mt(a-h.length,f,e+h);return Mh(d,b)},function(c){var g=Nh(c,b);return g.length>a-h.length?Mh(d,e+h):nt(a-h.length-g.length,c,f,g+d,e+
h)})})},PH=function(a,b,c,d){return a.finish(W.point(b,d))},QH={regex:function(){return new RegExp(sb.wordchar(),"i")},attempt:PH},RH={regex:function(){return new RegExp(sb.wordbreak(),"i")},attempt:PH},SH=function(a,b){return a.offset()===b.offset()&&P.eq(a.element(),b.element())},TH=function(a){return W.point(a,C.value(a).length)},UH=function(a){return W.point(a,0)},ot=function(a,b,c){var d=function(b){b=c(b);return SH(a,b)?g.none():g.some(b)};return b(a.element(),a.offset(),QH).fold(g.none,d,function(a){return b(a.element(),
a.offset(),RH).fold(g.none,d,function(a){return g.some(a)})})},tn=function(a){return ot(a,Cg.expandRight,TH)},lt=function(a){return ot(a,Cg.expandLeft,UH)},un=function(a,b,c,d,e,f){return a(c).fold(k(d),function(h){var g=e(c,h);return g.length+d.length>b||0===g.length?d:un(a,b,h,f(d,g),e,f)})},mt=function(a,b,c){return un(tn,a,b,c,Nh,function(a,b){return a+b})},OH=function(a,b,c){return un(lt,a,b,c,function(a,b){return Nh(b,a)},function(a,b){return b+a})},Nh=function(a,b){var c=B.defaultView(a.element()).dom();
a=wc.exact(a.element(),a.offset(),b.element(),b.offset());return Na.getAsString(c,a)},VH={beforeAfter:Mh,anchorText:function(a,b){var c=Xa.freefallLtr(b);return tn(c).map(function(b){var d=Nh(c,b);return d+mt(a-d.length,b,"")}).getOr("")},flankingText:function(a,b){if(0===a)return Mh("","");var c=Xa.freefallLtr(b);b=Xa.freefallRtl(b);return nt(a,c,b,"","")},extendRightAndLeft:nt,extendWordsSearch:un,extendWordsRight:mt,extendWordsLeft:OH,wordSearch:ot,wordLeft:lt,wordRight:tn,pointEq:SH,boundaryPointRight:TH,
boundaryPointLeft:UH,textBetweenPoints:Nh,wordSeeker:QH,wordBreakSeeker:RH},WH=function(a,b){try{return a()}catch(c){if(12===c.code)return b();throw c;}},pt=function(a){return L.closest(a,"a[href]")},qt=function(a,b){return pt(a).bind(function(a){return pt(b).filter(function(b){return P.eq(a,b)})})},k6=M("element","innerText","before","after"),rt=function(a,b,c,d){b=Te.isEmpty(b)&&Te.isEmpty(c)&&Te.isEmpty(d)?"#"+m.get(a,"id"):b;return k6(a,b,c,d)},st=function(a){return za.is(a,"a[href]")?[a]:za.all("a[href]",
a)},rd={contentLink:function(a){var b=a.getSelection();return lc.detect(b).fold(function(){return b.bind(function(a){return qt(a.startContainer(),a.endContainer())})},function(a){return g.some(a.image()).bind(pt)})},sharedLink:qt,sharedLinkOrClosest:function(a,b){var c=Xa.toLeaf(a.startContainer(),a.startOffset());a=Xa.toLeaf(a.endContainer(),a.endOffset());return qt(c.element(),a.element()).orThunk(function(){return L.closest(c.element(),"a[href]",b)})},findLinkTargets:function(a){return za.all("h1,h2,h3,h4,h5,h6,div[id],p[id],span[id],a[id],a[name]",
a)},linkTargetText:function(a,b){var c=Mb.get(b).length,d=Gc.deep(b);c=VH.anchorText(c,d);if(la.isBlock(b))return rt(b,c,"","");a=VH.flankingText(Math.max(0,a-c.length),b);return rt(b,c,a.before(),a.after())},linkTargetFastText:function(a,b){var c=Mb.get(b);a=c.length>a?c.substr(0,a):c;return rt(b,a,"","")},all:st,many:function(a){return ia(a,st)},hrefUrl:function(a,b){return WH(function(){return za.all('a[href="'+b+'"]',a)},function(){var c=st(a);return ka(c,function(a){return m.get(a,"href")===
b})})},anchorTarget:function(a,b){return WH(function(){return za.one("#"+b+',a[name="'+b+'"]',a)},function(){var c=B.owner(a).dom();return g.from(c.getElementById(b)).map(p.fromDom).orThunk(function(){var c=za.all("[name]",a);return va(c,function(a){return m.get(a,"id")===b||m.get(a,"name")===b})})})},getAnchorValue:function(a,b){a=a.replace(/[^0-9a-zA-Z$_.+*(),-]/g,"");return 0<a.length?a:b}},vn=["li"],XH=function(a,b){return qc.cata(a,function(a){return!0===b?[]:Cd.wrap(a)},function(a){return[a]},
function(a,b){return"table"===C.name(a)?[a]:Cd.handleContainer(vn,a,b,XH)},function(a){return!0===b?[]:Cd.wrap([a])})},l6={isRootContainer:Mm.isRootOrContainer,extract:function(a){return XH(a,!1)},isCapable:function(a){return xi.isBlock(a)||V(vn,C.name(a))},canUse:function(a){return la.isFormatting(a)||V(vn,C.name(a))},quasi:t(Cd.handleRoot,vn),ascend:aa},m6=function(a,b){return L.closest(b,'[dir="rtl"],[dir="ltr"]').filter(a).isSome()},YH=function(a,b,c){var d=yQ(b,c),e=function(a){d.set(a);v.reflow(a)},
f=function(a){return we.getDirection(a)===c};return{run:function(a,b,c,d,f){return vh.applyOn(a,l6,b,c,d,f,function(a){A(a,e);return a})},query:function(a,b){return zE.bothMatch(a,b,t(m6,f))},name:k(a)}},n6=YH("DirRtl","dir","rtl"),o6=YH("DirLtr","dir","ltr"),wn={dirLtr:k(o6),dirRtl:k(n6)},ZH=function(a){return function(b){var c=function(c,e,f,h){return a.run(b.content().isRoot,c,e,f,h)};Pb.cata(b.selections().get(),u,Gm.multiple(b.content(),b.undo(),c),Gm.single(b.content(),b.undo(),c,vj,uj));setTimeout(function(){b.content().uiChanged()},
0)}},ow={dirRtl:ZH(wn.dirRtl()),dirLtr:ZH(wn.dirLtr())},p6=M("ltrdir","rtldir"),$H=function(a,b){return b.query(a.startContainer(),a.endContainer())?wa.on(!0):wa.off()},q6=function(a){return L.closest(a.startContainer(),"[dir]").isSome()||L.closest(a.endContainer(),"[dir]").isSome()},nw={readDir:function(a){return a.getSelection().filter(q6).map(function(a){return p6($H(a,wn.dirLtr()),$H(a,wn.dirRtl()))})}},r6=sa.generate([{blob:["id","imageresult","objurl"]},{url:["id","url","raw"]}]),Bc=ra(r6,{cata:function(a,
b,c){return a.fold(b,c)}}),Hc={create:pw,clone:function(a){var b=pw(a.width,a.height);rw(b).drawImage(a,0,0);return b},resize:qw,get2dContext:rw,get3dContext:function(a){var b=null;try{b=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(c){}b||(b=null);return b}},Tg={getWidth:function(a){return a.naturalWidth||a.width},getHeight:function(a){return a.naturalHeight||a.height}},s6=function(){function a(a,b){return function(){a.apply(b,arguments)}}function b(a){var b=this;null===this._state?
this._deferreds.push(a):k(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)(b._state?a.resolve:a.reject)(b._value);else{try{var d=c(b._value)}catch(Qa){a.reject(Qa);return}a.resolve(d)}})}function c(b){try{if(b===this)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"===typeof b||"function"===typeof b)){var f=b.then;if("function"===typeof f){h(a(f,b),a(c,this),a(d,this));return}}this._state=!0;this._value=b;e.call(this)}catch(I){d.call(this,I)}}function d(a){this._state=
!1;this._value=a;e.call(this)}function e(){for(var a=0,c=this._deferreds.length;a<c;a++)b.call(this,this._deferreds[a]);this._deferreds=null}function f(a,b,c,d){this.onFulfilled="function"===typeof a?a:null;this.onRejected="function"===typeof b?b:null;this.resolve=c;this.reject=d}function h(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(Qa){d||(d=!0,c(Qa))}}var g=function(b){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");
if("function"!==typeof b)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];h(b,a(c,this),a(d,this))},k=g.immediateFn||"function"===typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},m=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};g.prototype["catch"]=function(a){return this.then(null,a)};g.prototype.then=function(a,c){var d=this;return new g(function(e,h){b.call(d,new f(a,c,e,h))})};g.all=function(){var a=Array.prototype.slice.call(1===
arguments.length&&m(arguments[0])?arguments[0]:arguments);return new g(function(b,c){function d(f,h){try{if(h&&("object"===typeof h||"function"===typeof h)){var g=h.then;if("function"===typeof g){g.call(h,function(a){d(f,a)},c);return}}a[f]=h;0===--e&&b(a)}catch(TO){c(TO)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})};g.resolve=function(a){return a&&"object"===typeof a&&a.constructor===g?a:new g(function(b){b(a)})};g.reject=function(a){return new g(function(b,c){c(a)})};
g.race=function(a){return new g(function(b,c){for(var d=0,e=a.length;d<e;d++)a[d].then(b,c)})};return g},sd=window.Promise?window.Promise:s6(),Ok={atob:function(a){return vc.getOrDie("atob")(a)},requestAnimationFrame:function(a){vc.getOrDie("requestAnimationFrame")(a)}},Wc={blobToImage:uw,imageToBlob:function(a){a=a.src;return 0===a.indexOf("data:")?ep(a):vw(a)},blobToArrayBuffer:function(a){return new sd(function(b){var c=new dp;c.onloadend=function(){b(c.result)};c.readAsArrayBuffer(a)})},blobToDataUri:xw,
blobToBase64:function(a){return xw(a).then(function(a){return a.split(",")[1]})},dataUriToBlobSync:ww,canvasToBlob:function(a,b,c){b=b||"image/png";return HTMLCanvasElement.prototype.toBlob?new sd(function(d){a.toBlob(function(a){d(a)},b,c)}):ep(a.toDataURL(b,c))},canvasToDataURL:function(a,b,c){b=b||"image/png";return a.then(function(a){return a.toDataURL(b,c)})},blobToCanvas:function(a){return uw(a).then(function(a){URL.revokeObjectURL(a.src);var b=Hc.create(Tg.getWidth(a),Tg.getHeight(a));Hc.get2dContext(b).drawImage(a,
0,0);return b})},uriToBlob:function(a){return 0===a.indexOf("blob:")?vw(a):0===a.indexOf("data:")?ep(a):null}},Fi={blobToImage:function(a){return Wc.blobToImage(a)},imageToBlob:function(a){return Wc.imageToBlob(a)},blobToDataUri:function(a){return Wc.blobToDataUri(a)},blobToBase64:function(a){return Wc.blobToBase64(a)},dataUriToBlobSync:function(a){return Wc.dataUriToBlobSync(a)},uriToBlob:function(a){return g.from(Wc.uriToBlob(a))}},Yd={fromBlob:yw,fromCanvas:function(a,b){return Wc.canvasToBlob(a,
b).then(function(b){return fp(sd.resolve(a),b,a.toDataURL())})},fromImage:function(a){return Wc.imageToBlob(a).then(function(a){return yw(a)})},fromBlobAndUrlSync:function(a,b){return fp(Wc.blobToCanvas(a),a,b)}},aI=function(a){return a.toBlob()},Lc={blobToImageResult:function(a){return Yd.fromBlob(a)},fromBlobAndUrlSync:function(a,b){return Yd.fromBlobAndUrlSync(a,b)},imageToImageResult:function(a){return Yd.fromImage(a)},imageResultToBlob:function(a,b,c){return void 0===b&&void 0===c?aI(a):a.toAdjustedBlob(b,
c)},imageResultToOriginalBlob:aI,imageResultToDataURL:function(a){return a.toDataURL()}},wf={createObjectURL:function(a){return vc.getOrDie("URL").createObjectURL(a)},revokeObjectURL:function(a){vc.getOrDie("URL").revokeObjectURL(a)}},Oj=ba.detect(),cI=function(a){var b=wf.createObjectURL(a);return bI(a,b)},bI=function(a,b){return Ba.nu(function(c){Fi.blobToDataUri(a).then(function(d){d=Lc.fromBlobAndUrlSync(a,d);var e=Za("image");d=Bc.blob(e,d,b);c(d)})})},t6=function(a){return 1===a.length&&V(a,
"Files")},u6=function(a){return!V(a,"text/_moz_htmlcontext")},v6=function(a){return V(a,"Files")},w6=function(a){return!0},Xd={multiple:function(a){return 0===a.length?Ba.pure([]):ae(a,cI)},toFiles:function(a){return a.raw().target.files||a.raw().dataTransfer.files},isFiles:Oj.browser.isChrome()||Oj.browser.isSafari()||Oj.browser.isOpera()?v6:Oj.browser.isFirefox()?u6:Oj.browser.isIE()?t6:w6,fromImages:function(a){a=F(a,function(a){var b=Za("image");return Bc.url(b,m.get(a,"src"),a)});return Ba.pure(a)},
single:cI,singleWithUrl:bI},tx={register:function(a,b,c){var d=G.create({dragover:q(["original"]),dragleave:q(["original"]),drop:q(["original"]),dragndropimages:q(["original","files"]),dragndrophtml:q(["original"])});b.each(function(b){var c=function(c){return function(){c(a,b)}};d.registry.dragover.bind(c(n.add));d.registry.dragleave.bind(c(n.remove));d.registry.drop.bind(c(n.remove))});var e=J.bind(a,"dragover",function(a){!0===c?(a.prevent(),d.trigger.dragover(a)):a.kill()}),f=J.bind(a,"dragleave",
d.trigger.dragleave),h=J.bind(a,"drop",function(a){d.trigger.drop(a);a.kill();if(Xd.isFiles(a.raw().dataTransfer.types)){var b=Xd.toFiles(a);d.trigger.dragndropimages(a,b)}else V(a.raw().dataTransfer.types,"text/html")&&d.trigger.dragndrophtml(a)});return{destroy:function(){e.unbind();f.unbind();h.unbind()},events:d.registry}}},BQ={forImages:function(a,b,c){a=tx.register(a,b,c);var d=G.create({dragover:q(["original"]),dragleave:q(["original"]),drop:q(["original"]),dragndropimages:q(["assets","x",
"y"]),dragndrophtml:q(["html","x","y"])});b=function(a,b){a.bind(function(a){b(a.original())})};a.events.dragndropimages.bind(function(a){var b=a.original();Xd.multiple(a.files()).get(function(a){d.trigger.dragndropimages(a,b.x(),b.y())})});a.events.dragndrophtml.bind(function(a){a=a.original();var b=a.raw().dataTransfer.getData("text/html");d.trigger.dragndrophtml(b,a.x(),a.y())});b(a.events.dragover,d.trigger.dragover);b(a.events.dragleave,d.trigger.dragleave);b(a.events.drop,d.trigger.drop);return{destroy:a.destroy,
events:d.registry}}},x6=Db(Ba.pure,N.value),y6=Db(Ba.pure,N.error),Ce={pure:x6,failed:y6,foldSync:function(a,b,c){return a.map(function(a){return a.fold(b,c)})},bindSync:function(a,b){return a.map(function(a){return a.bind(b)})},bindAsync:function(a,b){return a.bind(function(a){return a.bind(b)})},mapSync:function(a,b){return a.map(function(a){return a.map(b)})},handle:function(a,b,c){return a.get(function(a){return a.fold(b,c)})}},si={now:function(){return(new Date).getTime()}},dI=sa.generate([{strict:[]},
{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),xn=dI.strict;sa.generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var eI=function(a){var b=[],c=[];A(a,function(a){a.fold(function(a){b.push(a)},function(a){c.push(a)})});return{errors:b,values:c}},fI=function(a){return Db(N.error,Kb)(a)},gI={consolidateObj:function(a,b){a=eI(a);return 0<
a.errors.length?fI(a.errors):N.value(cb.apply(void 0,[b].concat(a.values)))},consolidateArr:function(a){a=eI(a);return 0<a.errors.length?fI(a.errors):N.value(a.values)}},aU=function(a,b){var c={};A(a,function(a){c[a[b]]=a});return c},z6=function(a){return function(b){return b.hasOwnProperty(a)?g.from(b[a]):g.none()}},Pj=function(a,b){return z6(b)(a)},Qj=function(a,b){var c={};c[a]=b;return c},tt=sa.generate([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},
{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),hI=sa.generate([{field:["name","presence","type"]},{state:["name"]}]),yd={parse:function(a){return vc.getOrDie("JSON").parse(a)},stringify:function(a,b,c){return vc.getOrDie("JSON").stringify(a,b,c)}},iI=function(a){return Zb(a)&&100<jb(a).length?" removed due to size":yd.stringify(a,null,2)},A6=function(a){a=10<a.length?a.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):
a;return F(a,function(a){return"Failed path: ("+a.path.join(" > ")+")\n"+a.getErrorInfo()})},jI=function(a,b){return N.error([{path:a,getErrorInfo:b}])},B6=function(a,b,c){return jI(a,function(){return'Could not find valid *strict* value for "'+b+'" in '+iI(c)})},C6=function(a,b){return jI(a,function(){return b})},D6=sa.generate([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),E6=function(a,b,c){return Pj(b,c).fold(function(){return B6(a,c,b)},N.value)},kI=function(a,b,
c){b=Pj(a,b).fold(function(){return c(a)},aa);return N.value(b)},F6=function(a,b,c){b=Pj(a,b).map(function(b){return!0===b?c(a):b});return N.value(b)},G6=function(a,b,c,d){return c.fold(function(c,f,h,l){var e=function(b){return l.extract(a.concat([c]),d,b).map(function(a){return Qj(f,d(a))})},m=function(b){return b.fold(function(){var a=Qj(f,d(g.none()));return N.value(a)},function(b){return l.extract(a.concat([c]),d,b).map(function(a){return Qj(f,d(g.some(a)))})})};return function(){return h.fold(function(){return E6(a,
b,c).bind(e)},function(a){return kI(b,c,a).bind(e)},function(){return N.value(Pj(b,c)).bind(m)},function(a){return F6(b,c,a).bind(m)},function(a){var d=a(b);return kI(b,c,k({})).map(function(a){return cb(d,a)}).bind(e)})}()},function(a,c){c=c(b);return N.value(Qj(a,d(c)))})},H6=function(a,b,c,d){c=F(c,function(c){return G6(a,b,c,d)});return gI.consolidateObj(c,{})},lI=function(a){return{extract:function(b,c,d){return a(d,c).fold(function(a){return C6(b,a)},N.value)},toString:function(){return"val"},
toDsl:function(){return tt.itemOf(a)}}},Mf=function(a){return{extract:function(b,c,d){return H6(b,d,a,c)},toString:function(){return"obj{\n"+F(a,function(a){return a.fold(function(a,b,e,f){return a+" -> "+f.toString()},function(a,b){return"state("+a+")"})}).join("\n")+"}"},toDsl:function(){return tt.objOf(F(a,function(a){return a.fold(function(a,b,e,f){return hI.field(a,e,f)},function(a,b){return hI.state(a)})}))}}},mI=k(lI(N.value)),I6=Db(function(a){return{extract:function(b,c,d){d=F(d,function(d,
f){return a.extract(b.concat(["["+f+"]"]),c,d)});return gI.consolidateArr(d)},toString:function(){return"array("+a.toString()+")"},toDsl:function(){return tt.arrOf(a)}}},Mf),Rj=D6.field,ut=function(a,b,c,d){return b.extract([a],c,d).fold(function(a){return N.error({input:d,errors:a})},N.value)},nI=function(a,b,c){return ut(a,b,k,c)},oI=function(a){return a.fold(function(a){throw Error(vt(a));},aa)},vt=function(a){return"Errors: \n"+A6(a.errors)+"\n\nInput object: "+iI(a.input)},yn=sa.generate([{get:[]},
{post:[]},{put:[]},{del:[]}]),zn={get:yn.get,post:yn.post,put:yn.put,del:yn.del},J6={generate:function(a,b,c,d){a=a.bind(function(a){return a.match({file:function(){return g.none()},form:function(){return g.some("application/x-www-form-urlencoded; charset=UTF-8")},json:function(){return g.some("application/json")},plain:function(){return g.some("text/plain")},html:function(){return g.some("text/html")}})});c=c.match({none:g.none,xhr:k(g.some(!0))});var e=b.match({json:g.none,blob:k(g.some("blob")),
xml:k(g.some("document")),html:k(g.some("document")),text:k(g.some("text"))});b=b.match({json:k("application/json, text/javascript"),blob:k("application/octet-stream"),text:k("text/plain"),html:k("text/html"),xml:k("application/xml, text/xml")})+", */*; q=0.01";return{contentType:k(a),credentials:k(c),responseType:k(e),accept:k(b),headers:k(d)}}},K6={mutate:function(a,b){b.contentType().each(function(b){a.setRequestHeader("Content-Type",b)});var c=b.accept();a.setRequestHeader("Accept",c);b.credentials().each(function(b){a.withCredentials=
b});b.responseType().each(function(b){a.responseType=b});b=b.headers();Ra(b,function(b,c){ta(c)||ta(b)?a.setRequestHeader(c,b):console.error("Request header data was not a string: ",c," -> ",b)})}},pI={parse:function(a){try{var b=yd.parse(a);return N.value(b)}catch(c){return N.error("Response was not JSON")}}},qI=ya(["message","status","responseText"],[]),rI={handle:function(a,b,c){var d=function(){return Ba.pure(c.response)};return b.match({json:function(){return pI.parse(c.response).fold(d,Ba.pure)},
blob:function(){return g.from(c.response).map(CQ).getOr(Ba.pure("no response content"))},text:d,html:d,xml:d}).map(function(b){return qI({message:0===c.status?"Unknown HTTP error (possible cross-domain request)":'Could not load url "'+a+'": '+c.statusText,status:c.status,responseText:b})})},nu:qI},L6=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a},me=function(a){return L6({},a,{bindFuture:function(b){return me(a.bind(function(c){return c.fold(function(){return a},
function(a){return b(a)})}))},bindResult:function(b){return me(a.map(function(a){return a.bind(b)}))},mapResult:function(b){return me(a.map(function(a){return a.map(b)}))},foldResult:function(b,c){return a.map(function(a){return a.fold(b,c)})},withTimeout:function(b,c){return me(Ba.nu(function(d){var e=!1,f=window.setTimeout(function(){e=!0;d(N.error(c()))},b);a.get(function(a){e||(window.clearTimeout(f),d(a))})}))}})},sI=function(a){return me(Ba.nu(a))},tI=function(a){return me(Ba.pure(N.value(a)))},
Sj={nu:sI,wrap:me,pure:tI,value:tI,error:function(a){return me(Ba.pure(N.error(a)))},fromResult:function(a){return me(Ba.pure(a))},fromFuture:function(a){return me(a.map(N.value))},fromPromise:function(a){return sI(function(b){a.then(function(a){b(N.value(a))},function(a){b(N.error(a))})})}},M6={validate:function(a,b){var c=function(){return Sj.pure(b.response)};return a.match({json:function(){return pI.parse(b.response).fold(function(a){return Sj.error(rI.nu({message:a,status:b.status,responseText:b.responseText}))},
Sj.pure)},blob:c,text:c,html:c,xml:function(a,b){return function(){return b().bindResult(function(b){return null===b?N.error(a):N.value(b)})}}("Invalid XML document",c)})}},An=function(a,b,c,d,e,f){var h=void 0!==f?f:{};return Sj.nu(function(f){var g=b.match({get:k("get"),put:k("put"),post:k("post"),del:k("delete")}),l=new (vc.getOrDie("XMLHttpRequest"));l.open(g,a,!0);g=J6.generate(c,d,e,h);K6.mutate(l,g);var m=function(){rI.handle(a,d,l).get(function(a){f(N.error(a))})};l.onload=function(){0!==
l.status||Ab(a,"file:")?100>l.status||400<=l.status?m():M6.validate(d,l).get(f):m()};l.onerror=m;c.fold(function(){l.send()},function(a){a=a.match({file:aa,form:aa,json:yd.stringify,plain:aa,html:aa});l.send(a)})}).toLazy()},Zd={get:function(a,b,c,d){var e=zn.get();return An(a,e,g.none(),b,c,d)},post:function(a,b,c,d,e){var f=zn.post();return An(a,f,g.some(b),c,d,e)},put:function(a,b,c,d,e){var f=zn.put();return An(a,f,g.some(b),c,d,e)},del:function(a,b,c,d){var e=zn.del();return An(a,e,g.none(),
b,c,d)}},Tj=sa.generate([{file:["data"]},{form:["data"]},{json:["data"]},{plain:["data"]},{html:["data"]}]),Ny={file:Tj.file,form:Tj.form,json:Tj.json,plain:Tj.plain,html:Tj.html},uI=sa.generate([{none:[]},{xhr:[]}]),Od={none:uI.none,xhr:uI.xhr},Uj=sa.generate([{json:[]},{blob:[]},{text:[]},{html:[]},{xml:[]}]),$d={json:Uj.json,blob:Uj.blob,text:Uj.text,html:Uj.html,xml:Uj.xml,cata:function(a,b,c,d,e,f){return a.match({json:b,blob:c,text:d,html:e,xml:f})}},vI=function(a,b){var c=-1===a.indexOf("?")?
"?":"&";return b?a+c+"apiKey="+encodeURIComponent(b):a},wI=function(a){return a.hasOwnProperty("tiny-api-key")?a["tiny-api-key"]:a.hasOwnProperty("tinymce-api-key")?a["tinymce-api-key"]:a["textbox-api-key"]},xI=function(a){return a.fold(function(a){var b=a.responseText();a=Zb(b)?b:a.message();return N.error(a)},N.value)},Qk={get:function(a,b,c,d){var e=wI(d);return{execute:function(f){f=oI(ut(a+".ajax.service.get",b,aa,f));f=Wb(f,function(a){return fq(a)?String(a):a});f=vI(Ly(c,f),e);return Zd.get(f,
$d.json(),Od.xhr(),d).map(xI)}}},post:function(a,b,c,d){var e=wI(d);return{execute:function(f){f=oI(ut(a+".ajax.service.post",b,aa,f));return Zd.post(vI(c,e),Ny.json(f),$d.json(),Od.xhr(),d).map(xI)}}}},N6={partition:function(a,b,c,d,e){return!0===e?{known:{},unknown:c}:hb(c,function(c,e){var f=d(e);return a(b,f).fold(function(){return{known:c.known,unknown:c.unknown.concat([e])}},function(a){a=Qj(f,a);return{known:ra(c.known,a),unknown:c.unknown}})},{known:{},unknown:[]})}},O6=function(a,b,c,d,e,
f,h){a=a(d,h);return Ce.mapSync(a,function(a){a=e(a);Ra(a,function(a,c){b.set(c,a,f)});return cb(c,a)})},Rk={single:function(a,b,c,d,e){return(!0===e?g.none():b.get(d,c)).fold(function(){return a(c,e).map(function(a){return a.map(function(a){b.set(c,a,d);return a})})},function(a){return Ce.pure(a)})},multiple:function(a,b,c,d,e,f,h){c=N6.partition(b.get,f,c,e,h);return 0===c.unknown.length?Ce.pure(c.known):O6(a,b,c.known,c.unknown,d,f,h)}},af=function(a){return Rj(a,a,xn(),mI())},yI=function(a,b){return Rj(a,
a,dI.defaultedThunk(k(b)),mI())},Bn=function(a){return"["+a.join(", ")+"]"},zI=["iframely","oembed","fallback"],Cn=function(a,b,c){return Va(b,function(b){return V(a,b)})?N.error("Embed response source: "+Bn(a)+" contains more than one of "+Bn(zI)):N.value(c)},P6={iframely:k("iframely"),oembed:k("oembed"),fallback:k("fallback"),identify:function(a){return V(a,"iframely")?Cn(a,["oembed","fallback","wikipedia"],"iframely"):V(a,"oembed")?Cn(a,["iframely","fallback","wikipedia"],"oembed"):V(a,"fallback")?
Cn(a,["iframely","oembed","wikipedia"],"fallback"):V(a,"wikipedia")?Cn(a,["iframely","oembed","fallback"],"wikipedia"):N.error("Embed response source: "+Bn(a)+" did not contain any of: "+Bn(zI))}},Q6=Mf([af("url"),af("maxWidth"),yI("fresh",!1)]),R6=Mf([af("status_code"),af("sub_code"),af("msg")]),S6=Mf([af("html"),function(a,b){return Rj(a,a,xn(),Mf(b))}("rels",[Rj("source","source",xn(),function(a){return lI(function(b){return a(b)})}(function(a){return Gb(a)?P6.identify(a):N.error("Sources was not an array: "+
a)}))])]),gp={requestOne:k(Q6),responseFailed:k(R6),responseSucceeded:k(S6)},zw={failed:function(a){return nI("EmbedResponse.failure",gp.responseFailed(),a).fold(function(a){return N.error({code:k(600),subcode:k(0),msg:k(vt(a))})},function(a){return N.error({code:a.status_code,subcode:a.sub_code,msg:a.msg})})},success:function(a){return nI("EmbedResponse.success",gp.responseSucceeded(),a).fold(function(a){return N.error({code:k(601),subcode:k(0),msg:k(vt(a))})},function(a){return N.value({recommended:k({html:a.html,
source:a.rels().source})})})}},bf=z.resolve("embed-checking"),hp={configure:function(a){a.add(a.input(),bf,Ka.removeClass(bf));a.add(a.output(),bf,Ka.removeClass(bf));a.add(a.history(),bf,Ka.removeClass(bf));a.add(a.internal(),bf,Ka.removeClass(bf))},embedChecking:k(bf)},wt=function(){return w.translate("link.anchor.top")},xt=function(){return w.translate("link.anchor.bottom")},AI=function(){var a={};a[wt().toLowerCase()]="top";a[xt().toLowerCase()]="bottom";return a},lb={bookmarkDataAttr:k("data-textbox-bookmark"),
bookmarkAnchorDataAttr:k("data-textbox-bookmark-anchor"),bookmarkBookmarkDataAttr:k("data-textbox-user-bookmark"),topAnchorUrl:wt,bottomAnchorUrl:xt,top:k("top"),bottom:k("bottom"),reservedUrls:AI,isReservedUrl:function(a){return AI().hasOwnProperty(a.toLowerCase())},getReservedUrl:function(a){var b={};b.top=wt();b.bottom=xt();return b[a.toLowerCase()]}},T6={setCss:function(a,b,c){a.dom().styleSheet?a.dom().styleSheet.cssText=b:y.append(a,c)}},U6={escape:function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,
"\\$&")}},BI=function(a,b,c){b=new RegExp("url\\(\\s*['\"]?"+U6.escape(b)+"(.*?)['\"]?\\s*\\)","g");return a.replace(b,'url("'+c+'$1")')},V6={replace:BI,replaceMany:function(a,b){var c=a;Ra(b,function(a,b){console.log("rm css",c);c=BI(c,b,a)});return c}},CI={stylesheets:function(a){a=a.dom().styleSheets;return Array.prototype.slice.call(a)},inject:function(a,b,c){var d=p.fromTag("style",c.dom());m.set(d,"type","text/css");a=void 0===b?a:V6.replaceMany(a,b);T6.setCss(d,a,p.fromText(a,c.dom()));c=L.descendant(c,
"head").getOrDie();y.append(c,d)}},W6=M("selector","style","raw"),yt=function(a){return ia(a.cssRules,function(a){if(a.type===CSSRule.IMPORT_RULE)return yt(a.styleSheet);if(a.type===CSSRule.STYLE_RULE){var b=a.selectorText,d=a.style.cssText;if(void 0===d)throw"WARNING: Browser does not support cssText property";return[W6(b,d,a.style)]}return[]})},DI={extract:yt,extractAll:function(a){return ia(a,yt)}},EI={},FI={exports:EI};(function(a,b,c,d){(function(d){"object"===typeof b&&"undefined"!==typeof c?
c.exports=d():"function"===typeof a&&a.amd?a([],d):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).EphoxContactWrapper=d()})(function(){return function(){function a(b,c,e){function f(g,k){if(!c[g]){if(!b[g]){var l="function"==typeof d&&d;if(!k&&l)return l(g,!0);if(h)return h(g,!0);k=Error("Cannot find module '"+g+"'");throw k.code="MODULE_NOT_FOUND",k;}k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){return f(b[g][1][a]||a)},k,k.exports,
a,b,c,e)}return c[g].exports}for(var h="function"==typeof d&&d,g=0;g<e.length;g++)f(e[g]);return f}return a}()({1:[function(a,b,c){a=function(){var a=function(a){var b=a,c={a:0,b:0,c:0},d=[];var e=function(e,f){var h;if(e.test(b)){e=b.match(e);var g=0;for(h=e.length;g<h;g+=1){c[f]+=1;var k=e[g];var l=b.indexOf(k);var m=k.length;d.push({selector:a.substr(l,m),type:f,index:l,length:m});b=b.replace(k,Array(m+1).join(" "))}}};(function(){var a=function(a){var c;if(a.test(b)){a=b.match(a);var d=0;for(c=
a.length;d<c;d+=1){var e=a[d];b=b.replace(e,Array(e.length+1).join("A"))}}};a(/\\[0-9A-Fa-f]{6}\s?/g);a(/\\[0-9A-Fa-f]{1,5}\s/g);a(/\\./g)})();(function(){var a=/:not\(([^\)]*)\)/g;a.test(b)&&(b=b.replace(a,"     $1 "))})();(function(){var a=/{[^]*/gm,c;if(a.test(b)){a=b.match(a);var d=0;for(c=a.length;d<c;d+=1){var e=a[d];b=b.replace(e,Array(e.length+1).join(" "))}}})();e(/(\[[^\]]+\])/g,"b");e(/(#[^#\s\+>~\.\[:]+)/g,"a");e(/(\.[^\s\+>~\.\[:]+)/g,"b");e(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,
"c");e(/(:[\w-]+\([^\)]*\))/gi,"b");e(/(:[^\s\+>~\.\[:]+)/g,"b");b=b.replace(/[\*\s\+>~]/g," ");b=b.replace(/[#\.]/g," ");e(/([^\s\+>~\.\[:]+)/g,"c");d.sort(function(a,b){return a.index-b.index});return{selector:a,specificity:"0,"+c.a.toString()+","+c.b.toString()+","+c.c.toString(),specificityArray:[0,c.a,c.b,c.c],parts:d}};return{calculate:function(b){var c,d=[];b=b.split(",");var e=0;for(c=b.length;e<c;e+=1){var f=b[e];0<f.length&&d.push(a(f))}return d},compare:function(b,c){var d;if("string"===
typeof b){if(-1!==b.indexOf(","))throw"Invalid CSS selector";b=a(b).specificityArray}else if(Array.isArray(b)){if(4!==b.filter(function(a){return"number"===typeof a}).length)throw"Invalid specificity array";}else throw"Invalid CSS selector or specificity array";if("string"===typeof c){if(-1!==c.indexOf(","))throw"Invalid CSS selector";c=a(c).specificityArray}else if(Array.isArray(c)){if(4!==c.filter(function(a){return"number"===typeof a}).length)throw"Invalid specificity array";}else throw"Invalid CSS selector or specificity array";
for(d=0;4>d;d+=1){if(b[d]<c[d])return-1;if(b[d]>c[d])return 1}return 0}}}();"undefined"!==typeof c&&(c.calculate=a.calculate,c.compare=a.compare)},{}],2:[function(a,b,c){a=a("specificity");b.exports={boltExport:a}},{specificity:1}]},{},[2])(2)})})(void 0,EI,FI,void 0);var X6=FI.exports.boltExport,GI=M("selector","raw"),Y6=function(a,b){var c={};A(a,function(d){if(void 0!==a[d]){var e=b.dom().style;V(e,d)||(c[d]=a[d])}});return c},Z6=function(a,b){b=ia(b,function(b){var c=ca.descendants(a,b.selector());
A(c,function(a){var c=Y6(b.raw(),a);v.setAll(a,c)});return c});A(b,function(a){m.remove(a,"class")})},HI=function(a,b){var c=function(a){return-1!==a.selector().indexOf(",")},d=ia(ka(a,c),function(a){var b=a.selector().split(",");return F(b,function(b){b=b.trim();return GI(b,a.raw())})});a=ka(a,function(a){return!c(a)}).concat(d);a.sort(function(a,b){return X6.compare(a.selector(),b.selector())}).reverse();Z6(b,a)},II={inlineStyles:function(a,b,c){a=CI.stylesheets(a);a=DI.extractAll(a).map(function(a){var b=
a.selector();b=c.hasOwnProperty(b)?c[b]:b;return GI(b,a.raw())});HI(a,b)},inlinePrefixedStyles:function(a,b,c){a=CI.stylesheets(a);a=DI.extractAll(a);a=ka(a,function(a){return Ab(a.selector(),c)});HI(a,b)}},Aw={inlineStyles:function(a,b,c){II.inlineStyles(a,b,c)},inlinePrefixedStyles:function(a,b,c){II.inlinePrefixedStyles(a,b,c)}},Xk={handle:function(a,b){return J.bind(a,"click",b)}},$6={editor:function(a,b){b=t(w.translate,b?"aria.label.fullscreen":"aria.label.editor");return a.fold(aa,b)}},a7=
function(a,b){var c=setInterval(b,500);return function(){clearInterval(c)}},b7=function(a,b){var c=new window.MutationObserver(b);c.observe(B.owner(a).dom(),{attributes:!0,subtree:!0,childList:!0,attributeFilter:["style","class"]});return function(){c.disconnect()}},c7=void 0!==window.MutationObserver&&null!==window.MutationObserver?b7:a7,Mw={onShow:function(a,b){if(kc.isVisible(a))return Ok.requestAnimationFrame(b),u;var c=De(function(){kc.isVisible(a)&&(d(),Ok.requestAnimationFrame(b))},100),d=
c7(a,c.throttle);return d}},Vj=[],zt=function(a){return Ta(Vj,function(b){return P.eq(b.element,a)}).getOr(-1)},At={begin:function(a,b){-1===zt(a)&&(b=b(),Vj.push({element:a,unbind:b}))},query:function(a){a=zt(a);return-1===a?g.none():g.some(Vj[a])},end:function(a){a=zt(a);if(-1!==a){var b=Vj[a];Vj.splice(a,1);b.unbind()}}},d7=function(a){return{element:a,handlers:[],lastWidth:Aa.get(a),lastHeight:pa.get(a)}},cf=[],JI=function(a){return Ta(cf,function(b){return P.eq(b.element,a)}).getOr(-1)},KI=function(a){var b=
Aa.get(a.element),c=pa.get(a.element);if(b!==a.lastWidth||c!==a.lastHeight)a.lastWidth=b,a.lastHeight=c,A(a.handlers,pb)},LI=function(a){var b=a.element;kc.isVisible(b)?KI(a):At.begin(b,function(){return Mw.onShow(b,function(){At.end(b);KI(a)})})},Bt=!1,e7=function(){Bt=!1;A(cf,LI)},f7=function(){Bt||(Bt=!0,Ok.requestAnimationFrame(e7))},Dn=g.none(),g7=function(){Dn.each(function(a){a.unbind();Dn=g.none()})},Cw={bind:function(a,b){var c=va(cf,function(b){return P.eq(b.element,a)}).getOr(void 0);void 0===
c&&(c=d7(a),cf.push(c));c.handlers.push(b);Dn.isNone()&&(Dn=g.some(J.bind(p.fromDom(window),"resize",f7)));setTimeout(function(){-1!==JI(c.element)&&LI(c)},100)},unbind:function(a,b){At.end(a);a=JI(a);-1!==a&&(b=zc(cf[a].handlers,b),b.isNone()||(cf[a].handlers.splice(b.getOr(0),1),0===cf[a].handlers.length&&cf.splice(a,1),0===cf.length&&g7()))}},Dw=ba.detect(),h7=k(!1),Tk=ba.detect(),MI=Tk.browser.isIE()||Tk.browser.isEdge()?2:5,Fw=sa.generate([{above:["element"]},{below:["element"]}]),NI=function(a,
b,c){return function(b){b=Na.forElement(a,b);b=wc.exactFromRange(b);return Na.getBounds(a,b).fold(h7,c)}},GQ=function(a,b){return NI(a,b,function(a){return b>a.top()+a.height()-MI})},HQ=function(a,b){return NI(a,b,function(a){return b<a.top()+MI})},Qb={clearAll:function(a){Na.clear(a)},get:function(a){return Na.getExact(a).map(function(a){return Ec(a.start(),a.soffset(),a.finish(),a.foffset())})},set:function(a,b){Na.setExact(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())},setExact:function(a,
b,c,d,e){Na.setExact(a,b,c,d,e)},setRelative:function(a,b,c){Na.setRelative(a,b,c)},replace:function(a,b){Na.get(a).each(function(c){Na.replace(a,c,b)})}},IQ=function(a,b){var c=t(P.eq,fa.body()),d=b.join(", ");return oc(a,function(a){return Da.ancestor(a,function(a){return za.is(a,d)},c)}).isSome()},i7=function(a,b){return{toEditor:a,toOld:t(Y.focus,b),isSet:function(){return Y.active().exists(function(a){return P.eq(a,b)})}}},OI=function(a,b,c,d){d=d.dom().activeElement;return a()?{toEditor:b,toOld:u,
isSet:k(!0)}:void 0===d||null===d?{toEditor:c,toOld:u,isSet:k(!1)}:i7(c,p.fromDom(d))},ip={build:OI,toEditor:function(a,b,c,d){OI(a,b,c,d).toEditor()}},j7=function(a){return tb.closest(a.startContainer(),'[contenteditable="false"]')&&tb.closest(a.endContainer(),'[contenteditable="false"]')},Iw={focus:function(a,b,c){b=b().filter(j7);b.each(function(b){L.closest(b.endContainer(),'[contenteditable="false"]').each(function(b){Qb.setRelative(a.win(),ha.after(b),ha.after(b))})});a.focus();b.each(function(a){c(a.startContainer(),
a.startOffset(),a.endContainer(),a.endOffset())})}},LQ=ba.detect(),k7=M("doc","href"),NQ=function(){var a=[],b=function(a,b){return function(c){return P.eq(a,c.doc())&&b===c.href()}};return{addLinkIfMissing:function(c,d){Va(a,b(c,d))||(a.push(k7(c,d)),Cz.addStylesheet(d,c))}}}(),Jw=function(){console.log("The previous selection could not be restored. Defaulting to the current selection.")},Ct=ba.detect(),l7=Ct.deviceType.isiOS()?UQ:Ct.deviceType.isAndroid()?SQ:TQ,XQ={get:function(a){return l7(a,Ct)}},
m7=function(a){a=a.dom();try{var b=a.contentWindow?a.contentWindow.document:a.contentDocument;return void 0!==b&&null!==b?g.some(p.fromDom(b)):g.none()}catch(c){return console.log("Error reading iframe: ",a),console.log("Error was: "+c),g.none()}},Kw={doc:function(a){return m7(a).fold(function(){return a},function(a){return a})}},WQ=ba.detect(),ZQ={resolve:Hb.create("ephox-hare").resolve},Lw={write:function(a,b){if(!fa.inBody(a))throw"Internal error: attempted to write to an iframe that is not in the DOM";
a=Kw.doc(a).dom();a.open("text/html","replace");a.writeln(b);a.close()}},$Q=function(a){var b=a.base.fold(k(""),function(a){return'<base href="'+a+'" />'}),c=a.editorStyles.concat(a.stylesheets),d=F(c,function(a){return'<link rel="stylesheet" type="text/css" href="'+a+'" onload="styleLoaded()" onerror="styleLoaded()" />'});a=0===a.documentStyles.length?"":'<style type="text/css">'+a.documentStyles+"</style>";return"<!doctype html>\n<html>\n  <head>\n    "+b+'\n    <script type="text/javascript">\n      var stillToLoad = '+
c.length+";\n      function styleLoaded() {\n        stillToLoad--;\n      }\n    \x3c/script>\n    "+d.join("")+"\n    "+a+'\n  </head>\n  <body contenteditable="true" spellcheck="false"></body>\n</html>'},PI=function(a){var b=g.none(),c=nd.tap(function(a,b,c){p.trigger.nodeChanged(a,b,c)});a.loaded(function(a){var d=function(){try{return null!==a.win().window&&void 0!==a.win().window}catch(Qa){return!1}};if(d()){b=g.some(a);if(ba.detect().browser.isFirefox()){try{a.execCommand("enableObjectResizing",
!1,!1)}catch(Qa){}try{a.execCommand("enableInlineTableEditing",!1,!1)}catch(Qa){}}a.events.nodeChanged.bind(function(a){c.instance(a.node(),a.offset(),a.prev())});a.events.loiter.bind(function(a){p.trigger.loiter(a.node(),a.offset())});a.events.uiStale.bind(function(){p.trigger.uiStale()});a.events.domChanged.bind(function(){p.trigger.domChanged()});a.events.interaction.bind(function(){p.trigger.interaction()});a.events.keyup.bind(function(a){p.trigger.keyup(a.original())});a.events.keydown.bind(function(a){p.trigger.keydown(a.original())});
a.events.keypress.bind(function(a){p.trigger.keypress(a.original())});a.events.mousedown.bind(function(a){p.trigger.mousedown(a.original())});a.events.mouseup.bind(function(a){p.trigger.mouseup(a.original())});a.events.contextmenu.bind(function(a){p.trigger.contextmenu(a.original())});a.events.cut.bind(function(a){p.trigger.cut(a.original())});a.events.copy.bind(function(a){p.trigger.copy(a.original())});a.events.paste.bind(function(a){p.trigger.paste(a.original())});a.events.focus.bind(function(a){p.trigger.focus(a.original())});
a.events.focusOut.bind(function(a){p.trigger.focusOut(a.original())});a.events.dblclick.bind(function(a){p.trigger.dblclick(a.original())});a.events.selectionchange.bind(function(a){p.trigger.selectionchange(a.original())});a.futures.stylesheetLoad.get(function(a){a.each(function(a){p.trigger.stylesheetLoad(a)})});a.events.paint.bind(function(){p.trigger.paint()});a.resetContent(f);d()&&(p.trigger.ready(a),p.trigger.loaded(),a.uiChanged())}else a.destroy()});var d=function(){return b.map(function(a){return a.win()})},
e=function(){return b.map(function(a){return a.doc()})},f=a.initial(),h=function(){b.each(function(a){a.focus()})},l=function(){return b.bind(function(a){return a.getSelection()})},m=function(a,c,d,e){b.each(function(b){b.setSelection(a,c,d,e)})},n=function(a,c){b.each(function(b){b.setRelativeSelection(a,c)})},x=function(){var a=arguments;b.each(function(b){b.execCommand.apply(null,a)})},p=G.create({nodeChanged:q(["node","offset","prev"]),loiter:q(["node","offset"]),uiStale:q([]),domChanged:q([]),
interaction:q([]),keydown:q(["original"]),keyup:q(["original"]),keypress:q(["original"]),mousedown:q(["original"]),mouseup:q(["original"]),contextmenu:q(["original"]),cut:q(["original"]),copy:q(["original"]),paste:q(["original"]),focus:q(["original"]),focusOut:q(["original"]),dblclick:q(["original"]),selectionchange:q(["original"]),paint:q([]),ready:q(["api"]),loaded:q([]),stylesheetLoad:q(["sheets"])});return{element:a.element,tabindex:a.tabindex,onCanvas:a.onCanvas,win:d,doc:e,body:function(){return b.map(function(a){return a.body()})},
getContent:function(){return b.fold(function(){return f},function(a){return a.getContent()})},setContent:function(a){b.fold(function(){f=a},function(b){b.setContent(a)})},resetContent:function(a){b.fold(function(){f=a},function(b){b.resetContent(a)})},blur:function(){b.each(function(a){a.blur()})},focus:h,uiChanged:function(){b.each(function(a){a.uiChanged()})},domChanged:function(){b.each(function(a){a.domChanged()})},clearSelection:function(){b.each(function(a){a.clearSelection()})},getSelection:l,
setSelection:m,setRelativeSelection:n,backupSelection:function(){b.each(function(a){a.backupSelection()})},replaceSelection:function(a){b.each(function(b){b.replaceSelection(a)})},execCommand:x,lockdown:function(a){var b=c.control.isBlocked();c.control.block();a();b||c.control.unblock()},destroy:function(){a.destroy();b=g.none()},events:p.registry,background:function(){b.each(function(a){a.background()})},foreground:function(){b.each(function(a){a.foreground()})},on:function(a){return d().bind(function(b){return e().map(function(c){return a({win:k(b),
doc:k(c),execCommand:x,getSelection:l,setSelection:m,setRelativeSelection:n,focus:h})})})},translateScreen:function(a,c){return b.fold(function(){return Ma(a,c)},function(b){return b.translateScreen(a,c)})},translateLocation:function(a,c){return b.fold(function(){return Ma(a,c)},function(b){return b.translateLocation(a,c)})},placeholder:a.placeholder,isInline:a.isInline}},QI={frame:function(a,b){a=aR(a,b);return PI(a)},detached:function(a,b,c){a=MQ(a,b,c);return PI(a)}},RI=ba.detect(),SI=RI.browser,
n7=!(SI.isEdge()&&16>SI.version.major||RI.deviceType.isiOS()),o7=function(a,b){if(n7&&void 0!==a&&wb(a.setData))try{return Ra(b,function(b,d){a.setData(d,b())}),!0}catch(c){return!1}else return!1},p7=function(a,b,c){var d=p.fromTag("div",a.doc().dom());v.setAll(d,{position:"absolute",top:"-1000px"});b=b["text/html"]();Ca.set(d,b);b=Cc.descendants(d,function(a){return"a"===C.name(a)&&m.has(a,"href")});A(b,function(a){var b=m.get(a,"href");Cb(b,"://")||m.set(a,"data-ephox-href",b)});y.append(a.body(),
d);var e=a.getSelection();Na.setToElement(a.win(),d);setTimeout(function(){E.remove(d);e.each(function(b){a.setSelection(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())});setTimeout(c,0)},0)},q7=function(a){return function(b,c,d){var e=b.raw();if(!ta(e.type)||"copy"!==e.type.toLowerCase()&&"cut"!==e.type.toLowerCase())throw"Can only set the clipboard with a cut or copy event";if(!wb(c["text/html"]))throw"Must provide at least text/html data function when setting clipboard contents";
o7(e.clipboardData,c)?(b.kill(),setTimeout(d,0)):a(c,d)}},r7=Ac(Qd,["doc","win","body","getSelection","setSelection"]),Dt={register:function(a){r7(a);a=t(p7,a);return{setClipboard:q7(a)}},textMime:k("text/plain"),htmlMime:k("text/html")},Et=nv(C.isComment,"comment"),Ft={get:function(a){return Et.get(a)},getOption:function(a){return Et.getOption(a)},set:function(a,b){Et.set(a,b)}},Li={intraFlag:k({findClipboardTags:function(a){a=Td(F(a,function(a){if(C.isComment(a)){var b=Ft.get(a);if(Cb(b,"x-textbox/html"))return g.some(a)}return g.none()}));
return 0===a.length?g.none():g.some(a)}}),buildClipboardContents:function(a,b){var c={};c[Dt.textMime()]=Xb(a);c[Dt.htmlMime()]=Xb(function(){return"\x3c!-- x-textbox/html --\x3e"+b()});return c},ignoreSelectors:k([".ephox-sloth-bin"])},TI=function(a,b){return{editable:k(a),connect:b}},s7=function(a,b){var c=QI.frame(b,Li.ignoreSelectors());c.events.ready.bind(function(b){b=b.api().body();a.updateUi(b)});return TI(c,function(a){y.append(a,c.element())})},t7=function(a,b){0!==b.stylesheets.length&&
console.log("You have attempted to declare the following stylesheets for use in textbox.io: ["+b.stylesheets.join(", ")+"]. User stylesheets are not used in inline editing mode and have been ignored.");0!==b.documentStyles.length&&console.log('You have attempted to declare the following document styles for use in textbox.io: "'+b.documentStyles+'". Document styles are not used in inline editing mode and have been ignored.');b.base.fold(u,function(a){console.log('You have attempted to declare the following content base URL for use in textbox.io: "'+
a+'". Content base URL is not used in inline editing mode and has been ignored.')});var c=QI.detached(b.inline,b.editorStyles,Li.ignoreSelectors());return TI(c,function(a){y.append(a,c.placeholder());a=L.ancestor(a,".ephox-polish-editor-container").getOr(a);v.set(c.placeholder(),"display","none");ja.add(a,[z.resolve("inline-editor-container"),z.resolve("layer-editor")])})},u7={build:function(a,b){return(void 0!==b.inline?t7:s7)(a,b)}},v7=ba.detect().browser.isFirefox(),w7=function(a){A(a,function(a){B.nextSibling(a).isNone()&&
y.after(a,p.fromText(fb()))})},x7={configure:function(a){v7&&a.addSelector(a.input(),"a",w7)}},En=z.resolve("content-eph-wrapper"),Fn=z.resolve("content-eph-extra"),Gn=z.resolve("content-eph-general"),y7=function(a){A(a,function(a){n.remove(a,Eb.styleSpan());m.remove(a,Eb.overrideSpan());m.hasNone(a)?E.unwrap(a):ad.isTransient(a)&&E.remove(a)})},UI=function(a){A(a,function(a){n.remove(a,Eb.quasiBlock())})},VI=function(a){A(a,function(a){var b=m.get(a,"style");m.set(a,"style",b.replace(/"/g,"'"))})},
z7=function(a){return oa.isCursorPosition(a)||la.isBlock(a)||oa.isCursorPosition(Xa.freefallLtr(a).element())},WI=function(a){A(a,function(a){if(0===ka(B.children(a),z7).length){var b=p.fromTag("br");y.append(a,b)}})},Hn={configure:function(a){a.add(a.internal(),En,Ka.unwrap);a.add(a.internal(),Fn,Ka.remove);a.add(a.internal(),Gn,Ka.remove);a.add(a.internal(),Eb.quasiBlock(),UI);a.add(a.output(),En,Ka.unwrap);a.add(a.output(),Fn,Ka.remove);a.add(a.output(),Gn,Ka.remove);a.add(a.output(),Eb.styleSpan(),
y7);a.add(a.output(),Eb.quasiBlock(),UI);a.addExcludedContext(["."+En,"."+Fn,"."+Gn,"."+Eb.styleSpan()]);a.addSelector(a.input(),"[style]",VI);a.addSelector(a.input(),"td,th,p",WI);a.addSelector(a.paste(),"[style]",VI);a.addSelector(a.paste(),"td,th,p",WI);a.addSelector(a.output(),"strong,b,em,i,u,s,strike,del,sup,sub",Ka.removeIfEmpty);x7.configure(a)},markerWrapper:k(En),markerExtra:k(Fn),markerGeneral:k(Gn)},Nf={resolve:Hb.create("ephox-cereal").resolve},Gt=Nf.resolve("start-cursor"),Ht=Nf.resolve("finish-cursor"),
It="data-"+Nf.resolve("start-offset"),Jt="data-"+Nf.resolve("finish-offset"),XI=function(a){m.remove(a,It);m.remove(a,Jt);ja.remove(a,[Gt,Ht]);""===m.get(a,"class")&&m.remove(a,"class")},YI=function(a,b){a=m.get(a,b);return parseInt(a,10)},Oh={setInfo:function(a,b,c,d){A([a,b],XI);n.add(a,Gt);n.add(b,Ht);m.set(a,It,c);m.set(b,Jt,d)},clearInfo:XI,findStart:function(a){return L.descendant(a,"."+Gt).map(function(a){return{token:k(a),offset:k(YI(a,It))}})},findFinish:function(a){return L.descendant(a,
"."+Ht).map(function(a){return{token:k(a),offset:k(YI(a,Jt))}})}},ZI=M("token","remove","extra"),$I={use:function(a,b){return ZI(b,u,[])},extract:function(a){return{remove:t(Oh.clearInfo,a),element:k(a)}}},aJ=Nf.resolve("pre-cursor-token"),bJ=Nf.resolve("post-cursor-token"),cJ=Nf.resolve("first-cursor-token"),Kt=function(){var a=p.fromTag("span");v.set(a,"display","none");return a},Lt=function(a){var b=t(E.remove,a);return ZI(a,b,[a])},A7=function(a){return n.has(a,aJ)?B.nextSibling(a):n.has(a,bJ)?
B.prevSibling(a):n.has(a,cJ)?B.parent(a):g.none()},Dg={pre:function(a,b){a=Kt();y.before(b,a);n.add(a,aJ);return Lt(a)},post:function(a,b){a=Kt();y.after(b,a);n.add(a,bJ);return Lt(a)},first:function(a,b){b=Kt();y.prepend(a,b);n.add(b,cJ);return Lt(b)},extract:function(a){return A7(a).map(function(b){return{remove:t(E.remove,a),element:k(b)}})}},B7=M("element","offset"),C7=M("startContainer","startOffset","endContainer","endOffset"),D7={point:B7,range:C7},Mt=Nf.resolve("text-node-wrapper"),dJ=function(a){return n.has(a,
Mt)},Of={create:function(){var a=p.fromTag("span");n.add(a,Mt);return a},findIn:function(a){return ca.children(a,"."+Mt)},isWrap:dJ,inWrap:function(a){return B.parent(a).fold(k(!1),function(a){return dJ(a)})},child:function(a){return B.child(a,0).fold(function(){var b=p.fromText("");y.append(a,b);return b},aa)}},E7=function(a){a=Of.findIn(a);A(a,function(a){0===B.children(a).length&&y.before(a,p.fromText(""));E.unwrap(a)})},F7=function(a){B.parent(a).each(E.unwrap)},eJ=function(a){(Of.inWrap(a)?F7:
E7)(a)},Nt=function(a,b,c,d){return P.eq(a,b)?Dg.first(a,b):C.isElement(b)&&!d(b)?$I.use(a,b):c(a,b)},Ot={extractFrom:function(a,b){a.remove();b.remove();var c=function(a){var b=Of.isWrap(a)?E.unwrap:eJ,c=Of.isWrap(a)?Of.child(a):a;return{target:k(c),unwrap:t(b,a)}},d=c(a.element()),e=c(b.element()),f=D7.range(d.target(),a.offset(),e.target(),b.offset());return{remove:function(){d.unwrap();e.unwrap()},getSelection:function(){return f}}},same:function(a,b,c,d,e){a=Nt(a,b,Dg.pre,e);Oh.setInfo(a.token(),
a.token(),c,d);return[a]},diff:function(a,b,c,d,e,f){var h=Vc.after(b,c,d,e),g=h?Dg.pre:Dg.post;b=Nt(a,b,h?Dg.post:Dg.pre,f);a=Nt(a,d,g,f);Oh.setInfo(b.token(),a.token(),c,e);return[b,a]}},G7=function(a){return B.parent(a).fold(k(!1),function(a){return Of.isWrap(a)})},H7=function(a){return zb(a,function(a,c){if(C.isText(c)&&!G7(c)){var b=Of.create();y.wrap(c,b);return[b].concat(a)}return a},[])},I7=function(a){var b=B.children(a);b=0<b.length?b:[a];return Of.isWrap(a)?[]:H7(b)},J7=function(a){a.remove()},
fJ={combine:function(a,b){var c=ia(a,I7),d=ia(b,function(a){return a.extra()});return{extra:k(d),wrappers:k(c),remove:function(){A(b,function(a){Oh.clearInfo(a.token())});A(a,eJ);A(b,J7)}}}},K7=function(a,b,c,d,e,f){var h=[b,d];a=Ot.diff(a,b,c,d,e,f);return fJ.combine(h,a)},L7=function(a,b,c,d,e,f){d=[b];a=Ot.same(a,b,c,e,f);return fJ.combine(d,a)},gJ=function(a,b){return b(a).map(function(a){var b=Dg.extract(a.token()).getOrThunk(function(){return $I.extract(a.token())});return{remove:b.remove,offset:a.offset,
element:b.element}})},M7=function(a){return gJ(a,Oh.findStart).bind(function(b){return gJ(a,Oh.findFinish).map(function(a){return{startMarker:k(b),finishMarker:k(a)}})})},hJ={insertAt:function(a,b,c,d,e,f){return(P.eq(b,d)?L7:K7)(a,b,c,d,e,f)},extract:function(a){return M7(a).map(function(a){return Ot.extractFrom(a.startMarker(),a.finishMarker())})}},iJ={insert:function(a,b,c){a=hJ.insertAt(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset(),c);return{extra:a.extra,wrappers:a.wrappers,
remove:a.remove}},extract:function(a){return hJ.extract(a).map(function(a){return{remove:a.remove,getSelection:a.getSelection}})}},jJ=function(a,b){A(a,function(a){n.add(a,b)})},N7=function(a){var b=function(){return B.parent(a).map(function(a){return"false"===m.get(a,"contenteditable")}).getOr(!1)};return"false"===m.get(a,"contenteditable")||b()},In={extract:function(a){return iJ.extract(a)},getSelection:function(a){var b=a.getSelection();a=b.startContainer();var c=b.startOffset(),d=b.endContainer();
b=b.endOffset();var e=oa.getEnd(a),f=oa.getEnd(d);return 0<=c&&c<=e&&0<=b&&b<=f?{start:k(ha.on(a,c)),finish:k(ha.on(d,b))}:{start:k(ha.before(a)),finish:k(ha.before(a))}},remove:function(a){a.remove()},serialise:function(a,b){return uh.path(a,b.startContainer()).bind(function(c){return uh.path(a,b.endContainer()).bind(function(d){var e=Gc.deep(a);return uh.follow(e,c).bind(function(a){return uh.follow(e,d).map(function(c){c={startContainer:k(a),startOffset:k(b.startOffset()),endContainer:k(c),endOffset:k(b.endOffset())};
c=iJ.insert(e,c,N7);jJ(c.wrappers(),Hn.markerWrapper());jJ(c.extra(),Hn.markerExtra());return Ol.writeChildren(e)})})})})}},Jn=M("word","left","right"),kJ=["'","\u2018","\u2019"],O7=ia(kJ,function(a){return F(["twas"],function(b){return a+b})}),P7=function(a){var b=a.word();return Jn(b.substring(1),g.some(b.charAt(0)),a.right())},Kn=function(a){return V(kJ,a)},Q7=function(a){var b=a.word(),c=Va(O7,function(a){return-1<b.indexOf(a)})?2:1,d=b.substring(0,c);return kb(d,Kn)&&!Kn(b.charAt(c))?P7(a):a},
lJ=function(a){var b=a.word();2<=b.length&&Kn(b.charAt(b.length-1))&&!Kn(b.charAt(b.length-2))&&(b=a.word(),a=Jn(b.substring(0,b.length-1),a.left(),g.some(b.charAt(b.length-1))));return Q7(a)},R7={scope:lJ,text:function(a){a=Jn(a,g.none(),g.none());return lJ(a).word()}},mJ={words:function(a){var b=sb.unsafetoken(sb.wordchar()+"+");b=hn.findall(a,b);var c=a.length;return F(b,function(b){var d=b.start(),f=b.finish();b=a.substring(d,f);d=0<d?g.some(a.charAt(d-1)):g.none();f=f<c?g.some(a.charAt(f)):g.none();
b=Jn(b,d,f);return R7.scope(b)})}},nJ={identify:function(a){return mJ.words(a)},isWord:function(a,b){return!Hj.hasBreak(b)}},S7=gb(),T7={identify:function(a){return nJ.identify(a)},isWord:function(a){return nJ.isWord(S7,a)}},U7=ba.detect(),oJ=function(a,b){return C.isText(a)?g.some(W.point(a,b)):0===B.children(a).length?g.none():B.child(a,b).bind(function(a){return oJ(a,0)})},V7=function(a,b,c){a.on(function(a){hd.expandWord(a,b,c)})},W7=function(a,b){a=a.dom().createRange();a.setStart(b.startContainer().dom(),
b.startOffset());a.setEnd(b.endContainer().dom(),b.endOffset());return T7.isWord(a.cloneContents().textContent)},pJ={correct:function(a){a.getSelection().each(function(b){a.doc().each(function(c){W7(c,b)&&oJ(b.startContainer(),b.startOffset()).each(function(c){(!b.collapsed()||a.isInline()&&U7.browser.isIE())&&V7(a,c.element(),c.offset())})})})},expand:function(a){a.on(hd.expand);a.backupSelection()}},qJ=function(a,b){return a.bind(function(a){return a.fold(function(){return Ba.pure(a)},function(a){return b(a)})})},
rJ=function(a){return Ba.pure(N.value(a))},sJ=function(a){return Ba.nu(function(b){a.then(function(a){b(N.value(a))},function(a){b(N.error(a))})})},tJ=function(a){return a.map(N.value)},La={fromPromise:sJ,error:function(a){return Ba.pure(N.error(a))},map:function(a,b){return a.map(function(a){return a.map(b)})},bind:qJ,pure:rJ,fromChain:function(a){return function(b){return hb(a,function(a,b){return qJ(a,function(a){return b(a)})},rJ(b))}},fromFuture:tJ,pToFR:function(a){return Db(sJ,a)},fToFR:function(a){return Db(tJ,
a)},effect:function(a){return function(b){b.each(function(){a()});return b}}},X7=function(a){return Ba.nu(function(b){if(!0===a.dom().complete)b(N.value(a));else{var c=kp();uJ(c,b);c.monitor(a)}})},uJ=function(a,b){a.events.success.bind(function(a){b(N.value(a.image()))});a.events.fail.bind(function(a){b(N.error("Unable to download image "+a.url()))})},Ln={load:function(a){return Ba.nu(function(b){var c=kp();uJ(c,b);c.go(a)})},loadIfNeeded:function(a){return!0===a.dom().complete||void 0===m.get(a,
"src")?La.pure(a):X7(a)}},Ph={text:function(a){a=B.children(a);return Pl.toText(a)},html:function(a,b){var c=p.fromTag("div");y.append(c,a);return Oi.output(b,c)},fragment:function(a,b){if(b.collapsed())return g.none();b=wc.exact(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset());a=Na.clone(a,b);return g.some(a)}},vJ=ba.detect(),Y7=function(a,b,c,d,e){Hn.configure(a);var f=g.none(),h={inline:c.inline,base:g.from(c.base),editorStyles:[c.css+"/content.css"],stylesheets:c.stylesheets,
documentStyles:c.documentStyles,needStyles:c.showDocumentStyles,autoresize:c.autoresize};d=u7.build(d,h);var l=d.editable();null!==c.tabindex&&l.tabindex(c.tabindex);void 0!==e.raw&&l.setContent(e.raw);l.events.ready.bind(function(){if(void 0!==e.raw){var a=l.getContent();e.raw===a&&e.marked!==e.raw&&D(e.marked,!1)}a=l.body().getOrDie();f=g.some(J.bind(a,"dblclick",function(a){pJ.correct(l)}))});l.events.ready.bind(function(a){aq.addClasses(a.api().body())});var r=function(){return l.getSelection().bind(function(a){var b=
l.body().getOrDie("content should not return a selection if body is not yet available");return In.serialise(b,a)}).getOr(l.getContent())},D=function(a,b){l.body().each(function(c){l.setContent(a);In.extract(c).fold(function(){var a=Xa.freefallLtr(c);l.setSelection(a.element(),a.offset(),a.element(),a.offset())},function(a){var b=In.getSelection(a);In.remove(a);l.setRelativeSelection(b.start(),b.finish())});if(!vJ.deviceType.isiOS()){var d=ca.descendants(c,"img");b?ae(d,Ln.loadIfNeeded).get(function(){A()}):
A()}})},x=G.create({nodeChanged:q(["node","offset","prev"]),undoChanged:q([]),loiter:Q(["node","offset"],l.events.loiter),uiStale:Q([],l.events.uiStale),domChanged:Q([],l.events.domChanged),interaction:Q([],l.events.interaction),keydown:Q(["original"],l.events.keydown),keyup:Q(["original"],l.events.keyup),keypress:Q(["original"],l.events.keypress),mousedown:Q(["original"],l.events.mousedown),mouseup:Q(["original"],l.events.mouseup),contextmenu:Q(["original"],l.events.contextmenu),copy:Q(["original"],
l.events.copy),paste:Q(["original"],l.events.paste),focus:Q(["original"],l.events.focus),focusOut:Q(["original"],l.events.focusOut),dblclick:Q(["original"],l.events.dblclick),selectionchange:Q(["original"],l.events.selectionchange),paint:Q([],l.events.paint),ready:Q(["api"],l.events.ready),loaded:Q([],l.events.loaded),stylesheetLoad:Q(["sheets"],l.events.stylesheetLoad),background:q([]),foreground:q([]),scrollToCursor:q([]),scrollToElement:q(["element"]),toEditing:q([]),toReading:q([])});l.events.nodeChanged.bind(function(a){x.trigger.nodeChanged(a.node(),
a.offset(),a.prev());a.prev().fold(v,function(b){Da.ancestor(b,la.isBlock).each(function(b){Da.ancestor(a.node(),la.isBlock).each(function(a){P.eq(a,b)||v()})})})});var u=nd.tap(function(){x.trigger.undoChanged()}),v=function(){u.instance()},w=function(a){u.instance();var b=u.control.isBlocked();u.control.block();a=a();b||u.control.unblock();u.instance();return a},A=function(){x.trigger.scrollToCursor()},z=nd.tap(function(){l.focus()});h=function(a){return function(){var b=arguments;B.parent(l.element()).fold(function(){a.apply(null,
b)},function(c){var d=c.dom().scrollTop;a.apply(null,b);c.dom().scrollTop=d})}}(l.execCommand);var F=function(a){return C.isText(a)&&(vJ.browser.isSafari()||0===Oa.get(a).length)||C.isElement(a)&&!la.isEmptyTag(a)&&!la.isBlock(a)},K=function(a){var b=p.fromText(fb());y.after(a,b);return b},L=function(a,b){var c=B.children(a);if(b>=c.length)return W.point(a,b);var d=c[b];return C.isElement(d)&&!la.isEmptyTag(d)?L(c[b],0):W.point(a,b)},M=function(a){a=F(a)?K(a):a;l.setRelativeSelection(ha.after(a),
ha.after(a));l.getSelection().each(function(a){a=L(a.startContainer(),a.startOffset());l.setSelection(a.element(),a.offset(),a.element(),a.offset())})},O=function(){return N.getSelection().bind(function(a){return N.win().bind(function(b){return Ph.fragment(b,a)})})},N={onCanvas:l.onCanvas,element:l.element,isInline:l.isInline,win:l.win,doc:l.doc,body:l.body,getContent:l.getContent,setContent:l.setContent,resetContent:l.resetContent,focus:function(){z.instance()},blur:l.blur,uiChanged:l.uiChanged,
domChanged:l.domChanged,undoChanged:v,clearSelection:l.clearSelection,getSelection:l.getSelection,getSelectionStart:function(){return l.getSelection().map(function(a){return a.startContainer()})},setSelection:l.setSelection,setRelativeSelection:l.setRelativeSelection,backupSelection:l.backupSelection,replaceSelection:l.replaceSelection,replaceElement:function(a,b){var c=N.getSelection().filter(function(b){var c=t(P.eq,a);return Da.closest(b.startContainer(),c)||Da.closest(b.endContainer(),c)}).isSome();
y.before(a,b);E.remove(a);c&&M(b);N.domChanged();v()},findTagAtCursor:function(b){var c=function(b,c,d){b=B.child(b,c).getOr(b);return Da.closest(b,function(b){return za.is(b,d)&&a.includeContext(b)})};return N.getSelection().bind(function(a){return c(a.startContainer(),a.startOffset(),b).orThunk(function(){return c(a.endContainer(),a.endOffset(),b)})})},getFilteredAttributes:function(b){b=Gc.shallow(b);var c=p.fromTag("div");y.append(c,b);a.filterDom(a.output(),c);return m.clone(b)},execCommand:h,
insertHtmlAtCursor:function(a){var c=te.fromHtml(a);w(function(){bd.insertAtCursorWithInstructions(Lf.doNotMerge,N,c).each(function(a){if(0===c.length)l.setSelection(a.element(),a.offset(),a.element(),a.offset());else{var d=a.element();B.parent(d).each(function(a){M(d);b.input(c)})}})})},on:l.on,destroy:function(){f.each(function(a){a.unbind()});l.destroy()},events:x.registry,state:function(){return{raw:l.getContent(),marked:r()}},serialize:r,deserialize:function(a){D(a,!0)},background:function(){l.background();
x.trigger.background()},foreground:function(){l.foreground();x.trigger.foreground()},isRoot:function(a){return l.body().fold(k(!1),function(b){return P.eq(b,a)})},selectWord:function(){pJ.expand(l)},cursor:function(){return bR(l)},activate:function(){z.control.unblock()},deactivate:function(){z.control.block()},cursorIntoView:A,elementIntoView:function(a){x.trigger.scrollToElement(a)},placeholder:l.placeholder,connect:d.connect,translateScreen:l.translateScreen,translateLocation:l.translateLocation,
runOrOnLoaded:function(a){l.body().fold(function(){l.events.ready.bind(function(b){a(b.api().body())})},function(b){a(b)})},getSelectedText:function(){return O().map(Ph.text)},getSelectedHtml:function(){return O().map(function(b){return Ph.html(b,a)})},getFilteredContents:function(b){return Oi.output(a,b)},toEditing:function(){x.trigger.toEditing()},toReading:function(){x.trigger.toReading()},undoOperation:w,markAsEphemeral:function(a){n.add(a,Hn.markerGeneral())},hideInlineSelection:function(){l.isInline()&&
(l.backupSelection(),l.clearSelection())},imageExcludes:c.imageExcludes};return N},Z7={get:k({onShortcut:function(a,b){a.bind(b)}})},wJ="data-"+z.resolve("context-type"),lp={nu:function(a,b,c){a=qb.item(a,c.value(),c.text());m.set(a,wJ,b);m.setAll(a,c.attrs());return a},type:function(a){return m.get(a,wJ)}},dR={derive:function(a,b,c){b=F(b,function(b){var d=c[b],f=d.primary(),h=d.submenus();return F(f,function(c){var d=lp.nu(a,b,c),e=h.hasOwnProperty(c.value())&&void 0!==h[c.value()]?[na.resolve("menu-more")]:
[],f=void 0!==h[c.value()];T.menuItem(d,g.some(c.text()),g.some(f));ja.add(d,e);return d})});b=ka(b,function(a){return 0<a.length});return Kb(XA(b,function(){return[qb.separator(a)]}))}},eR={derive:function(a,b,c){return ia(b,function(b){var d=c[b].secondary();return F(d,function(c){var d=qb.submenu(a,c.value(),[]);T.menu(d,w.get(c.textkey()));c=F(c.items(),function(c){var d=lp.nu(a,b,c);T.menuItem(d,g.some(c.text()),g.none());return d});O.append(d,c);return d})})}},xJ={mainmenu:function(a,b,c,d,
e,f){return Wf.main(a,b,c,d,e,f)},submenu:function(a,b,c,d,e){return Wf.submenu(a,b,c,d,e)}},ol={makeshift:function(a,b,c,d,e,f,h,g,m){return{recalculate:u,isAnchored:k(!1),place:function(k){var l=b.uiOrigin(),r=a.isInline()?Ma(c,d):he.translate(l,c,d),n=Af(r.left(),r.top(),e,f);r=h.isRtl()?Wg.allRtl():Wg.all();l=Rg.box(n,l);k=k.panel();ll.simple(l,k,g,r,void 0===m?{}:m)}}},mainmenu:function(a,b,c,d){return xJ.mainmenu(a.uiContainer,a.bounds,b,c,d)},submenu:function(a,b,c){return xJ.submenu(a.uiContainer,
a.bounds,b,c)}},yJ=M("target","x","y"),zJ=ba.detect().browser,gR=function(a,b,c,d,e,f){c=b.doc().getOrDie();var h=cR(c),l=Ma(0,0);c=Z7.get();var m=pl.fromUnsafe(b),n=ye.menuSystem(e.uiContainer,k("context"),mi.menu({focusActive:!0})),p=ye.popup(n.sandbox,e.bounds,a,[],Xf.editorContainer());f=S.div();var q=p.initMenu(f),t=function(a){h.update(a.target());var b=E(),c=[n.sandbox()];if(0<b.all.length){var d=a.x(),e=a.y();l=Ma(d,e);q.setContent(b.main);y(q);q.open();n.open(c,b.main);return g.some(a)}return g.none()},
u=function(a){return b.getSelection().bind(function(a){return function(){return Ne.selectionContains(a).fold(function(){return C.isText(a.startContainer())?B.parent(a.startContainer()):g.some(a.startContainer())},function(a){return g.some(a)})}().map(function(a){var c=Wa.viewport(a);c=b.translateScreen(c.left(),c.top());return yJ(a,c.left(),c.top())})})},w=function(a){var c=a.original();c=zJ.isIE()&&10>=zJ.version.major?Ma(c.raw().clientX,c.raw().clientY):Ma(c.x(),c.y());c=b.translateScreen(c.left(),
c.top());return yJ(a.original().target(),c.left(),c.top())},y=function(c){var d=Lg(14,10);d=ol.makeshift(b,e,l.left(),l.top(),0,0,a.uiDirection(),d);e.show(c,d)},z=function(){q.close();var a=E();A(a.all,function(a){v.set(a,"display","none")});m.end()};q.events.close.bind(function(){n.close()});var E=function(){var a=h.all();return{all:a,main:a[0],submenus:a.slice(1)}};b.events.contextmenu.bind(function(a){var b=w(a);t(b).orThunk(function(){return u().bind(t)}).each(function(b){a.original().raw().preventDefault()})});
c.onShortcut(d.events.context,function(){u().each(t)});n.events.open.bind(function(){var a=h.structure(),b=E();n.update(a);p.registerMenus(b.submenus);y(q);n.setActiveMenu(b.main)});n.events.itemAction.bind(function(a){h.handle(a.item())});n.events.itemHover.bind(function(a){m.begin()});n.events.reveal.bind(function(a){ma.expanded(a.trigger());p.expandMenu(a.menu(),a.trigger(),q);y(q)});n.events.collapse.bind(function(a){p.hideMenu(a.menu());a.item().each(ma.collapsed)});n.events.itemAction.bind(z);
n.events.escaped.bind(function(){z();b.focus()});b.events.mousedown.bind(z);return{register:h.register,destroy:function(){q.destroy();n.destroy()}}},Pt={resolve:am("ephox-darwin").resolve},AJ=Pt.resolve("selected"),$7="."+AJ,BJ=Pt.resolve("first-selected"),a8="."+BJ,CJ=Pt.resolve("last-selected"),b8="."+CJ,Vd={selected:k(AJ),selectedSelector:k($7),firstSelected:k(BJ),firstSelectedSelector:k(a8),lastSelected:k(CJ),lastSelectedSelector:k(b8)},iR=function(a){E.empty(a);y.append(a,p.fromTag("br"))},c8=
ba.detect().browser,Qt=function(a){var b=p.fromHtml("<p><br></p>");y.append(a,b);return g.some(b)},d8=function(a){var b=B.children(a);return 0===b.length?Qt(a):1===b.length&&"br"===C.name(b[0])?(E.empty(a),Qt(a)):g.none()},e8=function(a){return 1===a.dom().childNodes.length?B.firstChild(a).fold(k(!1),function(a){return"br"===C.name(a)&&m.has(a,"_moz_editor_bogus_node")}):!1},f8=function(a){return d8(a).orThunk(function(){if(c8.isFirefox()&&e8(a)){E.empty(a);var b=Qt(a)}else b=g.none();return b})},
lR={listen:function(a){a.events.nodeChanged.bind(function(b){b=b.node();a.isRoot(b)&&f8(b).each(function(b){a.setSelection(b,0,b,0)})})}},Nw={onNodeChange:function(a,b){a.events.nodeChanged.bind(function(c){c.prev().each(function(c){ad.withinTransient(c,c).each(function(c){b.atomic(function(){ad.cleanup(a.isRoot,c)})})})});return{destroy:u}},preLinebreak:function(a){a.getSelection().each(function(b){B.parent(b.startContainer()).each(function(b){ad.withinTransient(b,b).each(function(b){ad.cleanupNonEmpty(a.isRoot,
b)})})})}},Pf=function(a,b){b=b.original();b=b.raw().which||b.raw().keycode;return V(a,b)},g8=t(Pf,R.ENTER()),h8=t(Pf,R.SPACE()),i8=t(Pf,R.BACKSPACE()),j8=t(Pf,R.DEL()),k8=t(Pf,R.LEFT().concat(R.UP())),l8=t(Pf,R.RIGHT().concat(R.DOWN())),m8=t(Pf,R.TAB()),n8=t(Pf,R.ESCAPE()),Md={isEnter:g8,isSpace:h8,isBackspace:i8,isDel:j8,isTab:m8,isLeftOrUp:k8,isRightOrDown:l8,isEscape:n8},DJ=function(a,b,c,d){return Ub.isCollapsed(a)?b(a.startContainer(),a.startOffset(),d):c(a.startContainer(),a.startOffset(),
a.endContainer(),a.endOffset(),d)},Ow={soft:function(a,b){return DJ(a,et.soft,ht.soft,b)},hard:function(a,b){return DJ(a,et.hard,ht.hard,b)}},EJ=function(a,b){A(b,function(b){var c=b.find(a);b.cleaner(c,a)})},Uk={filterHtml:function(a,b){var c=p.fromTag("div");c.dom().innerHTML=a;EJ(c,b);return Ol.writeChildren(c)},filterDom:EJ},FJ=function(a,b){var c=W.point(a,b);return C.isText(a)?Cg.scanRight(a,b).getOr(c):c},Rw={handle:function(a){var b=FJ(a.startContainer(),a.startOffset());a=FJ(a.endContainer(),
a.endOffset());return Ec(b.element(),b.offset(),a.element(),a.offset())}},Eg=sa.generate([{onText:["element","offset"]},{firstText:["parent","child","offset"]},{beforeText:["parent","child","offset"]},{afterText:["parent","child"," offset"]},{lastText:["parent","child","offset"]},{onElement:["element","offset"]}]),GJ={detect:function(a,b){if(C.isText(a))return Eg.onText(a,b);var c=B.children(a);return 0===c.length?Eg.onElement(a,b):0===b&&C.isText(c[0])?(0,Eg.firstText)(a,c[0],0):b===c.length&&C.isText(c[c.length-
1])?(b=c[b-1],(0,Eg.lastText)(a,b,oa.getEnd(b))):b<c.length&&C.isText(c[b])?(0,Eg.beforeText)(a,c[b],0):0<b&&C.isText(c[b-1])?(b=c[b],(0,Eg.afterText)(a,b,oa.getEnd(b))):Eg.onElement(a,b)},cata:function(a,b,c,d,e,f,h){return a.fold(b,c,d,e,f,h)}},Fg=M("startContainer","startOffset","endContainer","endOffset"),HJ={resolve:Hb.create("ephox-newt").resolve}.resolve("cursor-marker"),Wj={generator:function(a){var b=null;return{getOrInit:function(){if(null===b){var c=p.fromTag("span",a.dom());n.add(c,HJ);
v.set(c,"display","none")}else c=b;return b=c}}},isCursor:function(a){return n.has(a,HJ)}},IJ=function(a,b){return{element:k(b),backup:aa,restore:function(){var b=Fg(a,0,a,0);return g.some(b)}}},JJ=function(a){a=B.children(a);return ka(a,xf(Wj.isCursor))},o8=function(a,b){return{element:k(b),backup:aa,restore:function(){var b=JJ(a).length;b=Fg(a,b,a,b);return g.some(b)}}},p8=function(a){return B.parent(a).bind(function(b){var c=JJ(b);return Ta(c,function(b){return P.eq(a,b)}).map(function(a){return Fg(b,
a,b,a)})})},q8=function(a,b){return{backup:function(){y.before(a,b)},restore:function(){var a=B.nextSibling(b);E.remove(b);return a.map(function(a){return p8(a).getOrThunk(function(){return Fg(a,0,a,0)})})},element:k(b)}},r8={place:function(a,b,c){var d=B.children(a);return 0===d.length?IJ(a,c):d.length===b?o8(a,c):0===b?IJ(a,c):b>d.length?Pw(c):q8(d[b],c)}},KJ=function(a,b){return b().fold(function(){return Wj.generator(a).getOrInit()},function(a){return a.element()})},Mn=function(a){a=a();a.backup();
return g.some(a)},LJ=function(a,b){var c=a.or(b),d=b.or(a);return c.bind(function(a){return d.map(function(b){return Fg(a.startContainer(),a.startOffset(),b.startContainer(),b.startOffset())})})},s8=function(a,b,c){var d=g.none(),e=g.none();return{backup:function(){e=Mn(b);d=Mn(c)},restore:function(){return d.bind(function(a){return e.bind(function(b){var c=a.restore();b=b.restore();return LJ(c,b)})})},element:t(KJ,a,function(){return e})}},t8=function(a,b,c){var d=g.none(),e=g.none();return{backup:function(){d=
Mn(c);e=Mn(b)},restore:function(){return e.bind(function(a){return d.bind(function(b){var c=a.restore();b=b.restore();return LJ(b,c)})})},element:t(KJ,a,function(){return d})}},u8=function(a,b,c){return{backup:function(){y.before(b,c)},restore:function(){var b=mc.after(c,a).map(function(a){return Fg(a,0,a,0)});E.remove(c);return b},element:k(c)}},MJ=function(a,b,c){return{backup:function(){y.after(b,c)},restore:function(){var b=mc.before(c,a).map(function(a){var b=oa.getEnd(a);return Fg(a,b,a,b)});
E.remove(c);return b},element:k(c)}},NJ={place:function(a,b,c,d){b=zh.split(b,c);return zh.position(b).fold(function(){return Pw(d)},function(b){return u8(a,b,d)},function(b,c){return MJ(a,b,d)},function(b){return MJ(a,b,d)})}},Rt=M("result","cursor"),v8=function(a,b,c){var d=function(b,d,h){return NJ.place(a,d,h,c)};return GJ.cata(b,function(b,d){return NJ.place(a,b,d,c)},d,d,d,d,function(a,b){return r8.place(a,b,c)})},St=function(a,b,c,d){d=d.getOrInit();b=GJ.detect(b,c);return v8(a,b,d)},OJ=function(a,
b){a.backup();b=b(a.element());return Rt(b,a.restore())},Nn={inspect:St,runOnRange:function(a,b,c,d,e,f){var h=B.owner(b),g=(Vc.after(b,c,d,e)?t8:s8)(h,function(){return St(a,d,e,Wj.generator(h))},function(){return St(a,b,c,Wj.generator(h))});return OJ(g,f)},runOnCursor:OJ},w8=function(a,b,c,d,e,f){return Nn.runOnRange(a,b,e>c?c:e,b,e>c?e:c,f)},x8=Nn.runOnRange,PJ={point:function(a,b,c,d){var e=B.owner(b);e=Wj.generator(e);a=Nn.inspect(a,b,c,e);return Nn.runOnCursor(a,d)},range:function(a,b,c){return(P.eq(b.startContainer(),
b.endContainer())?w8:x8)(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset(),c)}},y8=function(a,b){return function(a,d){a=d(b);return Rt(a,g.none())}},z8=function(a,b){return function(c,d){return PJ.point(a,b.startContainer(),b.startOffset(),QJ(c,d))}},A8=function(a,b){return function(c,d){return PJ.range(a,b,QJ(c,d))}},QJ=function(a,b){return function(c){n.add(c,a);return b(c)}},Qw={diagnose:function(a,b){var c=b.startContainer(),d=b.endContainer(),e=B.owner(c);return fa.inBody(c)&&
fa.inBody(d)&&Y.active(e).forall(fa.inBody)?b.collapsed()?z8(a,b):A8(a,b):y8(a,b.startContainer())}},Tt={fold:function(a,b){return zb(a,function(a,d){return a.bind(function(a){return b(d).map(function(b){return[b].concat(a)})})},N.value([]))}},RJ=function(a,b,c){Zb(a)&&b.hasOwnProperty(a.label)&&c(b[a.label]);return a},SJ={mapGroup:function(a,b){return RJ(a,b,function(b){return a.label=b})},mapMenu:function(a,b){return RJ(a,b,function(b){b.hasOwnProperty("label")&&(a.label=b.label);b.hasOwnProperty("menuLabel")&&
(a.menuLabel=b.menuLabel)})}},B8=function(a,b,c){b=b.groups();return b.hasOwnProperty(a)?N.value(b[a]):Ee("Unknown group: "+a,["No binding for group: "+a+". Known groups: "+jb(b)])},C8=function(a,b,c){a=SJ.mapGroup(a,c.groupMappings());a=Gb(a)?{label:"",items:a}:a;return N.value(a)},D8=function(a,b,c,d,e,f){return Tt.fold(b,function(a){return e.item(a,c,d,e,f)}).map(function(b){return{category:a,items:b}})},E8=function(a,b,c,d,e){b=b.commands();return b.hasOwnProperty(a)?N.value(b[a]):Ee("Unknown command: "+
a,["No binding for command: "+a+". Known commands: "+jb(b)])},G8=function(a,b,c,d,e){return(void 0===a.items?F8:d.menu)(a,b,c,d,e)},F8=function(a,b,c,d,e){return void 0===c?Ee("You need a custom action factory to use this",[]):c(a)},H8=function(a){return kb(a,Gb)?N.value(a):Va(a,Gb)?Ee("Menu items must be a single array or an array where every element is an array",["Menu items must be a single array or an array where every element is an array.","Contents of menu: "+yd.stringify(a)]):N.value([a])},
TJ=Wb({group:function(a,b,c,d,e){return(ta(a)?B8:C8)(a,b,e).bind(function(a){return D8(a.label,a.items,b,c,d,e)})},item:function(a,b,c,d,e){return(ta(a)?E8:G8)(a,b,c,d,e)},menu:function(a,b,c,d,e){if(void 0===a.label||void 0===a.items||0===a.items.length)return Ee("Invalid toolbar configuration for menu",["Invalid menu. Must be an object containing label and items.","Contents of menu: "+yd.stringify(a)]);var f=SJ.mapMenu(a,e.menuMappings()),h=f.menuLabel?f.menuLabel:f.label;return H8(f.items).bind(function(a){return Tt.fold(a,
function(a){return d.group(a,b,c,d,e)})}).map(function(b){return{name:a.id,textkey:a.label,menuTextkey:h,type:"submenu",contentFocus:!1,enabled:!0,icon:a.icon,commands:b}})}},function(a,b){return function(){if(5!==arguments.length)throw"Incorrect usage of builder ["+b+"]. Only given: "+arguments.length;return a.apply(null,arguments)}}),I8=function(a){if(void 0===a.items)return Ee("Invalid group, no items specified",["Invalid group, no items specified: "+a.label]);var b=a.items;return Gb(b)?(a=ia(b,
function(a,b){return ta(a)||Gb(a)||void 0!==a.label&&Gb(a.items)?[]:["Invalid group at index: "+b+". Must be either a string, an array or an object containing label and items. Was: "+yd.stringify(a)]}),0===a.length?N.value(b):Ee("Invalid toolbar configuration for groups",a)):Ee("Invalid toolbar, items is not an array",["Invalid toolbar, items is not an array: "+yd.stringify(a)])},UJ={build:function(a,b,c,d){return I8(a).bind(function(a){return Tt.fold(a,function(a){return TJ.group(a,b,c,TJ,d)})})}},
VJ=function(){return nc.isSmallTouch()},WJ=function(a,b){return{feature:a.feature,command:a.command,type:"pre_flatmenu",items:b}},np={shouldFlatten:VJ,never:k("never_flatten"),streamline:function(a){var b=function(a){return ia(a,function(a){return"never_flatten"===a.flatten?[a]:"submenu"===a.type?ia(a.commands,function(a){return b(a.items)}):"pre_flatmenu"===a.type?F(a.items,function(b){return{feature:a.feature,type:"general",command:b}}):[a]})};return F(a,function(a){var c=b(a.items);return{category:a.category,
items:c}})},setup:function(a,b){b=WJ(a,b);return nc.choice([{predicate:VJ,value:k(b)}],a)},make:WJ},ti=function(a,b){return{predicate:a,value:k(b)}},XJ=function(){return{make:function(a){var b=function(b){return Ee(w.translate("errors.toolbar.missing.custom.string",b),['The required property "'+b+'" for a custom command must be a string. It was: '+yd.stringify(a[b]),"Properties specified in custom command: "+jb(a).join(", "),"Definition specified for custom command: "+yd.stringify(a)])};if(!ta(a.id))return b("id");
if(!ta(a.text))return b("text");b={};b[a.id]=k({general:function(){return{toggle:!1,value:em.cssSanitise(a.id),textkey:w.raw(a.text),action:a.action,updateGeneral:aa,icon:void 0!==a.icon?a.icon:!1}}});return N.value({feature:g.some(b),command:a.id,type:"general"})}}}(),J8=function(a,b){return a.bind(function(a){return b.map(function(b){return a.concat(b)})})},YJ={groupMappings:k({"group.undo":"category.undo","group.insert":"category.insert","group.style":"category.style","group.language":"category.language",
"group.emphasis":"category.emphasis","group.align":"category.align","group.listindent":"category.listindent","group.format":"category.format","group.tools":"category.tools","group.table":"category.table","group.image":"category.image"}),menuMappings:k({"menu.insert":{label:"insert.menu-button",menuLabel:"insert.menu"},"menu.font":{label:"font.menu-button",menuLabel:"font.menu"}})},ui={config:function(a,b,c){return function(d,e,f,h){d=yR(d,e,f,h,c);d=cb(d,b);h={"table-tools":{feature:h.table().ui(),
command:"cell",type:"palette"},"image-tools":{feature:h.imageEdit().ui(),command:"edit",type:"palette"},"crop-tools":{feature:h.imageEdit().ui(),command:"crop",type:"palette"}};d={forItems:k({commands:k(d),groups:Tw}),forContextual:k({commands:k(h),groups:Tw})};h=UJ.build({items:a.items},d.forItems(),XJ.make,YJ);d=UJ.build({items:a.contextual},d.forContextual(),XJ.make,YJ);e=ba.detect().deviceType.isTouch()?np.streamline:aa;return J8(h,d).map(e)}}},K8=function(a){return function(a){setTimeout(function(){a()},
0)}},L8={resume:function(a){a.focus();var b=p.fromDom(a.document.body);(Y.active().exists(function(a){return V(["input","textarea"],C.name(a))})?K8(b):pb)(function(){Y.active().each(Y.blur);Y.focus(b)})}},On={safeParse:function(a,b){a=parseInt(m.get(a,b),10);return isNaN(a)?0:a}},M8=function(a){return{left:a.left,top:a.top,width:2,height:a.height}},N8=function(a){if(a.collapsed){var b=p.fromDom(a.startContainer);return B.parent(b).bind(function(c){c=wc.exact(b,a.startOffset,c,oa.getEnd(c));return Na.getFirstRect(a.startContainer.ownerDocument.defaultView,
c).map(function(a){return Wb(a,pb)}).map(M8).map(Vy)}).getOr([])}return a.getClientRects()},qp={getRectangles:function(a){a=a.getSelection();return void 0!==a&&0<a.rangeCount?N8(a.getRangeAt(0)):[]}},Wd={resolve:Hb.create("ephox-nomad").resolve},Ut="data-"+Wd.resolve("last-outer-height"),O8=function(a){return{top:k(a.top),bottom:k(a.top+a.height)}},P8=function(a){a=qp.getRectangles(a);return 0<a.length?g.some(a[0]).map(O8):g.none()},Q8=function(a){a=On.safeParse(a,Ut);var b=window.innerHeight;return a>
b?g.some(a-b):g.none()},CR={setup:function(a,b){var c=p.fromDom(b.document.body),d=J.bind(p.fromDom(a),"resize",function(){Q8(c).each(function(a){P8(b).each(function(c){c=c.top()>b.innerHeight||c.bottom()>b.innerHeight?Math.min(a,c.bottom()-b.innerHeight+50):0;0!==c&&b.scrollTo(b.pageXOffset,b.pageYOffset+c)})});m.set(c,Ut,window.innerHeight)});m.set(c,Ut,window.innerHeight);return{toEditing:function(){L8.resume(b)},destroy:function(){d.unbind()}}}},ZJ=function(a){var b=new (vc.getOrDie("Event"))("Event");
b.initEvent(a,!0,!0);return b},Uw={event:function(a,b){b=ZJ(b);a.target().dom().dispatchEvent(b)},target:function(a,b){b=ZJ(b);a.dom().dispatchEvent(b)}},$J=function(){var a=window.matchMedia("(orientation: portrait)").matches;return{isPortrait:k(a)}},Pg={get:$J,onChange:function(){var a=G.create({ready:q(["orientation"]),change:q(["orientation"])}),b=p.fromDom(window),c=null,d=J.bind(b,"orientationchange",function(){clearInterval(c);var b=$J();a.trigger.change(b);e(function(){a.trigger.ready(b)})}),
e=function(a){clearInterval(c);var b=window.innerHeight,d=0;c=setInterval(function(){b!==window.innerHeight?(clearInterval(c),a(g.some(window.innerHeight))):20<d&&(clearInterval(c),a(g.none()));d++},50)};return{onAdjustment:e,events:a.registry,destroy:function(){d.unbind()}}}},Ww={tag:function(){var a=L.first("head").getOrDie(),b=L.first('meta[name="viewport"]').getOrThunk(function(){var b=p.fromTag("meta");m.set(b,"name","viewport");y.append(a,b);return b}),c=m.get(b,"content");return{maximize:function(){m.set(b,
"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){void 0!==c&&null!==c&&0<c.length?m.set(b,"content",c):m.remove(b,"content")}}}},aK=function(a,b){a=Aa.get(a);return Math.floor(b/100*a)},bK=function(a,b){return L.ancestor(b,"td,th").fold(function(){return aK(a,98)},function(a){return aK(a,94)})},R8=function(a,b,c){var d=b.dom().width;a=bK(a,b);return Math.max(0,Math.min(a,d+c))},S8=function(a,b,c){return b.dom().height+c},op={compare:function(a,
b){var c=b.deltaX()-a.deltaX(),d=b.deltaY()-a.deltaY();a=b.deltaDistance()-a.deltaDistance();return{deltaX:k(c),deltaY:k(d),deltaDistance:k(a)}},extract:function(a){var b=a.raw().touches;if(2>b.length)return g.none();a=Math.abs(b[0].clientX-b[1].clientX);b=Math.abs(b[0].clientY-b[1].clientY);var c=Math.sqrt(Math.pow(a,2)+Math.pow(b,2));return g.some({deltaX:k(a),deltaY:k(b),deltaDistance:k(c)})},resize:function(a,b,c){var d=v.getRaw(b,"height"),e=v.getRaw(b,"width"),f=0<c.deltaDistance()?1:-1,h=f*
Math.abs(c.deltaX()),g=f*Math.abs(c.deltaY());c=R8(a,b,h);f=S8(a,b,g);h=Math.abs(h)>Math.abs(g);v.setAll(b,{height:h?"auto":f+"px",width:h?c+"px":"auto",transform:"translate3d(0, 0, 0)"});Aa.get(b)>bK(a,b)&&(d.each(function(a){v.set(b,"height",a)}),e.each(function(a){v.set(b,"width",a)}))}},BR=6<=ba.detect().os.version.major,T8=function(a){return a.body().map(function(a){a=v.get(a,"background-color");return void 0!==a&&""!==a?"background-color:"+a+"!important":"background-color:rgb(255,255,255)!important;"}).getOr("background-color:rgb(255,255,255)!important;")},
Zw={clobberStyles:function(a,b){var c=function(a){return function(b){var c=m.get(b,"style");c=void 0===c?"no-styles":c.trim();c!==a&&(m.set(b,"data-ephox-mobile-fullscreen-style",c),m.set(b,"style",a))}};a=ca.ancestors(a,"*");var d=ia(a,function(a){return ca.siblings(a,"*")});b=T8(b);A(d,c("display:none!important;"));A(a,c("position:absolute!important;top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;"+b))},
restoreStyles:function(){var a=ca.all("[data-ephox-mobile-fullscreen-style]");A(a,function(a){var b=m.get(a,"data-ephox-mobile-fullscreen-style");"no-styles"!==b?m.set(a,"style",b):m.remove(a,"style");m.remove(a,"data-ephox-mobile-fullscreen-style")})}},cK={input:function(a,b){var c=p.fromTag("input");v.setAll(c,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"});y.append(a,c);Y.focus(c);b(c);E.remove(c)}},xp={refreshInput:function(a){var b=a.dom().selectionStart,c=a.dom().selectionEnd,
d=a.dom().selectionDirection;setTimeout(function(){a.dom().setSelectionRange(b,c,d);Y.focus(a)},50)},refresh:function(a){var b=a.getSelection();if(0<b.rangeCount){var c=b.getRangeAt(0);a=a.document.createRange();a.setStart(c.startContainer,c.startOffset);a.setEnd(c.endContainer,c.endOffset);b.removeAllRanges();b.addRange(a)}}},pp={resume:function(a,b){Y.active().each(function(a){P.eq(a,b)||Y.blur(a)});a.focus();Y.focus(p.fromDom(a.document.body));xp.refresh(a)}},MR={stubborn:function(a,b,c,d,e){var f=
Vk(e),h=function(){pp.resume(a,c)},g=J.bind(b,"keydown",function(a){V(["input","textarea"],C.name(a.target()))||(f.closeMenus(void 0),h())});return{toReading:function(){cK.input(fa.body(),Y.blur)},toEditing:h,onToolbarTouch:function(a){},destroy:function(){g.unbind()}}},timid:function(a,b,c,d,e){return{toReading:function(){Y.blur(c)},toEditing:function(){pp.resume(a,c)},onToolbarTouch:function(){Y.blur(c)},destroy:u}}},U8={touch:function(a){var b=G.create({touchstart:q(["raw"]),touchend:q(["raw"])}),
c=!1,d=g.none(),e=J.capture(a,"touchstart",function(e){c=!0;d=g.some(J.capture(a,"touchend",function(a){c=!1;b.trigger.touchend(a.raw());f()}));b.trigger.touchstart(e.raw())}),f=function(){d.each(function(a){a.unbind()})};return{isTouching:function(){return c},events:b.registry,destroy:function(){e.unbind();f()}}}},V8=function(a){a=B.documentElement(a);var b=Wd.resolve("unfocused-selection");return L.descendant(a,"."+b).map(function(a){return Wa.absolute(a).top})},Vt={toFake:function(a,b,c){var d=
c.isActive,e=!1;return{on:function(){d()||(e=!1,c.update(),b.save(),Na.clear(a))},off:function(){d()&&!e&&(c.clear(),b.restore())},fakeOut:function(){e=!0;cK.input(fa.body(),b.restore)}}},inView:function(a,b,c){return function(){return V8(b).map(function(b){var c=a.dom().scrollTop;return 0<b()-c})}},onScroll:function(a,b,c,d){var e=function(){a()||f()},f=function(){d.events.touchend.unbind(e);d.isTouching()?d.events.touchend.bind(e):(c().getOr(!0)?b.off:b.fakeOut)()};return{start:function(){d.events.touchend.unbind(e);
b.on()},stop:f,destroy:function(){d.events.touchend.unbind(e)}}}},dK=function(a,b){return oc([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(c){return a<=c.width&&b<=c.height?
g.some(c.keyboard):g.none()}).getOr({portrait:b/5,landscape:a/4})}(window.screen.width,window.screen.height),eK=function(a){a=pa.get(a);var b=Pg.get().isPortrait(),c=b?dK.portrait:dK.landscape;return a-((b?window.screen.height:window.screen.width)-window.innerHeight>c?0:c)},Wt={getGreenzone:eK,updatePadding:function(a,b){var c=eK(b);b=pa.get(b)-c;v.set(a,"padding-bottom",b+"px")}},fK=sa.generate([{fixed:["element","offsetY"]},{scroller:["element","offsetY"]}]),Qf="data-"+Wd.resolve("position-y-fixed"),
Xt="data-"+Wd.resolve("scrolling"),gK="data-"+Wd.resolve("last-window-height"),hK=function(a){return On.safeParse(a,Qf)},W8=function(a){var b=hK(a);return("true"===m.get(a,Xt)?fK.scroller:fK.fixed)(a,b)},X8=function(a){var b=m.get(a,"style");v.setAll(a,{position:"absolute",top:"0px"});m.set(a,Qf,"0px");return{restore:function(){m.set(a,"style",b||"");m.remove(a,Qf)}}},Y8=function(a,b,c){var d=m.get(c,"style");Ic.register(c);v.setAll(c,{position:"absolute",height:b+"px",width:"100%",top:a+"px"});m.set(c,
Qf,a+"px");m.set(c,Xt,"true");return{restore:function(){Ic.deregister(c);m.set(c,"style",d||"");m.remove(c,Qf);m.remove(c,Xt)}}},iK=function(a,b){var c=window.innerHeight;m.set(a,gK,c+"px");return c-b},Yt={findFixtures:function(a){a=ca.descendants(a,"["+Qf+"]");return F(a,W8)},takeover:function(a,b,c){var d=X8(c),e=pa.get(c),f=iK(a,e),h=Y8(e,f,a);e=function(){var b=window.innerHeight,c=On.safeParse(a,gK);return b>c};var g=function(){var d=pa.get(c),e=iK(a,d);m.set(a,Qf,d+"px");v.set(a,"height",e+
"px");Wt.updatePadding(b,a)};Wt.updatePadding(b,a);return{setViewportOffset:function(b){m.set(a,Qf,b+"px");g()},isExpanding:e,isShrinking:xf(e),refresh:g,restore:function(){d.restore();h.restore()}}},getYFixedData:hK},Z8=function(a,b,c){return Math.abs(a-b)<=c?g.none():a<b?g.some(a+c):g.some(a-c)},Pn=function(){var a=null;return{animate:function(b,c,d,e,f,h){clearInterval(a);var g=function(b){clearInterval(a);f(b)};a=setInterval(function(){var h=b();Z8(h,c,d).fold(function(){clearInterval(a);f(c)},
function(d){e(d,g);var k=b();if(k!==d||Math.abs(k-c)>Math.abs(h-c))clearInterval(a),f(c)})},h)}}}(),Qn="data-"+Wd.resolve("last-scroll-top"),jK=function(a){return v.getRaw(a,"top").map(function(a){return parseInt(a,10)}).getOr(0)},kK=function(a){return parseInt(a.dom().scrollTop,10)},lK=function(a,b){b=b+Yt.getYFixedData(a)+"px";v.set(a,"top",b)},Xj={moveScrollAndTop:function(a,b,c){return Ba.nu(function(d){var e=t(kK,a);Pn.animate(e,b,15,function(b){a.dom().scrollTop=b;v.set(a,"top",jK(a)+15+"px")},
function(e){a.dom().scrollTop=b;v.set(a,"top",c+"px");d(b)},10)})},moveOnlyScroll:function(a,b){return Ba.nu(function(c){var d=t(kK,a);m.set(a,Qn,d());var e=Math.abs(b-d());Pn.animate(d,b,Math.ceil(e/10),function(b,c){On.safeParse(a,Qn)!==a.dom().scrollTop?c(a.dom().scrollTop):(a.dom().scrollTop=b,m.set(a,Qn,b))},function(d){a.dom().scrollTop=b;m.set(a,Qn,b);c(b)},10)})},moveOnlyTop:function(a,b){return Ba.nu(function(c){var d=t(jK,a),e=function(b){v.set(a,"top",b+"px")},f=Math.abs(b-d());Pn.animate(d,
b,Math.ceil(f/10),e,function(a){e(b);c(b)},10)})},moveWindowScroll:function(a,b,c){return Ba.nu(function(d){var e=function(c){lK(a,c);lK(b,c);window.scrollTo(0,c)};Pn.animate(function(){return window.pageYOffset},c,15,e,function(a){e(a);d(a)},10)})}},$8={scrollIntoView:function(a,b,c,d){var e=Wt.getGreenzone(b);a=t(xp.refresh,a);c>e||d>e?Xj.moveOnlyScroll(b,b.dom().scrollTop-e+d).get(a):0>c&&Xj.moveOnlyScroll(b,b.dom().scrollTop+c).get(a)}},a9=function(a,b){return a.fold(function(a,d){v.set(a,"top",
b+d+"px");return Ba.pure(d)},function(a,d){var c=b+d;d=v.getRaw(a,"top").getOr(d);d=c-parseInt(d,10);d=a.dom().scrollTop+d;return Xj.moveScrollAndTop(a,d,c)})},mK={updatePositions:function(a,b){a=Yt.findFixtures(a);a=F(a,function(a){return a9(a,b)});return tk(a,Ba.nu)}},b9=function(a,b,c,d,e,f){var h=IR(function(c){return Xj.moveWindowScroll(a,b,c)}),l=function(){var a=qp.getRectangles(f);return g.from(a[0]).bind(function(a){var c=a.top-b.dom().scrollTop;return c>window.innerHeight+5||-5>c?g.some({top:k(c),
bottom:k(c+a.height)}):g.none()})},m=De(function(){h.idle(function(){mK.updatePositions(c,d.pageYOffset).get(function(a){l().each(function(a){b.dom().scrollTop=b.dom().scrollTop+a.top()});h.start(0);e.refresh()})})},1E3),n=J.bind(p.fromDom(d),"scroll",function(){0>d.pageYOffset||m.throttle()});mK.updatePositions(c,d.pageYOffset).get(aa);return{unbind:n.unbind}},LR={setup:function(a){var b=a.cWin(),c=a.ceBody(),d=a.socket(),e=a.toolstrip(),f=a.toolbar(),h=a.contentElement(),g=a.cursor(),k=a.keyboardType();
a=a.isScrolling();var m=Yt.takeover(d,c,e),n=k(b,fa.body(),h,e,f),q=Pg.onChange();q.events.ready.bind(m.refresh);q.onAdjustment(function(){m.refresh()});var t=J.bind(p.fromDom(window),"resize",function(){m.isExpanding()&&m.refresh()}),w=b9(e,d,fa.body(),window,m,b),y=HR(b,h),A=function(){y.clear()};e=Vt.toFake(b,g,y);c=Vt.inView(d,c,f);var z=U8.touch(p.fromDom(b)),B=Vt.onScroll(a,e,c,z);return{toEditing:function(){n.toEditing();A()},toReading:function(){n.toReading()},onToolbarTouch:function(a){n.onToolbarTouch(a)},
refreshSelection:function(){y.isActive()&&y.update()},clearSelection:A,highlightSelection:function(){y.update()},scrollIntoView:function(a,c){$8.scrollIntoView(b,d,a,c)},updateToolbarPadding:u,setViewportOffset:function(a){m.setViewportOffset(a);Xj.moveOnlyTop(d,a).get(aa)},syncHeight:function(){v.set(h,"height",h.dom().contentWindow.document.body.scrollHeight+"px")},selectionScrollStarted:function(){B.start()},selectionScrollStopped:function(){B.stop()},destroy:function(){m.restore();q.destroy();
w.unbind();t.unbind();n.destroy();B.destroy();z.destroy();y.destroy()}}}},nK="data-"+Wd.resolve("horizontal-scroll"),c9=function(a){var b;(b=0<a.dom().scrollTop)||(a.dom().scrollTop=1,b=0!==a.dom().scrollTop,a.dom().scrollTop=0);return b},d9=function(a){var b;(b=0<a.dom().scrollLeft)||(a.dom().scrollLeft=1,b=0!==a.dom().scrollLeft,a.dom().scrollLeft=0);return b},oK={markAsHorizontal:function(a){m.set(a,nK,"true")},hasScroll:function(a){return"true"===m.get(a,nK)?d9:c9}},e9=function(a){var b=a.dom().scrollTop,
c=a.dom().scrollHeight;a=a.dom().offsetHeight;return 0>=b?g.some(1):b+a>=c?g.some(c-a-1):g.none()},pK=function(a){e9(a).each(function(b){a.dom().scrollTop=b})},Zt=function(a,b){return J.bind(a,"touchstart",function(a){b(a.target()).each(pK)})},ax={fixEdges:pK,exclusive:function(a,b){return J.bind(a,"touchmove",function(a){L.closest(a.target(),b).filter(oK.hasScroll).fold(function(){a.raw().preventDefault()},u)})},link:function(a,b){return Zt(a,k(b))},ancestor:function(a,b){return Zt(a,function(a){return L.closest(a,
b)})},indirect:Zt,markAsHorizontal:function(a){oK.markAsHorizontal(a)}},qK=function(a){return p.fromText(fb(),a.dom())},rK={runAndRemove:function(a,b){var c=B.owner(a),d=p.fromTag("span",c.dom());y.append(d,qK(c));y.prepend(a,d);a=b(d);E.remove(d);return a},enrichAndRemove:function(a,b){var c=qK(B.owner(a));y.append(a,c);a=b(a);E.remove(c);return a}},Rn=M("left","top","width","height","direction","absolute"),sK=function(a){return{position:k(fj.find(a)),width:k(Aa.getOuter(a)),height:k(pa.getOuter(a))}},
f9=function(a){var b=v.get(a,"display");return{backup:function(){v.set(a,"display","inline-block")},restore:function(){v.set(a,"display",b)}}},g9={backup:u,restore:u},h9=function(a){return C.isElement(a.startContainer())?g.some(a.startContainer()):C.isElement(a.endContainer())?g.some(a.endContainer()):B.parent(a.startContainer()).filter(C.isElement).orThunk(function(){return B.parent(a.endContainer()).filter(C.isElement)})},i9=function(a,b){return h9(b).fold(function(){return Rn(0,0,0,a.uiDirection(),
Ma(0,0))},function(b){var c=fj.find(b),e=Aa.get(b),f=pa.get(b),h=Wa.absolute(b);return Rn(c.left(),c.top(),e,f,a.directionAt(b),h)})},j9=function(a,b,c,d){return Qw.diagnose(a,c)(d,function(a){var d=kc.isVisible(a)||"br"===C.name(a)?g9:f9(a);d.backup();if(fa.inBody(a)){var e=rK.enrichAndRemove(a,sK);var g=e.position();var k=e.width();e=e.height();var m=b.directionAt(a);a=Wa.absolute(a);g=Rn(g.left(),g.top(),k,e,m,a)}else g=i9(b,c);d.restore();return g})},k9=function(a,b,c,d){var e=c.startContainer(),
f=c.startOffset();if("body"===C.name(e)&&0===f){var h=c.startContainer();a=parseInt(v.get(h,"padding-top"),10);d=parseInt(v.get(h,"padding-left"),10);var k=rK.runAndRemove(h,sK);e=k.position();f=k.width();k=k.height();b=b.directionAt(h);h=Wa.absolute(h);c=Rt(Rn(e.left()+d,e.top()+a,f,k,b,h),g.some(c))}else c=j9(a,b,c,d);return c},tK=function(a,b,c,d,e){b.focus();a=k9(b.isRoot,a,c,e);a.cursor().each(function(a){b.setSelection(a.startContainer(),a.startOffset(),a.endContainer(),a.endOffset())});a=a.result();
d(a)},$w={insertAt:tK,insertAtCursor:function(a,b,c,d){b.getSelection().each(function(e){tK(a,b,e,c,d)})}},cx=ba.detect(),uK=function(){try{var a=qf.localStorage;a.setItem("__storage_test__","__storage_test__");a.removeItem("__storage_test__");return g.some(a)}catch(b){return g.none()}}().fold(function(){var a={};return{getItem:function(b){return a[b]},setItem:function(b,c){a[b]=c}}},function(a){return{getItem:function(b){return a.getItem("ephox.textboxio."+b)},setItem:function(b,c){a.setItem("ephox.textboxio."+
b,c)}}}),vK=function(a,b){return g.from(uK.getItem(a)).map(yd.parse).getOr(b)},wK=function(a){return vK(a,{})},xK=function(a,b){b=yd.stringify(b);uK.setItem(a,b)},rp={read:wK,readOr:vK,write:xK,access:function(a){return{read:t(wK,a),write:t(xK,a)}}},yK=function(a,b,c){b.body().each(function(d){c.save();var e=p.fromHtml(fb());a(d,e);b.setSelection(e,0,e,0)})},dx={upOrLeft:function(a,b,c){a.setRelativeSelection(ha.before(c),ha.before(c));a.getSelection().fold(function(){yK(y.prepend,a,b)},u)},right:function(a,
b,c){a.setRelativeSelection(ha.after(c),ha.after(c));a.getSelection().fold(function(){yK(y.append,a,b)},u)}},wi={left:function(a,b,c){return a(b)&&oa.isStart(b,c)?g.none():oa.isStart(b,c)?mc.before(b,a).filter(function(a){return!tb.ancestor(a,"head")}):a(b)&&0<c?B.child(b,c-1):g.none()},right:function(a,b,c){return a(b)&&oa.isEnd(b,c)?g.none():oa.isEnd(b,c)?mc.after(b,a).filter(function(b){return a(b)||tb.ancestor(b,"body")}):a(b)&&c<oa.getEnd(b)?B.child(b,c+1):g.none()},isFirstInContent:function(a,
b){return a.body().map(function(a){a=B.children(a);return P.eq(a[0],b)}).getOr(!1)},isLastInContent:function(a,b){return a.body().map(function(a){a=B.children(a);return 0<a.length&&P.eq(a[a.length-1],b)}).getOr(!1)}},l9=function(a,b){return a.getSelection().bind(function(c){return c.collapsed()?b(a.isRoot,c.startContainer(),c.startOffset()):g.none()})},m9=function(a,b){return zb(a,function(a,d){return d(b).or(a)},g.none())},sp={get:function(a,b,c){return l9(a,c).bind(function(a){return m9(b,a)})}},
Qh={response:M("selection","kill")},Rh=function(a){return function(b){return b===a}},n9=Rh(38),o9=Rh(40),td={ltr:{isBackward:Rh(37),isForward:Rh(39)},rtl:{isBackward:Rh(39),isForward:Rh(37)},isUp:n9,isDown:o9,isNavigation:function(a){return 37<=a&&40>=a}},Qg={convertToRange:function(a,b){a=ke.asLtrRange(a,b);return{start:k(p.fromDom(a.startContainer)),soffset:k(a.startOffset),finish:k(p.fromDom(a.endContainer)),foffset:k(a.endOffset)}},makeSitus:function(a,b,c,d){return{start:k(ha.on(a,b)),finish:k(ha.on(c,
d))}}},zK=function(a,b){return b.column()>=a.startCol()&&b.column()+b.colspan()-1<=a.finishCol()&&b.row()>=a.startRow()&&b.row()+b.rowspan()-1<=a.finishRow()},AK={inSelection:function(a,b){var c=b.column(),d=b.column()+b.colspan()-1,e=b.row();b=b.row()+b.rowspan()-1;return c<=a.finishCol()&&d>=a.startCol()&&e<=a.finishRow()&&b>=a.startRow()},isWithin:zK,isRectangular:function(a,b){for(var c=!0,d=t(zK,b),e=b.startRow();e<=b.finishRow();e++)for(var f=b.startCol();f<=b.finishCol();f++)c=c&&vb.getAt(a,
e,f).exists(d);return c?g.some(b):g.none()}},BK=function(a,b,c){b=vb.findItem(a,b,P.eq);var d=vb.findItem(a,c,P.eq);return b.bind(function(a){return d.map(function(b){return Ha.bounds(Math.min(a.row(),b.row()),Math.min(a.column(),b.column()),Math.max(a.row()+a.rowspan()-1,b.row()+b.rowspan()-1),Math.max(a.column()+a.colspan()-1,b.column()+b.colspan()-1))})})},CK={getAnyBox:BK,getBox:function(a,b,c){return BK(a,b,c).bind(function(b){return AK.isRectangular(a,b)})}},Yj={moveBy:function(a,b,c,d){return vb.findItem(a,
b,P.eq).bind(function(b){var e=0<c?b.row()+b.rowspan()-1:b.row();b=0<d?b.column()+b.colspan()-1:b.column();return vb.getAt(a,e+c,b+d).map(function(a){return a.element()})})},intercepts:function(a,b,c){return CK.getAnyBox(a,b,c).map(function(b){b=vb.filterItems(a,t(AK.inSelection,b));return F(b,function(a){return a.element()})})},parentCell:function(a,b){return vb.findItem(a,b,function(a,b){return P.contains(b,a)}).bind(function(a){return a.element()})}},Sn=function(a){a=Bf.fromTable(a);return vb.generate(a)},
Sh={moveBy:function(a,b,c){return mb.table(a).bind(function(d){d=Sn(d);return Yj.moveBy(d,a,b,c)})},intercepts:function(a,b,c){a=Sn(a);return Yj.intercepts(a,b,c)},nestedIntercepts:function(a,b,c,d,e){var f=Sn(a);b=P.eq(a,c)?b:Yj.parentCell(f,b);a=P.eq(a,e)?d:Yj.parentCell(f,d);return Yj.intercepts(f,b,a)},getBox:function(a,b,c){a=Sn(a);return CK.getBox(a,b,c)}},$t=function(a,b){return L.ancestor(a,"table")},Zj=ya(["boxes","start","finish"],[]),DK=function(a,b,c){var d=function(a){return function(b){return c(b)||
P.eq(b,a)}};return P.eq(a,b)?g.some(Zj({boxes:g.some([a]),start:a,finish:b})):$t(a,c).bind(function(e){return $t(b,c).bind(function(f){if(P.eq(e,f))return g.some(Zj({boxes:Sh.intercepts(e,a,b),start:a,finish:b}));if(P.contains(e,f)){var h=ca.ancestors(b,"td,th",d(e));h=0<h.length?h[h.length-1]:b;return g.some(Zj({boxes:Sh.nestedIntercepts(e,a,e,b,f),start:a,finish:h}))}return P.contains(f,e)?(h=ca.ancestors(a,"td,th",d(f)),h=0<h.length?h[h.length-1]:a,g.some(Zj({boxes:Sh.nestedIntercepts(f,a,e,b,
f),start:a,finish:h}))):He.ancestors(a,b).shared().bind(function(h){return L.closest(h,"table",c).bind(function(c){var h=ca.ancestors(b,"td,th",d(c));h=0<h.length?h[h.length-1]:b;var k=ca.ancestors(a,"td,th",d(c));k=0<k.length?k[k.length-1]:a;return g.some(Zj({boxes:Sh.nestedIntercepts(c,a,e,b,f),start:k,finish:h}))})})})})},p9=function(a,b){return va(a,function(a){return za.is(a,b)})},q9=function(a,b){return L.ancestor(a,"table").bind(function(c){return L.descendant(c,b).bind(function(b){return DK(b,
a).bind(function(a){return a.boxes().map(function(b){return{boxes:k(b),start:k(a.start()),finish:k(a.finish())}})})})})},lf={identify:DK,retrieve:function(a,b){a=ca.descendants(a,b);return 0<a.length?g.some(a):g.none()},shiftSelection:function(a,b,c,d,e){return p9(a,e).bind(function(a){return Sh.moveBy(a,b,c).bind(function(a){return q9(a,d)})})},getEdges:function(a,b,c){return L.descendant(a,b).bind(function(b){return L.descendant(a,c).bind(function(a){return He.sharedOne($t,[b,a]).map(function(c){return{first:k(b),
last:k(a),table:k(c)}})})})}},EK=function(a,b,c,d,e){return P.eq(c,d)?g.none():lf.identify(c,d,b).bind(function(b){var d=b.boxes().getOr([]);return 0<d.length?(e(a,d,b.start(),b.finish()),g.some(Qh.response(g.some(Qg.makeSitus(c,0,c,oa.getEnd(c))),!0))):g.none()})},au={sync:function(a,b,c,d,e,f,h){return P.eq(c,e)&&d===f?g.none():L.closest(c,"td,th",b).bind(function(c){return L.closest(e,"td,th",b).bind(function(d){return EK(a,b,c,d,h)})})},detect:EK,update:function(a,b,c,d,e){return lf.shiftSelection(d,
a,b,e.firstSelectedSelector(),e.lastSelectedSelector()).map(function(a){e.clear(c);e.selectRange(c,a.boxes(),a.start(),a.finish());return a.boxes()})}},Th=ya(["left","top","right","bottom"],[]),kd={nu:Th,moveUp:function(a,b){return Th({left:a.left(),top:a.top()-b,right:a.right(),bottom:a.bottom()-b})},moveDown:function(a,b){return Th({left:a.left(),top:a.top()+b,right:a.right(),bottom:a.bottom()+b})},moveBottomTo:function(a,b){var c=a.bottom()-a.top();return Th({left:a.left(),top:b-c,right:a.right(),
bottom:b})},moveTopTo:function(a,b){var c=a.bottom()-a.top();return Th({left:a.left(),top:b,right:a.right(),bottom:b+c})},getTop:function(a){return a.top()},getBottom:function(a){return a.bottom()},translate:function(a,b,c){return Th({left:a.left()+b,top:a.top()+c,right:a.right()+b,bottom:a.bottom()+c})},toString:function(a){return"("+a.left()+", "+a.top()+") -> ("+a.right()+", "+a.bottom()+")"}},Tn=function(a){return kd.nu({left:a.left,top:a.top,right:a.right,bottom:a.bottom})},Un={getBoxAt:function(a,
b,c){return C.isElement(b)?g.some(a.getRect(b)).map(Tn):C.isText(b)?(a=0<=c&&c<oa.getEnd(b)?a.getRangedRect(b,c,b,c+1):0<c?a.getRangedRect(b,c-1,b,c):g.none(),a.map(Tn)):g.none()},getEntireBox:function(a,b){return C.isElement(b)?g.some(a.getRect(b)).map(Tn):C.isText(b)?a.getRangedRect(b,0,b,oa.getEnd(b)).map(Tn):g.none()}},ne=sa.generate([{none:[]},{retry:["caret"]}]),FK=function(a,b,c){return Da.closest(b,la.isBlock).fold(k(!1),function(b){return Un.getEntireBox(a,b).exists(function(a){return c.left()<
a.left()||1>Math.abs(a.right()-c.left())||c.left()>a.right()})})},r9={point:kd.getBottom,adjuster:function(a,b,c,d,e){var f=kd.moveDown(e,5);return 1>Math.abs(c.bottom()-d.bottom())?ne.retry(f):c.top()>e.bottom()?ne.retry(f):c.top()===e.bottom()?ne.retry(kd.moveDown(e,1)):FK(a,b,e)?ne.retry(kd.translate(f,5,0)):ne.none()},move:kd.moveDown,gather:mc.after},s9=function(a,b,c){return a.elementFromPoint(b,c).filter(function(a){return"table"===C.name(a)}).isSome()},t9=function(a,b,c,d,e){return bu(a,b,
c,b.move(d,5),e)},bu=function(a,b,c,d,e){return 0===e?g.some(d):s9(a,d.left(),b.point(d))?t9(a,b,c,d,e-1):a.situsFromPoint(d.left(),b.point(d)).bind(function(f){return f.start().fold(g.none,function(f,k){return Un.getEntireBox(a,f,k).bind(function(h){return b.adjuster(a,f,h,c,d).fold(g.none,function(d){return bu(a,b,c,d,e-1)})}).orThunk(function(){return g.some(d)})},g.none)})},u9=function(a,b,c){return a.point(b)>c.getInnerHeight()?g.some(a.point(b)-c.getInnerHeight()):0>a.point(b)?g.some(-a.point(b)):
g.none()},GK=function(a,b,c){var d=a.move(c,5),e=bu(b,a,c,d,100).getOr(d);return u9(a,e,b).fold(function(){return b.situsFromPoint(e.left(),a.point(e))},function(c){b.scrollBy(0,c);return b.situsFromPoint(e.left(),a.point(e)-c)})},ak={tryUp:t(GK,{point:kd.getTop,adjuster:function(a,b,c,d,e){var f=kd.moveUp(e,5);return 1>Math.abs(c.top()-d.top())?ne.retry(f):c.bottom()<e.top()?ne.retry(f):c.bottom()===e.top()?ne.retry(kd.moveUp(e,1)):FK(a,b,e)?ne.retry(kd.translate(f,5,0)):ne.none()},move:kd.moveUp,
gather:mc.before}),tryDown:t(GK,r9),ieTryUp:function(a,b){return a.situsFromPoint(b.left(),b.top()-5)},ieTryDown:function(a,b){return a.situsFromPoint(b.left(),b.bottom()+5)},getJumpSize:k(5)},Vn=sa.generate([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),v9=function(a){return L.closest(a,"tr")},Uh={verify:function(a,b,c,d,e,f,h){return L.closest(d,"td,th",h).bind(function(c){return L.closest(b,"td,th",h).map(function(b){return P.eq(c,b)?P.eq(d,c)&&oa.getEnd(c)===e?f(b):
Vn.none("in same cell"):He.sharedOne(v9,[c,b]).fold(function(){var d=a.getRect(b),e=a.getRect(c);return e.right>d.left&&e.left<d.right?Vn.success():f(b)},function(a){return f(b)})})}).getOr(Vn.none("default"))},cata:function(a,b,c,d,e){return a.fold(b,c,d,e)},adt:Vn},w9=M("ancestor","descendants","element","index"),HK=M("parent","children","element","index"),Wn=function(a,b){return Ta(a,t(P.eq,b))},x9={childOf:function(a,b){return Da.closest(a,function(a){return B.parent(a).exists(function(a){return P.eq(a,
b)})})},indexOf:Wn,indexInParent:function(a){return B.parent(a).bind(function(b){var c=B.children(b);return Wn(c,a).map(function(d){return HK(b,c,a,d)})})},selectorsInParent:function(a,b){return B.parent(a).bind(function(c){var d=ca.children(c,b);return Wn(d,a).map(function(b){return HK(c,d,a,b)})})},descendantsInAncestor:function(a,b,c){return L.closest(a,b).bind(function(b){var d=ca.descendants(b,c);return Wn(d,a).map(function(c){return w9(b,d,a,c)})})}},cu=function(a){return"br"===C.name(a)},du=
function(a,b,c){return b(a,c).bind(function(a){return C.isText(a)&&0===Oa.get(a).trim().length?du(a,b,c):g.some(a)})},y9=function(a,b,c){return c.traverse(b).orThunk(function(){return du(b,c.gather,a)}).map(c.relative)},z9=function(a,b){return B.child(a,b).filter(cu).orThunk(function(){return B.child(a,b-1).filter(cu)})},A9=function(a,b,c,d){return z9(b,c).bind(function(b){return d.traverse(b).fold(function(){return du(b,d.gather,a).map(d.relative)},function(a){return x9.indexInParent(a).map(function(a){return ha.on(a.parent(),
a.index())})})})},IK={tryBr:function(a,b,c,d){return(cu(b)?y9(a,b,d):A9(a,b,c,d)).map(function(a){return{start:k(a),finish:k(a)}})},process:function(a){return Uh.cata(a,function(a){return g.none()},function(){return g.none()},function(a){return g.some(W.point(a,0))},function(a){return g.some(W.point(a,oa.getEnd(a)))})}},bk=ba.detect(),B9=function(a,b,c){return a.getSelection().bind(function(d){return IK.tryBr(b,d.finish(),d.foffset(),c).fold(function(){return g.some(W.point(d.finish(),d.foffset()))},
function(e){e=a.fromSitus(e);e=Uh.verify(a,d.finish(),d.foffset(),e.finish(),e.foffset(),c.failure,b);return IK.process(e)})})},eu=function(a,b,c,d,e,f){return 0===f?g.none():C9(a,b,c,d,e).bind(function(h){var k=a.fromSitus(h);k=Uh.verify(a,c,d,k.finish(),k.foffset(),e.failure,b);return Uh.cata(k,function(){return g.none()},function(){return g.some(h)},function(h){return P.eq(c,h)&&0===d?JK(a,c,d,kd.moveUp,e):eu(a,b,h,0,e,f-1)},function(h){return P.eq(c,h)&&d===oa.getEnd(h)?JK(a,c,d,kd.moveDown,e):
eu(a,b,h,oa.getEnd(h),e,f-1)})})},JK=function(a,b,c,d,e){return Un.getBoxAt(a,b,c).bind(function(b){return KK(a,e,d(b,ak.getJumpSize()))})},KK=function(a,b,c){return bk.browser.isChrome()||bk.browser.isSafari()||bk.browser.isFirefox()||bk.browser.isEdge()?b.otherRetry(a,c):bk.browser.isIE()?b.ieRetry(a,c):g.none()},C9=function(a,b,c,d,e){return Un.getBoxAt(a,c,d).bind(function(b){return KK(a,e,b)})},D9={handle:function(a,b,c){return B9(a,b,c).bind(function(d){return eu(a,b,d.element(),d.offset(),
c,20).map(a.fromSitus)})}},E9=ba.detect(),F9=function(a,b){return ed.ancestor(a,function(a){return B.parent(a).exists(function(a){return P.eq(a,b)})})},LK=function(a,b,c,d,e){return L.closest(d,"td,th",b).bind(function(d){return L.closest(d,"table",b).bind(function(f){return F9(e,f)?D9.handle(a,b,c).bind(function(a){return L.closest(a.finish(),"td,th",b).map(function(b){return{start:k(d),finish:k(b),range:k(a)}})}):g.none()})})},MK=function(a,b,c,d,e,f){return E9.browser.isIE()?g.none():f(d,b).orThunk(function(){return LK(a,
b,c,d,e).map(function(a){a=a.range();return Qh.response(g.some(Qg.makeSitus(a.start(),a.soffset(),a.finish(),a.foffset())),!0)})})},NK=function(a,b,c,d,e,f,h){return LK(a,c,d,e,f).bind(function(a){return au.detect(b,c,a.start(),a.finish(),h)})},G9=function(a,b){return L.closest(a,"tr",b).bind(function(a){return L.closest(a,"table",b).bind(function(c){var d=ca.descendants(c,"tr");return P.eq(a,d[0])?mc.seekLeft(c,function(a){return ac.last(a).isSome()},b).map(function(a){var b=oa.getEnd(a);return Qh.response(g.some(Qg.makeSitus(a,
b,a,b)),!0)}):g.none()})})},H9=function(a,b){return L.closest(a,"tr",b).bind(function(a){return L.closest(a,"table",b).bind(function(c){var d=ca.descendants(c,"tr");return P.eq(a,d[d.length-1])?mc.seekRight(c,function(a){return ac.first(a).isSome()},b).map(function(a){return Qh.response(g.some(Qg.makeSitus(a,0,a,0)),!0)}):g.none()})})},fx=function(a,b){return L.closest(a,"td,th",b)},OK={traverse:B.nextSibling,gather:mc.after,relative:ha.before,otherRetry:ak.tryDown,ieRetry:ak.ieTryDown,failure:Uh.adt.failedDown},
PK={traverse:B.prevSibling,gather:mc.before,relative:ha.before,otherRetry:ak.tryUp,ieRetry:ak.ieTryUp,failure:Uh.adt.failedUp},Vh=M("rows","cols"),ix={mouse:function(a,b,c,d){a=ex(a);b=TR(a,b,c,d);return{mousedown:b.mousedown,mouseover:b.mouseover,mouseup:b.mouseup}},keyboard:function(a,b,c,d){var e=ex(a),f=function(){d.clear(b);return g.none()};return{keydown:function(a,k,m,n,p,q){var h=a.raw().which,l=!0===a.raw().shiftKey;return lf.retrieve(b,d.selectedSelector()).fold(function(){return td.isDown(h)&&
l?t(NK,e,b,c,OK,n,k,d.selectRange):td.isUp(h)&&l?t(NK,e,b,c,PK,n,k,d.selectRange):td.isDown(h)?t(MK,e,c,OK,n,k,H9):td.isUp(h)?t(MK,e,c,PK,n,k,G9):g.none},function(a){var c=function(c){return function(){return oc(c,function(c){return au.update(c.rows(),c.cols(),b,a,d)}).fold(function(){return lf.getEdges(b,d.firstSelectedSelector(),d.lastSelectedSelector()).map(function(a){var c=td.isDown(h)||q.isForward(h)?ha.after:ha.before;e.setRelativeSelection(ha.on(a.first(),0),c(a.table()));d.clear(b);return Qh.response(g.none(),
!0)})},function(a){return g.some(Qh.response(g.none(),!0))})}};return td.isDown(h)&&l?c([Vh(1,0)]):td.isUp(h)&&l?c([Vh(-1,0)]):q.isBackward(h)&&l?c([Vh(0,-1),Vh(-1,0)]):q.isForward(h)&&l?c([Vh(0,1),Vh(1,0)]):td.isNavigation(h)&&!1===l?f:g.none})()},keyup:function(a,e,f,k,m){return lf.retrieve(b,d.selectedSelector()).fold(function(){var h=a.raw().which;return!0===a.raw().shiftKey===!1?g.none():td.isNavigation(h)?au.sync(b,c,e,f,k,m,d.selectRange):g.none()},g.none)}}}},gx={byClass:function(a){var b=
Ue.addClass(a.selected()),c=Ue.removeClasses([a.selected(),a.lastSelected(),a.firstSelected()]),d=function(b){b=ca.descendants(b,a.selectedSelector());A(b,c)};return{clear:d,selectRange:function(c,f,h,g){d(c);A(f,b);n.add(h,a.firstSelected());n.add(g,a.lastSelected())},selectedSelector:a.selectedSelector,firstSelectedSelector:a.firstSelectedSelector,lastSelectedSelector:a.lastSelectedSelector}},byAttr:function(a){var b=function(b){m.remove(b,a.selected());m.remove(b,a.firstSelected());m.remove(b,
a.lastSelected())},c=function(b){m.set(b,a.selected(),"1")},d=function(c){c=ca.descendants(c,a.selectedSelector());A(c,b)};return{clear:d,selectRange:function(b,f,h,g){d(b);A(f,c);m.set(h,a.firstSelected(),"1");m.set(g,a.lastSelected(),"1")},selectedSelector:a.selectedSelector,firstSelectedSelector:a.firstSelectedSelector,lastSelectedSelector:a.lastSelectedSelector}}},jx={retrieve:function(a,b){return lf.retrieve(a,b)},retrieveBox:function(a,b,c){return lf.getEdges(a,b,c).bind(function(b){var c=function(b){return P.eq(a,
b)},d=L.ancestor(b.first(),"thead,tfoot,tbody,table",c),h=L.ancestor(b.last(),"thead,tfoot,tbody,table",c);return d.bind(function(a){return h.bind(function(c){return P.eq(a,c)?Sh.getBox(b.table(),b.first(),b.last()):g.none()})})})}},WR={configure:function(a){A([a.output(),a.internal()],function(b){var c=[Vd.lastSelected(),Vd.firstSelected(),Vd.selected()],d=F(c,function(a){return"."+a}).join(",");a.addSelector(b,d,function(a){A(a,Ue.removeClasses(c))})})}},QK=function(a){return 0===a.button},Xn=function(a,
b){return{bind:function(c,d){return Bq.bind(c,a,b,d)}}},Yk={realClick:Xn("click",function(a){return 6===a.mozInputSource||0===a.mozInputSource?!1:void 0!==a.isTrusted&&!0!==a.isTrusted?!1:!0}),leftDown:Xn("mousedown",QK),leftPressedOver:Xn("mouseover",function(a){return void 0===a.buttons?!0:0!==(a.buttons&1)}),leftUp:Xn("mouseup",QK)},hx=ba.detect(),ZR=function(a){var b=ba.detect(),c=b.os.isOSX(),d=b.os.isLinux(),e=c?R.META():R.CTRL();b=[[e,"Z"]];var f=c?[[R.META(),R.SHIFT(),"Z"]]:d?[[R.CTRL(),"Y"],
[R.CTRL(),R.SHIFT(),"Z"]]:[[R.CTRL(),"Y"]],h=[[R.SHIFT(),121]],g=c?[[R.ALT(),121]]:[[121]],k=[[e,R.SHIFT(),"F"]];d=c?[[R.META(),R.ALT(),"U"]]:d?[[R.CTRL(),R.ALT(),"U"]]:[[R.CTRL(),R.SHIFT(),"U"]];c=c?[[R.CTRL(),R.ALT(),"H"]]:[[R.CTRL(),R.SHIFT(),"H"]];var m=[[e,"B"]],n=[[e,"I"]],p=[[e,"U"]],q=[[e,221],[e,"M"]],t=[[e,219],[e,R.SHIFT(),"M"]],u=[[e,R.SHIFT(),"9"]],v=[[e,"K"]];e=[[e,"F"]];var w=M("keys","trigger");return{undo:w(b,a.trigger.undo),redo:w(f,a.trigger.redo),context:w(h,a.trigger.context),
toolbar:w(g,a.trigger.toolbar),bold:w(m,a.trigger.bold),italic:w(n,a.trigger.italic),underline:w(p,a.trigger.underline),indent:w(q,a.trigger.indent),outdent:w(t,a.trigger.outdent),link:w(v,a.trigger.link),search:w(e,a.trigger.search),blockquote:w(u,a.trigger.blockquote),help:w(c,a.trigger.help),fullscreen:w(k,a.trigger.fullscreen),plaincode:w(d,a.trigger.plaincode)}},$R=function(a,b){return function(c){return V(a,c)?g.some(b):g.none()}},RK=function(a){return function(b){return b.key()===a}},I9=M("key",
"value"),bS={put:function(a,b,c,d,e){var f=void 0!==d?d:I9,h=void 0!==e?e:RK(b);a=hb(a,function(a,d){var e=h(d)?f(b,c):d;return{updated:h(d)||a.updated,acc:a.acc.concat([e])}},{updated:!1,acc:[]});return a.updated?a.acc:a.acc.concat([f(b,c)])},get:function(a,b,c){b=void 0!==c?c:RK(b);return va(a,b)}},cS=M("popup","anchor"),kx={bind:function(a,b){var c=Pa.get(a);return{unbind:J.bind(a,"scroll",function(d){d=Pa.get(a);d.top()===c.top()&&d.left()===c.left()||b(d);c=d}).unbind}}},jS={isDefaultEmpty:function(a){return/^\s*<p>\s*<br\s?\/?>\s*<\/p>\s*$/.test(a)}},
hS={fromInitial:function(a){return lx({initial:a,undo:[],redo:[]})},fromState:function(a){return lx(a)}},Zk=M("raw","marked"),iS=function(a){return Zk(a.raw,a.marked)},mx=function(a,b){return{initial:b(a.initial),undo:F(a.undo,b),redo:F(a.redo,b)}},kS=function(a){return{raw:a.raw(),marked:a.marked()}},fu=sa.generate([{aboveView:["item"]},{inView:["item"]},{belowView:["item"]}]),bg={aboveView:fu.aboveView,inView:fu.inView,belowView:fu.belowView,cata:function(a,b,c,d){return a.fold(b,c,d)}},IW=function(a,
b,c){var d=Bw(a),e=QR(c.profile),f=pR(c.filters),h=rR(),l=Y7(f,h,a.content,b,c.content),m=VR(b,f,l),n=YR(l,a.shortcuts),p=a.ui.layout.bounds(a.ui),q=dS(l,p,b,a.ui),t=!1!==a.fullscreen.bundled?qR(l,n,a.fullscreen):Ja.fullscreen(),u=PR(l,q,b,t,a.platform),v=fS(l,n,q,u,t,b,a.ui,c.ui),y=vR(l,v),z=gS(f,l,y,n,c.undo),B=hR(l,m,y,z),C=RR(l,y,z),E=xR(f,l),F=kR(l,z,a.editorcontext),G=lS(l,a.ui.autoresize),J=SR(v,a.registration),K=fR(b,l,y,n,q,a.contextmenu),M=Nw.onNodeChange(l,E),N=rv(c.laundry);z.events.changed.bind(function(){N.setDirty(!0)});
N.events.clean.bind(function(){l.undoChanged()});l.events.interaction.bind(function(a){!N.isDirty()&&z.checkChanged()&&N.setDirty(!0)});var O=ba.detect(),P=O.deviceType.isTouch();p=n.isHelpShortcutEnabled();c=!l.isInline()&&!P&&a.ui.showHelpHint;a=$6.editor(a.ui.editorName,a.ui.isFullScreen);O=w.translate(O.os.isOSX()?"aria.help.mac":"aria.help.ctrl");p=p?g.some(O):g.none();var Q=(l.isInline()?T.inline:T.editor)(v.element(),l.element(),a,p,c),R=g.none();l.runOrOnLoaded(function(a){var b=Xk.handle(a,
function(a){L.closest(a.target(),"a").each(function(b){L.closest(b,'[contenteditable="false"]').each(a.kill)})});R=g.some(b);P&&(T.label(a,w.translate("aria.label.content")),T.region(v.viewport()),T.region(v.tabstrip.element()))});return{region:k(b),communication:k(d),profile:k(e),filter:k(f),internalevents:k(h),content:k(l),keyboard:k(y),shortcuts:k(n),smartview:k(q),undo:k(z),del:k(B),proximity:k(C),operations:k(E),context:k(F),fullscreen:k(t),platform:k(u),registration:k(J),contextmenu:k(K),ui:k(v),
selections:k(m),insertFilteredHtmlAtCursor:function(a){a=f.filterHtml(f.input(),a);l.insertHtmlAtCursor(a)},viewablearea:k(G),laundry:k(N),state:function(){return{ui:v.state(),undo:z.state(),content:l.state(),profile:e.state(),laundry:N.state()}},destroy:function(){R.each(function(a){a.unbind()});A([l,G,M,K,J,u,t,F,E,C,z,B,q,n,y,m,f,e,d,v],function(a){a.destroy?a.destroy():console.log("Feature missing destroy method: ",a)});Q.destroy()}}},Fb={resolve:Hb.create("ephox-hermes").resolve},SK=function(){var a=
G.create({upload:q(["files"])}),b=p.fromTag("input");n.add(b,Fb.resolve("hidden"));n.add(b,Fb.resolve("file-selector-input"));m.setAll(b,{type:"file",accept:"image/*"});var c=J.bind(b,"change",function(b){b=Xd.toFiles(b);a.trigger.upload(b)});return{element:k(b),open:function(){da.set(b,"");b.dom().click()},destroy:function(){c.unbind()},events:a.registry}},ox={single:SK,multiple:function(){var a=SK();m.set(a.element(),"multiple","multiple");return{element:a.element,open:a.open,destroy:a.destroy,
events:a.events}}},TK=function(a,b){return F(b,function(b){var c=p.fromTag("img"),e=J.bind(c,"load",function(){e.unbind();a.domChanged()});b=Bc.cata(b,function(a,b,c){return c},function(a,b,c){return b});m.set(c,"src",b);return c})},wp={insertMobileAssets:function(a,b,c,d){var e=TK(a,d);return a.undoOperation(function(){var f=bd.insertAt(a,b,e);c.uploadAssets(d);return f})},insertAssets:function(a,b,c){var d=TK(a,c);a.focus();a.undoOperation(function(){bd.insertAtCursor(a,d).each(function(b){a.setSelection(b.element(),
b.offset(),b.element(),b.offset())});b.uploadAssets(c)})}},bc={resolve:Hb.create("ephox-gel").resolve},pS=ba.detect().deviceType.isiOS(),qS=ba.detect(),UK=function(a){a.dom().click();return g.some(a)},Nb={setup:function(a,b,c){b=xa.dialog({execute:function(a){a.dom().click()},ok:b.ok().element(),cancel:b.cancel().element()});a=ea.dialog(a.element(),c,b);return{enter:a.enter,exit:a.exit,destroy:a.destroy}},button:function(a){return(za.is(a,".ephox-pastry-button")?g.some(a):L.descendant(a,".ephox-pastry-button")).bind(UK)},
click:UK,radio:function(a,b,c){b={item:k(b),selected:k(c)};return ea.radio(a,b,xa.radio({one:function(a,b){b.dom().click()}}))}},sS={previewAsset:function(a,b){Bc.cata(a,yb("asset should not be a file type"),function(a,d,e){n.add(b,Fb.resolve("fluid-image"));m.set(b,"src",d)})}},rx=ba.detect(),cg=M("heading","renderer"),up={left:k("left"),top:k("top")},J9=["image"],K9=function(a,b,c){return Va(J9,function(a){return ta(b.getType())&&-1<b.getType().indexOf(a)})},CS={validate:function(a){a=hb(a,function(a,
c){return!1===Bc.cata(c,K9,k(!0))?{assets:a.assets,failure:!0}:{assets:a.assets.concat([c]),failure:a.failure}},{assets:[],failure:!1});return{assets:k(a.assets),failure:k(a.failure)}}},oe={multiple:function(a){return Xd.multiple(a)},single:function(a){return Xd.single(a)},singleWithUrl:function(a,b){return Xd.singleWithUrl(a,b)}},gu=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,
.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],Je={identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:vp,multiply:mf,adjustContrast:function(a,b){b=Nd(b,-1,1);b*=100;if(0>b)var c=127+b/100*127;else c=b%1,c=0===c?gu[b]:gu[Math.floor(b)]*(1-c)+gu[Math.floor(b)+1]*c,c=127*c+127;return mf(a,
[c/127,0,0,0,.5*(127-c),0,c/127,0,0,.5*(127-c),0,0,c/127,0,.5*(127-c),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(a,b){b=Nd(255*b,-255,255);return mf(a,[1,0,0,0,b,0,1,0,0,b,0,0,1,0,b,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(a,b){b=Nd(b,-1,1);b=1+(0<b?3*b:b);return mf(a,[.3086*(1-b)+b,.6094*(1-b),.082*(1-b),0,0,.3086*(1-b),.6094*(1-b)+b,.082*(1-b),0,0,.3086*(1-b),.6094*(1-b),.082*(1-b)+b,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(a,b){b=Nd(b,-180,180)/180*Math.PI;var c=Math.cos(b);
b=Math.sin(b);return mf(a,[.213+.787*c+-.213*b,.715+-.715*c+-.715*b,.072+-.072*c+.928*b,0,0,.213+-.213*c+.143*b,.715+c*(1-.715)+.14*b,.072+-.072*c+-.283*b,0,0,.213+-.213*c+-.787*b,.715+-.715*c+.715*b,.072+.928*c+.072*b,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(a,b,c,d){b=Nd(b,0,2);c=Nd(c,0,2);d=Nd(d,0,2);return mf(a,[b,0,0,0,0,0,c,0,0,0,0,0,d,0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(a,b){b=Nd(b,0,1);return mf(a,vp([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,
0,0,0,1],b))},adjustGrayscale:function(a,b){b=Nd(b,0,1);return mf(a,vp([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],b))}},Ed={invert:function(a){return function(b){return $k(b,a)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:Sg(Je.adjustBrightness),hue:Sg(Je.adjustHue),saturate:Sg(Je.adjustSaturation),contrast:Sg(Je.adjustContrast),grayscale:Sg(Je.adjustGrayscale),sepia:Sg(Je.adjustSepia),colorize:function(a,b,c,d){return $k(a,Je.adjustColors(Je.identity(),
b,c,d))},sharpen:yx([0,-1,0,-1,5,-1,0,-1,0]),emboss:yx([-2,-1,0,-1,1,1,0,1,2]),gamma:xx(function(a,b){return 255*Math.pow(a/255,1-b)}),exposure:xx(function(a,b){return 255*(1-Math.exp(-(a/255)*b))}),colorFilter:$k,convoluteFilter:wx},L9={scale:zx},Yn={rotate:function(a,b){return a.toCanvas().then(function(c){var d=a.getType(),e=b,f=Hc.create(c.width,c.height),h=Hc.get2dContext(f),g=0,k=0;e=0>e?360+e:e;90!=e&&270!=e||Hc.resize(f,f.height,f.width);if(90==e||180==e)g=f.width;if(270==e||180==e)k=f.height;
h.translate(g,k);h.rotate(e*Math.PI/180);h.drawImage(c,0,0);return Yd.fromCanvas(f,d)})},flip:function(a,b){return a.toCanvas().then(function(c){var d=a.getType(),e=Hc.create(c.width,c.height),f=Hc.get2dContext(e);"v"==b?(f.scale(1,-1),f.drawImage(c,0,-e.height)):(f.scale(-1,1),f.drawImage(c,-e.width,0));return Yd.fromCanvas(e,d)})},crop:function(a,b,c,d,e){return a.toCanvas().then(function(f){var h=a.getType(),g=Hc.create(d,e);Hc.get2dContext(g).drawImage(f,-b,-c);return Yd.fromCanvas(g,h)})},resize:function(a,
b,c){return a.toCanvas().then(function(d){return L9.scale(d,b,c).then(function(b){return Yd.fromCanvas(b,a.getType())})})}},VK=function(){function a(a){this.littleEndian=!1;this._dv=new DataView(a)}a.prototype.readByteAt=function(a){return this._dv.getUint8(a)};a.prototype.read=function(a,c){if(a+c>this.length())return null;for(var b=this.littleEndian?0:-8*(c-1),e=0,f=0;e<c;e++)f|=this.readByteAt(a+e)<<Math.abs(b+8*e);return f};a.prototype.BYTE=function(a){return this.read(a,1)};a.prototype.SHORT=
function(a){return this.read(a,2)};a.prototype.LONG=function(a){return this.read(a,4)};a.prototype.SLONG=function(a){a=this.read(a,4);return 2147483647<a?a-4294967296:a};a.prototype.CHAR=function(a){return String.fromCharCode(this.read(a,1))};a.prototype.STRING=function(a,c){return this.asArray("CHAR",a,c).join("")};a.prototype.SEGMENT=function(a,c){var b=this._dv.buffer;switch(arguments.length){case 2:return b.slice(a,a+c);case 1:return b.slice(a);default:return b}};a.prototype.asArray=function(a,
c,d){for(var b=[],f=0;f<d;f++)b[f]=this[a](c+f);return b};a.prototype.length=function(){return this._dv?this._dv.byteLength:0};return a}(),M9={274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},N9={36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",
37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},O9={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},P9={513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"},WK={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",
6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",
7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",
71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},
ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},Q9=function(){function a(a){this._offsets=
{tiffHeader:10,IFD0:null,IFD1:null,exifIFD:null,gpsIFD:null};this._tiffTags={};this._reader=new VK(a);this._idx=this._offsets.tiffHeader;if(65505!==this.SHORT(0)||"EXIF\x00"!==this.STRING(4,5).toUpperCase())throw Error("Exif data cannot be read or not available.");this._reader.littleEndian=18761==this.SHORT(this._idx);if(42!==this.SHORT(this._idx+=2))throw Error("Invalid Exif data.");this._offsets.IFD0=this._offsets.tiffHeader+this.LONG(this._idx+=2);this._tiffTags=this.extractTags(this._offsets.IFD0,
M9);"ExifIFDPointer"in this._tiffTags&&(this._offsets.exifIFD=this._offsets.tiffHeader+this._tiffTags.ExifIFDPointer,delete this._tiffTags.ExifIFDPointer);"GPSInfoIFDPointer"in this._tiffTags&&(this._offsets.gpsIFD=this._offsets.tiffHeader+this._tiffTags.GPSInfoIFDPointer,delete this._tiffTags.GPSInfoIFDPointer);if(a=this.LONG(this._offsets.IFD0+12*this.SHORT(this._offsets.IFD0)+2))this._offsets.IFD1=this._offsets.tiffHeader+a}a.prototype.BYTE=function(a){return this._reader.BYTE(a)};a.prototype.SHORT=
function(a){return this._reader.SHORT(a)};a.prototype.LONG=function(a){return this._reader.LONG(a)};a.prototype.SLONG=function(a){return this._reader.SLONG(a)};a.prototype.CHAR=function(a){return this._reader.CHAR(a)};a.prototype.STRING=function(a,c){return this._reader.STRING(a,c)};a.prototype.SEGMENT=function(a,c){return this._reader.SEGMENT(a,c)};a.prototype.asArray=function(a,c,d){for(var b=[],f=0;f<d;f++)b[f]=this[a](c+f);return b};a.prototype.length=function(){return this._reader.length()};
a.prototype.UNDEFINED=function(){return this.BYTE.apply(this,arguments)};a.prototype.RATIONAL=function(a){return this.LONG(a)/this.LONG(a+4)};a.prototype.SRATIONAL=function(a){return this.SLONG(a)/this.SLONG(a+4)};a.prototype.ASCII=function(a){return this.CHAR(a)};a.prototype.TIFF=function(){return this._tiffTags};a.prototype.EXIF=function(){var a=null;if(this._offsets.exifIFD){try{a=this.extractTags(this._offsets.exifIFD,N9)}catch(e){return null}if(a.ExifVersion&&Array.isArray(a.ExifVersion)){for(var c=
0,d="";c<a.ExifVersion.length;c++)d+=String.fromCharCode(a.ExifVersion[c]);a.ExifVersion=d}}return a};a.prototype.GPS=function(){var a=null;if(this._offsets.gpsIFD){try{a=this.extractTags(this._offsets.gpsIFD,O9)}catch(c){return null}a.GPSVersionID&&Array.isArray(a.GPSVersionID)&&(a.GPSVersionID=a.GPSVersionID.join("."))}return a};a.prototype.thumb=function(){if(this._offsets.IFD1)try{var a=this.extractTags(this._offsets.IFD1,P9);if("JPEGInterchangeFormat"in a)return this.SEGMENT(this._offsets.tiffHeader+
a.JPEGInterchangeFormat,a.JPEGInterchangeFormatLength)}catch(c){}return null};a.prototype.extractTags=function(a,c){var b,e={},f={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},h={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};var g=this.SHORT(a);for(b=0;b<g;b++){var k=a+2+12*b;var m=c[this.SHORT(k)];if(void 0!==m){var n=f[this.SHORT(k+=2)];var p=this.LONG(k+=2);var q=h[n];if(!q)throw Error("Invalid Exif data.");k+=4;4<q*p&&(k=
this.LONG(k)+this._offsets.tiffHeader);if(k+q*p>=this.length())throw Error("Invalid Exif data.");"ASCII"===n?e[m]=this.STRING(k,p).replace(/\0$/,"").trim():(n=this.asArray(n,k,p),p=1==p?n[0]:n,WK.hasOwnProperty(m)&&"object"!=typeof p?e[m]=WK[m][p]:e[m]=p)}}return e};return a}(),R9=function(a){var b=[],c;for(c=2;c<=a.length();){var d=a.SHORT(c);if(65488<=d&&65495>=d)c+=2;else{if(65498===d||65497===d)break;var e=a.SHORT(c+2)+2;65505<=d&&65519>=d&&b.push({hex:d,name:"APP"+(d&15),start:c,length:e,segment:a.SEGMENT(c,
e)});c+=e}}return b},S9=function(a){return Wc.blobToArrayBuffer(a).then(function(b){try{var c=new VK(b);if(65496===c.SHORT(0)){var d=R9(c),e=d.filter(function(a){return"APP1"===a.name});b={};if(e.length){var f=new Q9(e[0].segment);b={tiff:f.TIFF(),exif:f.EXIF(),gps:f.GPS(),thumb:f.thumb()}}else return sd.reject("Headers did not include required information");b.rawHeaders=d;return b}return sd.reject("Image was not a jpeg")}catch(h){return sd.reject("Unsupported format or not an image: "+a.type+" (Exception: "+
h.message+")")}})},Zn=function(a,b){return Yn.rotate(a,b)},Wh={invert:function(a){return Ed.invert(a)},sharpen:function(a){return Ed.sharpen(a)},emboss:function(a){return Ed.emboss(a)},brightness:function(a,b){return Ed.brightness(a,b)},hue:function(a,b){return Ed.hue(a,b)},saturate:function(a,b){return Ed.saturate(a,b)},contrast:function(a,b){return Ed.contrast(a,b)},grayscale:function(a,b){return Ed.grayscale(a,b)},sepia:function(a,b){return Ed.sepia(a,b)},colorize:function(a,b,c,d){return Ed.colorize(a,
b,c,d)},gamma:function(a,b){return Ed.gamma(a,b)},exposure:function(a,b){return Ed.exposure(a,b)},flip:function(a,b){return Yn.flip(a,b)},crop:function(a,b,c,d,e){return Yn.crop(a,b,c,d,e)},resize:function(a,b,c){return Yn.resize(a,b,c)},rotate:Zn,exifRotate:function(a){return a.toBlob().then(S9).then(function(b){switch(b.tiff.Orientation){case 6:return Zn(a,90);case 3:return Zn(a,180);case 8:return Zn(a,270);default:return a}},function(){return a})}},ck=function(a){return function(b){return Lc.blobToImageResult(b).then(function(b){return a(b)}).then(Lc.imageResultToOriginalBlob)}},
XK=function(a){return ck(function(b){return Wh.rotate(b,a)})},YK=function(a){return ck(function(b){return Wh.flip(b,a)})},T9=function(a){return ck(function(b){return Wh.resize(b,a.width(),a.height())})},U9=La.pToFR(ck(Wh.sharpen)),V9=La.pToFR(XK(-90)),W9=La.pToFR(XK(90)),X9=La.pToFR(YK("v")),Y9=La.pToFR(YK("h")),fg={rotateLeft:V9,rotateRight:W9,flipVertical:X9,flipHorizontal:Y9,sharpen:U9,crop:function(a,b,c,d){return La.pToFR(ck(function(e){return Wh.crop(e,a,b,c,d)}))},resizeTo:function(a){return La.pToFR(T9(a))},
doExifRotate:function(a){return La.fromPromise(Wh.exifRotate(a))}},ZK={mapIfSet:function(a,b){return La.map(a,function(a){return a.map(b)})},applyIfSet:function(a){return function(b){return La.bind(a,function(a){return a.fold(function(){return La.pure(b)},function(a){return a(b)})})}}},Ji={partition:function(a){var b=[],c=[];A(a,function(a){a.fold(function(a){b.push(a)},function(a){c.push(a)})});return{errors:b,values:c}}},$n=M("width","height"),$K=sa.generate([{special:["size"]},{regular:["value",
"size","unit"]}]),ao={identify:function(a){a=a.match(/(\d*\.?\d*)(.*)/);return""!==a[1]?$K.regular(a[0],Number(a[1]),a[2]):$K.special(a[0])}},Z9=function(a,b){return v.getRaw(a,b).orThunk(function(){return m.has(a,b)?g.some(m.get(a,b)):g.none()}).bind(function(a){return ao.identify(a).fold(function(a){return g.none()},function(a,b,c){switch(c){case "":case "px":return g.some(parseInt(b,10));default:return g.none()}})})},hu=function(a,b,c){b=b(a);return 0<b?g.some(b):Z9(a,c)},$9={get:function(a){return hu(a,
Aa.get,"width").bind(function(b){return hu(a,pa.get,"height").map(function(a){return $n(b,a)})})},measure:hu},aL=function(a,b){a=b/a;return 1>a?a:1},a$=function(a,b){var c=aL(a.height,b.height);return 1===c?a:{width:a.width*c,height:b.height}},b$=function(a,b){var c=aL(a.width,b.width);return 1===c?a:{width:b.width,height:a.height*c}},c$={max:function(a,b){var c=0<b.height?b.height:0;b=0<b.width?b.width:0;if(!(a.height>c||a.width>b)||c===b&&0===c)return a;c={width:b,height:c};b=a.width>a.height;var d=
0<c.height,e=(d?a.height/c.height:0)>(0<c.width?a.width/c.width:0);return(c.width===c.height&&b||!d||!e?b$:a$)(a,c)}},d$=function(a){var b=wf.createObjectURL(a);return La.map(Ln.load(b),function(a){a=bL(a);wf.revokeObjectURL(b);return a})},bL=function(a){return $n(a.dom().naturalWidth,a.dom().naturalHeight)},e$=function(a){var b=bL(a);return $9.get(a).filter(function(a){return a.width()!==b.width()||a.height()!==b.height()})},Ap={restrain:function(a){var b=a.width(),c=a.height(),d=function(a){var d=
c$.max({width:a.width(),height:a.height()},{width:b,height:c});return a.height()>c||a.width()>b?g.some($n(d.width,d.height)):g.none()};return function(a){a=d$(a);return La.map(a,d)}},changedBounds:function(a){return La.map(Ln.loadIfNeeded(a),e$)}},f$=function(a){a=ZK.mapIfSet(a,fg.resizeTo);return ZK.applyIfSet(a)},cL=function(a,b,c){return La.fromChain([f$(a),c])(b)},zi={instance:function(a){var b=Ap.restrain(a);return function(a){return Bc.cata(a,function(c,e,f){c=La.fromPromise(Lc.imageResultToOriginalBlob(e));
return La.bind(c,function(c){var d=b(c);return cL(d,c,function(b){if(b===c)return La.pure(a);wf.revokeObjectURL(f);return La.fromFuture(oe.single(b))})})},function(){return La.pure(a)})}},processResults:function(a){return function(b){b=Ji.partition(b);0<b.errors.length&&(a("imageedit.generic"),console.error("Image resample errors: ",b.errors));return b.values}},resampleAction:cL},Ax={maybeDoRotate:function(a){return ae(a,function(a){return a.fold(function(a){return La.error(a)},function(a){return Bc.cata(a,
function(b,c,f){b=fg.doExifRotate(c);return La.bind(b,function(b){if(b===c)return La.pure(a);b=La.fromPromise(Lc.imageResultToOriginalBlob(b));return La.bind(b,function(a){URL.revokeObjectURL(f);return La.fromFuture(oe.single(a))})})},function(){return La.pure(a)})})})}},dL=z.resolve("find-match"),eL=z.resolve("find-mark"),iu="."+dL+", ."+eL,vd={configure:function(a){a.addSelector(a.output(),iu,Ka.unwrap);a.addSelector(a.history(),iu,Ka.unwrap);a.addSelector(a.internal(),iu,Ka.unwrap)},matchClass:k(dL),
markClass:k(eL),findIdAttr:k("data-ephox-find-id"),shiftKeyState:function(a){return{isShift:k(a)}}},bo={created:function(a){return{fold:function(b,c){return c(a)}}},preserved:function(a){return{fold:function(b,c){return b(a)}}}},g$=M("id","match","current"),ju={resolve:Hb.create("data.ephox.cram").resolve},ku={resolve:Hb.create("ephox-cram").resolve},fL=ju.resolve("highlight-id"),h$=ku.resolve("highlight-wrap"),gL=function(a,b){return L.closest(a,"."+b)},hL=function(a){return g.from(m.get(a,fL))},
Rf={marker:gL,idMarker:function(a){return gL(a,h$)},id:hL,set:function(a,b){m.set(a,fL,b);n.add(a,b)},all:function(a){return hL(a).fold(k([a]),function(b){var c=B.owner(a);return ca.descendants(c,"."+b)})}},lu=M("word","pattern"),i$={separate:function(a,b,c){var d=ia(c,function(a){return[a.start(),a.finish()]}),e=zd.splits(b,d,function(b,c){return DE.subdivide(a,b.element(),c)});return F(c,function(b){var c=zd.sublist(e,b.start(),b.finish());c=F(c,function(a){return a.element()});var d=F(c,a.property().getText).join("");
return{elements:k(c),word:b.word,exact:k(d)}})}},j$=function(a,b){return zd.generate(b,function(b,d){var c=d+a.property().getText(b).length;return g.from(W.range(b,d,c))})},mu=function(a,b,c,d){b=EE.group(a,b,d);return ia(b,function(b){b=Ll.justText(b);var d=F(b,a.property().getText).join("");d=hn.findmany(d,c);b=j$(a,b);return i$.separate(a,b,d)})},nu={safeWords:function(a,b,c,d){c=F(c,function(a){var b=sb.safeword(a);return lu(a,b)});return mu(a,b,c,d)},safeToken:function(a,b,c,d){c=lu(c,sb.safetoken(c));
return mu(a,b,[c],d)},run:mu},ou={safeWords:function(a,b,c,d){return nu.safeWords(a,b,c,d)},safeToken:function(a,b,c,d){return nu.safeToken(a,b,c,d)},run:function(a,b,c,d){return nu.run(a,b,c,d)}},pu=gb(),co={safeWords:function(a,b,c){return ou.safeWords(pu,a,b,c)},safeToken:function(a,b,c){return ou.safeToken(pu,a,b,c)},run:function(a,b,c){return ou.run(pu,a,b,c)}},k$=function(a,b){var c=ia(a.elements(),function(a){return Rf.marker(a,b).fold(k([]),function(a){return[a]})}),d=Za("ephox-cram");return g$(d,
a,g.from(c[0]))},dk={matchWords:function(a,b,c){return co.safeWords(a,b,c)},matchToken:function(a,b,c){return co.safeToken(a,b,c)},matchPattern:function(a,b,c){return co.run(a,[b],c)},annotates:function(a,b){return F(a,function(a){return k$(a,b)})}},iL=function(a,b,c,d){b=dk.annotates(d,c.label());return ia(b,function(b){return b.current().fold(function(){var d=b.match();if(a.ignore(d))return[];d=Ch.wrapper(d.elements(),c.nu)||[];A(d,t(c.tag,b));return[bo.created(d)]},function(a){return[bo.preserved(a)]})})},
l$={highlight:function(a,b,c,d){c=dk.matchToken(b,c,a.optimise);return iL(a,b,d,c)},highlightPattern:function(a,b,c,d){c=dk.matchPattern(b,c,a.optimise);return iL(a,b,d,c)}},m$=function(a,b){return C.isElement(b)&&la.isBlock(b)?0>Mb.get(b).toLowerCase().indexOf(a):!1},n$=function(a){return{ignore:k(!1),optimise:t(m$,a.toLowerCase())}},eo=k("."+vd.matchClass()),o$={label:vd.matchClass,tag:function(a,b){n.add(b,vd.matchClass());m.set(b,vd.findIdAttr(),a.id())},nu:function(){var a=p.fromTag("span");
return{element:k(a),wrap:t(y.append,a)}}},jL=function(a){A(a,function(a){n.add(a,vd.markClass())})},p$=function(a){A(a,function(a){n.remove(a,vd.markClass())})},qu=function(a,b){a=Lk(ca.descendants(a,b),function(a){return m.get(a,vd.findIdAttr())});return 0===a.length?g.none():g.some(a)},kL=function(a,b){b=sb.custom(sb.sanitise(a),k(0),k(0),b);return lu(a,b)},ru=function(a,b,c){return qu(a,eo()).map(function(d){var e=ka(d,function(a){return n.has(a[0],vd.markClass())}),f=Ta(d,function(a){return V(e,
a)}).getOr(-1);return{pos:c(d,Kb(e),f,b(f,d.length)),all:qu(a,eo())}})},su=function(a,b,c,d){p$(b);jL(a[d]);return d},lL=function(a,b){return a===b-1?0:a+1},q$=function(a,b){return 0===a?b-1:a-1},mL=function(a,b){return ru(a,lL,function(a,d,e,f){su(a,d,e,f);y.before(d[0],p.fromText(b));A(d,E.remove);return 0===f?f:e})},Ke={search:function(a,b,c){if(0===b.length)return g.none();var d=n$(b),e=B.children(a);b=!0===c?kL(b,g.none()):kL(b,g.some("gi"));l$.highlightPattern(d,e,b,o$);return qu(a,eo()).map(function(a){jL(a[0]);
return{all:g.some(a),pos:0}})},clear:function(a){a=ca.descendants(a,eo());A(a,E.unwrap);return g.none()},next:function(a){return ru(a,lL,su)},prev:function(a){return ru(a,q$,su)},replace:mL,replaceAll:function(a,b){for(;mL(a,b).isSome(););return g.none()}},Dx=ba.detect().deviceType.isiOS(),tu=function(a,b,c){a=a();var d=a.element();ja.add(d,b);T.button(d,c);m.set(d,"tabindex","-1");a.events.click.bind(function(){Y.focus(d)});return a},uu=function(a,b){a=tu(Dc,a,b);m.set(a.element(),"title",b);return a},
nL=function(a,b){var c=z.resolve("inline-main-button");a=a.concat([c]);a=tu(Dc,a,b);a.content(Rc(b));return a},oL=function(a,b,c){var d=z.resolve("inline-main-button-toggle");a=a.concat([d]);c=tu(Hd,a,c);m.set(c.element(),"title",b);return c},vu=function(a,b,c){var d=p.fromTag("input");ja.add(d,a);m.set(d,"placeholder",b);T.label(d,c);return{element:k(d),destroy:t(E.remove,d)}},al={counter:function(a){var b=S.div(),c=S.span();n.add(b,z.resolve("search-widget-counter"));n.add(c,z.resolve("search-widget-counter-text"));
y.append(b,c);return{element:k(b),update:function(a,b){a=w.translate("units.amount-of-total",a,b);E.empty(c);y.append(c,p.fromText(a));kc.isVisible(c)&&bb.speak(fa.body(),a)},hide:function(){v.set(b,"display","none")},show:function(){v.remove(b,"display")},destroy:function(){E.remove(c);E.remove(b)}}},dummyCounter:function(a){a=S.div();n.add(a,z.resolve("search-widget-counter"));return{element:k(a),update:u,hide:u,show:u,destroy:t(E.remove,a)}},searchField:function(){var a=S.span(),b=uu([z.resolve("stepper-button"),
z.resolve("search-widget-previous")],w.translate("search.previous")),c=uu([z.resolve("stepper-button"),z.resolve("search-widget-next")],w.translate("search.next")),d=oL([z.resolve("search-widget-more")],w.translate("aria.label.more"),w.translate("aria.label.more"));n.add(a,z.resolve("search-widget-searchField"));var e=vu([z.resolve("search-widget-input"),z.resolve("search-widget-input-search")].concat(nc.isSmallTouch()?[z.resolve("search-widget-small-touch")]:[]),w.translate("search.search"),w.translate("search.field.search")),
f=G.create({next:Q([],c.events.click),previous:Q([],b.events.click),more:Q([],d.events.click),input:q(["raw"])}),h=J.bind(e.element(),"input",f.trigger.input);O.append(a,[e.element(),b.element(),c.element(),d.element()]);return{events:f.registry,element:k(a),input:e.element,focus:function(){Y.focus(e.element())},previous:b.element,next:c.element,moreToggle:d,destroy:function(){h.unbind();e.destroy();b.destroy();c.destroy();d.destroy()}}},replaceDrawer:function(){var a=vu([z.resolve("search-widget-input"),
z.resolve("search-widget-input-replace")],w.translate("search.replace"),w.translate("search.field.replace")),b=oL([z.resolve("search-widget-matchcase")],w.translate("search.matchcase"),w.translate("search.matchcase")),c=nL([z.resolve("search-widget-replace")],w.translate("search.replace")),d=nL([z.resolve("search-widget-replace-all")],w.translate("search.replace-all")),e=p.fromTag("div");T.group(e);var f=S.div();n.add(e,z.resolve("search-widget-replace-drawer"));n.add(f,z.resolve("search-widget-replace-drawer-tools"));
O.append(f,[b.element(),c.element(),d.element()]);O.append(e,[a.element(),f]);return{element:k(e),replace:c,replaceAll:d,input:a,matchcase:b,destroy:function(){b.destroy();c.destroy();d.destroy();E.remove(f);E.remove(e)}}},button:uu,input:vu},Fx=function(a,b,c){a?(ma.expanded(b),T.hidden(c,!1)):(ma.collapsed(b),T.hidden(c,!0))},Ai={text:sa.generate([{text:["field","input"]}]).text,cata:function(a,b){return a.fold(b)}},GS=ba.detect(),FS=Il("element addEscape open close execute type events destroy".split(" "),
CA.isFunctionOrEvents(["toEditor"])),pL=z.resolve("toolbar-dialog"),r$=function(a){var b=DS(a);return cw(a,b,"search",pL)},s$=function(a){var b=ES(a);return bl(a,b,pL)},IS=function(a){return(ba.detect().deviceType.isTouch()?s$:r$)(a)},t$=function(a){return Ud.isAnnotation(a)||m.has(a,Eb.overrideSpan())},qL=function(a,b,c,d,e,f){var h=function(b){a(b,e,t$)};Pb.cata(d.get(),u,ln.multiple(b,c,h,f),ln.single(b,c,h,f))},fo=function(a,b,c,d,e){qL(a,b,c,d,e,b.toEditing)},nf={face:t(fo,Hh.face),background:t(fo,
Hh.background),foreground:t(fo,Hh.foreground),size:t(fo,Hh.size),partialSize:t(function(a,b,c,d,e){qL(a,b,c,d,e,u)},Hh.size)},Ug={color:M("hex","name"),face:M("textkey","value","icon"),size:M("name","size")},gc=Ug.color,pe=Ug.face,Ix={colors:function(){return[gc("#FFF",w.key("color.white")),gc("#000",w.key("color.black")),gc("#444",w.key("color.gray")),gc("#777",w.key("color.metal")),gc("#CCC",w.key("color.smoke")),gc("#FC1D00",w.key("color.red")),gc("#C81500",w.key("color.darkred")),gc("#FF8C00",
w.key("color.darkorange")),gc("#FEBE00",w.key("color.orange")),gc("#FFFC00",w.key("color.yellow")),gc("#22AE50",w.key("color.green")),gc("#006400",w.key("color.darkgreen")),gc("#3CB371",w.key("color.mediumseagreen")),gc("#8FCD4E",w.key("color.lightgreen")),gc("#00FF00",w.key("color.lime")),gc("#0000CD",w.key("color.mediumblue")),gc("#002360",w.key("color.navy")),gc("#0173C1",w.key("color.blue")),gc("#14B2F2",w.key("color.lightblue")),gc("#ee82ee",w.key("color.violet"))]},faces:function(){return[pe(w.key("font.arial"),
"Arial",g.none()),pe(w.key("font.comicsans"),"Comic Sans MS",g.none()),pe(w.key("font.consolas"),"Consolas",g.none()),pe(w.key("font.courier"),"Courier",g.none()),pe(w.key("font.georgia"),"Georgia",g.none()),pe(w.key("font.impact"),"Impact",g.none()),pe(w.key("font.tahoma"),"Tahoma",g.none()),pe(w.key("font.timesnr"),"Times New Roman",g.none()),pe(w.key("font.trebuchet"),"Trebuchet MS",g.none()),pe(w.key("font.verdana"),"Verdana",g.none())]}},cl={configuration:k({i18nNamespace:"font",cssNamespace:"font",
property:"font-size",tag:"span",specials:["xx-small x-small small medium large x-large xx-large".split(" ")]})},u$=function(a){var b=!isNaN(parseFloat(a))&&isFinite(a);return a+(b?"px":"")},v$=function(a,b,c){return(v.isValidValue(a,b,c)?g.some(c):g.none()).fold(function(){return N.error("Invalid value: "+c)},function(a){return a===c?N.value(c):N.error("Invalid value: "+c)})},rL=function(a){return ao.identify(a).fold(function(a){return a},function(a,c,d){return Math.round(10*c)/10+d})},of={identify:ao.identify,
validate:function(a,b,c){return(Te.isEmpty(a)?N.error("can not use empty value for font size."):N.value(a)).map(u$).map(rL).bind(t(v$,b,c))},sanitise:function(a){return rL(a)}},go={px:1,em:.1,"%":10,pt:1,rem:"0.1"},w$=function(a,b,c){return va(b,function(a){return V(a,c)}).bind(function(b){return zc(b,c).bind(function(c){return g.from(b[a(c,b)])})}).getOr(c)},sL=function(a,b,c,d){return of.identify(d).fold(function(b){return w$(a,c,b)},function(a,c,d){a=void 0!==go[d]?go[d]:1;var e=b*(void 0!==go[d]?
go[d]:1);return(df(c)&&0<=c?Math.max(a,c+e):a)+d})},dl={decrease:t(sL,function(a,b){return Math.max(0,a-1)},-1),increase:t(sL,function(a,b){return Math.min(b.length-1,a+1)},1)},KS=ya(["i18nNamespace","cssNamespace","property","tag","specials"],[]),x$=M("size"),z$=function(a){a=Pb.toSelection(a.get()).fold(wa.off,function(a){a=V(["td","th"],C.name(a.startContainer()))?Xa.freefallLtr(a.startContainer()).element():a.startContainer();a=y$(a);return wa.on(a)});return x$(a)},A$=function(a){return a.body().bind(function(a){a=
v.get(a,"font-size");return g.from(a)})},tL=function(a){var b=a.dom();if(!b.style)return!1;b=b.style.fontSize;return"body"!==C.name(a)&&!Te.isEmpty(b)},y$=function(a){var b=C.isText(a)?B.parent(a).getOrDie():a;return(tL(b)?g.some(b):Da.ancestor(b,tL)).fold(function(){return v.get(b,"font-size")},function(a){return a.dom().style.fontSize})},el={getState:function(a,b){return{readState:z$(a),fallbackSize:A$(b).getOr("12px")}}},B$=function(a){a.dom().click();return g.some(a)},C$=function(a,b){var c=ca.descendants(a,
b);if(0<pa.get(a)&&0<c.length){var d=Wa.absolute(c[0]).top();return Ta(c.slice(1),function(a){return Wa.absolute(a).top()!==d}).map(function(a){return{rows:k(Math.ceil(c.length/(a+1))),columns:k(a+1)}})}return g.none()},D$=function(a){return F(a,function(a){var b=a.text;b=w.has("color."+b)?w.key("color."+b):w.raw(b);return Ug.color(a.value,b)})},Ci={create:function(a){var b=0<a.length?D$(a):Ix.colors();a=MS();var c=F(b,function(a){var b=Gx(a);n.add(b.element(),z.resolve("palette-color-option"));v.set(b.element(),
"background-color",a.hex());return b});A(c,a.add);b=b.length%5;if(0!==b%5)for(b=5-b,c=0;c<b;c++){var d=Gx(Ug.color("#FFF",w.key("color.white")));n.add(d.element(),z.resolve("palette-color-option"));n.add(d.element(),z.resolve("palette-color-option-spacer"));a.add(d)}return a},makeLayout:function(a,b,c){c=xa.grid(cb({trigger:B$},c));var d=ea.grid(a,{cell:k(b)},4,5,c);return{layout:k(d),refresh:function(){d.clear();C$(a,b).each(function(a){d.resize(a.rows(),a.columns())})}}}},NS=function(a){return tb.closest(a,
".ephox-polish-palette-detail-active")},PS=ba.detect().deviceType.isTouch,ZS={widget:function(a,b){var c=a.content(),d=a.undo(),e=a.selections(),f=QS(b),h=G.create({color:Q(["value"],f.events.color),highlight:Q(["value"],f.events.highlight),done:q([]),abort:Q([],f.events.abort)});f.events.color.bind(function(a){h.trigger.done();nf.foreground(c,d,e,a.value());c.toEditing()});f.events.highlight.bind(function(a){h.trigger.done();nf.background(c,d,e,a.value());c.toEditing()});return{element:f.element,
name:k("color"),textkey:k(w.key("font.coloroption")),menuTextkey:k(w.key("aria.color.menu")),open:f.open,close:f.close,updateWidget:function(b){gi.isHighContrast(a.smartview())?b.disable():f.open()},ability:u,destroy:f.destroy,events:h.registry,label:k(!1)}}},TS=ya(["i18nNamespace","cssNamespace","property","tag","specials"],[]),XS={widget:function(a,b){b=Ro.cata(b,k(u),k(function(a){a.initLayout()}));var c=a.content(),d=a.undo(),e=fl(cl.configuration());b(e);var f=G.create({done:q([]),abort:Q([],
e.events.abort)});e.events.close.bind(function(a){f.trigger.done()});e.events.action.bind(function(b){var e=Y.active();c.focus();nf.size(c,d,a.selections(),b.value());e.each(Y.focus)});return{element:e.element,item:e.item,name:k("size"),textkey:k(w.key("font.size")),open:e.open,close:e.close,updateInlineWidget:function(){var b=el.getState(a.selections(),c);e.updateInlineWidget(b.readState,b.fallbackSize)},ability:u,destroy:e.destroy,events:f.registry}}},WS={widget:function(a,b){var c=a.content(),
d=a.smartview().uiContainer();b=a.ui().tabstrip.element;var e=a.undo(),f=fl(cl.configuration()),h=f.input(),g=Vk(b());m.set(h,"disabled","true");var r=J.bind(h,"touchstart",function(b){b.kill();g.closeMenus();var f=US(c,d,t(fl,cl.configuration()));f.show();b=f.contents;var h=el.getState(a.selections(),c),k=function(){f.destroy();c.cursorIntoView()};b.updateInlineWidget(h.readState,h.fallbackSize);b.events.close.bind(k);b.events.action.bind(function(b){nf.size(c,e,a.selections(),b.value())});f.events.close.bind(f.destroy);
f.events.ok.bind(function(b){nf.size(c,e,a.selections(),b.value());k()})}),n=G.create({done:q([]),abort:Q([],f.events.abort)});f.events.close.bind(function(a){n.trigger.done()});f.events.action.bind(function(b){nf.size(c,e,a.selections(),b.value())});return{element:f.element,item:f.item,name:k("size"),textkey:k(w.key("font.size")),open:f.open,close:f.close,updateInlineWidget:function(){var b=el.getState(a.selections(),c);f.updateInlineWidget(b.readState,b.fallbackSize)},ability:u,destroy:function(){r.unbind();
f.destroy()},events:n.registry}}},YS={face:function(a){return Pb.toSelection(a.get()).map(function(a){a=V(["td","th"],C.name(a.startContainer()))?Xa.freefallLtr(a.startContainer()).element():a.startContainer();a=qi.value(a,"font-family");return Te.isEmpty(a)?wa.off():wa.on(a)}).getOrThunk(wa.unchanged)}},aT=function(a){var b=a.baseUrl;!0===a.source&&(b+="/licenses");return b+"/textbox-licenses.html"},ek=function(a,b){return a.map(function(a){return a.bind(function(a){var c=a[b];return void 0===c?
N.error("Cannot find method "+b+" in help article list: "+jb(a)):wb(c)?N.value(c()):N.error("Key "+b+" in help article list was not a function")})})},cT=function(a){a=Fl.addScript(a,aa);a.get(function(a){a.each(function(a){pf.weakMatch(a.version,"Help articles").each(function(a){console.warn(a)})})});return{about:ek(a,"about"),accessibility:ek(a,"accessibility"),a11ycheck:ek(a,"a11ycheck"),markdown:ek(a,"markdown"),shortcuts:ek(a,"shortcuts")}},Ei=function(a,b){return a?g.some(b):g.none()},eT=function(a){var b=
{item:k(".ephox-pastry-statebutton.ephox-pastry-tablayout-item")},c=xa.flow({trigger:Nb.button,executeOnArrow:!0});return ea.flow(a.menu(),b,c)},fT=function(a){var b={stops:k(["a"])},c=xa.page({trigger:Nb.click,first:".ephox-pastry-tablayout-active"});return ea.page(a.body(),b,c)},jT=M("prefix","suffix","style"),Kx={rehighlight:function(a,b,c){var d=B.children(c),e=F(d,function(a){return C.isText(a)?Oa.get(a):""}).join("");va(b,function(a){return Ab(e,a.prefix())&&ce(e,a.suffix())}).fold(function(){a.preserve(function(){E.unwrap(c)})},
function(b){var e=p.fromTag("span");ja.add(e,[Me.highlightClass()]);v.setAll(e,b.style());a.preserve(function(){y.before(c,e);O.append(e,d);E.remove(c)})})},unhighlight:function(a,b){var c=B.children(b),d=p.fromTag("span");ja.add(d,[Me.placeholderClass()]);a.preserve(function(){y.before(b,d);E.unwrap(b);O.append(d,c)})}},E$=function(a,b){b=F(b,function(a){var b=sb.sanitise(a.prefix()),c=sb.sanitise(a.suffix());b=sb.unsafetoken(b+"[^"+c+"]*"+c);return{pattern:k(b),style:a.style}});return hn.findmany(a,
b)},F$=mp("."+Me.highlightClass(),Ka.unwrap),kT={run:function(a,b){a.body().each(function(a){Uk.filterDom(a,[F$]);a=Cc.descendants(a,C.isText);A(a,function(a){var c=Oa.get(a);c=E$(c,b);var d=ia(c,function(a){return[a.start(),a.finish()]}),h=zh.subdivide(a,d);A(c,function(a){var b=zd.sublist(h,a.start(),a.finish());b=F(b,function(a){return a.element()});Ch.wrapper(b,function(){var b=p.fromTag("span");ja.add(b,[Me.highlightClass()]);v.setAll(b,a.style());return Ch.nu(b)})})})})}},wu=z.resolve("input-invalid-field"),
G$=function(a){return parseInt(a,10).toString()===a&&0<=parseInt(a,10)},uL=function(a,b,c){var d=da.get(a);if(""===d)return N.value("");var e=p.fromTag("img");c=G$(d)?d+c.getOr(""):d;v.set(e,b,c);c=v.getRaw(e,b);v.remove(e,b);return c.fold(function(){return N.error(a)},N.value)},vL=function(a){n.remove(a,wu)},xc={highlight:function(a){bb.shout(a,w.translate("aria.input.invalid"));n.add(a,wu)},dehighlight:vL,clearHighlights:function(a){a=ca.descendants(a,"."+wu);A(a,vL)},validate:function(a){return zb(a,
function(a,c){return a.bind(function(a){return uL(c.input(),c.property(),c.defaultUnit()).map(function(b){da.set(c.input(),b);var d={};d[c.property()]=k(b);return cb(d,a)})})},N.value({}))},validateField:uL,rule:M("input","property","defaultUnit")},H$=M("size","unit"),ho=function(a){return ao.identify(a).fold(g.none,function(a,c,d){return g.some(H$(c,d))})},yp={fromHeight:function(a,b){return ho(b).map(function(b){return Math.ceil(a*b.size())+b.unit()})},fromWidth:function(a,b){return ho(b).map(function(b){return Math.ceil(1/
a*b.size())+b.unit()})},calculate:function(a,b){return ho(a).fold(g.none,function(a){return ho(b).fold(g.none,function(b){return g.some((a.size()+0)/(b.size()+0))})})}},wL=M("value","text","attrs"),xL=function(a){return"img"===C.name(a)},yL=function(a){return 0===a.length?xb:function(b){return lc.allowedForEditing(b,a)}},Mx={image:function(a){var b=yL(a),c=g.none(),d=G.create({properties:q(["image"]),contextmenu:q(["image"])});return{situation:function(a){a=c.map(function(a){return[wL("imagemenu-properties",
w.translate("image.context.properties"),{})]}).getOr([]);return{primary:k(a),secondary:k([]),submenus:k([])}},handle:function(a){c.each(function(a){d.trigger.properties(a)})},assign:function(a){c=a.filter(xL).filter(b);c.each(d.trigger.contextmenu)},events:d.registry}},imageEdit:function(a,b,c,d){var e=yL(d),f=g.none(),h=function(a){return F(a,function(a){return wL(a.spec.value,w.get(a.spec.textkey),{})})};return{situation:function(a){a=f.map(h).getOr([]);return{primary:k(a),secondary:k([]),submenus:k([])}},
handle:function(a){f.each(function(b){var c=m.get(a,"data-ephox-gopher-item-value");va(b,function(a){return a.spec.value===c}).each(function(a){a.spec.action()})})},assign:function(d){f=a()?g.some(b):d.filter(xL).filter(e).map(k(c))}}}},Nx={generate:function(a,b,c){a=function(){e();d.trigger.close()};var d=G.create({ok:Q(c,b.events.ok),close:q([])});b.events.close.bind(a);var e=function(){b.destroy()};return{open:function(){b.open()},hide:a,destroy:e,represent:b.represent,events:d.registry}}},zL=
sa.generate([{html:["key","value"]},{css:["key","value"]}]),AL=function(a,b){return Kb(xk(a,function(a,d){var c=[];if(m.has(b,d)){var f=m.get(b,d);c.push(zL.html(a,f))}v.getRaw(b,d).each(function(b){c.push(zL.css(a,b))});return c}))},I$=function(a){v.remove(a,"width");v.remove(a,"height");m.remove(a,"width");m.remove(a,"height")},J$=t(AL,{width:"width",height:"height"}),K$=t(AL,{width:"height",height:"width"}),BL=k([]),Oe={keepCrop:BL,keepFlip:J$,keepRotate:K$,keepResample:BL,updater:function(a,b){var c=
a(b);return La.effect(function(){I$(b);A(c,function(a){a.fold(function(a,c){m.set(b,a,c)},function(a,c){v.set(b,a,c)})})})}},L$={strictMode:!1,key:"source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@\/]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},
M$=function(a,b){a=b.parser[b.strictMode?"strict":"loose"].exec(a);for(var c={},d=14;d--;)c[b.key[d]]=a[d]||"";c[b.q.name]={};c[b.key[12]].replace(b.q.parser,function(a,d,h){d&&(c[b.q.name][d]=h)});return c},Yg={parse:function(a,b){b=ra(L$,b);return M$(a,b)}},CL=function(a){return""!==a.trim()&&!Cb(a,"://")},zp={local:function(a){return Ab(a,"data:")||Ab(a,"blob:")||Ab(a,"file:")},relative:CL,sameDomain:function(a,b){if(""===a.trim()||""===b.trim())return!1;if(CL(a))return!0;b=Yg.parse(b);a=Yg.parse(a);
return b.host===a.host&&b.port===a.port}},N$=M("bannerMessage","consoleMessage"),DL=function(a){return wb(a.message)&&wb(a.status)&&wb(a.responseText)},EL=function(a){if(DL(a)){var b=a.responseText();return a.message()+". Response code "+a.status()+(0===b.length?".":". Error details: "+b)}return a},Bp={diagnoseImageEdit:function(a,b){var c=18===a.code||"SecurityError"===a.name?"imageedit.needsproxy":DL(a)&&0===a.status()?"imageedit.proxyerror":"imageedit.generic",d=Yg.parse(b);b=""===d.host||zp.relative(b)?
b:""===d.port?d.host:d.host+":"+d.port;c=Ge.get(c,[b]);return N$(c,EL(a))},consoleMessage:EL},Vg={make:function(a,b,c){return{type:"general",spec:{value:a,textkey:w.key(b),action:c,updateGeneral:u,icon:!0,hasPopup:!1,toggle:!1,tooltip:ib.get}}}},O$=k(4),nb={resolve:Hb.create("ephox-clipper").resolve,CORNER_SIZE:O$},P$=function(a,b){a={left:"0px",top:"0px",width:a.width()+"px",height:a.height()+"px"};b={left:v.get(b,"left"),top:v.get(b,"top"),width:v.get(b,"width"),height:v.get(b,"height")};return{outside:k(a),
inside:k(b)}},Q$={snap:function(a,b){var c=P$(a,b),d=p.fromTag("div");n.add(d,nb.resolve("dynamic-box"));v.setAll(d,c.outside());var e=p.fromTag("div");n.add(e,nb.resolve("opaque-box"));v.setAll(e,c.outside());var f=function(a,b){return 2<Math.abs(parseInt(a,10)-parseInt(b,10))},h=function(a){return Ba.nu(function(b){b(a)})},g=function(a,b){return Ba.nu(function(c){var d=J.bind(a,"transitionend",function(){d.unbind();c(a)});v.setAll(a,b.inside())})};return{prepare:function(a,c,f){var h=m.get(c,"src"),
g=v.get(c,"width");c=v.get(c,"height");v.setAll(b,{"background-image":"url("+h+")","background-size":g+" "+c,"background-position-x":-f.left()+"px","background-position-y":-f.top()+"px"});n.add(b,nb.resolve("snapshot"));n.add(d,nb.resolve("dynamic-box-animate"));O.append(a,[d,e]);v.reflow(a)},showcase:function(){var a=c.outside(),b=c.inside();return f(a.left,b.left)||f(a.top,b.top)||f(a.right,b.right)||f(a.bottom,b.bottom)?g(d,c):h(d)}}}},CT={slide:function(){return{animate:function(a,b,c,d){c=Q$.snap(c.box(),
c.shade());c.prepare(a,b,{left:d.cropX,top:d.cropY,width:d.cropWidth,height:d.cropHeight});return c.showcase().map(k(d))}}},none:function(){return{animate:function(a,b,c,d){return Ba.pure(d)}}}},AT=ya("displayWidth displayHeight cropX cropY cropWidth cropHeight".split(" "),[]),xT={bind:function(a,b){return J.bind(a,"mousedown",function(a){a.kill();var c=a.target(),e=!1,f=J.bind(c,"mouseup",function(){e=!0;f.unbind()});setTimeout(function(){e||(f.unbind(),b(c))},250)})}},R$=ya(["top","left","width",
"height"],[]),S$=ya(["top","left"],[]),T$=ya(["top","left"],[]),ub={boxModel:R$,delta:S$,cornersMovements:T$},xu=function(a,b){b=Math.min(a.top()+a.height(),Math.max(0,a.top()+b.top()));var c=b-a.top();a=a.height()-c;return{top:b,height:a}},yu=function(a,b,c){a=Math.min(a.width(),Math.max(b.left(),b.left()+b.width()+c.left()))-b.left()-b.width();return{width:b.width()+a}},zu=function(a,b,c){return Math.min(a.height(),Math.max(b.top(),b.top()+c.top()+b.height()))-b.top()},Au=function(a,b){b=Math.min(a.width()+
a.left(),Math.max(0,a.left()+b.left()));var c=b-a.left();a=a.width()-c;return{left:b,width:a}},kl={nw:function(a,b,c){a=xu(b,c);b=Au(b,c);return ub.boxModel({left:b.left,width:b.width,top:a.top,height:a.height})},n:function(a,b,c){a=xu(b,c);return ub.boxModel({left:b.left(),width:b.width(),top:a.top,height:a.height})},ne:function(a,b,c){var d=xu(b,c);a=yu(a,b,c);return ub.boxModel({left:b.left(),width:a.width,top:d.top,height:d.height})},e:function(a,b,c){a=yu(a,b,c);return ub.boxModel({left:b.left(),
width:a.width,top:b.top(),height:b.height()})},se:function(a,b,c){var d=yu(a,b,c);a=zu(a,b,c);return ub.boxModel({left:b.left(),width:d.width,top:b.top(),height:a})},s:function(a,b,c){a=zu(a,b,c);return ub.boxModel({left:b.left(),width:b.width(),top:b.top(),height:a})},sw:function(a,b,c){a=zu(a,b,c);c=Au(b,c);return ub.boxModel({left:c.left,width:c.width,top:b.top(),height:a})},w:function(a,b,c){a=Au(b,c);return ub.boxModel({left:a.left,width:a.width,top:b.top(),height:b.height()})},translate:function(a,
b,c){var d=Math.min(Math.max(0,b.top()+c.top()),Math.max(0,a.height()-b.height()));a=Math.min(Math.max(0,b.left()+c.left()),Math.max(0,a.width()-b.width()));return ub.boxModel({top:d,left:a,width:b.width(),height:b.height()})}},Gi={navigation:function(a,b){var c=function(a,c,f){return function(){b(a,Ma(c,f));return g.some(!0)}};return[Z.rule(Z.and([Z.isShift,Z.inSet(R.LEFT())]),c(a,-1,0)),Z.rule(Z.and([Z.isShift,Z.inSet(R.RIGHT())]),c(a,1,0)),Z.rule(Z.and([Z.isShift,Z.inSet(R.UP())]),c(a,0,-1)),Z.rule(Z.and([Z.isShift,
Z.inSet(R.DOWN())]),c(a,0,1)),Z.basic(R.LEFT()[0],c(a,-10,0)),Z.basic(R.RIGHT()[0],c(a,10,0)),Z.basic(R.UP()[0],c(a,0,-10)),Z.basic(R.DOWN()[0],c(a,0,10))]}},FL=function(a,b,c){var d=b.top(),e=b.left()+b.width()/2-c.middle(),f=d+b.height()/2-c.middle(),h=b.left()+b.width()-c.right();a=b.left()-c.left();c=d+b.height()-c.bottom();b=ub.cornersMovements({top:d,left:e});e=ub.cornersMovements({top:c,left:e});var g=ub.cornersMovements({top:f,left:h});f=ub.cornersMovements({top:f,left:a});var m=ub.cornersMovements({top:d,
left:a});d=ub.cornersMovements({top:d,left:h});h=ub.cornersMovements({top:c,left:h});a=ub.cornersMovements({top:c,left:a});return{n:k(b),s:k(e),e:k(g),w:k(f),nw:k(m),ne:k(d),se:k(h),sw:k(a)}},Ox={calculate:function(a,b){var c={middle:k(2*nb.CORNER_SIZE()+1),right:k(nb.CORNER_SIZE()),left:k(0),bottom:k(nb.CORNER_SIZE())};return FL(a,b,c)},limitBounds:function(a,b){var c={};if(20>b.width()){var d=20-b.width();c.width=b.width()+d;c.left=b.left()===a.left()?a.left():b.left()-d}20>b.height()&&(d=20-b.height(),
c.height=b.height()+d,c.top=b.top()===a.top()?a.top():b.top()-d);return ra(b,Wb(c,k))},doCalculate:FL},Bu=function(a){return ub.boxModel({left:parseInt(m.get(a,"data-"+nb.resolve("image-left")),10),top:parseInt(m.get(a,"data-"+nb.resolve("image-top")),10),width:parseInt(m.get(a,"data-"+nb.resolve("image-width")),10),height:parseInt(m.get(a,"data-"+nb.resolve("image-height")),10)})},GL=function(a,b){m.set(a,"data-"+nb.resolve("image-left"),b.left());m.set(a,"data-"+nb.resolve("image-top"),b.top());
m.set(a,"data-"+nb.resolve("image-width"),b.width());m.set(a,"data-"+nb.resolve("image-height"),b.height())},dg={readPosition:Bu,writePosition:GL,updatePosition:function(a,b){var c=Bu(a);b=b(c);c=Ox.limitBounds(c,b);GL(a,c);return c},drawAtOrigin:function(a){var b=Bu(a);v.setAll(a,{left:b.left()+"px",top:b.top()+"px",width:b.width()+"px",height:b.height()+"px"})}},U$=nb.resolve("magic-box"),Qx={magicBox:k(U$)},jl={grab:function(a,b){m.set(a,"aria-grabbed",b)},effect:function(a,b){m.set(a,"aria-dropeffect",
b)}},V$=M("help","ids"),HL=function(a){m.set(a,"role","gridcell")},eg={base:function(a,b){m.setAll(a,{role:"grid","aria-label":b})},row:function(a){m.set(a,"role","row")},cell:function(a,b){HL(a);m.set(a,"aria-label",b)},gridcell:HL,createHelp:function(a,b,c){var d=p.fromTag("div");T.presentation(d);n.add(d,dj.resolve("aria-help"));for(var e=[],f=0;f<b;f++){var h=Za("ephox-aria"),g=p.fromTag("span");T.presentation(g);m.set(g,"id",h);n.add(g,dj.resolve("aria-help"));y.append(g,p.fromText(c.col(f+1)));
y.append(d,g);e[f]=h}f=[];for(h=0;h<a;h++){g=Za("ephox-aria");var k=p.fromTag("span");T.presentation(k);m.set(k,"id",g);n.add(k,dj.resolve("aria-help"));y.append(k,p.fromText(c.row(h+1)));y.append(d,k);f[h]=[];for(k=0;k<b;k++)f[h][k]=e[k]+" "+g}return V$(d,f)}},rf=function(a,b,c){var d=p.fromTag("div");v.set(d,"position","absolute");var e=p.fromTag("div");y.append(d,e);c.each(function(a){eg.cell(d,a);jl.grab(d,!1)});ja.add(d,[nb.resolve("corner-wrapper"),nb.resolve("corner-wrapper-"+b)]);ja.add(e,
[nb.resolve("corner-element"),nb.resolve("corner-"+a)]);m.set(d,"data-"+nb.resolve("direction"),b);return d},sf=function(a,b){v.setAll(a,{top:b.top()+"px",left:b.left()+"px"})},Px=function(a,b,c){var d=b()<c()?0:1;A(a,function(a){v.set(a,"opacity",String(d))})},tT={derive:function(a,b){return{leftRim:function(){var c=b.left(),d=a.height();return ub.boxModel({top:0,left:0,width:c,height:d})},topRim:function(){var c=b.left(),d=a.width()-b.left(),e=b.top();return ub.boxModel({top:0,left:c,width:d,height:e})},
rightRim:function(){return ub.boxModel({top:b.top(),left:b.left()+b.width(),width:a.width()-b.width()-b.left(),height:a.height()-b.top()})},bottomRim:function(){return ub.boxModel({top:b.top()+b.height(),left:b.left(),width:b.width(),height:a.height()-b.height()-b.top()})},shadeBox:k(b)}}},hl=function(a){var b=p.fromTag("div");ja.add(b,[nb.resolve("panel-"+a),nb.resolve("side-panel")]);return b},il=function(a,b){v.setAll(a,{top:b.top()+"px",left:b.left()+"px",width:b.width()+"px",height:b.height()+
"px"})},wT=function(a){var b=a.width();a=a.height();var c=Math.floor(.125*a),d=Math.floor(.125*b);return ub.boxModel({top:c,left:d,width:b-2*d,height:a-2*c})},zT=function(a){var b=Wa.absolute(a),c=b.top(),d=pa.get(a);b=b.left();a=Aa.get(a);return ub.boxModel({top:c,left:b,width:a,height:d})},DT=function(a,b){lc.detect(a.getSelection()).fold(function(){a.setRelativeSelection(ha.before(b),ha.before(b))},function(b){a.setRelativeSelection(ha.on(b.image(),0),ha.on(b.image(),0))})},IL=function(a,b,c,d){return a(function(a){var e=
J.bind(b,c,function(b){clearTimeout(h);e.unbind();a(N.value(b))}),h=setTimeout(function(){e.unbind();a(N.error("Event "+c+" did not fire within "+d+"ms"))},d)})},W$={cWaitFor:function(a,b,c){return IL(Fe.nu,a,b,c)},waitFor:function(a,b,c){return IL(Ba.nu,a,b,c)}},X$=La.fToFR(oe.single),Cp={run:function(a,b,c){return La.fromChain([a.getImage,b,X$,c])},applyEdit:function(a){return function(b){var c=Bc.cata(b,function(a,b,c){return c},function(a,b,c){return b});m.set(a,"src",c);b=La.pure(b);return a.dom().loaded?
b:La.bind(W$.waitFor(a,"load",1E3),k(b))}}},Y$=function(a){return 20<=a},Cu=function(a){return g.from(a).filter(Y$)},FT={ensureMin:Cu,parse:function(a,b){a=Cu(a).getOr(0);b=Cu(b).getOr(0);return 0===a&&0===b?g.none():g.some($n(a,b))}},IT=function(a){return function(b){var c=b.image(),d=b.asset(),e=function(a){a.fold(function(){m.remove(c,"src")},function(a){Bc.cata(a,function(a,b,d){m.set(c,"src",d)},u)})};return Ln.loadIfNeeded(c).bind(function(){return a(d).map(function(a){e(a);return a})})}},GT=
k(La.pure),HT=k(function(a){return La.pure(a.asset())}),Rx={edit:function(a,b,c,d){return{items:d,updatePalette:function(d){if(c())d.hide(g.none())&&a();else{var e=t(d.show,g.some(w.translate("image.context.palette.show")));d=t(d.hide,g.some(w.translate("image.context.palette.hide")));(b().isSome()?e:d)()&&a()}}}},crop:function(a,b,c){return{items:c,updatePalette:function(c){(b()?c.show:c.hide)(g.none())&&a()}}}},JL=function(a){var b=Ab(a,"www.")?"http://"+a:a;return{text:k(a),href:k(b)}},Du={preprocess:JL,
auto:function(a){return JL(a).href()}},KL=function(a,b){a.setRelativeSelection(ha.after(b),ha.after(b))},Z$=function(a,b,c,d){var e=a.getSelection();return lc.detect(e).fold(function(){return e.fold(function(){return[]},function(a){return(a.collapsed()?c:d)(a)})},function(a){return b(a.image())})},$$=function(a,b,c){var d=p.fromTag("a");io(d,cb(b,{text:k(g.none())}));y.wrap(c,d);Ne.select(a,c);return[d]},io=function(a,b){b.url().each(function(b){b=Du.auto(b);xh.attr(a,"href",b)});b.title().each(function(b){xh.attr(a,
"title",b)});b.target().each(function(b){xh.attr(a,"target",b)});b.action().each(function(b){b(a)});return b.text().filter(b.textChanged).map(function(b){Mb.set(a,b);return!0}).getOr(!1)},aaa=function(a){return function(b){return{link:b,properties:a}}},baa=function(a){return function(b){return{link:b,properties:cb(a,{text:k(g.some(Mb.get(b)))})}}},caa=function(a){return function(b){var c=Yr.findDescendants(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset(),"a");b=0<c.length?c:Yr.findAncestors(b.startContainer(),
b.endContainer(),"a");return F(b,1===b.length?aaa(a):baa(a))}},daa=function(a,b){return Z$(a,t($$,a,b),function(c){var d=p.fromTag("a");io(d,b);bd.insertAtCursor(a,[d]);b.action().each(function(a){a(d)});KL(a,d);return[d]},function(c){a.execCommand("CreateLink",!1,Du.auto(b.url().getOr("")));c=a.getSelection().map(caa(b)).getOr([]);A(c,function(c){io(c.link,c.properties);b.action().each(function(a){a(c.link)});KL(a,c.link)});return F(c,function(a){return a.link})})},Eu={hyperlink:function(a,b){var c=
b.text().fold(k(b),function(a){return cb(b,{text:k(g.some(0<a.trim().length?a:b.url().getOr(""))),textChanged:0<a.trim().length?b.textChanged:k(!0)})});a.focus();return c.url().fold(k([]),function(b){return 0<b.trim().length?daa(a,c):[]})},setProperties:io},LL=function(a,b){var c=oa.getEnd(b);a.setSelection(b,c,b,c)},ML=function(a,b){a.setSelection(b,0,b,0)},Cy={selectEnd:LL,moveToEnd:function(a){a.getSelection().each(function(b){LL(a,b.endContainer());a.focus()})},selectStart:ML,moveToStart:function(a){a.getSelection().each(function(b){ML(a,
b.endContainer());a.focus()})}},NL=function(a,b){return a.getSelection().bind(function(c){return rd.sharedLinkOrClosest(c,a.isRoot).map(function(a){b(a);return a})})},Gp={insert:Eu.hyperlink,update:function(a,b){return NL(a,function(c){b.text().fold(function(){Eu.setProperties(c,b)},function(d){""===d&&""!==Mb.get(c)?(a.setRelativeSelection(ha.before(c),ha.before(c)),E.remove(c)):Eu.setProperties(c,b)&&(d=B.children(c).length,a.setRelativeSelection(ha.on(c,d),ha.on(c,d)))});a.focus()})},unlink:function(a){NL(a,
function(b){a.setSelection(b,0,b,B.children(b).length);var c=B.lastChild(b);E.unwrap(b);c.each(function(b){Cy.selectEnd(a,b)});a.focus()})}},eaa=function(a){return a.getSelection().bind(function(b){return a.win().bind(function(a){var c=wc.exact(b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset());return Na.getFirstRect(a,c).map(function(a){a={left:a.left(),top:a.top(),right:a.right(),bottom:a.bottom(),width:a.width(),height:a.height()};return{bounds:k(a),element:k(b.startContainer())}})})})},
OL=function(a,b,c){eaa(b).fold(function(){$w.insertAtCursor(a,b,c)},function(d){var e=d.bounds();d=d.element();(C.isText(d)?B.parent(d):g.some(d)).each(function(d){d=a.directionAt(d);var f=b.translateScreen(e.left,e.top);c({left:f.left,top:f.top,height:k(e.height),width:k(e.width),direction:k(d)})})})},PL=function(a,b,c,d,e,f,h){var g=e.direction();a=ol.makeshift(a,b,e.left(),e.top(),e.width(),e.height(),g,f,h);b.show(c,a);c.setComponents([d.element()])},Fp={show:function(a,b,c,d,e){OL(a,b,function(a){PL(b,
c,d,e,a,Lg(0,0))})},showExpandable:function(a,b,c,d,e){OL(a,b,function(a){n.add(d.panel(),z.resolve("expandable-popup"));var f=Lg(22,14),g={maxHeightFunction:xe.expandable()};PL(b,c,d,e,a,f,g)})}},Fu=function(a,b,c){a=Dc(a);b=w.translate(b);a.content(Rc(b));n.add(a.element(),z.resolve(c));T.button(a.element(),b);return a},QL=function(a){var b=S.div();n.add(b,z.resolve("main-controls"));O.append(b,a);return b},RL=function(a,b,c){var d=Fu("remove","link.dialog.remove","link-remove"),e=Fu("cancel","button.cancel",
"link-cancel"),f=Fu(a,b,c);a=G.create({remove:Q([],d.events.click),cancel:Q([],e.events.click),execute:Q([],f.events.click)});b=[ea.button(d.element(),xa.button({execute:Nb.click})),ea.button(e.element(),xa.button({execute:Nb.click})),ea.button(f.element(),xa.button({execute:Nb.click}))];return{remove:d,cancel:e,execute:f,keylayouts:b,events:a.registry,destroy:function(){d.destroy();e.destroy();f.destroy()}}},Wx={insert:function(){var a=RL("insert","link.dialog.insert","link-insert"),b=QL([a.cancel.element(),
a.execute.element()]);a.remove.disable();ma.disable(a.remove.element());return{dialogTitle:k(w.key("link.dialog.aria.insert")),elements:k([a.remove.element(),b]),events:k(a.events),keylayouts:k(a.keylayouts),execute:a.execute,destroy:a.destroy}},update:function(){var a=RL("update","link.dialog.update","link-update"),b=QL([a.cancel.element(),a.execute.element()]);return{dialogTitle:k(w.key("link.dialog.aria.update")),elements:k([a.remove.element(),b]),events:k(a.events),keylayouts:k(a.keylayouts),
execute:a.execute,destroy:a.destroy}}},SL=z.resolve("link-validation-highlight"),TL=z.resolve("link-validation-invalid"),UL=z.resolve("link-validation-unknown"),VL=k([SL,TL,UL]),be={configure:function(a){A(VL(),function(b){a.add(a.output(),b,Ka.removeClass(b));a.add(a.internal(),b,Ka.removeClass(b))})},allClasses:VL,invalidLink:k(TL),unknownLink:k(UL),validationHighlight:k(SL)},Vx={enabled:function(a){var b=g.none(),c=M("value","text","attrs"),d=G.create({properties:q(["link"]),follow:q(["link"]),
ignore:q(["link"]),remove:q(["link"])}),e={"linkmenu-properties":d.trigger.properties,"linkmenu-follow":d.trigger.follow,"linkmenu-ignore":d.trigger.ignore,"linkmenu-remove":d.trigger.remove};return{situation:function(a){a=b.map(function(a){var b=[c("linkmenu-properties",w.translate("link.context.edit"),{}),c("linkmenu-follow",w.translate("link.context.follow"),{}),c("linkmenu-remove",w.translate("link.context.remove"),{})];a=n.has(a,be.validationHighlight())?[c("linkmenu-ignore",w.translate("link.context.ignore"),
{})]:[];return b.concat(a)}).getOr([]);return{primary:k(a),secondary:k([]),submenus:k([])}},handle:function(a){b.each(function(b){var c=m.get(a,"data-ephox-gopher-item-value");c=e[c];void 0!==c&&c(b)})},assign:function(c){b=c.bind(function(b){return L.closest(b,"a[href]",a.isRoot)})},events:d.registry}},disabled:function(){var a=Tf.noSituation(),b=G.create({properties:q(["link"])});return{situation:a,handle:u,assign:u,events:b.registry}}},jo=z.resolve("link-eph-cursor"),faa=function(a){A(a,E.remove)},
gaa=function(a,b){WL("textbox-bookmark-top",a,y.prepend,b,lb.top())},haa=function(a,b){WL("textbox-bookmark-bottom",a,y.append,b,lb.bottom())},WL=function(a,b,c,d,e){var f=Nk.generate(a);A(b,function(a){m.set(a,"href","#"+f)});a=ca.children(d,"["+lb.bookmarkDataAttr()+'="'+e+'"]');A(a,E.remove);0<b.length&&(b=p.fromTag("span"),m.setAll(b,{id:f,style:"visibility: hidden;"}),m.set(b,lb.bookmarkDataAttr(),e),c(d,b))},Xg={configure:function(a){a.add(a.internal(),jo,Ka.remove);a.add(a.output(),jo,Ka.remove);
a.addExcludedContext(["."+jo]);a.addSelector(a.input(),"["+lb.bookmarkDataAttr()+"]",faa);a.addSelector(a.output(),"["+lb.bookmarkAnchorDataAttr()+'="'+lb.top()+'"]',gaa);a.addSelector(a.output(),"["+lb.bookmarkAnchorDataAttr()+'="'+lb.bottom()+'"]',haa)},properties:ya("url textChanged text title target action invalid".split(" "),[]),insertCursor:k(jo)},Hi=z.resolve("inline-popup-expanded"),iaa={setValue:function(a,b,c){a=a.dom();a.value=b;a.text=c}},XL=function(a,b){a.dom().add(b.dom())},Ep={getValue:function(a){var b=
a.dom();a=b.selectedIndex;b=b.options[a];return void 0===b||-1===a?g.none():g.from(b.value)},add:XL,addAll:function(a,b){A(b,function(b){XL(a,b)})},setSelected:function(a,b){a.dom().selectedIndex=b}},YL=[{value:"",i18nKey:"link.properties.target.none"},{value:"_blank",i18nKey:"link.properties.target.blank"},{value:"_top",i18nKey:"link.properties.target.top"},{value:"_self",i18nKey:"link.properties.target.self"},{value:"_parent",i18nKey:"link.properties.target.parent"}],OT={target:function(a){var b=
Jc.common("select","target-container","link.properties.target.label"),c=F(YL,function(a){var b=p.fromTag("option");iaa.setValue(b,a.value,w.translate(a.i18nKey));return b});Ep.addAll(b.field(),c);var d=a.target().getOr("");a=Ta(YL,function(a){return a.value===d}).getOr(0);Ep.setSelected(b.field(),a);return{element:b.element,input:b.field}}},NT=function(){var a=S.div();n.add(a,z.resolve("invalid-link-info"));var b=Jc.comboBox("href-url-value","link.properties.url.label",g.some(a));m.setAll(b.input(),
{placeholder:w.translate("link.properties.url.placeholder"),autocomplete:"off",autocorrect:"off"});var c=n.toggler(b.element(),z.resolve("link-is-invalid"));return{input:b.input,element:b.element,dropArrow:b.dropArrow,showInvalid:function(){c.on();var d=S.span();ja.add(d,[z.resolve("icon"),z.resolve("invalid-link-icon")]);y.append(a,d);var e=w.translate("link.properties.url.invalid");m.set(d,"title",e);d=bb.describe(b.input(),e);m.set(d,"aria-live","assertive");y.append(a,d)},hideInvalid:function(){c.off();
E.empty(a);m.remove(b.input(),"aria-describedby")}}},ST=function(a){var b={};A(a,function(a){b[a]={}});return jb(b)},Ii={url:function(a){return g.some(a.url())},title:function(a){return a.title()},innerText:function(a){a=a.innerText();return 0<a.length?g.some(a):g.none()}},rc={resolve:Hb.create("ephox-tarot").resolve},ZL=function(a,b,c,d,e){var f=p.fromText(a.substr(0,b));b=p.fromText(a.substr(b,c));a=p.fromText(a.substr(d));e=p.fromTag(e);y.append(e,b);return[f,e,a]},$L=function(a,b,c,d){var e=S.tag(b);
O.append(e,c);d.each(function(a){n.add(e,a)});return{item:k(a),marked:k(g.some(e))}},aM=function(a,b,c,d){var e=a.text,f=a.marker.start(),h=a.marker.length(),k=0;0<d-(f+h)||0===f||(k=h>d?f-10:f-Math.floor((d-h)/2));d=e.substr(k);f-=k;b=ZL(d,f,h,f+h,b);e=d.length===e.length?g.none():g.some(rc.resolve("anchor-before"));return $L(a.item(),c,b,e)},Gu=function(a,b){var c=S.span();n.add(c,b);O.append(c,a);return c},bM=function(a,b,c){var d=[];b=Gu(b,rc.resolve("content-innertext"));0<a.length&&(a=Gu([p.fromText(a)],
rc.resolve("anchor-before")),d.push(a));d.push(b);0<c.length&&(c=Gu([p.fromText(c)],rc.resolve("anchor-after")),d.push(c));return d},Hu={contentMarker:function(a,b,c,d){var e=a.item().before(),f=a.item().after(),h=a.text;if(0===e.length&&0===f.length&&h.length>d)return aM(a,b,c,d);d=a.marker.start();var k=a.marker.length();b=ZL(h,d,k,d+k,b);e=bM(e,b,f);return $L(a.item(),c,e,g.none())},contentUnderlined:bM,attrMarker:aM},cM=function(a,b,c){a=S.tag(b);y.append(a,p.fromText(c));return a},Tx={anchors:function(a,
b){var c=b.item(),d=c.url(),e=S.div();n.add(e,rc.resolve("item-line"));var f=c.title().getOr(d);m.set(e,"title",f);b=b.marked().fold(function(){return cM(a,"div",f)},function(a){return a});n.add(b,rc.resolve("item-main-label"));d=g.from(d).map(function(b){return b!==f?(b=cM(a,"div",b),n.add(b,rc.resolve("item-secondary-label")),[b]):[]}).getOr([]);d=[b].concat(d);O.append(e,d);return e},standard:function(a,b){var c=b.item();a=S.div();n.add(a,rc.resolve("item-line"));n.add(a,rc.resolve("bookmark-icon"));
var d=[c.before(),c.innerText(),c.after()].join("");m.set(a,"title",d);b=b.marked().fold(function(){var a=Hu.contentUnderlined(c.before(),[p.fromText(c.innerText())],c.after()),b=S.div();O.append(b,a);return b},function(a){return a});n.add(b,rc.resolve("item-main-label"));c.indent()&&n.add(b,rc.resolve("indent"));y.append(a,b);return a},error:function(a,b){a=S.span();b=p.fromText(b);y.append(a,b);return a}},jaa=M("matchFunction","start","length"),kaa=function(a,b,c){for(var d=0,e=[],f=function(a){e.push(a);
d++},h=0,g=a.length;h<g&&d<b;h++)c(a[h]).each(f);return e},Iu={unmarked:function(a,b){b=b.getOr(1E3);a=a.length>b?a.slice(0,b):a;return F(a,function(a){return{item:k(a),marked:g.none}})},match:function(a,b,c,d){var e=c.toLowerCase();c=d.getOr(1E3);return kaa(a,c,function(a){return oc(b,function(b){return b(a).bind(function(c){var d=c.toLowerCase().indexOf(e);if(-1<d){var f=e.length;return g.some({item:k(a),marked:g.none,text:c,marker:jaa(b,d,f)})}return g.none()})})})},mark:function(a,b,c,d){return F(a,
function(a){return(a.marker.matchFunction()===Ii.innerText?Hu.contentMarker:Hu.attrMarker)(a,b,c,d)})}},dM="data"+rc.resolve("section-id"),Ju={create:function(a,b){var c=p.fromTag("ol");m.set(c,dM,b.id());var d=function(){E.empty(c)};return{element:k(c),clear:d,add:function(a){var b=p.fromTag("li");y.append(b,a);y.append(c,b);return b},spec:k(b),destroy:function(){d()}}},dataIdAttribute:k(dM)},laa=ya(["container","sections","translate"],["doc"]),maa=ya("id highlight contentLimit items render extractors".split(" "),
["itemLimit"]),Ku="data"+rc.resolve("item-id"),ml={init:function(a,b){var c=b.doc().getOr(p.fromDom(document)),d=b.translate(),e={},f=yi(),h=S.div();n.add(h,rc.resolve("predictive-menu"));T.hidden(h,!0);var l=QT(a,h),r=function(){A(f.state(),function(a){t(a,[])})},t=function(a,b){E.remove(a.element());a.clear();var d={};0<b.length&&(A(b,function(b){var e=a.spec().render()(c,b);e=a.add(e);var f=Za("");m.set(e,Ku,f);d[f]={gui:k(e),item:k(b.item())}}),y.append(h,a.element()));e[a.spec().id()]=d},x=function(){return B.parent(h).isSome()},
v=function(a){n.add(a,rc.resolve("selected"));K().bind(P).each(function(a){bb.speak(fa.body(),a.item().url())})},w=function(a){v(a);Pa.intoViewIfNeeded(a,h)},z=function(a){n.remove(a,rc.resolve("selected"))},C=function(){L.descendant(h,"li").each(w)},F=function(){za.one("ol:last-child li:last-child",h).each(w)},K=function(){return L.descendant(h,"li."+rc.resolve("selected"))},M=function(){return K().bind(P).map(function(a){a=a.item();bb.speak(fa.body(),d("link.dialog.autocomplete.accept",a.url()));
return a})},N=function(a){0===B.children(a).length?B.nextSibling(a).fold(C,N):B.firstChild(a).fold(F,w)},O=function(a){0===B.children(a).length?B.prevSibling(a).fold(F,O):B.lastChild(a).fold(C,w)},P=function(a){a=L.closest(a,"["+Ku+"]");var b=a.bind(function(a){return L.closest(a,"["+Ju.dataIdAttribute()+"]")}),c=a.map(function(a){return m.get(a,Ku)});return b.map(function(a){return m.get(a,Ju.dataIdAttribute())}).bind(function(a){return g.from(e[a])}).bind(function(a){return c.bind(function(b){return g.from(a[b])})})},
Q=J.capture(h,"mouseover",function(a){a=a.target();tb.closest(a,"li."+rc.resolve("selected"))||P(a).fold(u,function(a){K().each(function(a){z(a)});v(a.gui())})}),R=J.capture(h,"click",function(a){M().each(V.trigger.click)}),V=G.create({click:q(["item"])}),W=Ac(eh,["url","indent"]);A(b.sections(),function(a){A(a.items(),W);a=Ju.create(c,a);f.push(a)});r();return{element:k(h),events:V.registry,reset:r,resetFull:function(){A(f.state(),function(a){a.clear();var b=a.spec().items(),c=a.spec().itemLimit();
b=Iu.unmarked(b,c);t(a,b)})},filter:function(a){0<a.length?(e={},A(f.state(),function(b){var c=b.spec(),d=Iu.match(c.items(),c.extractors(),a,c.itemLimit());c=Iu.mark(d,c.highlight(),"div",c.contentLimit());t(b,c)})):r()},show:function(a){var c=b.container();y.append(c,h);l.position(a,Rg.relativeOrigin(c));bb.speak(fa.body(),d("link.dialog.autocomplete.open"))},isShowing:x,hide:function(){x()&&bb.speak(fa.body(),d("link.dialog.autocomplete.close"));E.remove(h);K().each(z)},getSelectedData:M,moveup:function(){K().fold(F,
function(a){z(a);B.prevSibling(a).fold(function(){B.parent(a).bind(B.prevSibling).fold(F,O)},w)})},movedown:function(){K().fold(C,function(a){z(a);B.nextSibling(a).fold(function(){B.parent(a).bind(B.nextSibling).fold(C,N)},w)})},destroy:function(){Q.unbind();R.unbind();A(f,function(a){a.destroy()});E.remove(h)}}},config:laa,section:maa},UT=ba.detect().browser.isSafari(),Dp=M("url","indent","action","before","innerText","after"),TT=M("url","indent","title","action"),Ux=M("url","action"),Sx=M("url",
"indent","action"),Lu=sa.generate([{invalid:["invalidUrl"]},{unknown:["unknownUrl"]},{valid:["validUrl"]}]),Yx={cata:function(a,b,c,d){return a.fold(b,c,d)},derive:function(a,b){return"VALID"===b?Lu.valid(a):"INVALID"===b?Lu.invalid(a):Lu.unknown(a)}},eM=[af("url"),yI("fresh",!1)],naa=Mf(eM),oaa=Mf([Rj("urls","urls",xn(),I6(eM))]),Xx={one:k(naa),many:k(oaa)},paa={recompose:function(a){var b="";""!==a.protocol&&(b+=a.protocol,b+=":");""!==a.authority&&(b=b+"//"+a.authority);b+=a.path;""!==a.query&&
(b=b+"?"+a.query);""!==a.anchor&&(b=b+"#"+a.anchor);return b}},ko={remove:function(a){for(var b="";""!==a;)if(Ab(a,"../"))a=Yi(a,"../");else if(Ab(a,"./"))a=Yi(a,"./");else if(Ab(a,"/./"))a="/"+Yi(a,"/./");else if("/."===a)a="/";else if(Ab(a,"/../"))a="/"+Yi(a,"/../"),b=Zi(b,b.substring(b.lastIndexOf("/")));else if("/.."===a)a="/",b=Zi(b,b.substring(b.lastIndexOf("/")));else if("."===a||".."===a)a="";else{var c=a.match(/(^\/?.*?)(\/|$)/)[1];a=Yi(a,c);b+=c}return b}},qaa={merge:function(a,b,c){if(""!==
c&&""===a)return"/"+b;c=a.substring(a.lastIndexOf("/")+1);return Zi(a,c)+b}},raa={transform:function(a,b){var c={strictMode:!0},d=Yg.parse(a,c);b=Yg.parse(b,c);c={};""!==b.protocol?(c.protocol=b.protocol,c.authority=b.authority,c.path=ko.remove(b.path),c.query=b.query):(""!==b.authority?(c.authority=b.authority,c.path=ko.remove(b.path),c.query=b.query):(""===b.path?(c.path=d.path,c.query=""!==b.query?b.query:d.query):(Ab(b.path,"/")?c.path=ko.remove(b.path):(c.path=qaa.merge(d.path,b.path,a.authority),
c.path=ko.remove(c.path)),c.query=b.query),c.authority=d.authority),c.protocol=d.protocol);c.anchor=b.anchor;return c}},Zx={resolve:function(a,b){a=raa.transform(a,b);return paa.recompose(a)}},cU=M("href","resolved"),eU={generate:function(a){var b={};A(a,function(a){var c=a.resolved();a=a.href();b.hasOwnProperty(c)?V(b[c],a)||b[c].push(a):b[c]=[a]});return b}},saa={rules:[{current:ua.backtrack,next:ua.sidestep,fallback:g.none()},{current:ua.sidestep,next:ua.sidestep,fallback:g.some(ua.backtrack)},
{current:ua.advance,next:ua.sidestep,fallback:g.some(ua.sidestep)}],inclusion:function(a,b,c){return!a.property().parent(c).exists(function(c){return a.eq(c,b.item())})}},taa=ua.walkers(),fM=function(a,b,c,d){return ua.walk(a,b,c,taa.left(),d.rules).map(function(c){return a.property().isEmptyTag(c.item())||a.property().isBoundary(c.item())?[]:(d.inclusion(a,c,b)?[c.item()]:[]).concat(fM(a,c.item(),c.mode(),d))}).getOr([])},gM=function(a,b,c){a=fM(b,c,ua.sidestep,a);return Ld(a).concat([c])},hM={top:t(gM,
saa),all:t(gM,{rules:void 0,inclusion:function(a,b,c){return a.property().isText(b.item())}})},iM=gb(),jM={top:function(a){return hM.top(iM,a)},all:function(a){return hM.all(iM,a)}},uaa=function(a,b){b=zd.generate(b,function(b,c){return a.property().isText(b)?g.some(W.range(b,c,c+a.property().getText(b).length)):g.none()});var c=zb(b,function(b,c){return a.property().getText(c.element())+b},"");return{list:k(b),text:k(c)}},vaa=function(a,b,c,d){var e=zd.find(b.list(),function(b){return a.eq(b.element(),
c)}).map(function(a){return a.start()+d});return{list:b.list,text:b.text,cursor:k(e)}},waa={from:function(a,b,c,d){b=uaa(a,b);return vaa(a,b,c,d)}},xaa=gb(),yaa={from:function(a,b,c){return waa.from(xaa,a,b,c)}},lU={get:function(a,b){var c=jM.all(a),d=yaa.from(c,a,b);b=d.cursor().orThunk(function(){return C.isText(a)?g.none():g.some(d.text().length)});return{list:d.list,text:d.text,cursor:k(b)}}},kM=function(a,b){return{patterns:function(){return[new RegExp("^("+a+")(.+)","gi")]},useCursor:Sc,generate:function(a,
d){a=p.fromTag(b,a.dom());O.append(a,d.clones());return Gd.species({elements:k([a]),cursor:g.none,dictation:g.none,notify:g.none})},derive:function(a){var b=a[1];return g.some({startIndex:k(a.index),finishIndex:k(a.index+b.length)})}}},Zg={normal:function(a,b){a=sb.sanitise(a);return kM(a,b)},spaced:function(a,b){a=sb.sanitise(a)+"\\s";return kM(a,b)}},lM=function(a,b){return Gd.species({elements:k([p.fromText(b.text())]),cursor:g.none,dictation:g.none,notify:g.none})},zaa=function(){return{patterns:function(){return[/([^.?!][.?!]\s+)([a-z][^\s]*)/g,
/^()([a-z][^\s]*)/g]},useCursor:k(!0),generate:lM,derive:function(a){var b=a.index,c=b+a[0].length;a=a[1]+qq(a[2]);return g.some({startIndex:k(b),finishIndex:k(c),text:k(a)})}}}(),Aaa=function(){return{patterns:function(){return[/([A-Z][A-Z]+)([a-z]+)/g]},useCursor:k(!1),generate:lM,derive:function(a){var b=a[2];b=qq(a[1].toLowerCase())+b.toLowerCase();var c=a.index;a=c+a[0].length;return g.some({startIndex:k(c),finishIndex:k(a),text:k(b)})}}}(),$x={capitalise:k(zaa),normalise:k(Aaa)},jU={patterns:function(){return[fm.autolink()]},
useCursor:k(!0),generate:function(a,b){a=p.fromTag("a");m.set(a,"href",b.href());y.append(a,p.fromText(b.text()));return Gd.species({elements:k([a]),cursor:g.none,dictation:g.none,notify:t(g.some,[a])})},derive:function(a){var b=Du.preprocess(a[1]),c=b.text();b=b.href();return-1<c.indexOf("@")?g.none():g.some({startIndex:k(a.index),finishIndex:k(a.index+c.length),text:k(c),href:k(b)})}},iU=k(function(a,b){return b}),Baa={cloneAfter:function(a,b,c){var d=b;return F(a,function(a){var b=Gc.deep(a);C.isText(a)&&
P.eq(c.endContainer(),a)&&Oa.get(a).length>c.endOffset()&&Oa.set(b,Oa.get(b).substring(0,c.endOffset()));if(C.isText(b)&&0<d){var e=Oa.get(b);a=Math.min(e.length,d);e=e.substring(a);Oa.set(b,e);d-=a}return b})}},mM={matcher:function(a,b,c){var d=function(a){return c.fold(function(){return a&&1<a.length},function(b){return a&&0<a.length&&a.index+a[0].length===b})};return oc(a,function(a){a:{if(!a.global)throw"Macro matching only works with global regexes: "+a;for(var c=a.exec(b);c;){if(d(c)){a=g.some(c);
break a}c=a.exec(b)}a=g.none()}return a})}},Caa=function(a,b,c,d){b=Baa.cloneAfter(b,d.finishIndex(),c);var e=ra(d,{clones:k(b)});return{build:function(b){b=a.generate(b,e);return Gd.applicator({elements:b.elements,cursor:b.cursor,range:k(c),dictation:b.dictation,notify:b.notify})}}},Daa=function(a,b,c){b=zd.get(a,b);var d=zd.get(a,c);return b.bind(function(a){return d.map(function(b){return{start:k(a),finish:k(b)}})})},Eaa=function(a,b){return b(a.start().element())&&b(a.finish().element())?g.some(a):
g.none()},Faa=function(a,b,c){return b.doc().bind(function(d){d=a.build(d);var e=d.elements();F(e,Lf.doNotMerge);var f=Rw.handle(d.range());bd.insertAt(b,f,e);F(e,Lf.clear);d.dictation().each(function(a){bb.shout(fa.body(),a())});d.notify().each(function(){c.input(e)});return d.cursor()})},nM=function(a,b,c,d,e){return a.detect(b,c,d,e).map(function(a){return{execute:t(Faa,a)}})},Ip={block:t(nM,{detect:function(a,b,c,d){var e=b.patterns(),f=a.cursor().filter(b.useCursor);return mM.matcher(e,a.text(),
f).bind(b.derive).bind(function(a){var e=jM.top(c);if(0<e.length){var f=es(e[0],0,c,d);return g.some(Caa(b,e,f,a))}return g.none()})}}),inline:t(nM,{detect:function(a,b,c,d){c=b.patterns();d=a.cursor().filter(b.useCursor);return mM.matcher(c,a.text(),d).bind(b.derive).bind(function(c){return Daa(a.list(),c.startIndex(),c.finishIndex()).bind(function(a){return Eaa(a,b.allowed).map(function(a){var d=c.startIndex()-a.start().start(),e=c.finishIndex()-a.finish().start(),f=es(a.start().element(),d,a.finish().element(),
e);return{build:function(a){a=b.generate(a,c);return Gd.applicator({elements:a.elements,cursor:a.cursor,range:k(f),dictation:a.dictation,notify:a.notify})}}})})})}})},oU=ba.detect().deviceType.isTouch(),by=function(a){a.disable();ma.disable(a.element())},rU=ba.detect().deviceType.isiOS(),Gaa=M("rawData","extra"),cy=function(a,b,c){if(Gb(b)&&Gb(c))return N.value(Gaa(b,c));console.error(a+" callback parameters were not both arrays",b,c);return N.error(a+" callback parameters were not both arrays")},
Jp=function(a,b){if(Ti.isPrototypeOf(b))return N.value(p.fromDom(b));console.error(a+" was not a DOM element",b);return N.error(a+" was not a DOM element")},EU={configure:function(a){var b=[a.internal(),a.history(),a.output()];A(b,function(b){a.addSelector(b,"span.ephox-polish-incomplete-mention",Ka.unwrap)});a.addExcludedContext(["span.ephox-polish-incomplete-mention"])}},ey=z.resolve("no-results"),dy=z.resolve("loading-results"),Kp=sa.generate([{none:["item"]},{extra:["value","item"]},{fetched:["userId",
"name","rawname","info","item"]}]),Lp=sa.generate([{nothing:[]},{refetch:["term"]},{open:["term"]}]),oM=function(){return new RegExp(sb.wordbreak(),"i")},Haa=function(a,b,c){return Cg.repeatLeft(a,c,function(a,b,c,h,g){return Cg.previousChar(h,g).fold(function(){return b.kontinue()},function(a){return b.finish(a.ch())})}).fold(g.none,g.none,g.some)},Iaa=function(a,b,c,d){return 0<=d&&"@"===c.charAt(d)?a.finish(W.point(b,d)):a.abort()},Jaa=function(a,b,c,d){return a.finish(W.point(b,d))},Kaa=function(a){return g.some(W.point(a,
oa.getEnd(a)))},gy={isValidMention:function(a,b){return Haa(a,ua.sidestep,b).fold(k(!0),function(a){return null===a.match(/[0-9a-zA-Z]/)})},scan:function(a,b){return Cg.expandLeft(a,b,{regex:oM,attempt:Iaa}).fold(g.none,g.none,g.some).bind(function(c){return Cg.expandRight(a,b,{regex:oM,attempt:Jaa}).fold(g.none,Kaa,g.some).map(function(a){return{start:c.element,soffset:c.offset,finish:a.element,foffset:a.offset}})})}},Xh=sa.generate([{none:[]},{bare:["text","start","soffset","finish","foffset"]},
{incomplete:["text","element"]},{complete:["text","element"]}]),pM=z.resolve("incomplete-mention"),Laa=function(a,b){return gy.scan(a,b).map(function(a){return Xh.bare("",a.start(),a.soffset(),a.finish(),a.foffset())})},qM=function(a){if(C.isText(a))return Oa.get(a);a=Cc.descendants(a,C.isText);return F(a,Oa.get).join("")},rM=function(a,b){return a.collapsed()?L.closest(a.startContainer(),b.hoverSelector()).fold(function(){return L.closest(a.startContainer(),"."+pM).fold(function(){return Laa(a.startContainer(),
a.startOffset())},function(a){return g.some(Xh.incomplete(qM(a),a))})},function(a){return g.some(Xh.complete(qM(a),a))}).getOrThunk(Xh.none):Xh.none()},$g={detect:function(a,b){return a.getSelection().map(function(a){return rM(a,b)}).getOrThunk(Xh.none)},detectOn:rM,withinIncomplete:function(a){return L.closest(a,"."+pM)}},sM=function(a){n.remove(a,z.resolve("incomplete-mention"));E.unwrap(a)},Np={cancel:sM,create:function(){var a=p.fromTag("span");n.add(a,z.resolve("incomplete-mention"));var b=p.fromText("@");
y.append(a,b);return a},validatePrevious:function(a,b){$g.withinIncomplete(a).filter(function(a){return $g.withinIncomplete(b).forall(function(b){return!P.eq(a,b)})}).each(sM)}},Mp="."+z.resolve("mentions-business-card"),BU=function(a,b){return 1<arguments.length||/\{(\d+)\}/.test(a)?fm.tokens.call(void 0,a,b):a},GU=M("textkey","value","icon"),Maa=function(){return{configure:function(a){var b=[a.internal(),a.history(),a.output(),a.paste()];A(b,function(b){a.addSelector(b,"[unselectable]",Ka.removeAttr("unselectable"))})},
clean:function(a){m.remove(a,"unselectable")},disableNativeResize:function(a){m.set(a,"unselectable","on")}}},Naa=function(){return{configure:u,clean:function(a){B.nextSibling(a).filter(Ud.isEmptyText).each(E.remove)},disableNativeResize:u}},tM=ba.detect().browser,Op=tM.isIE()?Maa():tM.isFirefox()?Naa():{configure:u,clean:u,disableNativeResize:u},uM="data-"+z.resolve("resize-direction"),lo=function(a,b){var c=p.fromTag("span");ja.add(c,[z.resolve(a),z.resolve("resize-eph-resizer")]);m.set(c,uM,b);
return c},OU={create:function(){var a=lo("element-se-resize","1"),b=lo("element-ne-resize","1"),c=lo("element-sw-resize","-1"),d=lo("element-nw-resize","-1"),e=p.fromTag("div");n.add(e,z.resolve("resize-wrapper"));O.append(e,[a,b,c,d]);var f=function(){E.remove(e)},h=G.create({click:q(["multiplier"])}),g=J.bind(e,"mousedown",function(a){n.has(a.target(),z.resolve("resize-eph-resizer"))&&(a.prevent(),a=m.get(a.target(),uM),a=void 0!==a?parseInt(a,10):1,h.trigger.click(a))});return{refresh:function(f,
h){y.append(f,e);f=Wa.absolute(h);var g=pa.get(h);h=Aa.get(h);h={top:f.top,height:k(g),left:f.left,width:k(h)};f=Aa.get(c)/2;v.setAll(c,{top:h.top()+h.height()-f+"px",left:h.left()-f+"px"});v.setAll(a,{top:h.top()+h.height()-f+"px",left:h.width()+h.left()-f+"px"});v.setAll(b,{top:h.top()-f+"px",left:h.width()+h.left()-f+"px"});v.setAll(d,{top:h.top()-f+"px",left:h.left()-f+"px"})},clear:f,events:h.registry,destroy:function(){g.unbind();f()}}}},Oaa=M("minRow","minCol","maxRow","maxCol"),Paa=function(a,
b){var c=a.grid().columns(),d=a.grid().rows(),e=c,f=0,h=0;Ra(a.access(),function(a){if(b(a)){var c=a.row(),g=c+a.rowspan()-1,k=a.column();a=k+a.colspan()-1;c<d?d=c:g>f&&(f=g);k<e?e=k:a>h&&(h=a)}});return Oaa(d,e,f,h)},Qaa=function(a,b,c,d){for(var e=b.grid().columns(),f=b.grid().rows(),h=0;h<f;h++)for(var g=!1,k=0;k<e;k++)if(!(h<c.minRow()||h>c.maxRow()||k<c.minCol()||k>c.maxCol()))if(vb.getAt(b,h,k).filter(d).isNone()){var m=g,n=a[h].element(),q=p.fromTag("td");y.append(q,p.fromTag("br"));(m?y.append:
y.prepend)(n,q)}else g=!0},Raa=function(a,b){var c=ka(kj.firstLayer(a,"tr"),function(a){return 0===a.dom().childElementCount});A(c,E.remove);b.minCol()!==b.maxCol()&&b.minRow()!==b.maxRow()||A(kj.firstLayer(a,"th,td"),function(a){m.remove(a,"rowspan");m.remove(a,"colspan")});m.remove(a,"width");m.remove(a,"height");v.remove(a,"width");v.remove(a,"height")},Saa={extract:function(a,b){var c=function(a){return za.is(a.element(),b)},d=Bf.fromTable(a),e=vb.generate(d),f=Paa(e,c),h="th:not("+b+"),td:not("+
b+")",g=kj.filterFirstLayer(a,"th,td",function(a){return za.is(a,h)});A(g,E.remove);Qaa(d,e,f,c);Raa(a,f);return a}},TU=function(a){A(a,function(a){E.empty(a);y.append(a,p.fromTag("br"))})},Taa=function(a){return mb.table(a[0]).map(Gc.deep).map(function(a){return[Saa.extract(a,Vd.selectedSelector())]})},RU=function(a,b){var c=Dt.register({doc:a.doc,win:a.win,body:a.body,getSelection:a.getSelection,setSelection:a.setSelection});return function(b,e,f,h){e=Li.buildClipboardContents(e,f);h();var d=pl.fromSafe(a);
d.begin();c.setClipboard(b,e,function(){d.end()})}},SU=function(a,b){return Taa(a).map(function(a){A(a,b);var c=t(Pl.toText,a);a=t(Pl.toHtml,a);return{text:c,html:a}})},UU=function(a,b,c){return Ph.fragment(b.win(),a).map(function(a){var b=t(Ph.text,a);a=t(Ph.html,a,c);return{text:b,html:a}})},cd={resolve:Hb.create("ephox-cement").resolve},Uaa=cd.resolve("smartpaste-eph-bin"),wy={binStyle:k(Uaa)},vM=function(a,b){return Pb.cata(b.get(),k([]),aa,k([a]))},Mu={mergable:function(a,b){return Pb.cata(b.get(),
g.none,function(b,d){return 0===b.length?g.none():jx.retrieveBox(a,Vd.firstSelectedSelector(),Vd.lastSelectedSelector()).bind(function(a){return 1<b.length?g.some({bounds:k(a),cells:k(b)}):g.none()})},g.none)},unmergable:function(a,b){var c=function(a){return m.has(a,"rowspan")&&1<parseInt(m.get(a,"rowspan"),10)||m.has(a,"colspan")&&1<parseInt(m.get(a,"colspan"),10)};a=vM(a,b);return 0<a.length&&kb(a,c)?g.some(a):g.none()},selection:vM},wM=function(a){return{element:k(a),mergable:g.none,unmergable:g.none,
selection:k([])}},Vaa=M("element","clipboard","generators"),ul={noMenu:wM,forMenu:function(a,b,c){return{element:k(c),mergable:k(Mu.mergable(b,a)),unmergable:k(Mu.unmergable(c,a)),selection:k(Mu.selection(c,a))}},notCell:function(a){return wM(a)},paste:Vaa},Waa=function(a){return"table"===C.name(a)||0===Mb.get(a).trim().length},xM=function(a){var b=ka(a,function(a){return"table"===C.name(a)});return 1!==b.length?g.none():kb(a,Waa)?g.from(b[0]):g.none()},EV={rules:function(a,b,c){var d=u,e=function(e,
f){return mb.table(e,a.isRoot).bind(function(h){var g=a.doc().getOrDie();g=pC.paste(g);g=ul.paste(e,f,g);var l=k(c);return pc.execute(b,dc.pasteCells,d,l)(a,h,g).map(function(a){return a.startContainer()})})},f=function(a){return xM(a).map(function(a){return{single:k(a)}})};return{collapsed:k(db(function(a,b,c){return mb.cell(b,a)},f,function(a,b){return e(a.element(),b.single())},"custom arcade table insert collapsed")),ranged:k(db(function(a,b,c){return mb.cell(b.element(),a).map(function(a){return{left:k(a),
right:k(a)}})},f,function(a,b){return e(a.left(),b.single())},"custom arcade table insert ranged"))}},extractTable:xM},yM="officeStyles htmlStyles isWord proxyBin isInternal backgroundAssets".split(" "),zM=ya([],yM),Ob={nu:zM,merge:function(a,b){var c={};A(yM,function(d){b[d]().or(a[d]()).each(function(a){c[d]=a})});return zM(c)}},fk=sa.generate([{error:["message"]},{paste:["elements","correlated"]},{cancel:[]},{incomplete:["elements","correlated","message"]}]),Nu=function(a,b,c,d,e){return a.fold(b,
c,d,e)},Ya={error:fk.error,paste:fk.paste,cancel:fk.cancel,incomplete:fk.incomplete,cata:Nu,carry:function(a,b){return Nu(a,g.none,g.none,g.none,function(a,d,e){return Nu(b,g.none,function(a,b){return g.some(fk.incomplete(a,b,e))},g.none,g.none)}).getOr(b)}},Ou=ya(["response","bundle"],[]),gk=function(a){return Pu(function(b){var c=Ou(a);b(c)})},Pu=function(a){var b=Pu;return{get:function(b){a(b)},map:function(c){return b(function(b){a(function(a){a=c(a);b(a)})})},bind:function(c){return b(function(b){a(function(a){c(a).get(b)})})}}},
Fa={call:function(a,b){a(Ou(b))},sync:Pu,pure:gk,pass:function(a){return gk({response:a.response(),bundle:a.bundle()})},done:Ou,error:function(a){return gk({response:Ya.error(a),bundle:Ob.nu({})})},initial:function(){return gk({response:Ya.paste([],[]),bundle:Ob.nu({})})},cancel:function(){return gk({response:Ya.cancel(),bundle:Ob.nu({})})}},AM=M("steps","input","label","capture"),Xaa=function(a,b){return oc(a,function(a){return a.getAvailable(b).map(function(b){return AM(a.steps(),b,a.label(),a.capture())})})},
Yaa=function(a,b){var c=t(Fa.pass,a),d=function(){return b().map(function(b){var c=Ob.merge(a.bundle(),b.bundle());b=Ya.carry(a.response(),b.response());return Fa.done({response:b,bundle:c})})};return Ya.cata(a.response(),c,d,c,d)},ny={choose:function(a,b,c){return Xaa(a,c).getOrThunk(function(){var a=b.getAvailable(c);return AM(b.steps(),a,b.label(),b.capture())})},run:function(a,b){return hb(a,function(a,d){return a.bind(function(a){return Yaa(a,function(){return d(b,a)})})},Fa.initial())}},hk=
Za("simple-adt"),BM={generate:function(a){var b=function(a){return 0===a.indexOf(hk)?a.substring(hk.length+1):a},c=jb(a),d={};A(c,function(a){d["as"+qq(a)]=function(b){return b._simpleAdt===hk+"_"+a?g.some(b.data):g.none()}});var e={};Ra(a,function(a,b){e[b]=function(c){var d=hk+"_"+b;var e=0===a.length?{}:ya(a,[])(c);return{_simpleAdt:d,data:e,_simpleAdt_data:c}}});return cb(d,{constructors:e,match:function(a,d){var e=jb(d);if(e.length!==c.length)throw Error("Partial match");return oc(e,function(b){return a._simpleAdt===
hk+"_"+b?g.some(d[b]):g.none()}).getOrDie("Must find branch for constructor: "+b(a._simpleAdt))(a.data)}})}},Kc=BM.generate({event:["nativeEvent"],html:["container"],word:["html","rtf"],text:["text"],images:["images"]}),mo=BM.generate({getFromFlash:[],disabled:[],fromClipboard:["rtf"]}),rl={getFromFlash:mo.constructors.getFromFlash,disabled:mo.constructors.disabled,fromClipboard:mo.constructors.fromClipboard,match:mo.match},CM=function(a,b){var c=new RegExp(b,"i");return oc(a,function(a){return null!==
a.match(c)?g.some({type:a,flavor:b}):g.none()})},Qu={isValidData:function(a){return void 0!==a&&void 0!==a.types&&null!==a.types},getPreferredFlavor:function(a,b){return oc(a,function(a){return CM(b,a)})},getFlavor:CM},Zaa=function(a,b){a=C.value(a);var c=p.fromTag("div"),d=a.indexOf("]>");c.dom().innerHTML=a.substr(d+2);return Da.descendant(c,function(a){return C.name(a)===b})},$aa=function(a){return C.isComment(a)?Zaa(a,"v:shape"):g.none()},aba=function(a){if("img"===C.name(a)){var b=m.get(a,"src");
if(void 0!==b&&null!==b&&Ab(b,"file://"))return a=Gc.shallow(a),b=b.split(/[\/\\]/),m.set(a,"data-image-id",b[b.length-1]),m.remove(a,"src"),m.set(a,"data-image-type","local"),n.add(a,"rtf-data-image"),g.some(a)}return g.none()},bba=function(a){return $aa(a).map(function(a){var b=m.get(a,"o:spid");b=void 0===b?m.get(a,"id"):b;var d=p.fromTag("img");n.add(d,"rtf-data-image");m.set(d,"data-image-id",b.substr(7));m.set(d,"data-image-type","code");v.setAll(d,{width:v.get(a,"width"),height:v.get(a,"height")});
return d})},DM={validStyles:function(){return/^(mso-.*|tab-stops|tab-interval|language|text-underline|text-effect|text-line-through|font-color|horiz-align|list-image-[0-9]+|separator-image|table-border-color-(dark|light)|vert-align|vnd\..*)$/},specialInline:function(){return/^(font|em|strong|samp|acronym|cite|code|dfn|kbd|tt|b|i|u|s|sub|sup|ins|del|var|span)$/}},Yh=sa.generate([{starts:["value","f"]},{pattern:["regex","f"]},{contains:["value","f"]},{exact:["value","f"]},{all:[]},{not:["stringMatch"]}]),
EM=function(a,b){return a.fold(function(a,d){return 0===d(b).indexOf(d(a))},function(a,d){return a.test(d(b))},function(a,d){return 0<=d(b).indexOf(d(a))},function(a,d){return d(b)===d(a)},function(){return!0},function(a){return!EM(a,b)})},K={starts:Yh.starts,pattern:Yh.pattern,contains:Yh.contains,exact:Yh.exact,all:Yh.all,not:Yh.not,cata:function(a,b,c,d,e,f,h){return a.fold(b,c,d,e,f,h)},matches:EM,caseSensitive:function(a){return a},caseInsensitive:function(a){return a.toLowerCase()}},no={keyval:function(a,
b,c,d){var e=d.name,f=void 0!==d.condition?d.condition:k(!0);d=void 0!==d.value?d.value:K.all();return K.matches(e,c)&&K.matches(d,b)&&f(a)},name:function(a,b){var c=C.name(a),d=b.name;b=void 0!==b.condition?b.condition:k(!0);return K.matches(d,c)&&b(a)}},cba=function(a,b,c){A(b,function(b){m.remove(a,b)});Ra(c,function(b,c){m.set(a,c,b)})},FM={filter:function(a,b){var c={};A(a.dom().attributes,function(a){b(a.value,a.name)||(c[a.name]=a.value)});return c},clobber:function(a,b,c){c=F(a.dom().attributes,
function(a){return a.name});jb(b).length!==c.length&&cba(a,c,b)},scan:k({})},dba=function(a){var b={};a=void 0!==a&&null!==a?a.split(";"):[];A(a,function(a){a=a.split(":");2===a.length&&(b[dh(a[0])]=dh(a[1]))});return b},GM=function(a){var b=jb(a);return F(b,function(b){return b+": "+a[b]}).join("; ")},Sf={filter:function(a,b){var c=a.dom().style,d={};A(void 0===c||null===c?[]:c,function(c){var e=a.dom().style.getPropertyValue(c);b(e,c)||(d[c]=e)});return d},clobber:function(a,b,c){m.set(a,"style",
"");var d=jb(b).length,e=jb(c).length;0===d&&0===e?m.remove(a,"style"):0===d?m.set(a,"style",GM(c)):(Ra(b,function(b,c){v.set(a,c,b)}),b=m.get(a,"style"),c=0<e?GM(c)+"; ":"",m.set(a,"style",c+b))},scan:function(a,b,c){a=a.dom().getAttribute("style");var d=dba(a),e={};A(b,function(a){var b=d[a];void 0===b||c(b,a)||(e[a]=b)});return e}},eba=["mso-list"],HM=function(a,b){var c=Sf.scan(a,eba,b);b=Sf.filter(a,b);Sf.clobber(a,b,c)},IM=function(a,b){b=FM.filter(a,b);FM.clobber(a,b,{})},oo={style:HM,attribute:IM,
styleDom:function(a,b){HM(p.fromDom(a),b)},attributeDom:function(a,b){IM(p.fromDom(a),b)},validateStyles:function(a){var b=Sf.filter(a,k(!1));Sf.clobber(a,b,{})}},JM=function(a,b,c){a(c,function(a,e){return Va(b,function(b){return no.keyval(c,a,e,b)})})},po={remover:function(a,b){var c=ra({styles:[],attributes:[],classes:[],tags:[]},b);b=ca.descendants(a,"*");A(b,function(a){JM(oo.style,c.styles,a);JM(oo.attribute,c.attributes,a);A(c.classes,function(b){var c=m.has(a,"class")?ja.get(a):[];A(c,function(c){K.matches(b.name,
c)&&n.remove(a,c)})})});a=ca.descendants(a,"*");A(a,function(a){Va(c.tags,t(no.name,a))&&E.remove(a)})},unwrapper:function(a,b){var c=ra({tags:[]},b);a=ca.descendants(a,"*");A(a,function(a){Va(c.tags,t(no.name,a))&&E.unwrap(a)})},transformer:function(a,b){var c=ra({tags:[]},b);a=ca.descendants(a,"*");A(a,function(a){va(c.tags,t(no.name,a)).each(function(b){b.mutate(a)})})},validator:function(a){a=ca.descendants(a,"*");A(a,function(a){oo.validateStyles(a)})}},ik=function(a,b,c){var d=p.fromDom(a);
switch(a.nodeType){case 1:if(b)var e="endElement";else e="startElement",v.setAll(d,c||{});var f="HTML"!==a.scopeName&&a.scopeName&&a.tagName&&0>=a.tagName.indexOf(":")?(a.scopeName+":"+a.tagName).toUpperCase():a.tagName;break;case 3:e="text";var h=a.nodeValue;break;case 8:e="comment";h=a.nodeValue;break;default:console.log("WARNING: Unsupported node type encountered: "+a.nodeType)}return{getNode:function(){return a},tag:function(){return f},type:function(){return e},text:function(){return h}}},KM=
function(a,b){return ik(b.createElement(a),!0)},rb={START_ELEMENT_TYPE:"startElement",END_ELEMENT_TYPE:"endElement",TEXT_TYPE:"text",COMMENT_TYPE:"comment",FINISHED:KM("HTML",window.document),token:ik,createStartElement:function(a,b,c,d){var e=d.createElement(a);Ra(b,function(a,b){e.setAttribute(b,a)});return ik(e,!1,c)},createEndElement:KM,createComment:function(a,b){return ik(b.createComment(a),!1)},createText:function(a,b){return ik(b.createTextNode(a))}},fba={create:function(a){var b=a.createDocumentFragment(),
c=b;return{dom:c,receive:function(d){var e=function(a){a=a.getNode().cloneNode(!1);b.appendChild(a);b=a},f=function(c,d){c=a.createTextNode(c.text());b.appendChild(c)};switch(d.type()){case rb.START_ELEMENT_TYPE:e(d);break;case rb.TEXT_TYPE:f(d);break;case rb.END_ELEMENT_TYPE:b=b.parentNode;null===b&&(b=c);break;case rb.COMMENT_TYPE:break;default:throw{message:"Unsupported token type: "+d.type()};}},label:"SERIALISER"}}},gba={tokenise:function(a,b){b=b||window.document;var c=b.createElement("div");
b.body.appendChild(c);c.style.position="absolute";c.style.left="-10000px";c.innerHTML=a;var d=c.firstChild||rb.FINISHED,e=[],f=!1;return{hasNext:function(){return void 0!==d},next:function(){var a=d,g=f;!f&&d.firstChild?(e.push(d),d=d.firstChild):f||1!==d.nodeType?d.nextSibling?(d=d.nextSibling,f=!1):(d=e.pop(),f=!0):f=!0;a===rb.FINISHED||d||(b.body.removeChild(c),d=rb.FINISHED);a=a===rb.FINISHED?a:a?rb.token(a,g):void 0;return a}}}},LM=function(a,b,c){var d=c;for(c=b.length-1;0<=c;c--)d=b[c](d,{},
a);return d},hba={build:LM,run:function(a,b,c){var d=fba.create(a);b=gba.tokenise(b,a);for(a=LM(a,c,d);b.hasNext();)c=b.next(),a.receive(c);return d.dom}},ab={removal:function(a){return function(b){po.remover(b,a)}},unwrapper:function(a){return function(b){po.unwrapper(b,a)}},transformer:function(a){return function(b){po.transformer(b,a)}},validate:function(){return function(a){po.validator(a)}},pipeline:function(a){return function(b){var c=Ca.get(b),d=B.owner(b);c=hba.run(d.dom(),c,a);E.empty(b);
b.dom().appendChild(c)}},isWordContent:function(a,b){return 0<=a.indexOf("<o:p>")||b.browser.isEdge()&&0<=a.indexOf('v:shapes="')||b.browser.isEdge()&&0<=a.indexOf("mso-")||0<=a.indexOf("mso-list")||0<=a.indexOf("p.MsoNormal, li.MsoNormal, div.MsoNormal")||0<=a.indexOf("MsoListParagraphCxSpFirst")||0<=a.indexOf("<w:WordDocument>")},go:function(a,b,c){var d=p.fromTag("div",a.dom());d.dom().innerHTML=b;A(c,function(a){a(d)});return Ca.get(d)}},Ru={getAttribute:function(a,b){a=p.fromDom(a.getNode());
return m.get(a,b)},getStyle:function(a,b){a=p.fromDom(a.getNode());return v.get(a,b)},isWhitespace:function(a){return a.type()===rb.TEXT_TYPE&&/^[\s\u00A0]*$/.test(a.text())},getMsoList:function(a){a=p.fromDom(a.getNode());return Sf.scan(a,["mso-list"],k(!1))["mso-list"]}},MM=function(a,b,c){return a===b||a&&b&&a.tag===b.tag&&a.type===b.type&&(c||a.variant===b.variant)},NM={guessFrom:function(a,b){return va(a,function(a){return"UL"===a.tag||b&&MM(a,b,!0)}).orThunk(function(){return 0===a.length?g.none():
g.some(a[0])})},eqListType:MM},Su=function(a,b){if(void 0===a||void 0===b)throw console.trace(),"brick";a.nextFilter.set(b)},OM=function(a,b,c){b.nextFilter.get()(a,b,c)},qo={next:Su,go:OM,jump:function(a){return function(b,c,d){Su(c,a);OM(b,c,d)}},isNext:function(a,b){return a.nextFilter.get()===b},setNext:function(a){return function(b,c,d){Su(c,a)}}},iba=M("level","token","type"),jba=function(a,b,c,d){a=c.getCurrentListType();c=c.getCurrentLevel()==d.level()?a:null;return NM.guessFrom(d.emblems(),
c).filter(function(a){if(a="OL"===a.tag)a=!V(["P"],b.tag())||/^MsoHeading/.test(Ru.getAttribute(b,"class"));return!a})},PM={predicate:function(a,b){return m.has(p.fromDom(b.getNode()),"data-list-level")},action:function(a){return function(b,c,d){b=p.fromDom(d.getNode());var e=parseInt(m.get(b,"data-list-level"),10),f=m.get(b,"data-list-emblems");f=JSON.parse(f);m.remove(b,"data-list-level");m.remove(b,"data-list-emblems");b={level:k(e),emblems:k(f)};b.level();c.originalToken.set(d);jba(c.listType.get(),
d,c.emitter,b).each(c.listType.set);d=iba(b.level(),c.originalToken.get(),c.listType.get());c.emitter.openItem(d.level(),d.token(),d.type());qo.next(c,a.inside())}}},ky=function(a,b){return function(a,d,e){return b(a,d,e)}},QM={inside:function(a){return jy("Inside.List.Item",[Pp(function(a,c){return c.type()===rb.END_ELEMENT_TYPE&&a.originalToken.get()&&c.tag()===a.originalToken.get().tag()},function(b,c,d){qo.next(c,a.outside())},"Closing open tag")],function(a,c,d){a.emit(d)})},outside:function(a){return jy("Outside.List.Item",
[Pp(PM.predicate,PM.action(a),"Data List ****"),Pp(function(a,c){return c.type()===rb.TEXT_TYPE&&Ru.isWhitespace(c)},function(a,c,d){a.emit(d)},"Whitespace")],function(b,c,d){c.emitter.closeAllLists();b.emit(d);qo.next(c,a.outside())})}},kba=M("state","result"),lba=M("state","value"),cc={state:M("level","type","types","items"),value:lba,result:kba},Tu={start:function(a,b){var c=a.items().slice(0);b=void 0!==b&&"P"!==b?g.some(b):g.none();b.fold(function(){c.push("P")},function(a){c.push(a)});a=cc.state(a.level(),
a.type(),a.types(),c);return cc.value(a,b)},finish:function(a){var b=a.items().slice(0);if(0<b.length&&"P"!==b[b.length-1]){var c=b[b.length-1];b[b.length-1]="P";a=cc.state(a.level(),a.type(),a.types(),b);return cc.value(a,g.some(c))}return cc.value(a,g.none())}},Uu=function(a,b,c){for(var d=[];b(a);){var e=c(a);a=e.state();d=d.concat(e.result())}return cc.result(a,d)},RM={moveRight:function(a,b,c){return Uu(a,function(a){return a.level()<b},c)},moveLeft:function(a,b,c){return Uu(a,function(a){return a.level()>
b},c)},moveUntil:Uu},mba={from:function(a){var b={"list-style-type":"none"};a?(a=Ru.getStyle(a,"margin-left"),a=void 0!==a&&"0px"!==a?{"margin-left":a}:{}):a=b;return a}},SM=function(a,b,c){var d=b.start&&1<b.start?{start:b.start}:{},e=a.level()+1,f=a.types().concat([b]);c=[t(rb.createStartElement,b.tag,d,c)];a=cc.state(e,b,f,a.items());return cc.result(a,c)},TM=function(a){var b=a.types().slice(0),c=[t(rb.createEndElement,b.pop().tag)],d=a.level()-1;a=cc.state(d,b[b.length-1],b,a.items());return cc.result(a,
c)},nba=function(a,b){a=TM(a);b=SM(a.state(),b,b.type?{"list-style-type":b.type}:{});return cc.result(b.state(),a.result().concat(b.result()))},Zh={open:SM,openItem:function(a,b,c){var d=mba.from(b);a=a.type()&&!NM.eqListType(a.type(),c)?nba(a,c):cc.result(a,[]);d=[t(rb.createStartElement,"LI",{},d)];c=Tu.start(a.state(),b&&b.tag());var e=c.value().map(function(a){oo.styleDom(b.getNode(),k(!0));return[k(b)]}).getOr([]);return cc.result(c.state(),a.result().concat(d).concat(e))},close:TM,closeItem:function(a){var b=
t(rb.createEndElement,"LI");a=Tu.finish(a);var c=a.value().fold(function(){return[b]},function(a){return[t(rb.createEndElement,a),b]});return cc.result(a.state(),c)}},ro=function(a){if(0===a.length)throw"Compose must have at least one element in the list";var b=a[a.length-1];a=ia(a,function(a){return a.result()});return cc.result(b.state(),a)},oba=function(a){a=Zh.closeItem(a);var b=Zh.close(a.state());return ro([a,b])},pba=function(a,b,c,d){return RM.moveRight(a,c,function(a){var e=a.level()===c-
1&&b.type?{"list-style-type":b.type}:{};a=Zh.open(a,b,e);e=Zh.openItem(a.state(),a.state().level()==c?d:void 0,b);return ro([a,e])})},UM=function(a,b){return RM.moveLeft(a,b,oba)},qba=function(a,b,c,d){var e=1<c?Tu.finish(a):cc.value(a,g.none());a=e.value().map(function(a){return[t(rb.createEndElement,a)]}).getOr([]);e.state().level();b=pba(e.state(),b,c,d);return cc.result(b.state(),a.concat(b.result()))},ly={openItem:function(a,b,c,d){a=a.level()>b?UM(a,b):cc.result(a,[]);a.state().level()===b?
(b=a.state(),b=0<b.level()?Zh.closeItem(b):cc.result(b,[]),c=Zh.openItem(b.state(),c,d),c=ro([b,c])):c=qba(a.state(),d,b,c);return ro([a,c])},closeAllLists:UM},YU=["disc","circle","square"],rba={getCurrentListType:function(){return jk().getCurrentListType()},getCurrentLevel:function(){return jk().getCurrentLevel()},closeAllLists:function(){return jk().closeAllLists.apply(void 0,arguments)},openItem:function(){return jk().openItem.apply(void 0,arguments)}},jk=function(){return{getCurrentListType:k({}),
getCurrentLevel:k(1),closeAllLists:aa,openItem:aa}},WM={inside:function(){return sba},outside:function(){return VM}},tba=function(){var a=!1,b="";return{check:function(c){return a&&c.type()===rb.TEXT_TYPE?(b+=c.text(),!0):c.type()===rb.START_ELEMENT_TYPE&&"STYLE"===c.tag()?a=!0:c.type()===rb.END_ELEMENT_TYPE&&"STYLE"===c.tag()?(a=!1,!0):!1}}}(),sba=QM.inside(WM),VM=QM.outside(WM),XM=function(a){var b=Ga(a),c=Ga(null),d=Ga(null);return{reset:function(e){b.set(a);c.set(null);d.set(null);e=XU(e,e.document);
jk=k(e)},nextFilter:b,originalToken:c,listType:d,emitter:rba}}(VM),uba=iy(function(a,b,c){tba.check(b)||qo.go(a,XM,b)},XM.reset,"list.filters"),vba=[{regex:/^\(?[dc][\.\)]$/,type:{tag:"OL",type:"lower-alpha"}},{regex:/^\(?[DC][\.\)]$/,type:{tag:"OL",type:"upper-alpha"}},{regex:/^\(?M*(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})[\.\)]$/,type:{tag:"OL",type:"upper-roman"}},{regex:/^\(?m*(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})[\.\)]$/,type:{tag:"OL",type:"lower-roman"}},{regex:/^\(?[0-9]+[\.\)]$/,
type:{tag:"OL"}},{regex:/^([0-9]+\.)*[0-9]+\.?$/,type:{tag:"OL",variant:"outline"}},{regex:/^\(?[a-z]+[\.\)]$/,type:{tag:"OL",type:"lower-alpha"}},{regex:/^\(?[A-Z]+[\.\)]$/,type:{tag:"OL",type:"upper-alpha"}}],YM={"\u2022":{tag:"UL",type:"disc"},"\u00b7":{tag:"UL",type:"disc"},"\u00a7":{tag:"UL",type:"square"}},ZM={o:{tag:"UL",type:"circle"},"-":{tag:"UL",type:"disc"},"\u25cf":{tag:"UL",type:"disc"},"\ufffd":{tag:"UL",type:"circle"}},wba={extract:function(a,b){var c=ZM[a]?[ZM[a]]:[];b=b&&YM[a]?[YM[a]]:
b?[{tag:"UL",variant:a}]:[];var d=ia(vba,function(b){if(b.regex.test(a)){var c=b.type;var d=a.split(".");if(0===d.length)d=a;else{var e=d[d.length-1];d=0===e.length&&1<d.length?d[d.length-2]:e}d=parseInt(d,10);d=isNaN(d)?{}:{start:d};b=b.type;b=void 0!==b.variant?b.variant:"("===a.charAt(0)?"()":")"===a.charAt(a.length-1)?")":".";c=[ra(c,d,{variant:b})]}else c=[];return c});c=c.concat(b).concat(d);return F(c,function(b){return void 0!==b.variant?b:ra(b,{variant:a})})}},$M=function(a){return Sf.scan(a,
["mso-list"],k(!1))["mso-list"]},aN=function(a){return C.isElement(a)&&v.getRaw(a,"font-family").exists(function(a){return V(["wingdings","symbol"],a.toLowerCase())})},sc={getMsoList:$M,extractLevel:function(a){a=$M(a);return(a=/ level([0-9]+)/.exec(a))&&a[1]?g.some(parseInt(a[1],10)):g.none()},extractEmblem:function(a,b){a=Mb.get(a).trim();b=wba.extract(a,b);return 0<b.length?g.some(b):g.none()},extractSymSpan:function(a){return Da.child(a,aN)},extractMsoIgnore:function(a){return Da.descendant(a,
function(a){return!!(C.isElement(a)?Sf.scan(a,["mso-list"],k(!1)):[])["mso-list"]})},extractCommentSpan:function(a){return Da.child(a,C.isComment).bind(B.nextSibling).filter(function(a){return"span"===C.name(a)})},isSymbol:aN,deduceLevel:function(a){return v.getRaw(a,"margin-left").bind(function(a){a=parseInt(a,10);return isNaN(a)?g.none():g.some(Math.max(1,Math.ceil(a/18)))})}},bN=function(a){for(var b=[];null!==a.nextNode();)b.push(p.fromDom(a.currentNode));return b},xba=function(a){try{return bN(a)}catch(b){return[]}},
cN=ba.detect().browser,yba=cN.isIE()||cN.isEdge()?xba:bN,zba=k(k(!0)),Aba={find:function(a,b){b=b.fold(zba,function(a){return function(b){return a(b.nodeValue)}});b.acceptNode=b;a=document.createTreeWalker(a.dom(),vc.getOrDie("NodeFilter").SHOW_COMMENT,b,!1);return yba(a)}},kk=function(a,b,c,d){m.set(a,"data-list-level",b);b=JSON.stringify(c);m.set(a,"data-list-emblems",b);b=Aba.find(a,g.none());A(b,E.remove);A(d,E.remove);m.remove(a,"style");m.remove(a,"class")},Bba=function(a){return sc.extractLevel(a).bind(function(b){return sc.extractSymSpan(a).bind(function(c){return sc.extractEmblem(c,
!0).map(function(d){return{mutate:function(){kk(a,b,d,[c])}}})})})},Cba=function(a){return sc.extractLevel(a).bind(function(b){return sc.extractCommentSpan(a).bind(function(c){return sc.extractEmblem(c,sc.isSymbol(c)).map(function(d){return{mutate:function(){kk(a,b,d,[c])}}})})})},Dba=function(a){return sc.extractLevel(a).bind(function(b){return sc.extractCommentSpan(a).bind(function(c){return sc.extractEmblem(c,sc.isSymbol(c)).map(function(d){return{mutate:function(){kk(a,b,d,[c])}}})})})},Eba=function(a){return"p"!==
C.name(a)?g.none():sc.extractLevel(a).bind(function(b){return sc.extractMsoIgnore(a).bind(function(c){return sc.extractEmblem(c,!1).map(function(d){return{mutate:function(){kk(a,b,d,[B.parent(c).getOr(c)])}}})})})},Fba=function(a){return"p"!==C.name(a)?g.none():sc.extractMsoIgnore(a).bind(function(b){var c=B.parent(b).getOr(b),d=sc.isSymbol(c);return sc.extractEmblem(b,d).bind(function(b){return sc.deduceLevel(a).map(function(d){return{mutate:function(){kk(a,d,b,[c])}}})})})},Gba={find:function(a){return Bba(a).orThunk(function(){return Cba(a)}).orThunk(function(){return Dba(a)}).orThunk(function(){return Eba(a)}).orThunk(function(){return Fba(a)})}},
Hba=ab.transformer({tags:[{name:K.pattern(/^(p|h\d+)$/,K.caseInsensitive),mutate:function(a){Gba.find(a).each(function(a){a.mutate()})}}]}),Iba=function(a){var b=a.dom().attributes;b=void 0!==b&&null!==b&&0<b.length;return"span"===C.name(a)?b:!0},so=function(a){return void 0===a.dom().attributes||null===a.dom().attributes?!0:0===a.dom().attributes.length||1===a.dom().attributes.length&&"style"===a.dom().attributes[0].name},dN=function(a,b){var c=p.fromTag(a);y.before(b,c);a=b.dom().attributes;A(a,
function(a){c.dom().setAttribute(a.name,a.value)});a=B.children(b);O.append(c,a);E.remove(b);return c},eN=function(a){return B.prevSibling(a).bind(function(a){return C.isText(a)&&0===Oa.get(a).trim().length?eN(a):"li"===C.name(a)?g.some(a):g.none()})},Gg={changeTag:dN,addBrTag:function(a){0===Ca.get(a).length&&y.append(a,p.fromTag("br"))},properlyNest:function(a){B.parent(a).each(function(b){b=C.name(b);V(["ol","ul"],b)&&eN(a).fold(function(){var b=p.fromTag("li");v.set(b,"list-style-type","none");
y.wrap(a,b)},function(b){y.append(b,a)})})},fontToSpan:function(a){var b=dN("span",a),c={"font-size":{1:"8pt",2:"10pt",3:"12pt",4:"14pt",5:"18pt",6:"24pt",7:"36pt"}};Ra({face:"font-family",size:"font-size",color:"color"},function(a,e){if(m.has(b,e)){var d=m.get(b,e);v.set(b,a,void 0!==c[a]&&void 0!==c[a][d]?c[a][d]:d);m.remove(b,e)}})}},Jba=ab.unwrapper({tags:[{name:K.pattern(/^([OVWXP]|U[0-9]+|ST[0-9]+):/i,K.caseInsensitive)}]}),Kba=[ab.pipeline([uba])],Lba=ab.removal({attributes:[{name:K.pattern(/^v:/,
K.caseInsensitive)},{name:K.exact("href",K.caseInsensitive),value:K.contains("#_toc",K.caseInsensitive)},{name:K.exact("href",K.caseInsensitive),value:K.contains("#_mso",K.caseInsensitive)},{name:K.pattern(/^xmlns(:|$)/,K.caseInsensitive)},{name:K.exact("type",K.caseInsensitive),condition:function(a){return"ol"===C.name(a)||"ul"===C.name(a)}}]});ab.removal({attributes:[{name:K.exact("id",K.caseInsensitive)},{name:K.exact("name",K.caseInsensitive)}]});var Mba=ab.removal({tags:[{name:K.exact("script",
K.caseInsensitive)},{name:K.exact("link",K.caseInsensitive)},{name:K.exact("style",K.caseInsensitive),condition:function(a){return 0===Ca.get(a).length}}],attributes:[{name:K.starts("on",K.caseInsensitive)},{name:K.exact('"',K.caseInsensitive)},{name:K.exact("lang",K.caseInsensitive)},{name:K.exact("language",K.caseInsensitive)}],styles:[{name:K.all(),value:K.pattern(/OLE_LINK/i,K.caseInsensitive)}]}),fN=ab.removal({tags:[{name:K.exact("meta",K.caseInsensitive)}]}),Nba=ab.removal({tags:[{name:K.exact("style",
K.caseInsensitive)}]}),Oba=ab.removal({styles:[{name:K.not(K.pattern(/width|height|list-style-type/,K.caseInsensitive)),condition:function(a){return!n.has(a,"ephox-limbo-transform")}},{name:K.pattern(/width|height/,K.caseInsensitive),condition:function(a){return"img"!==C.name(a)}}]}),Pba=ab.removal({classes:[{name:K.not(K.exact("rtf-data-image",K.caseInsensitive))}]}),Qba=ab.removal({styles:[{name:K.pattern(DM.validStyles(),K.caseInsensitive)}]}),Rba=ab.removal({classes:[{name:K.pattern(/mso/i,K.caseInsensitive)}]}),
Sba=ab.unwrapper({tags:[{name:K.exact("img",K.caseInsensitive),condition:function(a){a=m.get(a,"src");return/^file:/.test(a)}},{name:K.exact("a",K.caseInsensitive),condition:so}]}),Tba=ab.unwrapper({tags:[{name:K.exact("a",K.caseInsensitive),condition:so}]}),Uba=ab.removal({attributes:[{name:K.exact("style",K.caseInsensitive),value:K.exact("",K.caseInsensitive),debug:!0}]}),Vba=ab.removal({attributes:[{name:K.exact("class",K.caseInsensitive),value:K.exact("",K.caseInsensitive),debug:!0}]}),Wba=ab.unwrapper({tags:[{name:K.pattern(DM.specialInline(),
K.caseInsensitive),condition:xf(function(a){return so(a)?Iba(a)&&ed.descendant(a,function(a){var b=!so(a),d=!V("font em strong samp acronym cite code dfn kbd tt b i u s sub sup ins del var span".split(" "),C.name(a));return C.isText(a)||b||d}):!0})}]}),Xba=ab.unwrapper({tags:[{name:K.exact("p",K.caseInsensitive),condition:function(a){return function(b){return B.parent(b).exists(function(b){return C.name(b)===a&&1===B.children(b).length})}}("li")}]}),Yba=ab.transformer({tags:[{name:K.exact("p",K.caseInsensitive),
mutate:Gg.addBrTag}]}),Zba=ab.transformer({tags:[{name:K.pattern(/ol|ul/,K.caseInsensitive),mutate:Gg.properlyNest}]}),$ba=ab.transformer({tags:[{name:K.exact("b",K.caseInsensitive),mutate:t(Gg.changeTag,"strong")},{name:K.exact("i",K.caseInsensitive),mutate:t(Gg.changeTag,"em")},{name:K.exact("u",K.caseInsensitive),mutate:function(a){a=Gg.changeTag("span",a);n.add(a,"ephox-limbo-transform");v.set(a,"text-decoration","underline")}},{name:K.exact("s",K.caseInsensitive),mutate:t(Gg.changeTag,"strike")},
{name:K.exact("font",K.caseInsensitive),mutate:Gg.fontToSpan,debug:!0}]}),aca=ab.removal({classes:[{name:K.exact("ephox-limbo-transform",K.caseInsensitive)}]}),bca=ab.removal({tags:[{name:K.exact("br",K.caseInsensitive),condition:Ue.hasClass("Apple-interchange-newline")}]}),cca=ab.removal({styles:[{name:K.pattern(/^-/,K.caseInsensitive)},{name:K.all(),value:K.exact("initial",K.caseInsensitive)},{name:K.exact("background-color",K.caseInsensitive),value:K.exact("transparent",K.caseInsensitive)},{name:K.exact("font-style",
K.caseInsensitive),value:K.exact("normal",K.caseInsensitive)},{name:K.pattern(/font-variant.*/,K.caseInsensitive)},{name:K.exact("letter-spacing",K.caseInsensitive)},{name:K.exact("font-weight",K.caseInsensitive),value:K.pattern(/400|normal/,K.caseInsensitive)},{name:K.exact("orphans",K.caseInsensitive)},{name:K.exact("text-decoration",K.caseInsensitive),value:K.exact("none",K.caseInsensitive)},{name:K.exact("text-size-adjust",K.caseInsensitive)},{name:K.exact("text-indent",K.caseInsensitive),value:K.exact("0px",
K.caseInsensitive)},{name:K.exact("text-transform",K.caseInsensitive),value:K.exact("none",K.caseInsensitive)},{name:K.exact("white-space",K.caseInsensitive),value:K.exact("normal",K.caseInsensitive)},{name:K.exact("widows",K.caseInsensitive)},{name:K.exact("word-spacing",K.caseInsensitive),value:K.exact("0px",K.caseInsensitive)},{name:K.exact("text-align",K.caseInsensitive),value:K.pattern(/start|end/,K.caseInsensitive)},{name:K.exact("font-weight",K.caseInsensitive),value:K.pattern(/700|bold/,K.caseInsensitive),
condition:function(a){return/^h\d$/.test(C.name(a))}}]}),dca=function(){var a=function(a,b){return function(c){return a(c).filter(function(a){return C.isText(c)&&b(Mb.get(a)," ")}).isSome()}},b=a(B.prevSibling,ce),c=a(B.nextSibling,Ab);return ab.transformer({tags:[{name:K.exact("span",K.caseInsensitive),condition:Ue.hasClass("Apple-converted-space"),mutate:function(a){"\u00a0"===Mb.get(a)&&(b(a)||c(a)?E.unwrap(a):(y.before(a,p.fromText(" ")),E.remove(a)))}}]})}(),eca=function(){var a=/^file:\/\/\/[^#]+(#[^#]+)$/;
return ab.transformer({tags:[{name:K.exact("a",K.caseInsensitive),condition:function(b){return(b=m.get(b,"href"))?a.test(b):!1},mutate:function(b){var c=m.get(b,"href");m.set(b,"href",c.replace(a,"$1"))}}]})}(),fca=ab.removal({attributes:[{name:K.exact("href",K.caseInsensitive),value:K.starts("file:///",K.caseInsensitive),debug:!0}]}),gN=function(){return ab.transformer({tags:[{name:K.exact("a",K.caseInsensitive),condition:function(a){return m.has(a,"data-ephox-href")},mutate:function(a){var b=m.get(a,
"data-ephox-href");m.set(a,"href",b);m.remove(a,"data-ephox-href")}}]})}(),gca=function(a){var b="table thead tbody tfoot th tr td ul ol li".split(" "),c=Cc.descendants(a,C.isComment),d=va(c,function(a){return Cb(Ft.get(a),"StartFragment")}),e=va(c,function(a){return Cb(Ft.get(a),"EndFragment")});d.each(function(c){e.each(function(d){var e=c,f=[];for(d=Vc.commonAncestorContainer(c,0,d,0);void 0!==d&&!P.eq(d,a);)V(b,C.name(d))?e=d:f.push(d),d=B.parent(d).getOr(void 0);A(f,E.unwrap);A(B.prevSiblings(e),
E.remove)});E.remove(c)});e.each(E.remove)},to=u,uo=function(a){return a.browser.isIE()&&11<=a.browser.version.major},hca=function(a,b,c){var d=p.fromDom(a.getNode());return b(d).fold(function(){return[a]},function(b){var d=a.type()===rb.END_ELEMENT_TYPE,e=[rb.token(b.dom(),d)];!d&&c&&e.push(rb.token(b.dom(),!0));return e})},ica=function(a,b){return iy(function(c,d){d=hca(d,a,b);A(d,c.emit)},u,"image filters")},jca={derive:function(a,b,c){var d;var e=(d=c.browser.isFirefox()||c.browser.isEdge())?
aba:bba;var f=!d;e=uo(c)?to:ab.pipeline([ica(e,f)]);e=[a?e:to];d=[d?to:Sba];f=uo(c)||!a?[]:[Hba];var g=[$ba];if(a){var k=[Jba];var m=uo(c)?[]:Kba;k=k.concat(m).concat([Lba])}else k=[to];m=[Zba];var n=[Mba],p=[fN];var q=[Qba,Rba];var t=[Oba,Pba];q=b?q:t;t=[eca,fca,Tba,gN];var u=[Uba],v=[Vba],w=[Wba],y=[bca];b=!a&&b?[cca]:[];var z=[dca],A=[Yba];a=uo(c)&&a?[Xba]:[];return Kb([f,e,g,k,m,n,p,d,q,t,u,v,w,y,b,z,A,a,[aca],[Nba]])}},kca=fm.link().source,lca=function(a){var b=M("word","pattern"),c=sb.unsafetoken(kca);
b=b("__INTERNAL__",c);return co.run(a,[b])},mca=function(a){return!tb.closest(a,"a")},nca=function(a){return g.from(a[0]).filter(mca).map(function(b){var c=p.fromTag("a");y.before(b,c);O.append(c,a);m.set(c,"href",Mb.get(c));return c})},oca=function(a){a=lca(a);A(a,function(a){var b=a.exact(),d;(d=0>b.indexOf("@"))||(b=b.indexOf("://"),d=3<=b&&9>=b);d&&nca(a.elements())})},pca=function(a){A(a,function(a){C.isElement(a)&&v.getRaw(a,"position").isSome()&&v.remove(a,"position")})},qca=function(a){var b=
ka(a,function(a){return"li"===C.name(a)});if(0<b.length){var c=B.prevSiblings(b[0]),d=p.fromTag("ul");y.before(a[0],d);0<c.length&&(a=p.fromTag("li"),y.append(d,a),O.append(a,c));O.append(d,b)}},hN=function(a){var b=B.children(a);A([oca,pca,qca],function(a){a(b)})},vo={go:function(a,b,c,d,e){hN(c);c=Ca.get(c);b=jca.derive(e,d,b);return ab.go(a,c,b)},preprocess:hN,internal:function(a,b){b=Ca.get(b);return ab.go(a,b,[fN,gN])},clean:function(a,b){b=Ca.get(b);return ab.go(a,b,[gca])}},Vu=ba.detect().browser,
rca=!(Vu.isIE()||Vu.isEdge()&&16>Vu.version.major),sca=["^image/","file"],tca=function(a){return Cb(a,"<html")&&(Cb(a,'xmlns:o="urn:schemas-microsoft-com:office:office"')||Cb(a,'xmlns:x="urn:schemas-microsoft-com:office:excel"'))},uca=function(a){return 0<a.length},Wu=function(a,b){return Qu.getFlavor(a.types,b).map(function(b){return a.getData(b.type)}).filter(uca)},lk=function(a){return rca?g.some(a.clipboardData).filter(Qu.isValidData):g.none()},ZU={fromEvent:function(a){var b=function(a){return void 0===
a.items?g.none():Qu.getPreferredFlavor(sca,a.types).map(function(b){return Kc.constructors.images({images:a.items})})},c=function(a){return oc(a.types,function(b){return"text/plain"===b?g.some(a.getData(b)).map(function(a){return Kc.constructors.text({text:a})}):g.none()})};return{getWordData:function(){return lk(a).bind(function(a){return Wu(a,"html").filter(tca).map(function(b){var c=Wu(a,"rtf");return Kc.constructors.word({html:b,rtf:c.fold(rl.getFromFlash,function(a){return rl.fromClipboard({rtf:a})})})})})},
getImage:function(){return lk(a).bind(b)},getText:function(){return lk(a).fold(function(){var a=window.clipboardData;return void 0!==a?g.some(Kc.constructors.text({text:a.getData("text")})):g.none()},c)},getHtml:function(){return lk(a).bind(function(a){return Wu(a,"html").map(function(a){var b=p.fromTag("div");Ca.set(b,a);a=vo.clean(B.owner(b),b);b=p.fromTag("div");Ca.set(b,a);return Kc.constructors.html({container:b})})})},getOnlyText:function(){return lk(a).bind(function(a){var b=a.types;return 1===
b.length&&"text/plain"===b[0]?c(a):g.none()})},getNative:function(){return Kc.constructors.event({nativeEvent:a})}}},fromHtml:function(a){return{getWordData:function(){return g.some(Kc.constructors.word({html:a,rtf:rl.disabled()}))},getImage:g.none,getText:g.none,getNative:yb("There is no native event"),getOnlyText:g.none}},fromText:function(a){return{getWordData:g.none,getImage:g.none,getText:function(){return g.some(Kc.constructors.text({text:a}))},getNative:yb("There is no native event"),getOnlyText:g.none}}},
vca={resolve:Hb.create("ephox-sloth").resolve}.resolve("bin"),py={bin:k(vca)},iN=ba.detect(),wca=function(a,b,c){b.control.block();a.dom().execCommand("paste");c();b.control.unblock()},xca=function(a,b,c){setTimeout(c,1)},jN=iN.browser.isIE()&&10>=iN.browser.version.major,yca=jN?wca:xca,qy={willBlock:k(jN),run:function(a,b,c){return yca(a,b,c)}},oy=function(a){return F(a,function(a){return a.asset()})},mk=M("asset","image"),kN=function(a,b){return Bc.cata(a,function(a,d,e,f){m.set(b,"src",e);return!0},
Sc)},Pe={assetImage:mk,createImages:function(a){var b=[],c=[];A(a,function(a){return Bc.cata(a,function(d,f,g,k){d=p.fromTag("img");m.set(d,"src",g);b.push(d);c.push(mk(a,d))},function(a,b,c){console.error("Internal error: Paste operation produced an image URL instead of a Data URI: ",b)})});return Ya.paste(b,c)},findImages:function(a,b){var c=[],d=ia(a,function(a){return"img"===C.name(a)?[a]:ca.descendants(a,"img")});A(b,function(a){Bc.cata(a,function(b,e,g,k){A(d,function(b){m.get(b,"src")===g&&
c.push(mk(a,b))})},u)});return c},updateSource:kN,updateSources:function(a,b){var c=[];A(a,function(a,e){e=b[e];kN(a,e)&&c.push(mk(a,e))});return c},browserBlobs:function(a){return ae(a,function(a){return Ba.nu(function(b){var c=a.dom();Lc.imageToImageResult(c).then(function(d){d.toBlob().then(function(e){e=Ab(c.src,"blob:")?c.src:URL.createObjectURL(e);var f=Za("image");e=Bc.blob(f,d,e);b(mk(e,a))})})})})}},zca=function(a){return Ba.nu(function(b){var c=Lc.imageResultToBlob(a,"image/png").then(function(a){oe.single(a).map(g.some).get(b)});
return c["catch"].call(c,function(a){console.warn(a);b(g.none())})})},$U=function(a){var b=function(){return Ba.pure(a)};return Bc.cata(a.asset(),function(c,d,e){return/tiff$/.test(d.getType())?zca(d).map(function(b){return b.map(function(b){var c=a.image();wf.revokeObjectURL(e);Pe.updateSource(b,c);return Pe.assetImage(b,c)}).getOr(a)}):b()},b)},Ib={blocking:function(a){return function(b){return function(c,d){b.block();return a(c,d).map(function(a){b.unblock();return a})}}},normal:function(a){return k(a)}},
Aca={convert:function(a){var b=lg("window.clipboardData.files"),c=void 0!==a.convertURL?a.convertURL:void 0!==a.msConvertURL?a.msConvertURL:void 0;return void 0!==b&&void 0!==c&&0<b.length?(b=ae(b,function(b){var d=wf.createObjectURL(b);c.apply(a,[b,"specified",d]);return oe.singleWithUrl(b,d)}),g.some(b)):g.none()}},Bca=function(){var a=g.none();return{convert:function(b){a=Aca.convert(b)},listen:function(b){return a.fold(function(){return Ba.nu(function(a){a([])})},function(a){return a}).get(b)},
clear:function(){a=g.none()}}},Cca=function(a,b){return Fi.dataUriToBlobSync(b).map(function(b){return Pe.assetImage(oe.single(b),a)})},Dca=function(a,b){return Fi.uriToBlob(b).map(function(b){var c=Ba.nu(function(a){b.then(function(b){oe.single(b).get(a)})});return Pe.assetImage(c,a)})},sy=function(a){var b=p.fromTag("div");O.append(b,a);return ca.descendants(b,"img[src]")},lN=function(a){return 0===a.indexOf("data:")&&-1<a.indexOf("base64")},ty=function(a){a=m.get(a,"src");return lN(a)||0===a.indexOf("blob:")},
aV=function(a){return ia(sy(a),function(a){var b=m.get(a,"src");return lN(b)?Cca(a,b).toArray():0===b.indexOf("blob:")?Dca(a,b).toArray():[]})},bV=function(a){a=ka(a,function(a){return"img"!==C.name(a)||!ty(a)});return Ya.incomplete(a,[],"errors.local.images.disallowed")},Eca={convert:function(a,b){if(0===a.length)throw"Zero length content passed to Hex conversion";for(var c=Array(a.length/2),d=0;d<a.length;d+=2){var e=a.substr(d,2);c[Math.floor(d/2)]=parseInt(e,16)}a=tw(c);return sw([a],{type:b})}},
mN=sa.generate([{unsupported:["id","message","isEquation"]},{supported:["id","contentType","blob","isEquation"]}]),$h={unsupported:mN.unsupported,supported:mN.supported,cata:function(a,b,c){return a.fold(b,c)}},nN=function(a,b,c,d,e,f){return-1===a||-1===b?g.none():g.some({start:a,end:b,bower:c,regex:d,idRef:e,isEquation:f})},wo=function(a,b){if(-1===b)return b;var c=0,d=a.length;do{var e=a.indexOf("{",b);var f=a.indexOf("}",b);f>e&&-1!==e?(b=e+1,++c):(e>f||0>e)&&-1!==f&&(b=f+1,--c);if(b>d||-1===
f)return-1}while(0<c);return b},Fca=function(a,b,c,d,e){a=a.substring(c,d);return nN(c,d,a,/[^a-fA-F0-9]([a-fA-F0-9]+)\}$/,"i",e)},Gca=function(a,b,c,d,e){a=a.substring(c,d);return nN(c,d,a,/([a-fA-F0-9]{64,})(?:\}.*)/,"s",e)},Hca={identify:function(a,b){var c=a.indexOf("{\\pict{",b),d=wo(a,c),e=a.indexOf("{\\shp{",b),f=wo(a,e),h=a.indexOf("{\\mmathPict{",b),k=wo(a,h);k=-1!==h&&(h<c&&k>d||h<e&&k>f);h=t(Gca,a,b,e,f,k);a=t(Fca,a,b,c,d,k);return-1===c&&-1===e?g.none():-1===c?h():-1===e?a():e<c&&f>d?
a():c<e&&d>f?h():c<e?a():e<c?h():g.none()},endBracket:wo},oN=function(a,b){return Hca.identify(a,b)},pN=function(a){return 0<=a.indexOf("\\pngblip")?N.value("image/png"):0<=a.indexOf("\\jpegblip")?N.value("image/jpeg"):N.error("errors.imageimport.unsupported")},qN=function(a,b){return(a=a.match(b))&&a[1]&&0===a[1].length%2?N.value(a[1]):N.error("errors.imageimport.invalid")},rN=function(a){a=a.match(/\\shplid(\d+)/);return null!==a?g.some(a[1]):g.none()},Ica=function(a){var b=a.bower,c=a.regex,d=
a.isEquation;return rN(b).map(function(e){var f=a.idRef+e;return pN(b).fold(function(a){return $h.unsupported(f,a,d)},function(a){return qN(b,c).fold(function(a){return $h.unsupported(f,a,d)},function(b){return $h.supported(f,a,Eca.convert(b,a),d)})})})},Jca=function(a){for(var b=[],c=function(){return a.length},d=function(a){var c=Ica(a);b=b.concat(c.toArray());return a.end},e=0;e<a.length;)e=oN(a,e).fold(c,d);return b},Kca={nextBower:oN,extractId:rN,extractContentType:pN,extractHex:qN,images:function(a){a=
a.replace(/\r/g,"").replace(/\n/g,"");return Jca(a)}},Qe={images:function(a){return Kca.images(a)},toId:function(a){return $h.cata(a,function(a,c,d){return a},function(a,c,d,e){return a})},isEquation:function(a){return $h.cata(a,function(a,c,d){return d},function(a,c,d,e){return e})},toBlob:function(a){return $h.cata(a,function(a,c,d){return N.error(c)},function(a,c,d,e){return N.value(d)})}},Lca=function(a){return hb(a,function(a,c){var b=Qe.toId(c),e=Qe.isEquation(c);return Ta(a,function(a){return Qe.toId(a)===
b&&Qe.isEquation(a)===e}).fold(function(){return a.concat([c])},function(b){return Qe.toBlob(a[b]).isValue()?a:a.slice(0,b).concat(a.slice(b+1)).concat([c])})},[])},cV={convert:function(a,b,c,d){var e=Lca(b),f=[],g=!1;a=ia(a,function(a,b){var c=m.get(a,"data-image-id"),h="true"===m.get(a,"data-ms-equation");m.remove(a,"rtf-data-image");m.remove(a,"data-image-id");m.remove(a,"data-ms-equation");return"unsupported"===c?(g=!0,m.set(a,"alt",d("errors.imageimport.unsupported")),[]):va(e,function(a){return Qe.toId(a)===
c&&Qe.isEquation(a)===h}).fold(function(){console.log("WARNING: unable to find data for image ",a.dom());return[]},function(b){return Qe.toBlob(b).fold(function(b){g=!0;m.set(a,"alt",d(b));return[]},function(b){f.push(a);return[b]})})});oe.multiple(a).get(function(a){a=Pe.updateSources(a,f);c(a,g)})}},sN=function(a){return ca.descendants(a,"[rtf-data-image]")},Ki={exists:function(a){return 0<sN(a).length},find:sN},tN=function(a){return a.officeStyles().getOr(!0)},uN=function(a){return a.htmlStyles().getOr(!1)},
vN=function(a){return a.isWord().getOr(!1)},qe={proxyBin:function(a){return{handle:function(b,c){return a.proxyBin().fold(function(){console.error(b);return Fa.pure({response:Ya.cancel(),bundle:Ob.nu({})})},c)}}},backgroundAssets:function(a){return Ba.nu(function(b){a.backgroundAssets().fold(function(){b([])},function(a){a.listen(b)})})},merging:function(a){var b=vN(a);return b&&tN(a)||!b&&uN(a)},mergeOffice:tN,mergeNormal:uN,isWord:vN,isInternal:function(a){return a.isInternal().getOr(!1)}},wN=function(a,
b){var c=eV(a,b);return function(a,b){var d=b.bundle(),e=b.response();return Fa.sync(function(a){c.get(qe.isWord(d),function(c){c=c.fold(function(){return{response:Ya.cancel(),bundle:b.bundle()}},function(a){return{response:e,bundle:Ob.nu({officeStyles:a.officeStyles,htmlStyles:a.htmlStyles})}});Fa.call(a,c)})})}},Xu={fixed:function(a,b){return function(c,d){return Fa.pure({response:d.response(),bundle:Ob.nu({officeStyles:a,htmlStyles:b})})}},fromConfig:wN,fromConfigIfExternal:function(a,b){return function(c,
d){return qe.isInternal(d.bundle())?Fa.pure({response:d.response(),bundle:Ob.nu({officeStyles:!0,htmlStyles:!0})}):wN(a,b)(c,d)}}},Mca={p:"p, li[data-converted-paragraph]"},Nca=function(a){var b=function(){var b=p.fromTag("span");y.prepend(a,b);return b}();return{convertToPx:function(a){v.set(b,"margin-left",a);return parseFloat(v.get(b,"margin-left").match(/-?\d+\.?\d*/)[0])},destroy:function(){return E.remove(b)}}},Oca=u,Qca=function(a,b){var c=function(a){m.remove(a,"data-list-level");m.remove(a,
"data-text-indent-alt");m.remove(a,"data-border-margin");v.remove(a,"margin-left");v.remove(a,"text-indent");Ra(v.getAllRaw(a),function(b,c){!c.startsWith("border")||"border-image"!==c&&"none"!==b.trim()&&"initial"!==b.trim()||v.remove(a,c)})},d=ca.descendants(a,"li[data-converted-paragraph]");A(d,function(a){m.remove(a,"data-converted-paragraph")});b&&(b=ca.descendants(a,"li"),A(b,function(b){var d=Nca(a);var e=m.has(a,"data-tab-interval")?m.get(a,"data-tab-interval"):"36pt";e=d.convertToPx(e);e=
Pca(b,e,d).getOr({});c(b);d.destroy();v.setAll(b,e)}),b=ca.descendants(a,"ol,ul"),A(b,function(a){var b=ca.descendants(a,"li");v.getRaw(a,"margin-top").isNone()&&g.from(b[0]).each(function(b){v.set(a,"margin-top",v.get(b,"margin-top"))});v.getRaw(a,"margin-bottom").isNone()&&g.from(b[b.length-1]).each(function(b){v.set(a,"margin-bottom",v.get(b,"margin-bottom"))})}));m.remove(a,"data-tab-interval")},Pca=function(a,b,c){var d=function(a){return m.has(a,"data-list-level")?parseInt(m.get(a,"data-list-level"),
10):1};return v.getRaw(a,"text-indent").bind(function(e){return v.getRaw(a,"margin-left").map(function(f){var g=v.getRaw(a,"list-style").exists(function(a){return Cb(a,"none")}),k=m.has(a,"data-border-margin")?m.get(a,"data-border-margin"):"0px";g=g?d(a)+1:d(a);f=c.convertToPx(f)+c.convertToPx(k);g*=b;var r=m.has(a,"data-text-indent-alt")?c.convertToPx(m.get(a,"data-text-indent-alt")):c.convertToPx(e);k={};r=b/2*-1-r;0<r&&(k["text-indent"]=r+"px");f=f-g-r;k["margin-left"]=0<f?f+"px":"0px";return k})})},
Rca={process:function(a,b,c){c=c.mergeInline();(c?Aw.inlineStyles:Oca)(a,b,Mca);Qca(b,c)}},Sca=function(a){var b=fV(p.fromDom(document.body));return function(c,d){b.play(c,function(b,c){Rca.process(b,c,{mergeInline:k(a)});return Ca.get(c)},d)}},Tca=function(a,b,c,d){var e=function(b){Fa.call(a,{response:b,bundle:Ob.nu({})})};Sca(b)(c,function(a){var b=te.fromHtml(a);a=function(a){e(Ya.paste(b,a))};var c=p.fromTag("div");O.append(c,b);var f=za.all("img[src]",c);0===f.length?a([]):d?Pe.browserBlobs(f).get(a):
(A(f,E.remove),a=B.children(c),e(Ya.incomplete(a,[],"errors.local.images.disallowed")))})},Uca={handle:function(a,b,c,d){var e=a.html();return Fa.sync(function(a){c.cleanDocument(e,b).get(function(c){c.fold(function(b){Fa.call(a,{response:Ya.error("errors.paste.process.failure"),bundle:Ob.nu({})})},function(c){void 0===c||null===c||0===c.length?Fa.call(a,{response:Ya.paste([],[]),bundle:Ob.nu({})}):Tca(a,b,c,d)})})})}},Vca={handle:function(a){a=ka(a,function(a){return"file"===a.kind&&/image/.test(a.type)});
var b=F(a,function(a){return a.getAsFile()});return Fa.sync(function(a){oe.multiple(b).get(function(b){b=Pe.createImages(b);Fa.call(a,{response:b,bundle:Ob.nu({})})})})}},Wca=ba.detect(),xN=function(a){try{var b=a(),c=void 0!==b&&null!==b&&0<b.length?te.fromHtml(b):[];return N.value(c)}catch(d){return console.error(d),N.error("errors.paste.process.failure")}},yN=function(a){return a.fold(function(a){return Fa.error(a)},function(a){return Fa.pure({response:Ya.paste(a,[]),bundle:Ob.nu({})})})},zN=function(a,
b,c,d){return xN(function(){return vo.go(a,Wca,b,c,d)})},xo={direct:function(a,b,c){a=zN(a,b,c,!1);return yN(a)},internal:function(a,b){var c=xN(function(){return vo.internal(a,b)});return yN(c)},transfer:function(a,b,c,d,e){return zN(a,b,d,c).fold(function(a){return Fa.error(a)},function(a){return Fa.sync(function(b){e.get(function(c){c=Pe.findImages(a,c);Fa.call(b,{response:Ya.paste(a,c),bundle:Ob.nu({})})})})})}},AN={internal:function(a,b,c){b=b.findClipboardTags(B.children(c)).getOr([]);A(b,E.remove);
b=Ba.nu(function(a){a([])});return xo.transfer(a,c,!1,!0,b)},external:function(a,b,c,d,e){return xo.transfer(a,b,d,c,e)}},BN={encode:function(a){var b=p.fromTag("div");Mb.set(b,a);return Ca.get(b)},convert:function(a){a=a.trim().split(/\n{2,}|(?:\r\n){2,}/);a=F(a,function(a){return a.split(/\n|\r\n/).join("<br />")});return 1===a.length?a[0]:F(a,function(a){return"<p>"+a+"</p>"}).join("")}},Xca={handle:function(a){var b=Kc.asText(a).getOrDie("Required text input for Text Handler");return Fa.sync(function(a){if(0<
b.text().length){var c=b.text();c=BN.encode(c);c=BN.convert(c);c=te.fromHtml(c);c=Ya.paste(c,[])}else c=Ya.cancel();Fa.call(a,{response:c,bundle:Ob.nu({})})})}},Fd={plain:function(a,b,c){return Xca.handle(a)},autolink:function(a,b){a=function(a,c){var d=p.fromTag("div");O.append(d,a);vo.preprocess(d);a=B.children(d);return Fa.pure({response:Ya.paste(a,c),bundle:b.bundle()})};var c=t(Fa.pass,b);return Ya.cata(b.response(),c,a,c,a)},noImages:function(){return function(a,b){return Fa.error("errors.local.images.disallowed")}},
images:function(){return function(a,b){a=Kc.asImages(a).getOrDie("Must have image data for images handler");return Vca.handle(a.images())}},handleInternal:function(a){return function(b,c){b=Kc.asHtml(b).getOrDie("Wrong input type for HTML handler");b=a.findClipboardTags(B.children(b.container()));b.each(function(a){A(a,E.remove)});b=b.isSome();return Fa.pure({response:c.response(),bundle:Ob.nu({isInternal:b})})}},nativeHtml:function(a,b,c){return function(c,e){c=Kc.asHtml(c).getOrDie("Wrong input type for HTML handler").container();
var d=B.owner(b);e=e.bundle();if(qe.isInternal(e))return xo.internal(d,c);a(c);e=qe.merging(e);return xo.direct(d,c,e)}},external:function(a,b){return function(c,d){var e=d.bundle();return qe.proxyBin(e).handle("There was no proxy bin setup. Ensure you have run proxyStep first.",function(c){var d=qe.merging(e),f=qe.isWord(e),g=qe.isInternal(e),k=qe.backgroundAssets(e),m=B.owner(a);return g?AN.internal(m,b,c):AN.external(m,c,d,f,k)})}},wordimport:function(a,b){return function(c,d){c=Kc.asWord(c).getOrDie("Wrong input type for Word Import handler");
d=qe.mergeOffice(d.bundle());return Uca.handle(c,d,a,b)}},setBundle:function(a){return function(b,c){b=Ob.merge(c.bundle(),Ob.nu(a));return Fa.pure({response:c.response(),bundle:b})}},none:function(a,b){return Fa.cancel()}},Yca=function(a,b){return ed.descendant(a,function(a){return m.has(a,"style")?-1<m.get(a,"style").indexOf("mso-"):!1})},Zca=function(a,b){a=Ca.get(a);return ab.isWordContent(a,b)},hV={isWord:function(a,b){var c=a.browser;return(c.isIE()&&11<=c.version.major?Yca:Zca)(b,a)}},Qp=ba.detect(),
$ca=function(a,b){return a.isSupported()?b.getWordData():g.none()},ada=function(a){return a.getNative()},bda=function(a){return a.getImage()},cda=function(a){return a.getHtml()},dda=function(a){return a.getText()},eda=function(a){return a.getOnlyText()},Hg=function(a,b,c,d){return{_label:a,label:k(a),getAvailable:b,steps:k(c),capture:k(d)}},ig={wordimport:function(a,b,c,d){return Hg("Word Import pasting",t($ca,a),[Ib.normal(Fd.setBundle({isWord:!0})),Ib.normal(Xu.fromConfig(b,c)),Ib.normal(Fd.wordimport(a,
c.allowLocalImages)),Ib.blocking(iV(c,vy(d,c))),Ib.normal(ql())],!0)},image:function(a){return Hg("Image pasting",bda,[Ib.normal(!1===a.allowLocalImages?Fd.noImages(u):Fd.images()),Ib.normal(ql())],!0)},nativeHtml:function(a,b,c,d){return Hg("Outside of Textbox.io pasting HTML5 API (could be internal)",cda,[Ib.normal(Fd.handleInternal(b.intraFlag)),Ib.normal(Xu.fromConfigIfExternal(a,b)),Ib.normal(Fd.nativeHtml(c,d,b.intraFlag)),Ib.normal(ry(b)),Ib.normal(ql())],!0)},text:function(){return Hg("Plain text pasting",
dda,[Ib.normal(Fd.plain),Ib.normal(Fd.autolink)],!0)},onlyText:function(){return Hg("Only plain text is available to paste",eda,[Ib.normal(Fd.plain),Ib.normal(Fd.autolink)],!0)},none:function(){return Hg("There is no valid way to paste",g.some,[Ib.normal(Fd.none)],!1)},fallback:function(a,b,c,d,e,f){return Hg("Outside of Textbox.io pasting offscreen (could be internal)",ada,[Ib.normal(gV(d,c,e,b.intraFlag,Bca)),Ib.normal(Xu.fromConfigIfExternal(a,b)),Ib.normal(Fd.external(e,b.intraFlag)),Ib.blocking(vy(f,
b)),Ib.normal(ry(b)),Ib.normal(ql())],!1)}},CN=function(a){return p.fromHtml("<p>"+a("cement.dialog.flash.press-escape")+"</p>")},Yu={paste:function(a){var b=p.fromTag("div");n.add(b,cd.resolve("flashbin-helpcopy"));var c=ba.detect().os.isOSX()?["\u2318"]:["Ctrl"];var d=p.fromHtml("<p>"+a("cement.dialog.flash.trigger-paste")+"</p>");c=p.fromHtml('<div><span class="ephox-polish-help-kbd">'+c+'</span> + <span class="ephox-polish-help-kbd">V</span></div>');n.add(c,cd.resolve("flashbin-helpcopy-kbd"));
O.append(b,[d,c,CN(a)]);return b},noflash:function(a){var b=p.fromTag("div");n.add(b,cd.resolve("flashbin-helpcopy"));var c=p.fromHtml("<p>"+a("cement.dialog.flash.missing")+"</p>");O.append(b,[c,CN(a)]);return b},indicator:function(a){var b=p.fromTag("div");n.add(b,cd.resolve("flashbin-loading"));var c=p.fromTag("div");n.add(c,cd.resolve("flashbin-loading-spinner"));var d=p.fromTag("p");a=a("loading.wait");Ca.set(d,a);m.set(d,"aria-label",a);O.append(b,[c,d]);return b}},kV=ba.detect(),mV=function(a,
b,c,d){b=Yu.noflash(d);y.append(a,b);return{reset:u}},lV=function(a,b,c,d){var e=Yu.paste(d),f=Yu.indicator(d);O.append(a,[f,e,b.element()]);a=function(){v.set(e,"display","block");v.set(f,"display","none");c()};b.events.spin.bind(function(){v.set(e,"display","none");v.set(f,"display","block");v.remove(f,"height");v.remove(f,"padding");c()});b.events.reset.bind(a);b.events.hide.bind(function(){v.setAll(f,{height:"0",padding:"0"})});return{reset:a}},pV={responsive:function(){var a=Ga(g.none()),b=G.create({crashed:q([]),
timeout:q([])});return{start:function(c,d,e,f){var h=d,k=setInterval(function(){e()?clearInterval(k):0>=h?(b.trigger.timeout(),clearInterval(k)):f()&&(clearInterval(k),b.trigger.crashed());h--},c);a.set(g.some(k))},stop:function(){a.get().each(function(a){clearInterval(a)})},events:b.registry}}},tf=zz.install("ephox.flash"),Rp=ba.detect(),qV=g.none(),DN=ba.detect(),fda=DN.deviceType.isiOS()||DN.deviceType.isAndroid(),gda=function(a){var b=Fl.addScript(a+"/wordimport.js",aa);b.get(function(a){a.fold(function(a){console.error("Unable to load word import: ",
a)},u)});return{isSupported:k(!0),cleanDocument:function(a,d){return b.map(function(b){return b.map(function(b){return b.cleanDocument(a,d)})})}}},hda=k({isSupported:k(!1),cleanDocument:k(Sj.error("not supported"))}),ida=fda?hda:gda,jda="b i u sub sup strike".split(" "),kda=function(a){A(B.children(a),function(a){C.isElement(a)&&!B.hasChildNodes(a)&&V(jda,C.name(a))&&E.remove(a)})},lda=function(a,b){a=B.children(a);A(a,function(a){if(b(a)){var c=B.children(a),e=p.fromTag("div",B.owner(a).dom());O.append(e,
c);y.before(a,e);E.remove(a)}})},vV={consolidate:function(a,b){B.nextSibling(a).filter(b).each(function(b){var c=B.children(b);O.append(a,c);E.remove(b)});lda(a,b);kda(a)}},xy=py.bin(),yy=xy+Za(""),uV=we.onDirection("-100000px","100000px"),mda=function(a){return{startContainer:a.start,startOffset:a.soffset,endContainer:a.finish,endOffset:a.foffset}},yV={set:function(a,b){Na.setExact(a,b.startContainer(),b.startOffset(),b.endContainer(),b.endOffset())},get:function(a,b){return Na.getExact(a).map(mda)}},
DV=function(a,b,c,d){var e=AV(a.uiContainer(),d),f=function(a){b.filterDom(b.paste(),a)},g=BV(w,Li.intraFlag(),c);return function(a){var b=ida(g.baseUrl),c=t(rV,e),d=xV(void 0!==g.pasteBinAttrs?g.pasteBinAttrs:{});b=[ig.onlyText(),ig.wordimport(b,e,g,c),ig.nativeHtml(e,g,f,a),ig.image(g)];a=ig.fallback(e,g,f,d,a,c);return my(b,a)}},HV=function(a){for(var b=[],c=a.start.charCodeAt(0);c<=a.finish.charCodeAt(0);c++)b.push(String.fromCharCode(c));return b},uf=function(a){return{start:a,finish:a}},KV=
{controls:function(a){var b=a+"-";a=S.div();n.add(a,z.resolve(b+"dialog-controls"));var c=ud.button(b,"cancel","button.cancel"),d=ud.button(b,"insert","specialchar.insert");ud.makeNormal(c.element());ud.makeDefault(d.element());O.append(a,[c.element(),d.element()]);b=G.create({insert:Q([],d.events.click),cancel:Q([],c.events.click)});return{element:k(a),ok:k(d),cancel:k(c),destroy:function(){d.destroy();c.destroy()},events:b.registry}}},nda=function(a){var b=p.fromTag("span");n.add(b,z.resolve("special-char"));
var c=p.fromHtml(a);m.setAll(b,{"data-ephox-polish-special-char":a,"data-ephox-polish-char-code":a.charCodeAt(0).toString(16),tabindex:"-1"});eg.gridcell(b);y.append(b,c);return b},oda=function(a,b){var c=p.fromTag("div");ja.add(c,[z.resolve("special-char-row"),z.resolve("special-char-row-"+b)]);eg.row(c);A(a,function(a){y.append(c,nda(a))});return c},pda=function(a,b,c){var d=p.fromTag("div");n.add(d,z.resolve(b));eg.base(d,w.translate("specialchar.grid"));a=rX(a,c);a=F(a,function(a){return oda(a,
b)});O.append(d,a);return d},JV={generateItems:function(a){var b=600>=Math.min(window.innerWidth,window.innerHeight)?12:16;return xk(a,function(a,d){a=pda(a,d,b);return cg(w.translate("specialchar."+d),vx(a))})}},LV=function(a){var b={item:k(".ephox-pastry-statebutton.ephox-pastry-tablayout-item")},c=xa.flow({trigger:Nb.button,executeOnArrow:!0});return ea.flow(a.menu(),b,c)},qda=function(a){return tb.closest(a,".ephox-pastry-tablayout-active")},MV=function(a){var b={row:k(".ephox-pastry-tablayout-active ."+
z.resolve("special-char-row")),cell:k(".ephox-pastry-tablayout-active ."+z.resolve("special-char"))},c=xa.tabular({trigger:Nb.click,isValid:qda});return ea.tabular(a.body(),b,c)},EN=sa.generate([{single:["element"]},{range:["start","soffset","finish","foffset"]}]),sl={cata:function(a,b,c){return a.fold(b,c)},single:EN.single,range:function(a,b,c,d){var e=Vc.after(c,d,a,b),f=e?W.point(a,b):W.point(c,d);a=e?W.point(c,d):W.point(a,b);return EN.range(f.element(),f.offset(),a.element(),a.offset())}},FN=
M("suggestions","ignore"),ai=function(a){var b=new RegExp(fb(),"g");return a.replace(b,"").replace(/[\u2018\u2019]/g,"'")},kW=function(a){var b={},c=function(a){return b.hasOwnProperty(a)&&void 0!==b[a]?b[a]:{}},d=function(a,d){var e=c(a);d(e);b[a]=e},e=function(a,b){a=c(a);return b(a)},f=function(a,b,c){d(a,function(a){var d=ai(b);a.hasOwnProperty(d)&&void 0!==a[d]||(a[d]=FN(g.some(c),!1))})},h=function(a,b){d(a,function(a){var c=ai(b),d=a.hasOwnProperty(c)?a[c]:void 0;d=void 0!==d?d.suggestions():
g.none();d=FN(d,!0);a[c]=d})};Ra(void 0!==a?a:{},function(a,b){Ra(a,function(a,c){!0===a.ignore&&h(b,c);void 0!==a.suggestions&&f(b,c,a.suggestions)})});return{add:f,get:function(a,b){return e(a,function(a){var c=ai(b);return a.hasOwnProperty(c)?g.from(a[c]):g.none()})},ignore:h,suggestions:function(a,b){return e(a,function(a){var c=ai(b);return(a.hasOwnProperty(c)?g.from(a[c]):g.none()).bind(function(a){return a.suggestions()})})},state:function(){return Wb(b,function(a,b){return Wb(a,function(a,
b){return{ignore:a.ignore(),suggestions:a.suggestions().getOr([])}})})},destroy:function(){b={}}}},Vp={configure:function(a){a.add(a.internal(),"ephox-cram-annotation-wrap",Ka.unwrap);a.add(a.output(),"ephox-cram-annotation-wrap",Ka.unwrap);a.add(a.paste(),"ephox-cram-annotation-wrap",Ka.unwrap);a.addExcludedContext([".ephox-cram-annotation-wrap"])},isWrap:function(a){return n.has(a,"ephox-cram-annotation-wrap")}},rda={en_au:"en_gb",en_bz:"en_gb",en_ca:"en_gb",en_gb:"en_gb",en_ie:"en_gb",en_in:"en_gb",
en_jm:"en_gb",en_my:"en_gb",en_nz:"en_gb",en_ph:"en_gb",en_sg:"en_gb",en_tt:"en_gb",en_za:"en_gb",en_zw:"en_gb",en_us:"en_us",en:"en_us"},sda="da de en en_au en_br en_gb en_uk en_us es fi fr it nb nl pt pt_pt sv".split(" "),Zc=function(a,b){return{value:k(a),textkey:k(b),icon:g.none}},tda=function(a){var b=ra(Nq.localeList(),rda);return Nq.determineFrom(a,b).filter(function(a){return V(sda,a)})},Re={determine:function(a){return"no.language"===a?g.some(a):tda(a)},get:function(){return[Zc("no.language",
w.key("spelling.none")),Zc("en_us",w.key("parlance.en_us")),Zc("en_gb",w.key("parlance.en_gb")),Zc("da",w.key("parlance.da")),Zc("de",w.key("parlance.de")),Zc("es",w.key("parlance.es")),Zc("fi",w.key("parlance.fi")),Zc("fr",w.key("parlance.fr")),Zc("it",w.key("parlance.it")),Zc("nb",w.key("parlance.no")),Zc("nl",w.key("parlance.nl")),Zc("pt",w.key("parlance.pt_br")),Zc("pt_pt",w.key("parlance.pt_pt")),Zc("sv",w.key("parlance.sv"))]},isOn:function(a){return"no.language"!==a},offKey:k("no.language")},
RV=function(a,b){var c=Re.get();return{"spelling.dropdown":{name:"spellcheck",textkey:w.key("spelling.menu"),menuTextkey:"",updateDropdown:function(b){b.populate([{label:g.none,items:k(c)}]);var d=a.profile().spelling().get();wa.on(d).fold(b.untick,u,b.tick)},action:function(c){a.profile().spelling().setAndCache(c);Ab(c,"en")||a.profile().autocorrect().set(!1);b.trigger.change(c)},values:c,render:g.none(),describe:function(a){return w.key("spelling.menu")},hasPopup:!0,toggle:!1}}},SV=function(a,b,
c){var d=a.profile().spelling().get()!==Re.offKey();return{"spelling.general":{toggle:!0,value:"spellcheck",textkey:w.key("cog.spellcheck"),action:function(){var e=(d=!d)?b:Re.offKey();a.profile().spelling().setAndCache(e);c.trigger.change(e)},updateGeneral:function(a){d?a.select():a.deselect()},icon:!1}}},UV=M("area","f"),nk={stop:k("trampoline.stop"),run:function(a){for(;"trampoline.stop"!==a;)a=a()}},bi=sa.generate([{inline:["item","mode","lang"]},{text:["item","mode"]},{empty:["item","mode"]},
{boundary:["item","mode","lang"]},{concluded:["item","mode"]}]),GN=function(a,b,c,d){var e=a.property().isElement(b)?g.from(a.attrs().get(b,"lang")):g.none();return a.property().isText(b)?bi.text(b,c):d(b,c)?bi.concluded(b,c):a.property().isBoundary(b)?bi.boundary(b,c,e):a.property().isEmptyTag(b)?bi.empty(b,c):bi.inline(b,c,e)},uda=function(a,b,c,d){return ua.walk(a,b,c,ua.walkers().right(),void 0).fold(function(){return bi.concluded(b,c)},function(b){return GN(a,b.item(),b.mode(),d)})},HN=function(a,
b,c,d,e,f){return function(){return b.fold(function(b,g,k){(g===ua.advance?d.openInline:d.closeInline)(k,b);return ok(a,b,g,c,d,e,f)},function(b,g){var h=e(a,b);d.addDetail(h);return c(b,g)?nk.stop():ok(a,b,g,c,d,e,f)},function(b,g){d.addEmpty(b);return ok(a,b,g,c,d,e,f)},function(b,g,k){var h=f.assess(b);return bg.cata(h,function(h){return g!==ua.backtrack?ok(a,b,ua.sidestep,c,d,e,f):nk.stop()},function(h){(g===ua.advance?d.openBoundary:d.closeBoundary)(k,b);return ok(a,b,g,c,d,e,f)},function(a){return nk.stop()})},
function(a,b){return nk.stop()})}},ok=function(a,b,c,d,e,f,g){b=uda(a,b,c,d);return HN(a,b,d,e,f,g)},vda={walk:function(a,b,c,d,e,f){var g=function(b,d){return a.eq(b,c)&&(d!==ua.advance||a.property().isText(b)||0===a.property().children(b).length)},k=Fh.nu(d),m=GN(a,b,ua.advance,g);nk.run(function(){return HN(a,m,g,k,e,f)});return k.done()}},wda=ya(["elements","lang","words"],[]),xda={fromWalking:function(a,b){a=F(b,function(a){var b=a.details();a=a.lang();var c=F(b,function(a){return a.text()}).join("");
b=F(b,function(a){return a.item()});c=mJ.words(c);return wda({lang:a,words:c,elements:b})});return{zones:k(a)}}},yda=function(a,b,c,d,e,f){return(a.eq(b,c)?g.some(b):a.property().parent(b)).map(function(g){g=Fh.calculate(a,g).getOr(d);return vda.walk(a,b,c,g,e,f)})},yo=function(a,b,c,d,e,f){b=gd.subset(a,b,c).bind(function(b){return 0===b.length?g.none():yda(a,b[0],b[b.length-1],d,e,f)}).getOr([]);return xda.fromWalking(a,b)},Zu=function(a,b){return function(c,d){return c.eq(d,a.item())?a:c.eq(d,
b.item())?b:$e.detail(c,d)}},IN=function(){return{zones:k([])}},Ig={fromRange:function(a,b,c,d,e){b=Jj.getEdges(a,b,c,k(!1));c=Zu(b.left(),b.right());return yo(a,b.left().item(),b.right().item(),d,c,e)},transformEdges:Zu,fromBounded:function(a,b,c,d,e){return yo(a,b,c,d,$e.detail,e)},fromBoundedWith:yo,fromInline:function(a,b,c,d){b=Jj.byBoundary(a,b);var e=Zu(b.left(),b.right());return b.isEmpty()?IN():yo(a,b.left().item(),b.right().item(),c,e,d)},empty:IN},KN=function(a,b,c,d){return a.property().isBoundary(b)?
Ig.fromBounded(a,b,b,c,d):a.property().isEmptyTag(b)?JN():Ig.fromInline(a,b,c,d)},JN=function(){return Ig.empty()},$u={single:KN,range:function(a,b,c,d,e,f,g){b=Pc.toLeaf(a,b,c);d=Pc.toLeaf(a,d,e);return a.eq(b.element(),d.element())?KN(a,b.element(),f,g):Ig.fromRange(a,b.element(),d.element(),f,g)},empty:JN},LN=gb(),tl={single:function(a,b,c){return $u.single(LN,a,b,c)},range:function(a,b,c,d,e,f){return $u.range(LN,a,b,c,d,e,f)},empty:function(){return $u.empty()}},zy={update:function(a,b,c){var d=
jb(c);A(d,function(d){a.add(b,d,c[d])});return d},getInCache:function(a,b,c){return ka(c,function(c){return a.get(b,c.word()).fold(k(!1),function(a){return a.suggestions().isSome()})})}},zda={anything:k({assess:bg.inView})}.anything(),av=function(a,b,c,d,e,f){a=Ig.fromBoundedWith(a,b,c,d,f,zda).zones();1===a.length?(a=a[0],e=a.lang()===e?g.some(a):g.none()):e=g.none();return e},MN=function(a,b,c,d,e){return av(a,b,c,d,e,$e.detail)},zo={fromRange:function(a,b,c,d,e){var f=Fh.strictBounder(d,e);b=Jj.getEdges(a,
b,c,f);c=Ig.transformEdges(b.left(),b.right());return av(a,b.left().item(),b.right().item(),d,e,c)},fromBounded:MN,fromInline:function(a,b,c,d){var e=Fh.strictBounder(c,d);e=Jj.getEdges(a,b,b,e);var f=Ig.transformEdges(e.left(),e.right());e.isEmpty()?(f=a.property().isText(b)?a.property().getText(b):a.property().children(b).length,e=Pc.toLeaf(a,b,0),b=Pc.toLeaf(a,b,f),a=MN(a,e.element(),b.element(),c,d)):a=av(a,e.left().item(),e.right().item(),c,d,f);return a},empty:function(){return g.none()}},NN=
function(a,b,c,d){return a.property().isBoundary(b)?zo.fromBounded(a,b,b,c,d):a.property().isEmptyTag(b)?zo.empty():zo.fromInline(a,b,c,d)},ON={single:NN,range:function(a,b,c,d,e,f,g){b=Pc.toLeaf(a,b,c);d=Pc.toLeaf(a,d,e);return a.eq(b.element(),d.element())?NN(a,b.element(),f,g):zo.fromRange(a,b.element(),d.element(),f,g)}},PN=gb(),Ada={single:function(a,b,c){return ON.single(PN,a,b,c)},range:function(a,b,c,d,e,f){return ON.range(PN,a,b,c,d,e,f)}},QN=function(a){return ia(a,function(a){return Cc.descendants(a,
C.isText)})},Ao={textnodes:QN,text:function(a){a=QN(a);return F(a,function(a){return C.isText(a)?Oa.get(a):""}).join("")},parsed:function(a,b,c){return g.from(a[0]).bind(function(a){return Ada.single(a,b,c).bind(function(a){a=a.words();return 1===a.length?g.some(a[0]).map(function(a){return a.word()}):g.none()})})},children:function(a){return ia(a,B.children)}},Bda={clobber:function(a,b){var c=Ao.children(a),d=Ao.textnodes(a);return g.from(a[0]).bind(function(e){O.before(e,c);e=g.from(d[0]);e.each(function(a){Oa.set(a,
b)});A(d.slice(1),function(a){Oa.set(a,"")});A(a,E.remove);return e})}},RN=ju.resolve("annotation"),SN=ju.resolve("lingo"),TN=ku.resolve("annotation-wrap"),ci={nu:function(){var a=p.fromTag("span");n.add(a,TN);m.set(a,"aria-invalid","spelling");return Ch.nu(a)},set:function(a,b,c){m.set(a,RN,c);m.set(a,SN,b)},label:k(TN),detail:function(a){return Rf.id(a).bind(function(b){return g.from(m.get(a,RN)).bind(function(c){return g.from(m.get(a,SN)).map(function(a){return{id:k(b),word:k(c),lang:k(a)}})})})}},
Cda=ku.resolve("wrap-disabled"),Dda=function(a){a=Rf.all(a);A(a,function(a){n.remove(a,Cda)})},Eda=M("id","elements","word","lang"),UN={success:function(a){return{fold:function(b,c){c(a)}}},fail:function(a){return{fold:function(b,c){b(a)}}}},Fda=function(a,b){var c={};A(a,function(a){Rf.marker(a,b.label()).filter(fa.inBody).each(function(a){b.detail(a).each(function(b){var d=b.id(),e=b.word();b=b.lang();var f=Rf.all(a);0<f.length&&(c[d]=Eda(d,f,e,b))})})});return c},VN=function(a,b,c,d){var e=Ao.text(a);
a=Ao.parsed(a,c,d);return e===b&&a.is(b)},Gda=function(a,b,c){a=se(a);return F(a,function(a){return a.lang()===c&&VN(a.elements(),a.word(),b,a.lang())?UN.success(a):UN.fail(a)})},Hda={validate:VN,verify:function(a,b,c,d,e){b=Fda(a.elements(),b);a=Gda(b,e,a.lang());A(a,function(a){var b=function(a){return function(b){A(b.elements(),a)}};a.fold(b(d),b(c))})}},WN=function(a){return Rf.marker(a,ci.label())},Up={highlight:function(a,b,c,d){Hda.verify(b,ci,Dda,E.unwrap,a.lang());c=dk.matchWords(b.elements(),
c,d);c=dk.annotates(c,ci.label());return ia(c,function(c){return c.current().fold(function(){var d=c.match(),e=d.word();if(a.ignore(d))return[];d=Ch.wrapper(d.elements(),ci.nu)||[];A(d,function(a){Rf.set(a,c.id());ci.set(a,b.lang(),e)});return[bo.created(d)]},function(a){return[bo.preserved(a)]})})},marker:WN,substitute:function(a,b){a=WN(a).fold(k([]),Rf.all);return Bda.clobber(a,b)},detail:function(a){return ci.detail(a)}},XV={highlight:function(a,b,c,d){var e={operation:a,internal:a,ignore:k(!1),
lang:k(d)},f=F(c,function(a){return a.word()}),g=ka(f,function(a,b){return zc(f,a).filter(function(a){return a===b}).isSome()});e.operation(function(){Up.highlight(e,b,g,k(!1))})}},Ida=function(a,b){return Ba.nu(function(c){var d={words:F(a.words(),function(a){return ai(a.word())})};b.correction(d,a.lang(),function(b){b=N.value({spelling:k(b),zone:k(a)});c(b)},function(a){a=N.error(Error(a));c(a)})})},YV={scan:function(a,b,c){var d=function(b){var c=b.zone(),d=zy.update(a,c.lang(),b.spelling());b=
ka(c.words(),function(a){a=ai(a.word());return V(d,a)});return{zone:k(c),words:k(b)}};c=F(c,function(a){return Ida(a,b)});return tk(c,Ba.nu).map(function(a){a=ia(a,function(a){return a.fold(k([]),Vy)});return F(a,d)})}},By={active:function(a){var b={};a.autocorrect().get(function(a){a.fold(function(a){console.log("Error loading autocorrect list")},function(a){b=a.corrections})});return{lookup:function(a){return b.hasOwnProperty(a)?g.from(b[a]):g.none()}}},inactive:function(){return{lookup:g.none}}},
Jda=Mf([af("language"),af("words")]),$V={many:k(Jda)},Kda=function(a,b){return Pj(a,b).getOrThunk(function(){return Pk()})},bv=Za("good-spelling"),Ay={execute:function(a,b,c,d,e,f){var g=Kda(b,c);f=Rk.multiple(function(b,d){return a.execute({language:c,words:b})},g,d,function(a){return a.spell},aa,e,void 0!==f?f:!1);b[c]=g;return Ce.mapSync(f,function(a){A(d,function(b){a.hasOwnProperty(b)&&void 0!==a[b]&&null!==a[b]||g.set(b,bv,e)});var b={};Ra(a,function(a,c){g.get(e,c).is(bv)||(b[c]=a)});return b})},
initCaches:function(a){var b={};Ra(void 0!==a?a:{},function(a,d){b[d]=Pk(a)});return b},correct:k(bv)},Lda={image:k("1"),spelling:k("1")},XN=function(a,b){return(ce(a,"/")?a:a+"/")+b},bW={corsQuery:function(a){return XN(a,"version")},spelling:function(a){return XN(a,Lda.spelling())+"/"}},pk=function(a){a="data-"+z.resolve(a);return k(a)},de={value:pk("spelling-value"),type:pk("spelling-type"),overflow:pk("spelling-overflow"),overflowMenu:pk("spelling-overflow-menu"),spelling:pk("spelling-suggestion")},
YN=M("primary","secondary","submenus"),Mda=M("value","text","attrs"),Nda=M("textkey","value","items"),gW={generate:function(a,b){if(a.length>b){var c=a.slice(0,b);var d=Mda(de.overflow(),w.translate("spelling.context.more"),{});b=a.slice(b);a={};a[de.overflow()]=de.overflowMenu();b=Nda(w.key("spelling.context.morelabel"),de.overflowMenu(),b);c=YN(c.concat([d]),[b],a)}else c=YN(a,[],{});return c}},fW=M("value","text","attrs"),Dy=ba.detect().browser,lW=ya("communication profile content undo viewable cache url autocorrectOn language fromServiceState multilingual".split(" "),
[]),ZN=function(a){a=p.fromTag(a);var b=p.fromText(fb());y.append(a,b);n.add(a,Eb.styleSpan());return a},$N=function(a,b,c,d){var e=ZN(d);B.firstChild(e).each(function(d){a(c,e);b.setSelection(d,0,d,0)})},aO={nu:ZN,insertAfter:t($N,y.after),insertBefore:t($N,y.before)},bO=ba.detect().browser,cO=function(a,b){return Xa.toLeaf(a,b)},Oda=function(a){return C.isText(a)&&0!==Oa.get(a).trim().length},Pda=function(a){return C.isElement(a)&&"br"===C.name(a)},Qda=function(a){return Va([Oda,Pda],function(b){return b(a)})},
Rda=function(a){return C.isText(a.element())&&0===a.offset()||C.isElement(a.element())},Sda=function(a,b,c){var d=k(a);return(!1===b&&Rda(a)?g.some(!0):g.none()).fold(d,function(b){return mc.seekLeft(a.element(),Qda,c).fold(d,function(a){return W.point(a,C.isText(a)?Oa.get(a).length:0)})})},Tda=function(a,b){return P.eq(a.element(),b.element())},Se={context:function(a){return a.getSelection().bind(function(b){if(b.collapsed()){var c=b.startContainer();return mb.cell(c,a.isRoot).bind(function(d){return mb.table(c,
a.isRoot).map(function(a){return{cell:k(d),table:k(a),start:k(c),selection:k(b)}})})}return g.none()})},selectedCells:function(a,b){return Pb.cata(a.get(),k([]),aa,function(a){var c=bO.isFirefox()?cO(a.startContainer(),a.startOffset()):W.point(a.startContainer(),a.startOffset()),e=bO.isFirefox()?cO(a.endContainer(),a.endOffset()):W.point(a.endContainer(),a.endOffset());a=Sda(e,a.collapsed()||Tda(c,e),b);return He.sharedOne(function(a){return mb.cell(a,b)},[c.element(),a.element()]).toArray()})}},
di={none:function(a){return{fold:function(b,c,d,e){return b(a)}}},first:function(a){return{fold:function(b,c,d,e){return c(a)}}},middle:function(a,b){return{fold:function(c,d,e,f){return e(a,b)}}},last:function(a){return{fold:function(b,c,d,e){return e(a)}}}},dO=function(a,b){return mb.table(a,b).bind(function(b){var c=mb.cells(b);return Ta(c,function(b){return P.eq(a,b)}).map(function(a){return{index:k(a),all:k(c)}})})},Bo={next:function(a,b){return dO(a,b).fold(function(){return di.none(a)},function(b){return b.index()+
1<b.all().length?di.middle(a,b.all()[b.index()+1]):di.last(a)})},prev:function(a,b){return dO(a,b).fold(function(){return di.none()},function(b){return 0<=b.index()-1?di.middle(a,b.all()[b.index()-1]):di.first(a)})}},Jy={upOrLeft:function(a){Se.context(a).each(function(b){Bo.prev(b.cell()).fold(u,function(){wi.isFirstInContent(a,b.table())&&ag.isLeft(b.cell(),b.selection())&&aO.insertBefore(a,b.table(),"p")},u,u)})},right:function(a){Se.context(a).each(function(b){Bo.next(b.cell()).fold(u,u,u,function(){wi.isLastInContent(a,
b.table())&&ag.isRight(b.cell(),b.selection())&&aO.insertAfter(a,b.table(),"p")})})}},DW={widget:function(a){var b=a.content(),c=M("value","icon","textkey"),d=c("aligntop",g.some(na.resolve("aligntop")),w.key("table.cell.alignment.top")),e=c("alignmiddle",g.some(na.resolve("alignmiddle")),w.key("table.cell.alignment.middle"));c=c("alignbottom",g.some(na.resolve("alignbottom")),w.key("table.cell.alignment.bottom"));var f=[d,e,c];d=function(a){return function(b){v.set(b,"vertical-align",a)}};var h=
{aligntop:d("top"),alignmiddle:d("middle"),alignbottom:d("bottom")},l=g.none(),m=function(a,b){a.enable();return v.getRaw(b,"vertical-align").fold(function(){return wa.on("aligntop")},function(a){return"middle"===a?wa.on("alignmiddle"):"bottom"===a?wa.on("alignbottom"):wa.on("aligntop")})};return{name:"cell-alignment",textkey:w.key("table.cell.alignment.toolbar"),menuTextkey:w.key("table.cell.alignment.toolbar"),action:function(c){b.focus();var d=Se.selectedCells(a.selections(),b.isRoot);A(d,h[c]);
b.uiChanged()},updateDropdown:function(c){var d=Se.selectedCells(a.selections(),b.isRoot);0<d.length?d=m(c,d[0]):(c.disable(),d=wa.off());c.populate([{label:g.none,items:k(f)}]);Gk.updateMenu(c,d,wa.on(),f,l)},values:f,render:l,tooltip:ib.get,toggle:!1,describe:function(a){return w.translate("alignment.describe",w.get(a.textkey()))}}}},Uda={cssNamespace:"table-cell-border",i18nNamespace:"table.cell.border",property:"border-width",tag:"table",specials:[["thin","medium","thick"]]},CW={widget:function(a){var b=
a.content(),c=fl(Uda);c.initLayout();T.dialog(c.element(),w.translate("aria.table.cell.border.size"));var d=G.create({done:q([]),abort:Q([],c.events.abort)});c.events.close.bind(function(a){d.trigger.done();b.focus()});c.events.action.bind(function(c){var d=Y.active();b.focus();var e=Se.selectedCells(a.selections(),b.isRoot);A(e,function(a){v.set(a,"border-width",c.value());v.getRaw(a,"border-style").fold(function(){v.set(a,"border-style","solid")},u)});b.domChanged();d.each(Y.focus)});var e=function(){c.enter();
c.open()};return{element:c.element,destroy:c.destroy,name:k("cellborderwidth"),textkey:k(w.key("table.cell.border.width")),tooltip:ib.get,label:k(!1),updateWidget:function(d){var f=Se.selectedCells(a.selections(),b.isRoot);0<f.length?(d.enable(),d=v.getRaw(f[0],"border-width").fold(wa.off,wa.on),c.updateInlineWidget({size:k(d)},"1px")):d.disable();e()},events:d.registry,open:e,close:c.close}}},Vda=ya(["name","textkey","menuTextkey","action","shortname"],[]),Hy={widget:function(a,b,c){var d=Vda(c),
e=a.content();c=S.div();T.label(c,w.translate(d.textkey()));ja.add(c,[z.resolve("palette-cell-colors"),z.resolve(d.shortname()+"-cell-colors")]);var f=Ci.create(b.colors.buttons);y.append(c,f.element());b="."+z.resolve(d.shortname()+"-cell-colors")+" ."+z.resolve("palette-detail-action")+":not(."+z.resolve("palette-color-option-spacer")+")";var g=Ci.makeLayout(c,b,{});b=g.layout();var l=G.create({done:q([]),abort:q([])});f.events.selected.bind(function(b){b=b.value();var c=Se.selectedCells(a.selections(),
e.isRoot);d.action()(c,b);l.trigger.done()});var m=function(){n.enter();g.refresh()},n=Nv(c,[b]);n.events.exit.bind(function(){l.trigger.abort()});return{element:k(c),destroy:function(){n.destroy();f.destroy()},name:k(d.name()),textkey:k(w.key(d.textkey())),tooltip:ib.get,label:k(!1),updateWidget:function(b){gi.isHighContrast(a.smartview())?b.disable():(0===Se.selectedCells(a.selections(),e.isRoot).length?b.disable():b.enable(),m())},events:l.registry,open:m,close:function(){l.trigger.done()}}}},
Wda={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"},percentages:!0},Xda=function(a,b,c,d,e){void 0===e&&(e=Wda);var f=p.fromTag("table");v.setAll(f,e.styles);m.setAll(f,e.attributes);var g=p.fromTag("tbody");y.append(f,g);for(var k=[],n=0;n<a;n++){for(var q=p.fromTag("tr"),t=0;t<b;t++){var u=n<c||t<d?p.fromTag("th"):p.fromTag("td");t<d&&m.set(u,"scope","row");n<c&&m.set(u,"scope","col");y.append(u,p.fromTag("br"));e.percentages&&v.set(u,"width",100/b+"%");y.append(q,u)}k.push(q)}O.append(g,
k);return f},Yda={insert:function(a,b,c,d,e){return a.getSelection().bind(function(f){var h=Xda(b,c,d,e);bd.insertAtCursor(a,[h]).each(function(b){mb.firstCell(h).each(function(b){a.setSelection(b,0,b,0)})});return g.some(h)})}},Zda=dd.resolve("table-picker"),$da=dd.resolve("table-picker-row"),aea=dd.resolve("table-picker-cell"),bea=dd.resolve("table-picker-button"),jg={table:k(Zda),row:k($da),cell:k(aea),button:k(bea)},cea="."+jg.cell(),dea="."+jg.row(),vf={cells:function(a){return ca.descendants(a,
cea)},rows:function(a){return ca.descendants(a,dea)},grid:function(a,b,c){b=parseInt(m.get(a,b),10);a=parseInt(m.get(a,c),10);return Ha.grid(b,a)},button:function(a){return L.child(a,"."+jg.button()).getOr(a)}},eO=function(a,b,c,d,e){d=Math.max(d,Math.min(e,a.row()));a=Math.max(b,Math.min(c,a.column()));return Ha.address(d,a)},fO=function(a,b){a=eO(a,1,b.maxCols,1,b.maxRows);var c=Ha.address(a.row()+1,a.column()+1);b=eO(c,b.minCols,b.maxCols,b.minRows,b.maxRows);return{selection:k(a),full:k(b)}},
Fy={resize:function(a,b){a=Ha.address(a.row()+1,a.column()+1);return fO(a,b)},grow:function(a,b,c,d){a=Ha.address(a.rows()+c,a.columns()+b);return fO(a,d)}},gO=function(a,b,c,d){var e=a.width()/b.columns();a=a.height()/b.rows();return Ha.address(Math.floor(d/a),Math.floor(c/e))},eea={pickerCell:function(a,b,c,d){var e=d.x()-a.x();a=d.y()-a.y();return gO(b,c,e,a)},isRtl:k(!1)},fea={pickerCell:function(a,b,c,d){var e=a.x()+b.width()-d.x();a=d.y()-a.y();return gO(b,c,e,a)},isRtl:k(!0)},BW={widget:function(a,
b){var c=a.content(),d=qW(a.region().uiDirection().isRtl()?fea:eea,b),e=a.undo();a=G.create({done:Q([],d.events.done),abort:Q([],d.events.abort)});d.events.select.bind(function(a){e.save();Yda.insert(c,a.rows(),a.cols(),a.rowHeaders(),a.columnHeaders()).each(function(a){e.save();c.domChanged()});c.toEditing()});return{element:d.element,name:k("table"),textkey:k(w.key("insert.table")),menuTextkey:k(w.key("table.menu")),tooltip:ib.get,label:k(!1),updateWidget:function(a){c.getSelection().each(function(b){a.enable()});
d.open()},destroy:d.destroy,events:a.registry,open:d.open,close:d.close}}},Mi={set:function(a,b){a.dom().checked=b},find:function(a){return L.descendant(a,"input:checked")}},hO=ya(["floatval","caption","summary","border","dimensions"],[]),gea=function(a){a=m.get(a,"border");return"0"===a||"1"===a?g.some(a):g.none()},hea=function(a){var b=v.getRaw(a,"width");a=v.getRaw(a,"height");return{width:k(b),height:k(a)}},Wp={divine:function(a,b){var c=ys.divine(b),d=m.get(b,"summary"),e=L.child(b,"caption").map(function(b){b=
Ca.get(b);return a.filterHtml(a.output(),b)}).getOr(""),f=gea(b);b=hea(b);return hO({floatval:c,caption:e,summary:d,border:f,dimensions:b})},properties:hO,apply:function(a,b){b.floatval().each(function(b){wg.runFloat(a,b)});b.border().each(function(b){m.set(a,"border",b)});""===b.summary()?m.remove(a,"summary"):jf.setSummary(a,b.summary());""===b.caption()?L.child(a,"caption").each(E.remove):jf.setCaption(a,b.caption());jf.setDimensions(a,b.dimensions())}},Xp={halve:function(a,b){fc.getGenericWidth(a).each(function(c){var d=
c.width()/2;fc.setGenericWidth(a,d,c.unit());fc.setGenericWidth(b,d,c.unit())})}},iO=function(a,b,c,d){return c.fold(g.none,g.none,function(a,b){return ac.first(b).bind(function(a){return g.some(Ec(a,0,a,0))})},function(c){return mb.table(c,b.isRoot).bind(function(e){pc.execute(a,dc.insertRowAfter,u,d)(b,e,ul.noMenu(c));e=ca.descendants(e,"tr");if(0<e.length)return L.descendant(e[e.length-1],"td,th").map(function(a){return Ec(a,0,a,0)})})})},Iy={forward:function(a,b,c,d){return iO(a,b,Bo.next(c),
d)},backward:function(a,b,c,d){return iO(a,b,Bo.prev(c),d)}},Gy={setBorderColor:function(a,b){v.set(a,"border-color",b);v.getRaw(a,"border-style").fold(function(){v.set(a,"border-style","solid")},u)},setBackgroundColor:function(a,b){v.set(a,"background-color",b)},setHeight:function(a,b){v.set(a,"height",b)},setWidth:function(a,b){v.set(a,"width",b)},setType:function(a,b){b=Gc.copy(a,b);y.after(a,b);E.remove(a)},setScope:function(a,b){m.set(a,"scope",b)},setStyle:function(a,b){m.set(a,"style",b)},
setClass:function(a,b){m.set(a,"class",b)}},yW=dd.resolve("resizer-bar-dragging"),iea=M("withSpaces","withoutSpaces"),jea=function(a){return ka(a.split(/[\.,-\/#!$%\^&\*;:{}=\-_`~()\s\u00A0]/gim),function(a){return 0<a.length}).length},Ky={count:function(a){return{words:k(jea(a)),characters:k(iea(a.length,a.replace(/[\s\u00A0]/gim,"").length))}}},JW=ya("accessibility formatting alignindent bookmark directionality table font parlance media imageEdit blocktag specialchar wordcount link linkvalidator horizontalrule help fileupload findreplace plaincodeview macros spelling".split(" "),
[]),Co=0,cv=g.none(),$p={add:function(){if(0===Co){var a=p.fromTag("style");Mb.set(a,'/*\n * Keep this file as small as possible.\n * It is injected into the JavaScript, so it needs to be tiny.\n */\n\n/*\n * Animate from 0 to 359, not 0 to 360, as they are the same and FireFox does nothing\n *\n * Until we have token replacement, manual shorthand for "ephox-polish-spin"\n */\n\n@keyframes e-p-spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(359deg);\n  }\n}\n\n/* Until we have token replacement, manual shorthand for "ephox-polish-spinner-img" */\n\n.e-p-s-img {\n  animation: e-p-spin 2s infinite linear;\n  width: 30px;\n  height: 30px;\n  margin: 2px 2em 0 auto;\n  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAIVBMVEUAAABAQEBDQ0NERERERERCQkJDQ0NERERDQ0NEREREREQTPu3mAAAACnRSTlMAENDPwGBwsKB/qy4kVgAAAFpJREFUCNdjAAImAwYI4FoApooFuBYwWgAZXoZMCsJLgAyhpQwMUYpABmMiA4OYAAMCaC2GklqLwIxFMAmoYkmQYmGQdkOQgYpMBkIgA4tAVmggLAU7QwFIAADjyQ3FWhtneAAAAABJRU5ErkJggg==") 0/cover;\n}');
y.append(fa.body(),a);cv=g.some(a)}Co++},remove:function(){0!==Co&&0===--Co&&(cv.each(E.remove),cv=g.none())}},kea=Yb.pencil(),Do=Yb.code(),jO=function(a){var b=a.old().toTransfer();a.nu().fromTransfer(b)},lea={transition:jO,factory:tv,style:Yb.pencil},mea={transition:jO,factory:vl,style:Yb.code},wl={goingToDesign:function(a){return a===Do},alternate:function(a){return a===Do?kea:Do},detect:function(a){return a===Do?lea:mea}},NW=function(a,b){return{destroy:u,init:u,setMode:yb("Code view is not enabled, cannot switch modes"),
events:G.create({change:q([]),ready:q([])}).registry}},MW=function(a,b){var c=b.css+"/codemirror.css",d=G.create({change:q([]),ready:q(["type"])}),e=g.none(),f=function(){var a=vk.load.codeview(b.js).map(function(a){return a.map(k(!0))});e=g.some(a)},h=function(a){a(N.value(!0))};return{init:function(a){e.fold(function(){Fl.addStylesheet(c,h).get(function(b){b.fold(function(a){console.error(a);console.error("Code View disabled due to error loading stylesheet")},function(){f();d.trigger.ready(a)})})},
function(b){d.trigger.ready(a)})},setMode:function(b){return e.fold(function(){throw"Cannot set mode before Code View has loaded";},function(c){c.get(function(c){c.fold(function(a){d.trigger.ready(b);console.error(a);console.error("Code View non-functional due to error downloading script file")},function(){var c=wl.detect(b),e=a.swap(c.factory,{},{});d.trigger.change();c.transition(e);e.destroy()})})})},events:d.registry,destroy:u}},My=ba.detect().browser,RW={build:function(a,b,c,d,e,f,g,l){var h=
PW(a,b,c,f,g,l),m=d.full(h);m.init();return{element:h.element,socket:h.socket,viewport:h.viewport,uiContainerParent:h.uiContainerParent,init:function(b,d,g){d=m.config(a.isInline(),d,e,g);OB.setup(h,f,a,b,c,d);m.loaded()},connect:h.connect,destroy:function(){h.destroy();m.destroy()},displayBanner:h.displayBanner,hideBanner:h.hideBanner,position:u,refresh:h.refresh,tabstrip:h.toolbar,state:k(l),dialogContainer:h.dialogContainer}},bounds:function(){return We.view}},kO={blobTob64:function(a,b){var c=
m.get(b,ic.blobId());m.remove(b,ic.blobId());a.get(c).each(function(a){m.remove(b,ic.blobId());m.set(b,"src",Lc.imageResultToDataURL(a.imageresult()))})},b64ToBlob:function(a,b){var c=m.get(b,"src"),d=function(){return Fi.dataUriToBlobSync(c).map(function(b){var d=Lc.fromBlobAndUrlSync(b,c);b=wf.createObjectURL(b);var e=Za("image");return a.add(e,d,b)})};try{a.lookupByData(c).fold(d,g.some).each(function(a){m.set(b,ic.blobId(),a.id());m.set(b,"src",a.objurl())})}catch(e){console.warn("Unable to read Base64 image data: ",
e,c)}}},eX={configure:function(a,b){var c=ic.blobId(),d="img["+c+"]";a.addSelector(a.internal(),d,Ka.removeAttr(c));a.addSelector(a.output(),d,function(a){A(a,function(a){kO.blobTob64(b,a)})});a.addSelector(a.input(),"img:not(["+c+"])[src]",function(a){A(a,function(a){kO.b64ToBlob(b,a)})});c=Ka.removeClass(ic.uploadInProgress());a.add(a.output(),ic.uploadInProgress(),c);a.add(a.history(),ic.uploadInProgress(),c);a.add(a.internal(),ic.uploadInProgress(),c);d=ic.trackedImage();c="img["+d+"]";d=Ka.removeAttr(d);
a.addSelector(a.output(),c,d);a.addSelector(a.internal(),c,d)},blobId:ic.blobId},lO=M("image","blobInfo"),dv=sa.generate([{failure:["error"]},{success:["result","images","blob"]}]),oea=function(a,b,c,d){A(b,function(a){m.set(a,"src",d.location);m.remove(a,ic.blobId())});return nea(a,c)},mO=function(a,b,c,d,e){var f=Lc.imageResultToDataURL(c);f=a.lookupByData(f).getOrThunk(function(){return a.add(b,c,d)});m.set(e,ic.blobId(),f.id());return lO(e,f)},pea=function(a,b){var c=m.get(b,ic.blobId());return a.get(c).fold(function(){return N.error(c)},
function(a){return N.value(lO(b,a))})},nea=function(a,b){return a.get(b).fold(function(){return N.error("Internal error with blob cache")},function(c){a.remove(b);return N.value(c)})},Qi={prepareForUpload:function(a,b,c){var d=a.isActive(b);a.register(c,b);n.add(c,ic.uploadInProgress());return d?g.none():g.some(b)},handleUpload:function(a,b,c,d,e,f,g){var h=function(){console.error("Internal error with blob cache",e);g(dv.failure({status:k(666)}))};a.upload(f,e,function(a){var f=b.findById(d,e);A(f,
Ue.removeClass(ic.uploadInProgress()));a.fold(function(a){g(dv.failure(a))},function(a){oea(c,f,e,a).fold(h,function(b){g(dv.success(a,f,b))})});b.report(e,f,a.isValue())})},registerAssets:function(a,b,c){return ia(c,function(c){return Bc.cata(c,function(c,d,g){return L.descendant(b,'img[src="'+g+'"]').fold(function(){return[N.error("Image that was just inserted could not be found: "+g)]},function(b){return[N.value(mO(a,c,d,g,b))]})},k([]))})},registerBlob:mO,findBlobs:function(a,b,c){c=a.findAll(c);
return a.inProgress()?[]:F(c,function(a){return pea(b,a)})}},qea=function(a){var b=function(b){var c=b.image(),e=b.blobInfo(),f=Ap.changedBounds(c);e=La.fromPromise(Lc.imageResultToOriginalBlob(e.imageresult()));return La.bind(e,function(d){return zi.resampleAction(f,d,function(e){if(e===d)return La.pure(b);var f=Oe.updater(Oe.keepResample,c),g=Cp.applyEdit(c);e=oe.single(e).bind(g).map(f);return La.map(e,function(d){return Bc.cata(d,function(b,d,e){return Qi.registerBlob(a,b,d,e,c)},function(a,c,
d){return b})})})})};return function(a){return ae(a,b)}},rea=function(a){a=F(a,N.value);return Ba.pure(a)},dX={instance:function(a,b){return!0===a.immediate?rea:qea(b)}},sea={400:"errors.http.400",401:"errors.http.401",403:"errors.http.403",404:"errors.http.404",407:"errors.http.407",409:"errors.http.409",413:"errors.http.413",415:"errors.http.415",500:"errors.http.500",501:"errors.http.501"},tea={get:function(a,b){return g.from(sea[a]).map(function(a){return w.translate(a,b)})}},uea=function(a){return ta(a)&&
""!==a.trim()?{description:k(a),link:k(null)}:Ge.get("error.imageupload.generic")},vea=function(a,b){var c=b.status();return tea.get(c,a).fold(function(){var b=0===c?"error.imageupload.cors":400<=c&&500>c?"error.code.images.not.found":"error.imageupload";return Ge.get(b,[a])},function(a){return{description:k(a),link:k(null)}})},nO=function(a,b){return{instance:function(){return Xb(function(c){c=b(c);a.show(c)})}}},oO={simple:function(a){return nO(a,uea)},url:function(a,b){return nO(a,t(vea,b))}},
wea=["jpg","png","gif","jpeg"],Pi={failureObject:M("message","status","contents"),getFilename:function(a,b){ta(a.name)&&!ce(a.name,".tmp")?b=a.name:ta(a.type)&&Ab(a.type,"image/")&&(a=a.type.substr(6),b=V(wea,a)?b+"."+a:b);return b},buildData:function(a,b,c){var d=new (vc.getOrDie("FormData"));d.append(a,b,c);return d}},VW=M("id","filename","blob","base64"),pO={direct:function(a){return TW(a)},custom:function(a){return UW(a)}},ev=M("uploader","errors"),cX={choose:function(a,b,c){return!0!==a.bundled?
ev({upload:yb},{instance:k(yb("Image Upload is disabled"))}):wb(a.handler)?ev(pO.custom(a.handler),oO.simple(b)):ev(pO.direct(a.direct),oO.url(b,a.direct.url))}},XW=M("id","imageresult","objurl"),xl=ic.trackedImage(),$W=function(a,b){return ca.descendants(a,"img["+xl+'="'+b+'"]')},aX=function(a){return ca.descendants(a,"img:not(["+xl+"])["+ic.blobId()+"]")},xea={settings:function(a){var b={ui:{toolbar:{display:!1}},spelling:{bundled:!1},highlighter:{bundled:!1},table:{bundled:!1},resize:{bundled:!1},
codeview:{bundled:!1},imageEdit:{bundled:!1},imageupload:{immediate:!0},linkvalidator:{bundled:!1}};b=ba.detect().deviceType.isTouch()?b:{};return cb(b,void 0===a.content||void 0===a.content.inline?{}:{fullscreen:{bundled:!1},codeview:{bundled:!1},plaincodeview:{bundled:!1}})}},Py={isRtl:k(!1)},Oy={isRtl:k(!0)},hX=function(a){return Va(["ar","fa","he"],function(b){return Ab(a,b)})},jX=function(a){return cb(Qy.settings(a.resources),a,xea.settings(a))},qO=function(a,b,c){var d=dA.withOptions(a,c);d.content&&
d.content.tabindex&&(0,m.remove)(a,"tabindex",d.content.tabindex);c=cq(d,{});var e=Ca.get(a),f=m.get(a,"style");b(a);Ca.set(a,"");c.connect(a);ld.set(c,e);return{polish:c,restore:function(b){Ca.set(a,b);null!==f&&void 0!==f&&0<f.length?m.set(a,"style",f):m.remove(a,"style");d.content&&d.content.tabindex&&(0,m.set)(a,"tabindex",d.content.tabindex);return a}}},rO={replace:function(a,b){return qO(a,b.content&&!0===b.content.autoresize?MY:LY,b)},takeover:function(a,b){return qO(a,u,b)}},Bb=function(a,
b){var c={};if(void 0===a)return c;A(b,function(b){var d=b.name();d=a[d];void 0!==d&&(b.validate(d),c[b.output()]=Gb(b.contents)?Bb(d,b.contents):d)});return c},yea=function(a){return F(void 0===a?[]:a,function(a){var b=Bb,d=X.string("prefix"),e=X.string("suffix");var f=[X.string("color"),X.string("background-color")];f=ra(X.object("style"),{contents:f});return b(a,[d,e,f])})},zea=function(a){if(void 0===a||void 0===a.url)return{service:!1};var b=sO(a,"autocorrect",!0);if(ta(a.url))return{url:a.url,
service:!0,autocorrect:b};throw Error("Spelling URL was not a string");},Aea=function(a){if(void 0===a||void 0===a.validation||void 0===a.validation.url)return{};if(ta(a.validation.url))return{url:a.validation.url,bundled:!0};throw Error("Link Validation URL was not a string");},Bea=function(a){if(void 0===a||void 0===a.embed||void 0===a.embed.url)return{};if(ta(a.embed.url))return{url:a.embed.url,bundled:!0};throw Error("Link Embed URL was not a string");},Cea=function(a,b){b=!1===b?!0:!1;a=(void 0===
a?{}:a).upload;if(void 0!==a){if(void 0!==a.handler){if(!wb(a.handler))throw Error("Image Upload Handler was not a function");return{handler:a.handler,immediate:b,bundled:!0}}if(!ta(a.url))throw Error("Image Upload URL was not a string");return{direct:Bb(a,[X.string("url"),X.string("basePath"),X.bool("credentials")]),immediate:b,bundled:!0}}return{}},Dea=function(a){a=Bb((void 0===a?{}:a).editing,[X.bool("enabled"),X.string("proxy"),X.number("preferredWidth"),X.number("preferredHeight")]);void 0!==
a.enabled&&(a.bundled=a.enabled);return a},sO=function(a,b,c){if(void 0===a[b])return c;X.bool(b).validate(a[b]);return a[b]},Eea=function(a){return Bb((void 0===a?{}:a).toolbar,[X.arrayOfToolbarGroups("items"),X.arrayOfStrings("contextual")])},Fea=function(a){if(void 0===a)return{};if(void 0===a.toolbar)var b={};else{var c=a.toolbar;if(void 0!==c.offset){c=c.offset;if(!Zb(c)||void 0===c.top||void 0===c.left)throw Error("toolbar offset must be an object with left and top");if(!df(c.top)&&!df(c.left))throw Error("toolbar offset values must be numbers");
b={draggable:!0,offset:{left:c.left,top:c.top}}}else b={}}c=Bb(a.toolbar,[X.bool("visible"),X.bool("draggable"),X.bool("sticky")]);b=cb(b,c);return void 0===c.sticky&&!0===a.autoresize?cb(b,{sticky:!0}):b},Gea=function(a){if(void 0!==a){if(!ta(a))throw Error("The basePath configuration value was not a string");return Zi(a,"/")}},Hea=function(a){if(void 0===a||void 0===a.fonts)return[];a=a.fonts;if(!Gb(a))throw Error("The fonts configuration was not an array");var b=function(a,b){console.error(a+" :",
b);throw Error(a);};return F(a,function(a){if(ta(a))return{value:a,text:a};Zb(a)||b("The fonts array value was not a string or object",a);void 0!==a.value&&ta(a.value)||b("The font value configuration was not a string or is undefined",a);void 0===a.text||ta(a.text)||b("The font text configuration was not a string",a);return{value:a.value,text:a.text&&0<a.text.length?a.text:a.value}})},Jea=function(a){if(void 0===a||void 0===a.colors)return{};var b=Bb(a.colors,[X.bool("custom")]);void 0!==a.colors.buttons&&
(b.buttons=Iea(a.colors.buttons));return b},Iea=function(a){if(!Gb(a))throw Error("The colors button configuration was not an array");var b=function(a,b){console.error(a+" :",b);throw Error(a);};return F(a,function(a){if(ta(a))return{value:a,text:a};Zb(a)||b("A buttons array value was not a string or object",a);void 0!==a.value&&ta(a.value)||b("The color button value configuration was not a string or is undefined",a);void 0===a.text||ta(a.text)||b("The color button text configuration was not a string",
a);return{value:a.value,text:a.text&&0<a.text.length?a.text:a.value}})},Kea=function(a){a=Bb(void 0===a?{}:a,[X.bool("enabled"),X.bool("showButton")]);return{bundled:void 0===a.enabled||!0===a.enabled,showButton:void 0===a.showButton||!0===a.showButton}},Lea=function(a){a=ra({allowLocal:!0},void 0===a?{}:a);X.bool("allowLocal").validate(a.allowLocal);return a.allowLocal},Mea=function(a){a=Bb(void 0===a?{}:a,[X.arrayOfStrings("languages")]);return void 0===a.languages?{}:{languages:F(a.languages,function(a){return a.toLowerCase()})}},
Nea=function(a){void 0!==a.styles&&(a.styles=ka(a.styles,function(a){a=a.rule;return!(void 0===a||"."===a||0<=a.indexOf("..")||0<=a.indexOf("#"))}))},Oea=function(a,b,c){return"plain"===a?{forceText:!0}:{officeStyles:"retain"===a?"merge":void 0!==a?a:"prompt",htmlStyles:"retain"===a?"merge":void 0!==a?a:"merge",allowLocalImages:c,enableFlashImport:!1===b?!1:!0}},Pea=function(a){a=Bb(a.macros,[X.arrayOfStrings("allowed")]);void 0!==a.allowed&&(a.allowed=g.some(a.allowed));return a},nX=function(a){var b=
Bb(a,[X.arrayOfStrings("plugins")]);b=void 0===b.plugins?[]:b.plugins;var c=Bb(a.ui,[X.string("locale","code")]),d=sO(a,"autosubmit",!0),e=Bb(a.content,[X.arrayOfObjects("highlighters")]),f=Bb(a.paste,[X.string("style"),X.bool("enableFlashImport")]),g=function(){var b=Bb(a.css,[X.arrayOfStrings("stylesheets"),X.string("documentStyles"),X.bool("showDocumentStyles")]),c=Bb(a.ui,[X.bool("autoresize")]);return ra(b,c)}(),k=Bb(a.css,[X.arrayOfObjects("styles"),X.bool("showDocumentStyles")]);Nea(k);var m=
Bb(a.ui,[X.bool("shortcuts","features")]),n=Mea(a.ui),p=Kea(a.codeview),q=zea(a.spelling),t=Aea(a.links),u=Bea(a.links),v=Lea(a.images),w=Dea(a.images),y=v?Cea(a.images,w.bundled):{},z=Eea(a.ui),A=Fea(a.ui),B=Gea(a.basePath),C=Hea(a.ui),E=Jea(a.ui),F=function(){var b=Bb(a.ui,[X.string("aria-label","editorName"),X.bool("autoresize")]);return ra(b,{locale:c,toolbar:A})}(),G=Pea(a);return{resources:B,plugins:b,spelling:q,linkvalidator:t,embed:u,font:{faces:C,colors:E},table:{colors:E},macros:G,ui:F,
shortcuts:m,autosubmit:d,highlighter:{external:yea(e.highlighters)},smartclipboard:{paste:Oea(f.style,f.enableFlashImport,v)},parlance:n,content:g,imageEdit:w,imageupload:y,blocktag:k,fileupload:{allowLocalImages:v},platform:{toolbar:z,allowLocalImages:v},plaincodeview:{bundled:p.bundled},codeview:p}},Qea={getPath:function(a){var b=document.getElementsByTagName("script");return va(gq(b),function(b){return b.src.indexOf(a)===b.src.length-a.length}).map(function(b){return b.src.substring(0,b.src.indexOf(a))}).getOr(void 0)}},
tO=Xb(function(){return g.from(Qea.getPath("textboxio.js")).map(function(a){return Zi(a,"/")})}),uO=function(a){return a+"/resources"},Sy={setupResources:function(a){return g.from(a.resources).orThunk(tO).map(uO).fold(yb("basePath auto detection failed, please provide one in the editor configuration"),function(b){b=Ri.load(b);return cb(a,{resources:b})})},speculate:function(a){g.from(a).orThunk(tO).map(uO).each(Ri.load)}},Rea=function(a,b,c){var d=function(){var a=p.fromDom(document.activeElement);
b(a)&&c()};return J.bind(a,"blur",function(){setTimeout(d,200)})},Sea=function(a,b,c){return J.bind(a,"focusout",function(a){vO(a,b)&&c()})},Tea=function(a,b,c){return J.bind(a,"blur",function(a){vO(a,b)&&c()})},Uea=function(){var a=ba.detect();return a.browser.isFirefox()?Rea:a.browser.isIE()?Sea:Tea}(),vO=function(a,b){a=g.from(a.raw().relatedTarget).getOr(document.activeElement);return b(p.fromDom(a))},Vea={register:function(a,b,c,d){var e=J.bind(a,"focus",function(a){Y.hasFocus(a.target())&&c()}),
f=Uea(a,function(c){return!ed.closest(c,function(c){return P.eq(a,c)||P.eq(b(),c)||n.has(c,Qx.magicBox())})},d);return{destroy:function(){e.unbind();f.unbind()}}}},re={replace:function(a,b){b=cb(b,{content:{inline:a}});var c=m.clone(a),d=cq(b),e=kX(d.element,a,c),f=Ho(e.toolbarHide,e.toolbarShow,!1),g=function(){var a=e.isVisible();f.on();!1===a&&d.activateInline()},k=function(){d.deactivateInline();f.off()},n=Vea.register(a,d.element,g,k);b=function(){Y.active().each(function(b){P.eq(b,a)||k()})};
b();d.events.connected.bind(b);d.events.loaded.bind(function(){d.content().getSelection().bind(g)});var p=d.focus;b={polish:ra(d,{focus:function(){g();p()}}),restore:function(b){n.destroy();e.restore();Ca.set(a,b);return a}};d.connect(fa.body());ld.set(d,Ca.get(a));return b}},Wea={attach:function(a,b,c,d){if(4!==arguments.length)throw"requires 4 parameters";var e=function(b){return function(){var c=p.fromTag("input");m.setAll(c,{type:"hidden",name:b});a.append(c.dom());return function(a){c.val(a)}}},
f=c.getOrThunk(e(b)),g=d.getOrThunk(e(b+"_styles"));return function(a){f(a.content);g(a.styles)}}},wO=function(a,b){var c=a.onsubmit,d=lX(a);a.onsubmit=function(e){if(d.inprogress())return!0;b(function(){c&&!1===c.apply(a)||setTimeout(d.submit,0)});return!1};return{unbind:function(){a.onsubmit=c}}},Xea={attachToFormSubmit:wO,attachToParentFormSubmit:function(a,b,c,d,e){if(5!==arguments.length)throw"requires 5 parameters";var f=a.parents("form:first");if(0!==f.size()){var g=f.get(0),k=Wea.attach(f,
b,d,e);wO(g,function(a){k(c());a()})}}},Zea=function(a,b,c,d){v.set(b,"display","none");var e=cq(dA.withOptions(b,d)),f=da.get(b);e.connect(a);ld.set(e,f);var h=!0===d.autosubmit?Yea(b,e):g.none();return{polish:e,restore:function(d){h.each(function(a){a.unbind()});da.set(b,d);c.fold(function(){v.remove(b,"display")},function(a){v.set(b,"display",a)});E.remove(a);return b}}},Yea=function(a,b){return L.closest(a,"form").map(function(c){return Xea.attachToFormSubmit(c.dom(),function(c){b.uploadImages(function(){da.set(a,
ld.get(b));c()})})})},oX={textarea:{replace:function(a,b){var c=v.getRaw(a,"display");return B.parent(a).fold(function(){return null},function(){var d=m.get(a,"id");d=d?"ephox_"+d:Za("ephox");var e=p.fromTag("div");m.set(e,"id",d);v.copy(a,e);(b.content&&!0===b.content.autoresize?KY:JY)(a,e);y.before(a,e);return Zea(e,a,c,b)})}},div:rO,body:{replace:function(a,b){b=cb(b,{platform:{fillscreen:!0}});a=rO.takeover(a,b);return{polish:a.polish,restore:a.restore}}}},pX={div:re,blockquote:re,article:re,
aside:re,figure:re,figcaption:re,footer:re,header:re,nav:re,section:re},qk=function(a){return{name:a.name,required:Sc,validate:a.validate}},yl={bool:Db(qk,X.bool),func:Db(qk,X.func),number:Db(qk,X.number),object:Db(qk,X.object),string:Db(qk,X.string)},fv=function(a){return N.error("ERROR: Textbox.io requires "+a+" or above")},gv=ba.detect().os,rk=ba.detect().browser,xO="CSS1Compat"===document.compatMode||document.doctype&&"html"===document.doctype.name,$ea={supported:function(){if(rk.isIE()&&11>rk.version.major)return fv("Internet Explorer 11");
if(gv.isOSX()&&rk.isSafari()&&9>rk.version.major)return fv("Safari 9");if(gv.isiOS()&&9>gv.version.major)return fv("iOS 9");if(!xO&&rk.isIE())return N.error("ERROR: Document is not in standards mode. Textbox.io requires standards mode on Internet Explorer.");xO||void 0===console.warn||console.warn("WARNING: Document is not in standards mode. Textbox.io may experience user interface issues.");return N.value(void 0)}},yO=function(a){qf.textboxio=a},afa=Db(yO,function(a){a=yb(a);return{replace:a,replaceAll:a,
inline:a,inlineAll:a,get:a,getActiveEditor:a,definePlugin:a,version:hv,isSupported:Sc}});(function(){var a=qf.install;qf.install=function(b,c){qf.install=a;$ea.supported().fold(afa,function(){var a=null===c||void 0===c?{onprem:!0}:c;a=null===b||void 0===b?a:cb(a,{resources:b});yO(qX(a));Sy.speculate(a.resources)})}})()})();
install();
